import{n as T,S as E,B as L,i as b,z as M,a7 as d,y as N,ad as t,N as l,r as A,j as p}from"./index-nY2QEa15.js";import{c as g,C as R}from"./CustomerCard-DxW_j6h4.js";import{u as U}from"./useToast-C0Zq5D0u.js";import{S as O}from"./SheContextSidebar-C9XHDPKZ.js";import"./types-Cye8Ba1V.js";import"./form-rR3P5XEK.js";import"./SheInput-DACYsg9p.js";import"./useAppTranslation-U95Zo56s.js";import"./chevron-up-CNFSe4zU.js";import"./ComponentViewEnum-Ba6F4129.js";import"./plus-gDfo8HrU.js";import"./SheCard-DogZVG5K.js";import"./SheCardNotification-BOboksNb.js";import"./settings-2-B-VDw1D0.js";import"./folder-up-Cj3KmWUi.js";import"./trash-BNRtZ8ux.js";const P={};function $(){const r=T(E.CUSTOMERS),{openConfirmationDialog:c}=L(),e=b(),m=M(),[n]=d.useUpdateCustomerMutation(),[i]=d.useCreateCustomerMutation(),[S]=d.useLazyGetCustomerDetailsQuery(),[D]=d.useLazyGetCustomerInfoQuery(),[I]=d.useDeleteCustomerMutation(),{customerId:f}=N(),{addToast:C}=U();function h(s){var o;const a=g(s);return e(t.setIsCustomerBasicDataLoading(!0)),n({id:(o=r.selectedCustomer)==null?void 0:o.customerId,model:a}).then(u=>{if(e(t.setIsCustomerBasicDataLoading(!1)),!u.error)return C({text:"Customer updated successfully",type:"info"}),u.data})}function y(s){const a=g(s);return e(t.setIsCustomerBasicDataLoading(!0)),i(a).then(o=>{var u;if(e(t.setIsCustomerBasicDataLoading(!1)),!o.error)return C({text:"New customer created successfully",type:"info"}),e(t.refreshSelectedCustomer(o.data)),e(t.refreshCustomers([o.data,...r.customers])),m(`${l.CUSTOMERS}/${l.CUSTOMER_BASIC_DATA}/${(u=o.data)==null?void 0:u.customerId}`),o.data})}function B(){if(r.selectedCustomer)return r.selectedCustomer;if(f)return e(t.setIsCustomerBasicDataLoading(!0)),S(Number(f)).then(s=>(e(t.setIsCustomerBasicDataLoading(!1)),e(t.refreshSelectedCustomer(s.data)),s.data))}function x(){e(t.resetSelectedCustomer()),m(`${l.CUSTOMERS}`)}function v(s){return D(s).then(a=>{const o=a.data;return e(t.refreshCustomerCounter(o)),a.data})}async function H(s){await c({headerTitle:"Deleting customer",text:`You are about to delete customer ${s.customerName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&I(s.id).then(o=>{if(o.error){C({text:"Failed to delete customer",type:"error"});return}else C({text:"Customer deleted successfully",type:"info"}),e(t.refreshCustomers(r.customers.filter(u=>u.customerId!==s.customerId))),m(`${l.CUSTOMERS}`)})}return{state:r,actions:t,customerId:f,updateCustomerHandler:h,createCustomerHandler:y,getCustomerHandler:B,onCancelHandler:x,getCustomerInfoHandler:v,deleteCustomerHandler:H}}function ee(){const{state:r,customerId:c,...e}=$();A.useEffect(()=>{var n;e.getCustomerHandler(),((n=r.customerCounter)==null?void 0:n.addressesAmount)===void 0&&c&&e.getCustomerInfoHandler(Number(c))},[]);async function m(n,i){switch(n){case"deleteCustomer":e.deleteCustomerHandler(i);break;case"createCustomer":e.createCustomerHandler(i);break;case"updateCustomer":e.updateCustomerHandler(i);break;case"closeCustomerCard":e.onCancelHandler();break}}return p.jsx("div",{id:"CustomerBasicDataPage",className:P.customerBasicDataPage,children:p.jsx(O,{menuCollectionType:"customer",menuTitle:"Customer",counter:r.customerCounter,itemId:Number(c),activeCards:r.activeCards,children:p.jsx(R,{isLoading:r.isCustomerBasicDataLoading,customer:r.selectedCustomer,onAction:m})})})}export{ee as CustomerBasicDataPage};
