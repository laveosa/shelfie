import{j as e,q as A,f as E,w as U,s as $,e as k,x as D,u as G,S as b,n as T,h as R,i as W,z as w,E as j,U as N,a7 as q,a8 as u,l as O,N as h,$ as M,y as Q,r as K}from"./index-BvS2t_3W.js";import{c as V}from"./OrdersPage.module-m8m3mWZe.js";import{S as J}from"./SheCard-BzfZOYN_.js";import{S as _}from"./SheSelect-s_a5Vb1D.js";import{S as X,T as Y,a as C,b as x}from"./SheTabs-BLvkVIXu.js";import{G as Z}from"./GridItemsFilter-CJ5qhwUN.js";import{S as f}from"./SheGrid-CaQur0dm.js";import{I as ee,u as se}from"./useAppTranslation-CV6m8AY1.js";import{G as te}from"./GridDateRangeFilter-DNzbSxVi.js";import{d as ae,P as re,e as ne,T as ie,a as P,S as le}from"./SheContextSidebar-Du3zfCzr.js";import{B as oe}from"./trash-D4k-iJzS.js";import{P as ce}from"./plus-ZvpJqvoX.js";import{u as me}from"./useCardActions-CnQ6g5U4.js";import{u as de}from"./useToast-DYyO4org.js";import{G as ue,a as pe}from"./GridSortingEnum-Qa64oiYF.js";import"./SheCardNotification-DWA5hfRF.js";import"./ComponentViewEnum-Ba6F4129.js";import"./SheInput-D6Dh9ugR.js";import"./select-D0Cb5vTV.js";import"./chevron-up-CLMtw2v2.js";import"./settings-2-D465fVPt.js";import"./SheDatePicker-R2ofkfCB.js";import"./folder-up-BuLt1IIO.js";const he="_shipmentsCardWrapper_1ps21_1",Se="_shipmentsCard_1ps21_1",ge="_shipmentsCardContent_1ps21_9",Ce="_tabItemsWrapper_1ps21_9",xe="_tabItems_1ps21_9",fe="_tabItemTrigger_1ps21_21",ve="_tabBlock_1ps21_28",be="_createShipmentButton_1ps21_34",l={shipmentsCardWrapper:he,shipmentsCard:Se,shipmentsCardContent:ge,tabItemsWrapper:Ce,tabItems:xe,tabItemTrigger:fe,tabBlock:ve,createShipmentButton:be},Ie="_customerNameBlock_1skv2_1",je="_noImageIcon_1skv2_7",Ne="_avatarInitials_1skv2_14",_e="_shipmentStatus_1skv2_28",Pe="_shipmentStatusAvailable_1skv2_38",ke="_shipmentStatusNotAvailable_1skv2_44",Te="_selectButton_1skv2_62",d={customerNameBlock:Ie,noImageIcon:je,avatarInitials:Ne,shipmentStatus:_e,shipmentStatusAvailable:Pe,shipmentStatusNotAvailable:ke,selectButton:Te};function v(o){const n=s=>s==="New"||s==="Pending"?d.shipmentStatusAvailable:s==="Not Available"?d.shipmentStatusNotAvailable:"";return[{id:"shipmentId",header:"ID",minSize:60,maxSize:60,cell:({row:s})=>e.jsx("span",{children:s.original.shipmentId})},{id:"customer",accessorFn:s=>s.variantName,header:"customer",minSize:120,cell:({row:s})=>{var t,a;const i=(t=s.original.customer)==null?void 0:t.thumbnailUrl,m=(a=s.original.customer)==null?void 0:a.name;return e.jsxs("div",{className:d.customerNameBlock,children:[i?e.jsx("img",{src:i,alt:m||"Customer",className:"object-cover rounded-md w-full h-full",style:{width:"48px",height:"48px"}}):m?e.jsx("div",{className:d.avatarInitials,children:A(m)}):e.jsx("div",{className:d.noImageIcon,children:e.jsx(E,{icon:ee,maxWidth:"30px"})}),e.jsx(U,{delayDuration:200,text:m,className:"max-w-[120px] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-text",children:m})})]})}},{id:"createdAt",header:"Date",minSize:100,maxSize:100,cell:({row:s})=>e.jsx("span",{children:$(s.original.createdAt,"date")})},{id:"service",header:"Service",minSize:80,cell:({row:s})=>e.jsx("span",{children:s.original.service})},{id:"number",header:"Number",minSize:80,maxSize:80,cell:({row:s})=>e.jsx("span",{children:s.original.number})},{id:"shipmentStatus",header:"Status",minSize:150,maxSize:150,cell:({row:s})=>{const i=s.original.shipmentStatus;return e.jsx("div",{className:`${d.shipmentStatus} ${n(i)}`,children:e.jsx("span",{children:i})})}},{id:"quantityPacked",header:"Qty Packed",minSize:100,maxSize:100,cell:({row:s})=>e.jsx("span",{children:s.original.quantityPacked})},{id:"weight",header:"Weight",minSize:100,maxSize:100,cell:({row:s})=>e.jsx("span",{children:s.original.weight})},{id:"manage",header:"",minSize:120,maxSize:120,cell:({row:s})=>e.jsx("div",{className:d.selectButton,onClick:i=>i.stopPropagation(),children:e.jsx(k,{icon:D,value:"Manage",variant:"secondary",onClick:()=>o("manageShipment",s.original)})})}]}function ye({isLoading:o,isShipmentsGridLoading:n,preferences:s,sortingOptions:i,customersList:m,shipmentsGridRequestModel:t,onAction:a}){var S;const{translate:p}=se();return e.jsxs("div",{className:l.shipmentsCardWrapper,children:[e.jsx(J,{className:l.shipmentsCard,title:"Shipment",titleTransKey:"SectionTitles.Shipment",isLoading:o,children:e.jsx("div",{className:l.shipmentsCardContent,children:e.jsxs(X,{defaultValue:"allShipments",onValueChange:()=>a("setActiveTab"),children:[e.jsx("div",{className:l.tabItemsWrapper,children:e.jsx(Y,{className:l.tabItems,children:e.jsxs("div",{children:[e.jsx(C,{className:l.tabItemTrigger,value:"queued",children:e.jsxs("div",{className:l.tabBlock,children:[e.jsx(ae,{size:"16"})," ",p("TabLabels.Queued")]})}),e.jsx(C,{className:l.tabItemTrigger,value:"readyForPacking",children:e.jsxs("div",{className:l.tabBlock,children:[e.jsx(re,{size:"16"}),p("TabLabels.ReadyForPacking")]})}),e.jsx(C,{className:l.tabItemTrigger,value:"readyForSending",children:e.jsxs("div",{className:l.tabBlock,children:[e.jsx(ne,{size:"16"}),p("TabLabels.ReadyForSending")]})}),e.jsx(C,{className:l.tabItemTrigger,value:"allShipments",children:e.jsxs("div",{className:l.tabBlock,children:[e.jsx(ie,{size:"16"}),p("TabLabels.AllShipments")]})})]})})}),e.jsx(x,{value:"queued",children:e.jsx(f,{isLoading:n,columns:v(a),data:t.items,gridRequestModel:t,sortingItems:i,columnsPreferences:s,preferenceContext:"productReferences",skeletonQuantity:t.pageSize,onApplyColumns:()=>a("applyColumns"),onDefaultColumns:()=>a("resetColumnsHandler"),onGridRequestChange:c=>a("gridRequestChange",c)})}),e.jsx(x,{value:"readyForPacking",children:e.jsx(f,{isLoading:n,columns:v(a),data:t.items,gridRequestModel:t,sortingItems:i,columnsPreferences:s,preferenceContext:"productReferences",skeletonQuantity:t.pageSize,onApplyColumns:()=>a("applyColumns"),onDefaultColumns:()=>a("resetColumnsHandler"),onGridRequestChange:c=>a("gridRequestChange",c)})}),e.jsx(x,{value:"readyForSending",children:e.jsx(f,{isLoading:n,columns:v(a),data:t.items,gridRequestModel:t,sortingItems:i,columnsPreferences:s,preferenceContext:"productReferences",skeletonQuantity:t.pageSize,onApplyColumns:()=>a("applyColumns"),onDefaultColumns:()=>a("resetColumnsHandler"),onGridRequestChange:c=>a("gridRequestChange",c)})}),e.jsx(x,{value:"allShipments",children:e.jsxs(f,{isLoading:n,columns:v(a),data:t.items,gridRequestModel:t,sortingItems:i,columnsPreferences:s,preferenceContext:"productReferences",skeletonQuantity:t.pageSize,onApplyColumns:()=>a("applyColumns"),onDefaultColumns:()=>a("resetColumnsHandler"),onGridRequestChange:c=>a("gridRequestChange",c),children:[e.jsx(Z,{items:m,columnName:"Customer",identifier:"customerId",icon:oe,getId:c=>c.customerId,getName:c=>c.customerName,selected:(S=t==null?void 0:t.filter)==null?void 0:S.suppliers}),e.jsx(te,{}),e.jsx(_,{placeholder:"Status",placeholderTransKey:"OrderForm.Placeholders.Status",icon:P,minWidth:"150px"}),e.jsx(_,{placeholder:"Status",placeholderTransKey:"OrderForm.Placeholders.Status",icon:P,minWidth:"150px"})]})})]})})}),e.jsx(k,{className:l.createShipmentButton,value:"Create Shipment",valueTransKey:"OrderActions.CreateShipment",icon:ce,variant:"info",onClick:()=>a("createShipment")})]})}function Le(){G(r=>r[b.SHIPMENTS]);const o=T(b.APP),n=R(),s=W(),{addToast:i}=de(),m=w(),[t]=j.useGetShipmentsListForForGridMutation(),[a]=j.useCreateShipmentMutation(),[p]=N.useUpdateUserPreferencesMutation(),[S]=N.useResetUserPreferencesMutation(),[c]=q.useGetCustomersForGridMutation();function I(r){return s(u.setIsShipmentsGridLoading(!0)),t(r).then(g=>(s(u.setIsShipmentsGridLoading(!1)),s(u.refreshShipmentsGridRequestModel(g.data)),g))}function y(){return c({}).then(r=>(s(u.refreshCustomersList(r.data.items)),r.data))}function L(r){I(r)}function H(r){const g=O.merge({},o.preferences,r);return p(g).then(()=>{n.getUserPreferencesHandler()})}function z(r){return S(r).then(()=>{n.getUserPreferencesHandler()})}function B(){return s(u.setIsShipmentsCardLoading(!0)),a().then(r=>(s(u.setIsShipmentsCardLoading(!1)),s(u.refreshSelectedShipment(r.data)),m(`${h.SALES}${h.SHIPMENTS}${h.SHIPMENT_DETAILS}/${r.data.shipmentId}`),r.data))}function F(r){m(`${h.SALES}${h.SHIPMENTS}${h.SHIPMENT_DETAILS}/${r.shipmentId}`)}return{getShipmentsListForForGridHandler:I,createShipmentHandler:B,manageShipmentHandler:F,handleGridRequestChange:L,updateUserPreferencesHandler:H,resetUserPreferencesHandler:z,getListOfCustomersHandler:y}}function es(){const o=Le(),n=T(b.SHIPMENTS);me({selectActiveCards:t=>t[b.SHIPMENTS].activeCards,refreshAction:M.refreshActiveCards});const s=Object.values(ue).map(t=>({value:t,description:pe[t]})),{orderId:i}=Q();K.useEffect(()=>{o.getShipmentsListForForGridHandler(n.shipmentsGridRequestModel),o.getListOfCustomersHandler()},[]);async function m(t,a){switch(t){case"createShipment":o.createShipmentHandler();break;case"manageShipment":o.manageShipmentHandler(a);break;case"gridRequestChange":o.handleGridRequestChange(a);break;case"applyColumns":o.updateUserPreferencesHandler(a);break;case"resetColumns":o.resetUserPreferencesHandler("products");break}}return e.jsx("div",{className:V.ordersPage,children:e.jsx(le,{menuCollectionType:"sales",menuTitle:"Sales",itemId:Number(i),activeCards:n.activeCards,children:e.jsx(ye,{isLoading:n.isShipmentsCardLoading,isShipmentsGridLoading:n.isShipmentsGridLoading,sortingOptions:s,customersList:n.customersList,shipmentsGridRequestModel:n.shipmentsGridRequestModel,onAction:m})})})}export{es as ShipmentsPage};
