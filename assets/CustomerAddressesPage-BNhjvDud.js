import{d as L,S as k,b as B,a0 as h,c as F,o as _,a6 as d,a8 as H,j as a,n as D,i as M,C as E,r as G,q as V,Y as K,a9 as O}from"./index-Cw1axte0.js";import{A as Q}from"./AddressForm-Jvn75SWk.js";import{c as U,a as b,C as Y}from"./CustomerAddressCard-D2z70Mj7.js";import{u as $}from"./useToast-C-IbJ-Pz.js";import{S as W}from"./SheCard-aSRRE8J-.js";import{S as J}from"./SheGrid-En_vYHu8.js";import{u as X}from"./useAppTranslation-C0plkqGJ.js";import{P as Z}from"./settings-2-D0TSVohS.js";import{G as ee,a as se}from"./GridSortingEnum-Qa64oiYF.js";import{S as re}from"./SheContextSidebar-B80ytWA5.js";import"./types-D_x_05Po.js";import"./form-CC68foBk.js";import"./SheInput-CRh_9A_6.js";import"./ComponentViewEnum-Ba6F4129.js";import"./SheSelect-p3B5lCDb.js";import"./select-C6XQeQRZ.js";import"./chevron-up-B1noOLu8.js";import"./she-select-convertors-CdG-Ygpu.js";import"./SheCardNotification-BO0xFGAj.js";import"./trash-CCSUe94n.js";const te={};function de(){const e=L(k.CUSTOMERS),t=L(k.APP),s=B(),[m]=h.useUpdateCustomerAddressMutation(),[u]=h.useCreateCustomerAddressMutation(),[C]=h.useLazyGetCustomerAddressDetailsQuery(),[g]=h.useDeleteCustomerAddressMutation(),[I]=h.useGetCustomerAddressesForGridMutation(),[y]=F.useLazyGetCountryCodeQuery(),[S]=h.useLazyGetCustomerInfoQuery(),{customerId:p}=_(),{addToast:o}=$();function i(r){return s(d.setIsCustomerAddressesLoading(!0)),I({model:r,id:Number(p)}).then(n=>{if(s(d.setIsCustomerAddressesLoading(!1)),!n.error){const c=n.data.items.filter(l=>!l.isDeleted);s(d.refreshCustomerAddressesGridRequestModel(n.data)),s(d.refreshCustomerAddresses(c))}return n})}function A(r){const n=U(r.alias,r.addressLine1,r.addressLine2,r.city,r.state,r.postalCode,r.countryId);return r.addressId?x(n):w(n)}function x(r){const n=b(r);return s(d.setIsCustomerAddressDetailsLoading(!0)),m({id:e.selectedCustomerAddressId,model:n}).then(c=>{if(s(d.setIsCustomerAddressDetailsLoading(!1)),!c.error){const l=e.customerAddresses.map(f=>f.addressId===e.selectedCustomerAddressId?c.data:f);return s(d.refreshCustomerAddresses(l)),v(),o({text:"Customer address updated successfully",type:"info"}),c.data}})}function w(r){const n=b(r);return s(d.setIsCustomerAddressDetailsLoading(!0)),u({id:Number(p),model:n}).then(c=>{if(s(d.setIsCustomerAddressDetailsLoading(!1)),!c.error){o({text:"New customer address created successfully",type:"info"});const l=[c.data,...e.customerAddresses];return v(),s(d.refreshCustomerAddresses(l)),c.data}})}function R(r){const n=e.customerAddresses.find(l=>l.addressId===r),c=e.customerAddresses.filter(l=>l.addressId!==r);return s(d.refreshCustomerAddresses(H(c))),v(),g(r).then(l=>{if(l.error){if(n&&!e.customerAddresses.some(f=>f.addressId===n.addressId)){const f=[...e.customerAddresses,n];s(d.refreshCustomerAddresses(H(f)))}o({text:"Failed to delete customer address",type:"error"});return}else return o({text:"Customer address deleted successfully",type:"info"}),l.data})}function N(r){return C(r).then(n=>n.data)}function P(r){s(d.setCreateCustomerAddress(!1)),s(d.refreshSelectedCustomerAddress(r)),s(d.refreshSelectedCustomerAddressId(r.addressId))}function v(){s(d.refreshActiveCards([])),s(d.refreshSelectedCustomerAddressId(null)),s(d.refreshSelectedCustomerAddress(null))}function T(){s(d.setCreateCustomerAddress(!0)),s(d.refreshSelectedCustomerAddress(Q)),s(d.refreshSelectedCustomerAddressId(null))}function q(){return y(null).then(r=>(r.data&&s(d.refreshCountryList(r.data)),r))}function z(r){return S(r).then(n=>{const c=n.data;return s(d.refreshCustomerCounter(c)),n.data})}return{state:e,appState:t,actions:d,customerId:p,dispatch:s,getCustomerAddressDetailsHandler:N,deleteCustomerAddressHandler:R,getCustomerAddressesForGridHandler:i,onManageCustomerAddressHandler:P,onCloseCustomerAddressCardHandler:v,onCreateCustomerAddressHandler:T,getCountryCodeHandler:q,resolveCustomerAddressData:A,getCustomerInfoHandler:z}}const oe="_customerAddressesCard_1kinp_1",ae="_customerAddressesCardHeader_1kinp_1",ne="_headerButtonBlock_1kinp_6",j={customerAddressesCard:oe,customerAddressesCardHeader:ae,headerButtonBlock:ne};function ue(e){return[{accessorKey:"addressId",header:"ID",minSize:60,maxSize:60},{id:"alias",accessorFn:t=>t.alias,header:"Alias",minSize:150,cell:({row:t})=>a.jsx("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:a.jsx("div",{children:a.jsx(D,{delayDuration:200,text:t.getValue("alias"),className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap",children:a.jsx("span",{children:t.getValue("alias")})})})})},{accessorKey:"city",header:"City",minSize:100,cell:({row:t})=>a.jsx(D,{delayDuration:200,text:t.original.city,className:"max-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap",children:a.jsx("span",{children:t.original.city})})},{accessorKey:"addressLine1",header:"Address",minSize:100,cell:({row:t})=>a.jsx(D,{delayDuration:200,text:t.getValue("addressLine1"),className:"max-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap",children:a.jsx("span",{children:t.getValue("addressLine1")})})},{accessorKey:"postalCode",header:"Postal Code",minSize:120,maxSize:120,cell:({row:t})=>a.jsx("span",{children:t.getValue("postalCode")})},{id:"manage",header:"",minSize:120,maxSize:120,cell:({row:t,table:s})=>{const m=s.options.meta,u=C=>{C.stopPropagation(),C.preventDefault(),e("manageCustomerAddress",t.original)};return a.jsx("div",{onClick:C=>C.stopPropagation(),children:a.jsx(M,{icon:E,variant:"secondary",onClick:u,disabled:m==null?void 0:m.isRowLoading(t.id),children:"Manage"})})}}]}function ie({isLoading:e,onAction:t,addresses:s,gridRequestModel:m,sortingOptions:u}){const{translate:C}=X();return a.jsxs(W,{className:j.customerAddressesCard,minWidth:"850px",showHeader:!1,children:[a.jsxs("div",{className:j.customerAddressesCardHeader,children:[a.jsx("div",{className:"she-title",children:C("CardTitles.CustomerAddresses")}),a.jsx("div",{className:j.headerButtonBlock,children:a.jsx(M,{value:"Create Address",valueTransKey:"CustomerActions.CreateAddress",icon:Z,variant:"default",onClick:()=>t("createCustomerAddress")})})]}),a.jsx(J,{isLoading:e,columns:ue(t),data:s,gridRequestModel:m,sortingItems:u,skeletonQuantity:3,onGridRequestChange:g=>t("getCustomerAddressesForGrid",g)})]})}function be(){var p;const{state:e,actions:t,customerId:s,dispatch:m,...u}=de(),C=G.useRef({}),{openConfirmationDialog:g}=V(),I=Object.values(ee).map(o=>({value:o,description:se[o]}));G.useEffect(()=>{var o,i;u.getCustomerAddressesForGridHandler(e.customerAddressesGridRequestModel),((o=e.countryList)==null?void 0:o.length)===0&&u.getCountryCodeHandler(),((i=e.customerCounter)==null?void 0:i.addressesAmount)===void 0&&s&&u.getCustomerInfoHandler(Number(s))},[]);function y(o,i){let A;switch(i){case"open":A=e.activeCards.includes(o)?e.activeCards:[...e.activeCards,o];break;case"close":A=e.activeCards.filter(x=>x!==o);break;case"toggle":default:A=e.activeCards.includes(o)?e.activeCards.filter(x=>x!==o):[...e.activeCards,o];break}O(C.current,o),m(t.refreshActiveCards(A))}async function S(o,i){switch(o){case"manageCustomerAddress":u.onManageCustomerAddressHandler(i),y("customerAddressCard","open"),m(t.refreshCustomerAddresses(K(i.addressId,e.customerAddresses,"addressId")));break;case"deleteCustomerAddress":if(!await g({headerTitle:"Deleting customer address",text:`You are about to delete customer address ${i.alias}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"}))return;u.deleteCustomerAddressHandler(i);break;case"createCustomerAddress":u.onCreateCustomerAddressHandler(),y("customerAddressCard","open");break;case"getCustomerAddressesForGrid":u.getCustomerAddressesForGridHandler(i);break;case"closeCustomerAddressCard":u.onCloseCustomerAddressCardHandler(),m(t.refreshCustomerAddresses(H(e.customerAddresses)));break;case"submitCustomerAddressData":u.resolveCustomerAddressData(i);break}}return a.jsx("div",{id:"CustomerAddressesPage",className:te.customerAddressesPage,children:a.jsxs(re,{menuCollectionType:"customer",menuTitle:"Customer",counter:e.customerCounter,itemId:Number(s),activeCards:e.activeCards,children:[a.jsx(ie,{isLoading:e.isCustomerAddressesLoading,addresses:e.customerAddresses,gridRequestModel:e.customerAddressesGridRequestModel,onAction:S,sortingOptions:I}),((p=e.activeCards)==null?void 0:p.includes("customerAddressCard"))&&a.jsx("div",{ref:o=>{C.current.customerAddressCard=o},children:a.jsx(Y,{isLoading:e.isCustomerAddressDetailsLoading,customerAddress:e.selectedCustomerAddress,countryList:e.countryList,onAction:S})})]})})}export{be as CustomerAddressesPage};
