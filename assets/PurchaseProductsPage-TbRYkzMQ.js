import{n as le,S as te,t as Be,z as er,B as ar,Y as W,A as ge,W as Pe,Z as _,k as tr,bD as o,a0 as V,a5 as rr,s as Ae,N as Ne,j as t,f as He,X as or,e as F,aa as Re,K as sr,L as nr,Q as ir,V as ee,w as $,x as Ve,r as X,ah as dr,_ as fe,l as cr,a6 as ur,o as ye,y as lr}from"./index-BShB5fhp.js";import{G as pr,a as hr}from"./GridSortingEnum-Qa64oiYF.js";import{u as we}from"./useProductsPageService-BuH4MsOy.js";import{u as mr}from"./useToast-CdMBstYU.js";import{u as Cr,P as gr,C as Pr,a as fr}from"./useProductBasicDataPageService-CeZhdsX2.js";import{u as yr}from"./chevron-up-Drj9YO3e.js";import{S as xr,T as Ir,a as Ge,b as De}from"./SheTabs-HqKbg6ke.js";import{S as ze}from"./SheCard-B6vQIC0s.js";import{G as de}from"./GridItemsFilter-C9AIKm49.js";import{G as Fe}from"./GridTraitsFilter-Csz1UR5R.js";import{G as Lr}from"./GridShowItemsFilter-C2_KDAn7.js";import{S as Ie}from"./SheGrid-CbfBzlki.js";import{p as qe}from"./placeholder-image-BgG3Yd5d.js";import{o as Hr,b as ce,u as We,S as $e,a as Y,d as ue}from"./types-mtm9cZvm.js";import{e as Me}from"./form-CHktgBl9.js";import{R as Ee,S as pe}from"./SheInput-c5Qiy30C.js";import{S as he}from"./SheSelect-Bk-ryUsW.js";import{T as Ue}from"./SheCardNotification-D3N47frH.js";import{E as Vr,A as vr,q as Sr,r as kr,S as br}from"./SheContextSidebar-BCLuoTkA.js";import{c as Z}from"./she-select-convertors-CdG-Ygpu.js";import{I as Ke,u as Qe}from"./useAppTranslation-zSXCVuIB.js";import{L as Tr}from"./trash-BKRTX9MF.js";import{P as ve}from"./plus-CHP6QOSb.js";import{P as jr,C as Nr}from"./ConnectImageCard-CyqmhHEd.js";import{C as Gr,P as Dr,A as Fr}from"./AddVariantCard-BpgOPKY-.js";import{V as Mr,A as Or,S as _r,D as Br,a as Ar,b as Rr,M as wr}from"./VariantPhotosCard-Cpf9dI3Y.js";import{u as zr}from"./useCardActions-Btvxmtw2.js";import{S as qr,C as Wr}from"./CompaniesListGridColumns-CISSnPbU.js";import{S as $r}from"./SelectEntityCard-BeInK5mT.js";import{C as Er,a as Ur,P as Oe,M as Kr,L as Qr,b as Yr}from"./ManageLocationPhotosGridColumns-DykPoWvK.js";import"./SheFileUploader-WR-qh7Wn.js";import"./index-BeK_2_r4.js";import"./ComponentViewEnum-Ba6F4129.js";import"./settings-2-gwc_wogu.js";import"./select-C7cYjRvE.js";import"./folder-up-BdkQKupl.js";import"./ChooseVariantTraitsCard.module-DPmE-6dq.js";import"./SheForm-DuwEjz7F.js";import"./SheDatePicker-2fKvD8lZ.js";import"./SheTextarea-ARAQkp8y.js";import"./AddressForm-BOzU4MIv.js";const Xr="_purchaseProductsPage_830lg_1",Zr="_purchaseProductsCard_830lg_1",_e={purchaseProductsPage:Xr,purchaseProductsCard:Zr};function Jr(u,x,C){const i=le(te.PURCHASE_PRODUCTS),s=le(te.PRODUCTS),h=le(te.APP),d=we(),e=Be(),{addToast:r}=mr(),S=er(),{openConfirmationDialog:L}=ar(),m=Cr(u),{t:j}=yr(),[z]=W.useGetListOfPurchaseProductsForGridMutation(),[P]=W.useAddVariantToPurchaseProductsMutation(),[B]=W.useUpdatePurchaseProductMutation(),[v]=W.useDeleteStockActionMutation(),[G]=W.useLazyGetPurchaseSummaryQuery(),[M]=ge.useDeletePhotoMutation(),[b]=Pe.useAttachProductPhotoToVariantMutation(),[A]=Pe.useDetachVariantPhotoMutation(),[R]=ge.useSetPhotoActivationStateMutation(),[O]=W.useGetListOfPurchasesForGridMutation(),[H]=W.useLazyGetPurchaseDetailsQuery(),[l]=W.useCreatePurchaseForSupplierMutation(),[T]=_.useGetListOfCompaniesForGridMutation(),[E]=Pe.useGetVariantsForGridMutation(),[re]=tr.useLazyGetCountryCodeQuery(),[oe]=_.useAddNewLocationToCompanyMutation(),[se]=_.useCreateCompanyMutation(),[q]=_.useLazyGetCompanyDetailsQuery(),[y]=_.useDeleteCompanyMutation(),[D]=_.useAddLocationToCompanyMutation(),[me]=ge.useUploadPhotoMutation(),[Ze]=_.useUpdateCompanyDetailsMutation(),[Je]=_.useChangePositionOfCompanyPhotoMutation(),[ea]=_.useChangePositionOfLocationPhotoMutation(),[aa]=_.useUpdateLocationDetailsMutation(),[ta]=_.useDeleteLocationMutation();function K(a,n){return z({id:a,model:n}).then(c=>(e(o.refreshPurchasesProductsGridRequestModel(c.data)),e(o.refreshPurchaseProducts(c.data.items)),c.data))}function Se(a,n){return P({id:a,model:n}).then(c=>c.data)}function ke(a,n){return B({id:a,model:n}).then(c=>c)}function be(a){return v(a).then(n=>n.data)}function ne(a){return G(a).then(n=>(e(o.refreshPurchaseSummary(n.data)),n.data))}function ra(a){s.selectedPurchase||d.getPurchaseDetailsHandler(a),s.purchaseCounters||(e(o.setIsProductMenuCardLoading(!0)),d.getPurchaseCountersHandler(Number(a)).then(()=>e(o.setIsProductMenuCardLoading(!1)))),s.currenciesList.length===0&&d.getCurrenciesListHandler(),s.taxesList.length===0&&d.getTaxesListHandler(),d.getTraitsForFilterHandler(),C(["purchaseProductsCard"]),e(V.refreshActiveTab("purchases"))}function oa(a){s.createdPurchase||(e(o.setIsPurchasesProductsGridLoading(!0)),Promise.all([K(a,i.purchasesProductsGridRequestModel),ne(a)]).then(()=>{e(o.setIsPurchasesProductsGridLoading(!1))})),e(o.refreshPurchasesProductsGridRequestModel({}))}function sa(){Object.keys(i.variantsForPurchaseGridRequestModel).length===0&&(e(o.setIsVariantsForPurchaseGridLoading(!0)),E(i.variantsForPurchaseGridRequestModel).then(a=>{e(o.setIsVariantsForPurchaseGridLoading(!1)),e(o.refreshVariantsForPurchaseGridRequestModel(a.data)),e(o.refreshVariants(a.data.items))}))}function na(){s.brands.length===0&&d.getBrandsForFilterHandler(),s.categories.length===0&&d.getCategoriesForFilterHandler(),J(),(i.sizesForFilter.length===0||i.colorsForFilter.length===0)&&d.getTraitsForFilterHandler(),e(o.refreshActiveCards(null))}function J(){i.countryCodes.length===0&&re().then(a=>{e(o.refreshCountryCodes(a.data))})}function ia(a,n){Se(n,{variantId:a.variantId,...a.data}).then(c=>{c?(d.getPurchaseCountersHandler(Number(n)),r({text:"Variant added successfully",type:"success"})):r({text:`${c.error.data.detail}`,type:"error"})})}function da(a,n){e(o.refreshPurchasesProductsGridRequestModel({...i.purchasesProductsGridRequestModel,items:i.purchasesProductsGridRequestModel.items.map(c=>c.stockActionId===a.stockActionId?{...c,unitsAmount:a.data.unitsAmount,stockDocumentPrice:{...c.stockDocumentPrice,currencyId:a.data.currencyId,taxTypeId:a.data.taxTypeId,netto:a.data.nettoPrice}}:c)})),ke(a.stockActionId,a.data).then(c=>{c.error?(K(n,i.purchasesProductsGridRequestModel),r({text:`${c.error.data.detail}`,type:"error"})):(ne(n),r({text:"Product updated successfully",type:"success"}))})}function ca(){e(o.resetSelectedProduct()),x({purchaseProductsCard:!1,productConfigurationCard:!0})}function ua(a){e(o.setIsProductConfigurationCardLoading(!0)),d.createNewProductHandler(a).then(n=>{e(o.setIsProductConfigurationCardLoading(!1)),n.error?r({text:`${n.error.data.detail}`,type:"error"}):(x({productConfigurationCard:!1,manageProductCard:!0}),e(o.refreshSelectedProduct(n.data)),r({text:"Product created successfully",type:"success"}))})}function la(){u("createCategoryCard",!0)}function pa(a){m.checkCategoryNameHandler(a)}function ha(a){m.createNewCategoryHandler(a),u("createCategoryCard")}function ma(){u("createBrandCard",!0)}function Ca(a){m.checkBrandNameHandler(a)}function ga(a){m.createBrandHandler(a),u("createBrandCard")}function Pa(a){m.uploadCategoryOrBrandPhotoHandler(a)}function fa(){i.activeCards.includes("manageProductCard")?u("productConfigurationCard"):C(["purchaseProductsCard"])}function ya(){m.generateProductCodeHandler()}function xa(a){d.checkProductCodeHandler({code:a})}function Ia(a){C(["purchaseProductsCard"]),e(o.setIsPurchasesProductsGridLoading(!0)),Promise.all([K(a,i.purchasesProductsGridRequestModel),ne(a)]).then(()=>{e(o.setIsPurchasesProductsGridLoading(!1))})}function La(){u("manageProductCard"),e(o.setIsManageProductCardLoading(!0)),Promise.all([d.getListOfTraitsWithOptionsForProductHandler(s.selectedProduct.productId),d.getPurchaseProductVariantsHandler(i.selectedPurchase.purchaseId,s.selectedProduct.productId)]).then(([a,n])=>{e(o.setIsManageProductCardLoading(!1)),e(o.refreshPurchaseProductVariantsGridRequestModel(n)),e(o.refreshPurchaseProductVariants(n.items))})}function Ha(){u("productConfigurationCard",!0)}function Va(){u("productPhotosCard",!0),e(o.setIsProductPhotosCardLoading(!0)),d.getProductPhotosHandler(Number(i.selectedProduct.productId)).then(()=>{e(o.setIsProductPhotosCardLoading(!1))})}function va(a){return e(o.setIsPhotoUploaderLoading(!0)),me(a).then(n=>{var c;return n.error?(r({text:((c=n.error.data)==null?void 0:c.detail)||"Upload failed",type:"error"}),n):(n.data.photoId&&(e(o.setIsPhotoUploaderLoading(!1)),a.contextName==="Company"?(e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(p=>{e(o.setIsSuppliersGridLoading(!1));const g=p.data.items.map(I=>{var w;return{...I,isSelected:I.companyId===((w=i.selectedCompany)==null?void 0:w.companyId)}});e(o.refreshCompaniesGridRequestModel({...p.data,items:g}))}),e(o.refreshManagedCompany({...i.managedCompany,photos:[...i.managedCompany.photos||[],n.data]}))):e(o.refreshManagedLocation({...i.managedLocation,photos:[...i.managedLocation.photos||[],n.data]})),r({text:"Photos added successfully",type:"success"})),n)})}function Sa(a){switch(a.contextName){case"Company":Je({companyId:i.managedCompany.companyId,photoId:a.activeItem.photoId,index:a.newIndex}).then(n=>{n.error||(q(i.managedCompany.companyId).then(c=>{e(o.refreshManagedCompany(c.data))}),(a.newIndex===0||a.oldIndex===0)&&(e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(c=>{e(o.setIsSuppliersGridLoading(!1));const p=c.data.items.map(g=>{var I;return{...g,isSelected:g.companyId===((I=i.selectedCompany)==null?void 0:I.companyId)}});e(o.refreshCompaniesGridRequestModel({...c.data,items:p}))})))});break;case"Location":ea({locationId:i.managedLocation.locationId,photoId:a.activeItem.photoId,index:a.newIndex}).then(n=>{n.error||q(i.managedCompany.companyId).then(c=>{e(o.refreshManagedCompany(c.data))})});break;default:d.changePhotoPositionForVariantHandler(s.selectedVariant.variantId,a.activeItem.photoId,a.newIndex).then(()=>{e(o.setIsVariantPhotoGridLoading(!0)),(a.newIndex===0||a.oldIndex===0)&&d.getVariantsForGridHandler(s.gridRequestModel).then(n=>e(V.refreshVariants(n.items))),d.getVariantDetailsHandler(s.selectedVariant.variantId).then(n=>{e(o.setIsVariantPhotoGridLoading(!1)),e(V.refreshSelectedVariant(n)),e(V.refreshVariantPhotos(n==null?void 0:n.photos))})})}}async function ka(a){await L({headerTitle:"Deleting product photo",text:"You are about to delete product photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&M(a.photoId).then(c=>{c?(e(V.refreshProductPhotos(s.productPhotos.filter(p=>p.photoId!==a.photoId))),r({text:"Photo deleted successfully",type:"success"})):r({text:"Photo not deleted",type:"error"})})}function ba(a){return R({contextName:"Product",contextId:i.selectedProduct.productId,photoId:a.photoId,model:{isActive:!a.isActive}}).then(n=>{n.error||e(V.refreshProductPhotos(s.productPhotos.map(c=>c.photoId===a.photoId?{...c,isActive:!a.isActive}:c)))})}function Ta(){u("productPhotosCard")}function ja(a){e(V.refreshProductPhotos(rr(a.photoId,s.productPhotos,"photoId"))),e(o.refreshSelectedPhoto(a)),e(V.refreshProductVariants(s.productVariants.map(n=>{var p;const c=(p=a.variants)==null?void 0:p.some(g=>g.variantId===n.variantId);return{...n,isActive:c}}))),u("connectImageCard",!0)}function Na(a){a.row.original.isActive?je(a):Te(a)}function Te(a){return b({variantId:a.row.original.variantId,photoId:i.selectedPhoto.photoId}).then(n=>{if(!n.error){const c=s.productVariants.map(p=>p.variantId===a.row.original.variantId?{...p,isActive:!0}:p);e(V.refreshProductVariants(c))}})}function je(a){return A({id:a.row.original.variantId,photoId:i.selectedPhoto.photoId}).then(n=>{if(!n.error){const c=s.productVariants.map(p=>p.variantId===a.row.original.variantId?{...p,isActive:!1}:p);e(V.refreshProductVariants(c))}})}function Ga(){u("connectImageCard")}function Da(){u("chooseVariantTraitsCard",!0),e(o.setIsChooseVariantTraitsCardLoading(!0)),Promise.all([d.getListOfAllTraitsHandler(),d.getListOfTraitsWithOptionsForProductHandler(i.selectedProduct.productId)]).then(()=>{e(o.setIsChooseVariantTraitsCardLoading(!1))})}function Fa(){e(o.setIsProductTraitConfigurationCardLoading(!0)),e(o.resetSelectedTrait()),d.getListOfTypesOfTraitsHandler().then(()=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),u("productTraitConfigurationCard",!0),e(o.refreshSelectedTrait({}))})}function Ma(a){u("productTraitConfigurationCard",!0),e(o.setIsProductTraitConfigurationCardLoading(!0)),e(o.setIsTraitOptionsGridLoading(!0)),Promise.all([d.getTraitHandler(a),d.getOptionsForTraitHandler(a),d.getListOfTypesOfTraitsHandler()]).then(([n,c,p])=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),e(o.setIsTraitOptionsGridLoading(!1)),e(o.refreshSelectedTrait(n)),e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:c.filter(g=>!g.isDeleted)}))})}function Oa(a){e(o.refreshSelectedTraitsIds(a)),e(o.setIsChooseVariantTraitsCardLoading(!0)),d.setProductTraitsHandler(i.selectedProduct.productId,a).then(n=>{e(o.setIsChooseVariantTraitsCardLoading(!1)),n?(x({chooseVariantTraitsCard:!1,productTraitConfigurationCard:!1}),d.getListOfTraitsWithOptionsForProductHandler(i.selectedProduct.productId),r({text:"Traits set successfully",type:"success"})):r({text:"Traits not set",description:n.error.message,type:"error"})})}async function _a(a){if(await L({headerTitle:"Deleting trait",text:`You are about to remove the trait ${a.traitName}. All products connected to it will loose the configuration and will require your attention to map it to the new trait.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})){e(o.setIsChooseVariantTraitsCardLoading(!0));try{await d.deleteTraitHandler(a.traitId),await Promise.all([d.getListOfTraitsWithOptionsForProductHandler(i.selectedProduct.productId),d.getListOfAllTraitsHandler()]),r({text:"Trait deleted successfully",type:"success"})}catch(c){r({text:c.message||"Failed to delete trait",type:"error"})}finally{e(o.setIsChooseVariantTraitsCardLoading(!1)),u("productTraitConfigurationCard")}}}function Ba(a){e(o.setIsProductTraitConfigurationCardLoading(!0)),d.createNewTraitHandler(a).then(n=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),n?(e(o.refreshSelectedTrait(n)),d.getOptionsForTraitHandler(n.traitId).then(c=>{e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:c.filter(p=>!p.isDeleted)}))}),d.getListOfAllTraitsHandler(),r({text:"Trait created successfully",type:"success"})):r({text:"Trait not created",description:n.error.message,type:"error"})})}function Aa(a){e(o.setIsProductTraitConfigurationCardLoading(!0)),d.updateTraitHandler(i.selectedTrait.traitId,a).then(n=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),n?(d.getListOfAllTraitsHandler(),r({text:"Trait updated successfully",type:"success"})):r({text:"Trait not updated",description:n.error.message,type:"error"})})}function Ra(a){d.updateOptionsForTraitHandler(a.optionId,a.updatedModel).then(n=>{n?(e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:i.colorOptionsGridRequestModel.items.map(c=>c.optionId===n.optionId?n:c)})),r({text:"Option updated successfully",type:"success"})):r({text:"Option not updated",description:n.error.message,type:"error"})})}function wa(){e(o.setIsTraitOptionsGridLoading(!0)),d.createNewOptionForTraitHandler(i.selectedTrait.traitId,{optionColor:"#fff",optionName:"Default option"}).then(a=>{e(o.setIsTraitOptionsGridLoading(!1)),a?(e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:[...i.colorOptionsGridRequestModel.items,a]})),d.getListOfAllTraitsHandler(),r({text:"Option created successfully",type:"success"})):r({text:"Option not created",description:a.error.message,type:"error"})})}async function za(a){await L({headerTitle:"Deleting option",text:`You are about to remove the option ${a.optionName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&d.deleteOptionsForTraitHandler(a.optionId).then(c=>{var p;c.error?r({text:(p=c.error)==null?void 0:p.message,type:"error"}):(d.getListOfAllTraitsHandler().then(g=>{e(V.refreshTraits(g))}),e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:i.colorOptionsGridRequestModel.items.filter(g=>g.optionId!==a.optionId)})),r({text:"Option deleted successfully",type:"success"}))})}function qa(a){d.changePositionOfTraitOptionHandler(a.selectedTrait.traitId,a.activeItem.optionId,a.newIndex)}function Wa(){u("productTraitConfigurationCard")}function $a(a){u("addVariantCard",!0),e(o.setIsAddVariantCardLoading(!0)),d.getListOfTraitsWithOptionsForProductHandler(a.productId).then(()=>{e(o.setIsAddVariantCardLoading(!1))})}function Ea(a){C(["manageProductCard"]),e(o.setIsProductConfigurationCardLoading(!0)),e(o.setIsVariantGridLoading(!0)),Promise.all([d.getProductDetailsHandler(a.productId),d.getListOfTraitsWithOptionsForProductHandler(a.productId),d.getPurchaseProductVariantsHandler(s.selectedPurchase.purchaseId,a.productId)]).then(([n,c,p])=>{e(o.setIsProductConfigurationCardLoading(!1)),e(o.setIsVariantGridLoading(!1)),n?e(o.refreshSelectedProduct(n)):(x({purchaseProductsCard:!0,manageProductCard:!1}),r({text:"Something gone wrong",type:"error"})),e(o.refreshPurchaseProductVariants(p))})}function Ua(a,n){e(o.setIsAddVariantCardLoading(!0)),d.checkVariantCombinationHandler(i.selectedProduct.productId,a).then(c=>{c?d.createVariantHandler(i.selectedProduct.productId,a).then(p=>{e(o.setIsAddVariantCardLoading(!1)),p?(u("addVariantCard"),d.getPurchaseProductVariantsHandler(n,i.selectedProduct.productId).then(g=>{e(o.refreshPurchaseProductVariants(g))}),r({text:"Variant added successfully",type:"success"})):r({text:"Variant not added",description:p.error.message,type:"error"})}):(e(o.setIsAddVariantCardLoading(!1)),e(o.refreshIsDuplicateVariant(!0)))})}function Ka(a,n){e(o.setIsAddVariantCardLoading(!0)),d.createVariantHandler(i.selectedProduct.productId,a).then(c=>{e(o.setIsAddVariantCardLoading(!1)),c?(u("addVariantCard"),d.getPurchaseProductVariantsHandler(n,i.selectedProduct.productId).then(p=>{e(o.refreshPurchaseProductVariants(p))}),r({text:"Variant added successfully",type:"success"})):r({text:"Variant not added",description:c.error.message,type:"error"})}),e(o.refreshIsDuplicateVariant(!1))}function Qa(){e(o.refreshIsDuplicateVariant(!1)),u("addVariantCard")}function Ya(a){Se(a.purchase.purchaseId,{...a.formData,variantId:a.row.original.variantId}).then(n=>{n.error?r({text:n.error.message,type:"error"}):(e(o.refreshPurchaseProductVariants(i.purchaseProductVariants.map(c=>c.variantId===a.row.original.variantId?{...c,variantStockActions:[...c.variantStockActions||[],n]}:c))),r({text:"Stock action added successfully",type:"success"}))})}function Xa(a){ke(a.stockAction.stockActionId,a.formData).then(n=>{n.error?r({text:n.error.message,type:"error"}):r({text:"Stock action updated successfully",type:"success"})})}function Za(a,n){e(o.setIsVariantGridLoading(!0)),be(a.stockActionId).then(c=>{e(o.setIsVariantsGridLoading(!1)),c?(d.getPurchaseProductVariantsHandler(s.selectedPurchase.purchaseId,i.selectedProduct.productId).then(p=>{e(o.setIsVariantGridLoading(!1)),e(o.refreshPurchaseProductVariants(p))}),K(n,i.purchasesProductsGridRequestModel),e(o.refreshPurchaseSummary({...i.purchaseSummary,unitsAmount:c.unitsAmount,expense:c.expense,valueAmount:c.valueAmount})),r({text:"Stock action deleted successfully",type:"success"})):r({text:c.error.message,type:"error"})})}function Ja(a){be(a.stockActionId).then(n=>{n.error?r({text:n.error.message,type:"error"}):(e(o.refreshPurchaseProducts(i.purchaseProducts.filter(c=>c.stockActionId!==a.stockActionId))),e(o.refreshPurchaseSummary({...i.purchaseSummary,unitsAmount:n.unitsAmount,expense:n.expense,valueAmount:n.valueAmount})),r({text:"Stock action deleted successfully",type:"success"}))})}function et(a){C(["manageProductCard","variantConfigurationCard"]),e(o.setIsVariantConfigurationCardLoading(!0)),e(o.setIsVariantOptionsGridLoading(!0)),e(o.setIsVariantPhotoGridLoading(!0)),Promise.all([d.getVariantDetailsHandler(a.variantId),d.getProductDetailsHandler(a.productId),d.getListOfTraitsWithOptionsForProductHandler(a.productId),d.getPurchaseProductVariantsHandler(s.selectedPurchase.purchaseId,a.productId)]).then(([n,c,p,g])=>{e(o.setIsVariantConfigurationCardLoading(!1)),e(o.setIsVariantOptionsGridLoading(!1)),e(o.setIsVariantPhotoGridLoading(!1)),e(o.refreshSelectedProduct(c)),n?(e(V.refreshSelectedVariant(n)),e(o.refreshVariantPhotos(n==null?void 0:n.photos)),e(o.setIsProductPhotoGridLoading(!0)),e(o.refreshPurchaseProductVariants(g)),d.getProductPhotosForVariantHandler(a.productId,a.variantId).then(I=>{e(o.setIsProductPhotoGridLoading(!1)),e(o.refreshProductPhotosForVariant(I))})):(r({text:"Variant not found",type:"error"}),u("variantConfigurationCard"))})}function at(a){e(o.setIsVariantConfigurationCardLoading(!0)),d.updateVariantDetailsHandler(a.variant.variantId,a.formattedData).then(n=>{e(o.setIsVariantConfigurationCardLoading(!1)),n?(e(V.refreshSelectedVariant(n)),r({text:"Variant updated successfully",type:"success"})):r({text:"Variant not updated",description:n.error.message,type:"error"})})}function tt(a){e(o.setIsManageTraitsCardLoading(!0)),d.updateVariantTraitOptionsHandler(a.variant.variantId,a.submissionData).then(n=>{e(o.setIsManageTraitsCardLoading(!1)),n?(d.getProductVariantsHandler(i.selectedProduct.productId).then(c=>{e(V.refreshProductVariants(c))}),d.getVariantDetailsHandler(a.variant.variantId).then(c=>{e(V.refreshSelectedVariant(c))}),r({text:"Variant trait options updated successfully",type:"success"})):r({text:"Variant trait options not updated",description:n.error.message,type:"error"})})}function rt(a){e(o.setIsDisposeStockCardLoading(!0)),d.disposeVariantFromStockHandler(a.variant.variantId,a.formattedData).then(n=>{e(o.setIsDisposeStockCardLoading(!1)),r(n?{text:"Variant disposed successfully",type:"success"}:{text:"Variant not disposed",description:n.error.message,type:"error"})})}function ot(a){e(o.setIsVariantPhotosCardLoading(!0)),me(a).then(n=>{e(o.setIsVariantPhotosCardLoading(!1)),n.error?r({text:"Photo not uploaded",description:n.error.message,type:"error"}):(e(o.refreshVariantPhotos([...i.variantPhotos,n.data])),e(V.refreshSelectedVariant({...s.selectedVariant,photos:[...s.selectedVariant.photos,n.data]})),r({text:"Photo uploaded successfully",type:"success"}))})}function st(a){d.attachProductPhotoToVariantHandler(s.selectedVariant.variantId,a.photoId).then(n=>{if(e(o.setIsVariantPhotosCardLoading(!1)),!n.error){const c=i.productPhotosForVariant.find(p=>p.photoId===a.photoId);if(c){const p=i.variantPhotos??[],g=p.some(I=>I.photoId===c.photoId)?p:[...p,c];e(o.refreshVariantPhotos(g)),e(o.refreshProductPhotosForVariant(i.productPhotosForVariant.filter(I=>I.photoId!==a.photoId)))}r({text:"Photo added to variant successfully",type:"success"})}})}async function nt(a){await L({headerTitle:"Detach photo from variant",text:`You are about to detach photo from variant  "${s.selectedVariant.variantName}".`,primaryButtonValue:"Detach",secondaryButtonValue:"Cancel"})&&await d.detachVariantPhotoHandler(s.selectedVariant.variantId,a.photoId).then(c=>{if(c.error)r({text:"Photo not added to variant",description:c.error.message,type:"error"});else{const p=i.variantPhotos??[],g=p.find(I=>I.photoId===a.photoId);if(g){const I=i.productPhotosForVariant??[],w=I.some(Ce=>Ce.photoId===g.photoId)?I:[...I,g];e(o.refreshProductPhotosForVariant(w));const ie=p.filter(Ce=>Ce.photoId!==a.photoId);e(o.refreshVariantPhotos(ie))}r({text:"Photo was detached successfully",type:"success"})}})}function it(a){d.changePhotoPositionForVariantHandler(s.selectedVariant.variantId,a.activeItem.photoId,a.newIndex).then(()=>{e(o.setIsVariantPhotoGridLoading(!0)),d.getVariantDetailsHandler(s.selectedVariant.variantId).then(n=>{e(o.setIsVariantPhotoGridLoading(!1)),e(V.refreshSelectedVariant(n)),e(o.refreshVariantPhotos(n==null?void 0:n.photos))})})}function dt(){u("addStockCard",!0),e(o.setIsAddStockCardLoading(!0)),d.getCurrenciesListHandler().then(a=>{e(o.setIsAddStockCardLoading(!1)),e(V.refreshCurrenciesList(a))})}function ct(){u("disposeStockCard",!0)}function ut(a){u("variantHistoryCard",!0),e(o.setIsVariantHistoryCardLoading(!0)),e(o.setIsVariantHistoryGridLoading(!0)),Promise.all([d.getVariantStockHistoryHandler(a),d.getVariantDetailsHandler(a)]).then(([n,c])=>{const p=n.map(g=>({...g,createdDate:Ae(g.createdDate,"date")}));e(o.setIsVariantHistoryCardLoading(!1)),e(o.setIsVariantHistoryGridLoading(!1)),e(o.refreshVariantHistory(p)),e(V.refreshSelectedVariant(c))})}function lt(){u("manageTraitsCard",!0)}function pt(){u("createCategoryCard")}function ht(){u("createBrandCard")}function mt(){u("variantPhotosCard",!0)}function Ct(){u("variantPhotosCard")}function gt(){u("variantConfigurationCard")}function Pt(){u("variantHistoryCard")}function ft(a){d.getVariantDetailsHandler(a.variantId).then(n=>{e(V.refreshSelectedVariant(n)),e(V.refreshVariantPhotos(n.photos)),e(V.refreshActiveTab("products")),S(`${Ne.PRODUCTS}${Ne.MANAGE_VARIANTS}/${a==null?void 0:a.productId}`)})}function yt(a){u("selectPurchaseCard"),e(o.refreshSelectedPurchase(a))}function xt(a){e(o.setIsPurchaseGridLoading(!0)),O({...i.purchaseGridRequestModel,searchQuery:a}).then(n=>{if(n.error)return;const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.purchaseId===((g=i.selectedPurchase)==null?void 0:g.purchaseId)}});e(o.refreshPurchaseGridRequestModel({...n.data,items:c}))})}function It(a){e(o.setIsPurchaseGridLoading(!0)),O({...i.purchaseGridRequestModel,filter:a}).then(n=>{if(n.error)return;const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.purchaseId===((g=i.selectedPurchase)==null?void 0:g.purchaseId)}});e(o.refreshPurchaseGridRequestModel({...n.data,items:c}))})}function Lt(a){return e(o.setIsSupplierCardLoading(!0)),l({date:a.selectedDate,supplierId:i.selectedCompany.companyId,documentNotes:a.purchaseNotes}).then(n=>{e(o.refreshSelectedPurchase(n.data)),e(o.setIsSupplierCardLoading(!1)),r(n?{text:j("SuccessMessages.PurchaseCreated"),type:"success"}:{text:n.error.message,type:"error"})})}function Ht(a){u("selectPurchaseCard",!0),O(a).then(n=>{if(n.error)return;const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.purchaseId===((g=i.selectedPurchase)==null?void 0:g.purchaseId)}});e(o.refreshPurchaseGridRequestModel({...n.data,items:c}))})}function Vt(){u("supplierCard",!0)}function vt(){e(V.resetSelectedSupplier()),u("selectEntityCard",!0),i.countryCodes||J(),e(o.setIsSelectEntityCardLoading(!0)),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(a=>{e(o.setIsSelectEntityCardLoading(!1)),e(o.setIsSuppliersGridLoading(!1));const n=a.data.items.map(c=>{var p;return{...c,isSelected:c.companyId===((p=i.selectedCompany)==null?void 0:p.companyId)}});e(o.refreshCompaniesGridRequestModel({...a.data,items:n}))})}function St(a){e(o.setIsSuppliersGridLoading(!0)),T({...i.companiesGridRequestModel,searchQuery:a}).then(n=>{e(o.setIsSuppliersGridLoading(!1));const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.companyId===((g=i.selectedCompany)==null?void 0:g.companyId)}});e(o.refreshCompaniesGridRequestModel({...n.data,items:c}))})}function kt(a){u("selectEntityCard"),e(o.refreshSelectedCompany(a))}function bt(){if(u("selectEntityCard",!0),i.companiesGridRequestModel===null)e(o.setIsSelectEntityCardLoading(!0)),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(a=>{e(o.setIsSelectEntityCardLoading(!1)),e(o.setIsSuppliersGridLoading(!1));const n=a.data.items.map(c=>{var p;return{...c,isSelected:c.companyId===((p=i.selectedCompany)==null?void 0:p.companyId)}});e(o.refreshCompaniesGridRequestModel({...a.data,items:n}))});else{const a=i.companiesGridRequestModel.items.map(n=>{var c;return{...n,isSelected:n.companyId===((c=i.selectedCompany)==null?void 0:c.companyId)}});e(o.refreshCompaniesGridRequestModel({...i.companiesGridRequestModel,items:a}))}}function Tt(){u("supplierCard")}function jt(){u("selectEntityCard")}function Nt(){u("supplierConfigurationCard")}function Gt(a){e(o.setIsAddStockCardLoading(!0)),P({id:a.purchaseId,model:a.priceModel}).then(n=>{e(o.setIsAddStockCardLoading(!1)),H(a.purchaseId).then(c=>{e(o.refreshSelectedPurchase(c.data))}),n?(u("addStockCard"),r({text:"Stock increased successfully",type:"success"})):r({text:"Stock not increased",description:n.error.message,type:"error"})})}function Dt(){u("addStockCard"),e(o.resetSelectedPurchase())}function Ft(a){K(a,i.purchasesProductsGridRequestModel),ne(a)}function Mt(a,n){n.activeTab==="purchaseProducts"?K(a,n.updates):E(n.updates).then(c=>{e(o.refreshVariantsForPurchaseGridRequestModel(c.data))})}function Ot(){u("createCompanyCard",!0),J()}function _t(a){e(o.setIsCreateCompanyCardLoading(!0)),se(a.company).then(n=>{n.error?r({text:n.error.details.message,type:"error"}):(a.image.uploadModels.map(c=>{c.contextId=n.data.companyId,e(o.setIsImageUploaderLoading(!0)),me(c).then(p=>{e(o.setIsImageUploaderLoading(!1)),r(p?{text:j("SuccessMessages.ImageAdded"),type:"success"}:{text:p.error.details.message,type:"error"})})}),oe({companyId:n.data.companyId,model:a.address}).then(()=>{e(o.setIsCreateCompanyCardLoading(!1)),u("createCompanyCard"),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(c=>{e(o.setIsSuppliersGridLoading(!1));const p=c.data.items.map(g=>{var I;return{...g,isSelected:g.companyId===((I=i.selectedCompany)==null?void 0:I.companyId)}});e(o.refreshCompaniesGridRequestModel({...c.data,items:p}))})}),r({text:"Company created successfully",type:"success"}))})}function Bt(){u("createCompanyCard")}function At(a){u("companyConfigurationCard",!0),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),J(),q(a.companyId).then(n=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(n.data))})}function Rt(a){e(o.setIsCompanyConfigurationCardLoading(!0)),Ze({companyId:i.managedCompany.companyId,model:a}).then(n=>{e(o.setIsCompanyConfigurationCardLoading(!1)),n.error?r({text:"Failed to update company",type:"error"}):(e(o.refreshManagedCompany(n.data)),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(c=>{e(o.setIsSuppliersGridLoading(!1));const p=c.data.items.map(g=>{var I;return{...g,isSelected:g.companyId===((I=i.selectedCompany)==null?void 0:I.companyId)}});e(o.refreshCompaniesGridRequestModel({...c.data,items:p}))}),r({text:"Company updated successfully",type:"success"}))})}async function wt(a){await L({headerTitle:"Deleting company",text:`You are about to delete company ${a.companyName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&(e(o.setIsCompanyConfigurationCardLoading(!0)),y(a.companyId).then(c=>{if(c.error){r({text:"Failed to delete company",type:"error"});return}else r({text:"Company deleted successfully",type:"info"}),u("companyConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.resetManagedCompany()),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(p=>{e(o.setIsSuppliersGridLoading(!1));const g=p.data.items.map(I=>{var w;return{...I,isSelected:I.companyId===((w=i.selectedCompany)==null?void 0:w.companyId)}});e(o.refreshCompaniesGridRequestModel({...p.data,items:g}))}),i.selectedCompany.companyId===i.managedCompany.companyId&&e(o.resetSelectedCompany())}))}function zt(){u("companyConfigurationCard"),e(o.resetManagedCompany())}function qt(){u("companyPhotosCard",!0)}async function Wt(a){await L({headerTitle:"Deleting company photo",text:"You are about to delete company photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&M(a.photoId).then(c=>{const p=i.managedCompany.photos.filter(g=>g.photoId!==a.photoId);e(o.refreshManagedCompany({...i.managedCompany,photos:p})),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(g=>{e(o.setIsSuppliersGridLoading(!1));const I=g.data.items.map(w=>{var ie;return{...w,isSelected:w.companyId===((ie=i.selectedCompany)==null?void 0:ie.companyId)}});e(o.refreshCompaniesGridRequestModel({...g.data,items:I}))}),c.error?r({text:"Photo not deleted",description:c.error.details.message,type:"error"}):r({text:"Photo deleted successfully",type:"success"})})}function $t(a){u(a==="Company"?"companyPhotosCard":"locationPhotosCard")}function Et(a){u("locationConfigurationCard",!0),J(),e(a?o.refreshManagedLocation(a):o.resetManagedLocation())}function Ut(a){e(o.setIsLocationConfigurationCardLoading(!0)),D({companyId:i.managedCompany.companyId,model:a}).then(n=>{var c;n.error?r({text:(c=n.error.data)==null?void 0:c.detail,type:"error"}):(u("locationConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),q(i.managedCompany.companyId).then(p=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(p.data))}),r({text:"Location added successfully",type:"success"}))})}function Kt(a){e(o.setIsLocationConfigurationCardLoading(!0)),ta(a.locationId).then(n=>{var c;n.error?r({text:(c=n.error.data)==null?void 0:c.detail,type:"error"}):(u("locationConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),q(i.managedCompany.companyId).then(p=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(p.data))}),r({text:"Location deleted successfully",type:"success"}))})}function Qt(){u("locationPhotosCard",!0)}function Yt(a){e(o.setIsLocationConfigurationCardLoading(!0)),aa({locationId:i.managedLocation.locationId,model:a}).then(n=>{e(o.setIsLocationConfigurationCardLoading(!1)),n.error?r({text:"Failed to update location",type:"error"}):(e(o.setIsCompanyConfigurationCardLoading(!0)),q(i.managedCompany.companyId).then(c=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.refreshManagedCompany(c.data))}),r({text:"Location updated successfully",type:"success"}))})}async function Xt(a){await L({headerTitle:"Deleting location photo",text:"You are about to delete location photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&M(a.photoId).then(c=>{const p=i.managedLocation.photos.filter(g=>g.photoId!==a.photoId);e(o.refreshManagedLocation({...i.managedLocation,photos:p})),c.error?r({text:"Photo not deleted",description:c.error.details.message,type:"error"}):r({text:"Photo deleted successfully",type:"success"})})}function Zt(){u("locationConfigurationCard"),e(o.resetManagedLocation())}function Jt(){u("selectPurchaseCard")}return{state:i,appState:h,productsState:s,productsService:d,getPurchaseProductsPageDataHandler:ra,getPurchasesProductsGridDataHandler:oa,getVariantsForPurchaseGridDataHandler:sa,getGridFiltersDataHandler:na,addProductToPurchaseHandler:ia,updatePurchaseProductHandler:da,openCreateProductCardHandler:ca,submitProductDataHandler:ua,openCreateProductCategoryCardHandler:la,checkCategoryNameHandler:pa,createProductCategoryHandler:ha,openCreateProductBrandCardHandler:ma,checkBrandNameHandler:Ca,createProductBrandHandler:ga,uploadCategoryOrBrandPhotoHandler:Pa,closeProductConfigurationCardHandler:fa,generateProductCodeHandler:ya,checkProductCodeHandler:xa,openPurchaseProductsCardHandler:Ia,openManageProductCardHandler:La,manageProductDataHandler:Ha,manageProductPhotosHandler:Va,uploadPhotoHandler:va,changePhotoPositionHandler:Sa,deletePhotoHandler:ka,setPhotoActivationStateHandler:ba,closeProductPhotosCardHandler:Ta,openConnectImageCardHandler:ja,imageActionsHandler:Na,attachImageToVariantHandler:Te,detachImageFromVariantHandler:je,closeConnectImageCardHandler:Ga,manageProductTraitsHandler:Da,addTraitHandler:Fa,manageTraitHandler:Ma,setProductTraitsHandler:Oa,deleteTraitHandler:_a,createTraitHandler:Ba,updateTraitHandler:Aa,updateOptionHandler:Ra,addOptionHandler:wa,deleteOptionHandler:za,dndTraitOptionHandler:qa,closeProductTraitConfigurationCardHandler:Wa,openAddVariantCardHandler:$a,addVariantGridActionHandler:Ea,addVariantHandler:Ua,addDuplicatedVariantHandler:Ka,closeAddVariantCardHandler:Qa,addStockActionHandler:Ya,updateStockActionHandler:Xa,deleteStockActionHandler:Za,deleteStockActionInGridHandler:Ja,manageVariantHandler:et,updateVariantDetailsHandler:at,updateVariantTraitOptionsHandler:tt,disposeFromStockHandler:rt,uploadPhotoToVariantHandler:ot,addPhotoToVariantHandler:st,detachPhotoFromVariantHandler:nt,dndVariantPhotoHandler:it,openAddStockCardHandler:dt,openDisposeStockCardHandler:ct,openVariantHistoryCardHandler:ut,openManageTraitsCardHandler:lt,closeCreateProductCategoryCardHandler:pt,closeCreateProductBrandCardHandler:ht,openVariantPhotosCardHandler:mt,closeVariantPhotosCardHandler:Ct,closeVariantConfigurationCardHandler:gt,closeVariantHistoryCardHandler:Pt,navigateToManageVariantHandler:ft,selectPurchaseHandler:yt,searchSupplierHandler:xt,filterSuppliersByDateHandle:It,openSelectPurchaseCardHandler:Ht,openSupplierCardHandler:Vt,openSelectEntityCardHandler:vt,searchEntityHandle:St,selectCompanyHandle:kt,detachSupplierHandler:bt,createPurchaseForSupplierHandler:Lt,closeSupplierCardHandler:Tt,closeSelectEntityCardHandler:jt,closeSupplierConfigurationCardHandler:Nt,increaseStockAmountHandler:Gt,closeAddStockCardHandler:Dt,refreshPurchaseProductsTabHandler:Ft,gridRequestChangeHandler:Mt,openCreateEntityCardHandler:Ot,createCompanyHandler:_t,closeCreateCompanyCardHandler:Bt,manageCompanyHandler:At,updateCompanyHandler:Rt,deleteCompanyHandler:wt,manageCompanyPhotosHandler:qt,closeCompanyConfigurationCardHandler:zt,deleteCompanyPhotoHandler:Wt,closePhotosCardHandler:$t,openLocationConfigurationCardHandler:Et,createLocationHandler:Ut,deleteLocationHandler:Kt,manageLocationPhotosHandler:Qt,updateLocationHandler:Yt,deleteLocationPhotoHandler:Xt,closeLocationConfigurationCardHandler:Zt,closeSelectPurchaseCardHandler:Jt}}const eo="_purchaseProductsCard_1lsai_1",ao="_purchaseProductsCardContent_1lsai_5",to="_tabItemsWrapper_1lsai_5",ro="_tabItems_1lsai_5",oo="_tabItemTrigger_1lsai_17",so="_tabBlock_1lsai_27",no="_purchaseSummary_1lsai_35",io="_purchaseSummaryTitle_1lsai_44",co="_purchaseSummaryItems_1lsai_47",k={purchaseProductsCard:eo,purchaseProductsCardContent:ao,tabItemsWrapper:to,tabItems:ro,tabItemTrigger:oo,tabBlock:so,purchaseSummary:no,purchaseSummaryTitle:io,purchaseSummaryItems:co},uo="_productName_1bem4_1",lo="_productCode_1bem4_5",po="_noImageIcon_1bem4_9",ho="_productCategory_1bem4_13",mo="_productBrand_1bem4_13",ae={productName:uo,productCode:lo,noImageIcon:po,productCategory:ho,productBrand:mo},Co="_purchaseProducts_1w6nz_1",go="_purchaseProductsForm_1w6nz_1",Po="_purchaseFormItemTaxCurrency_1w6nz_12",fo="_purchaseFormItemNettoPrice_1w6nz_17",yo="_purchaseFormItemQuantity_1w6nz_22",xo="_purchaseProductsFormIcon_1w6nz_27",Io="_variantGridButtonBlock_1w6nz_32",Lo="_formItemsValid_1w6nz_36",Ho="_buttonValid_1w6nz_40",N={purchaseProducts:Co,purchaseProductsForm:go,purchaseFormItemTaxCurrency:Po,purchaseFormItemNettoPrice:fo,purchaseFormItemQuantity:yo,purchaseProductsFormIcon:xo,variantGridButtonBlock:Io,formItemsValid:Lo,buttonValid:Ho},Ye=Hr({nettoPrice:ce(),currencyId:ce().optional(),taxTypeId:ce().optional(),unitsAmount:ce()}),Le={nettoPrice:void 0,currencyId:void 0,taxTypeId:void 0,unitsAmount:void 0};function Xe({data:u,currencies:x,taxes:C,activeTab:i,isVariantGrid:s=!1,onSubmit:h,onDelete:d,onCancel:e}){const{form:r,isValid:S}=We({values:u,defaultValues:Le,scheme:Ye,mode:Ee.CHANGE});function L(){h(r.getValues())}return t.jsx("div",{className:N.purchaseProducts,children:t.jsxs($e,{form:r,className:N.purchaseProductsForm,defaultValues:Le,fullWidth:!0,hidePrimaryBtn:!0,hideSecondaryBtn:!0,onSubmit:h,onCancel:e,children:[t.jsx(Y,{name:"nettoPrice",className:N.purchaseFormItemNettoPrice,render:({field:m})=>t.jsx(ue,{className:N.purchaseFormItemNettoPrice,children:t.jsx(pe,{value:m.value,className:i==="connectProducts"&&m.value?N.formItemsValid:"",type:"number",min:0,minWidth:"100px",maxWidth:"100px",placeholder:"0"})})}),t.jsx(Me,{control:r.control,name:"currencyId",render:({field:m})=>t.jsx(ue,{className:N.purchaseFormItemTaxCurrency,children:t.jsx(he,{selected:(u==null?void 0:u.currencyId)||(m==null?void 0:m.value),className:i==="connectProducts"&&m.value?N.formItemsValid:"",placeholder:" ",items:x,hideFirstOption:!0,minWidth:"70px",maxWidth:"70px",onSelect:j=>{m.onChange(j),r.trigger("currencyId")}})})}),t.jsx(Me,{control:r.control,name:"taxTypeId",render:({field:m})=>t.jsx(ue,{className:N.purchaseFormItemTaxCurrency,children:t.jsx(he,{placeholder:" ",className:i==="connectProducts"&&m.value?N.formItemsValid:"",selected:m.value||(u==null?void 0:u.taxTypeId),items:C,hideFirstOption:!0,minWidth:"70px",maxWidth:"70px",onSelect:j=>{m.onChange(j),r.trigger("taxTypeId")}})})}),t.jsx(He,{className:N.purchaseProductsFormIcon,icon:or}),t.jsx(Y,{name:"unitsAmount",className:N.purchaseFormItemTaxCurrency,render:({field:m})=>t.jsx(ue,{className:N.purchaseFormItemQuantity,children:t.jsx(pe,{value:m.value,className:i==="connectProducts"&&m.value?N.formItemsValid:"",type:"number",min:0,hideErrorMessage:!0,width:"80px",minWidth:"80px",maxWidth:"80px",placeholder:"0"})})}),s?t.jsxs("div",{className:N.variantGridButtonBlock,children:[t.jsx(F,{icon:Re,variant:"secondary",value:"Save"}),t.jsx(F,{icon:Ue,type:"button",variant:"secondary",disabled:!u.stockActionId,onClick:d})]}):t.jsx(F,{className:i==="connectProducts"&&S?N.buttonValid:"",style:{marginLeft:"10px"},value:i==="connectProducts"?"Add":"Update",variant:"ghost",type:"submit",disabled:i==="connectProducts"?!S:!1,onClick:()=>L()})]})})}function Vo({row:u,table:x,onAction:C}){return x.options.meta,t.jsxs(sr,{children:[t.jsx(nr,{asChild:!0,children:t.jsxs(F,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[t.jsx(Vr,{}),t.jsx("span",{className:"sr-only",children:"Open menu"})]})}),t.jsxs(ir,{align:"start",className:"w-[160px]",children:[t.jsx(ee,{onClick:()=>C("addVariant",u),children:"Add additional variants"}),t.jsx(ee,{onClick:()=>C("manageVariant",u),children:"Manage variant"}),t.jsx(ee,{onClick:()=>C("transferToPurchase",u),children:"Transfer to purchase"}),t.jsx(ee,{onClick:()=>C("removeFromStock",u),children:"Remove from stock"}),t.jsx(ee,{onClick:()=>C("stockChangeHistory",u),children:"Stock change history"})]})]})}function vo(u,x,C,i){return[{accessorKey:"photo",header:"Image",minSize:80,maxSize:80,cell:({row:s,table:h})=>{const d=s.getValue("photo"),e=h.options.meta;return t.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>i("image",s.id,e==null?void 0:e.setLoadingRow),children:d?t.jsx("img",{src:(d==null?void 0:d.thumbnailUrl)||qe,alt:s.getValue("variantName"),className:"object-cover rounded-md w-full h-full"}):t.jsx("div",{children:t.jsx(He,{icon:Ke,maxWidth:"60px",className:ae.noImageIcon})})})}},{accessorKey:"variantCode",header:"Code",minSize:70,maxSize:150,cell:({row:s})=>t.jsx($,{delayDuration:200,text:s.getValue("variantCode"),children:t.jsx("span",{className:ae.productCode,children:s.getValue("variantCode")})})},{accessorKey:"variantName",header:"Product Name",minSize:70,cell:({row:s})=>t.jsx($,{delayDuration:200,text:s.getValue("variantName"),children:t.jsx("span",{className:ae.productName,children:s.getValue("variantName")})})},{accessorKey:"productCategory",header:"Category",minSize:70,cell:({row:s})=>{var d,e;const h=s.getValue("productCategory");return t.jsx($,{delayDuration:200,text:(h==null?void 0:h.categoryName)||"N/A",children:t.jsxs("div",{className:ae.productCategory,children:[((d=s.original.productCategory)==null?void 0:d.thumbnail)&&t.jsx("img",{src:(e=s.original.productCategory)==null?void 0:e.thumbnail,alt:s.original.productCategory.categoryName}),t.jsx("span",{children:(h==null?void 0:h.categoryName)||"N/A"})]})})}},{accessorKey:"brand",header:"Brand",minSize:70,cell:({row:s})=>{var d,e;const h=s.getValue("brand");return t.jsx($,{delayDuration:200,text:(h==null?void 0:h.brandName)||"N/A",children:t.jsxs("div",{className:ae.productBrand,children:[((d=s.original.brand)==null?void 0:d.thumbnail)&&t.jsx("img",{src:(e=s.original.brand)==null?void 0:e.thumbnail,alt:s.original.brand.brandName}),t.jsx("span",{children:(h==null?void 0:h.brandName)||"N/A"})]})})}},{accessorKey:"traitOptions",header:"Details",minSize:60,maxSize:150,cell:({row:s})=>{const h=s.original.traitOptions||[],d=h.filter(r=>r.traitTypeId===2&&r.optionColor),e=h.filter(r=>r.traitTypeId===1&&r.optionName);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[d.map((r,S)=>t.jsx("div",{style:{background:r.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${S}`)),e.map((r,S)=>t.jsx("span",{style:{fontSize:"0.875rem"},children:r.optionName},`size-${S}`))]})}},{accessorKey:"",minSize:500,maxSize:500,header:C==="connectProducts"?"Quantity to add":"Quantity in purchase",cell:({row:s})=>{const h=s.original.stockActionId,d={unitsAmount:s.original.unitsAmount,currencyId:Number(s.original.stockDocumentPrice.currencyId),taxTypeId:Number(s.original.stockDocumentPrice.taxTypeId),nettoPrice:s.original.stockDocumentPrice.netto};return t.jsx(Xe,{activeTab:C,taxes:Z(x,{text:"name",value:"id"}),currencies:Z(u,{text:"briefName",value:"id"}),data:d,onSubmit:e=>{i("updatePurchaseProduct",{data:e,stockActionId:h})}})}},{id:"rowActions",header:"",minSize:50,maxSize:50,cell:({row:s,table:h})=>t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx(Vo,{row:s,onAction:i,table:h})})}]}const So="_productName_zht6d_1",ko="_productCode_zht6d_5",bo="_noImageIcon_zht6d_9",To="_productCategory_zht6d_13",jo="_productBrand_zht6d_13",No="_gridButton_zht6d_26",Q={productName:So,productCode:ko,noImageIcon:bo,productCategory:To,productBrand:jo,gridButton:No};function Go(u,x,C,i){return[{accessorKey:"photo",header:"Image",minSize:80,maxSize:80,cell:({row:s,table:h})=>{const d=s.getValue("photo"),e=h.options.meta;return t.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>i("image",s.id,e==null?void 0:e.setLoadingRow),children:d?t.jsx("img",{src:(d==null?void 0:d.thumbnailUrl)||qe,alt:s.getValue("variantName"),className:"object-cover rounded-md w-full h-full"}):t.jsx(He,{icon:Ke,className:Q.noImageIcon})})}},{accessorKey:"variantCode",header:"Code",minSize:70,maxSize:150,cell:({row:s})=>t.jsx($,{delayDuration:200,text:s.getValue("variantCode"),children:t.jsx("span",{className:Q.productCode,children:s.getValue("variantCode")})})},{accessorKey:"variantName",header:"Product Name",minSize:70,cell:({row:s})=>t.jsx($,{delayDuration:200,text:s.getValue("variantName"),children:t.jsx("span",{className:Q.productName,children:s.getValue("variantName")})})},{accessorKey:"productCategory",header:"Category",minSize:70,cell:({row:s})=>{var d,e;const h=s.getValue("productCategory");return t.jsx($,{delayDuration:200,text:(h==null?void 0:h.categoryName)||"N/A",children:t.jsxs("div",{className:Q.productCategory,children:[((d=s.original.productCategory)==null?void 0:d.thumbnail)&&t.jsx("img",{src:(e=s.original.productCategory)==null?void 0:e.thumbnail,alt:s.original.productCategory.categoryName}),t.jsx("span",{children:(h==null?void 0:h.categoryName)||"N/A"})]})})}},{accessorKey:"brand",header:"Brand",minSize:70,cell:({row:s})=>{var d,e;const h=s.getValue("brand");return t.jsx($,{delayDuration:200,text:(h==null?void 0:h.brandName)||"N/A",children:t.jsxs("div",{className:Q.productBrand,children:[((d=s.original.brand)==null?void 0:d.thumbnail)&&t.jsx("img",{src:(e=s.original.brand)==null?void 0:e.thumbnail,alt:s.original.brand.brandName}),t.jsx("span",{children:(h==null?void 0:h.brandName)||"N/A"})]})})}},{accessorKey:"traitOptions",header:"Details",minSize:60,maxSize:150,cell:({row:s})=>{const h=s.original.traitOptions||[],d=h.filter(r=>r.traitTypeId===2&&r.optionColor),e=h.filter(r=>r.traitTypeId===1&&r.optionName);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[d.map((r,S)=>t.jsx("div",{style:{background:r.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${S}`)),e.map((r,S)=>t.jsx("span",{style:{fontSize:"0.875rem"},children:r.optionName},`size-${S}`))]})}},{id:"nettoPriceGroup",accessorKey:"",minSize:480,maxSize:480,header:()=>t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{style:{marginRight:"40px"},children:"Netto Price"}),t.jsx("span",{style:{marginRight:"22px"},children:"Currency"}),t.jsx("span",{style:{marginRight:"85px"},children:"Tax"}),t.jsx("span",{children:"Quantity"})]}),cell:({row:s})=>{const h=s.original.variantId;return t.jsx(Xe,{activeTab:C,taxes:Z(x,{text:"name",value:"id"}),currencies:Z(u,{text:"briefName",value:"id"}),onSubmit:d=>{i("addProductToPurchase",{data:d,variantId:h})}})}},{id:"manage",minSize:120,maxSize:120,cell:({row:s})=>t.jsx("div",{className:Q.gridButton,onClick:h=>h.stopPropagation(),children:t.jsx(F,{style:{marginLeft:"20px"},icon:Ve,value:"Manage",variant:"secondary",onClick:()=>i("navigateToManageVariant",s.original)})})}]}function Do({isLoading:u,isPurchaseProductsGridLoading:x,isProductsGridLoading:C,purchaseProductsGridRequestModel:i,variantsGridRequestModel:s,preferences:h,sortingOptions:d,brands:e,categories:r,colorsForFilter:S,sizesForFilter:L,variantsSkeletonQuantity:m,currencies:j,taxes:z,purchaseSummary:P,purchaseId:B,onAction:v}){var re,oe,se,q;const[G,M]=X.useState("purchaseProducts"),{translate:b}=Qe(),A=we(),R=Be(),O=le(te.APP);function H(y){y!==G&&(M(y),R(o.refreshActiveTab(y)),y==="purchaseProducts"&&v("refreshPurchaseProductsTab",B),y==="connectProducts"&&v("refreshConnectProductsTab",B))}function l(y,D){switch(y){case"addProductToPurchase":v("addProductToPurchase",D);break;case"updatePurchaseProduct":v("updatePurchaseProduct",D);break;case"addVariant":v("addVariantGridAction",D.original);break;case"manageVariant":v("manageVariant",D.original);break;case"transferToPurchase":console.log("transferToPurchase");break;case"removeFromStock":v("deleteStockActionInGrid",D.original);break;case"stockChangeHistory":v("openVariantHistoryCard",D.original.variantId);break;case"navigateToManageVariant":v("navigateToManageVariant",D);break}}function T(y){const D=cr.merge({},O.preferences,y);R(ur.refreshPreferences(D)),A.updateUserPreferencesHandler(D)}function E(){A.resetUserPreferencesHandler("products")}return t.jsx(ze,{className:k.purchaseProductsCard,title:"Manage Purchases",titleTransKey:"CardTitles.ManagePurchases",showHeader:!1,isLoading:u,children:t.jsx("div",{className:k.purchaseProductsCardContent,children:t.jsxs(xr,{defaultValue:"purchaseProducts",onValueChange:H,children:[t.jsx("div",{className:k.tabItemsWrapper,children:t.jsxs(Ir,{className:k.tabItems,children:[t.jsxs("div",{children:[t.jsx(Ge,{className:k.tabItemTrigger,value:"purchaseProducts",children:t.jsxs("div",{className:k.tabBlock,children:[t.jsx(dr,{size:"16"})," ",b("TabLabels.PurchaseProducts")]})}),t.jsx(Ge,{className:k.tabItemTrigger,value:"connectProducts",children:t.jsxs("div",{className:k.tabBlock,children:[t.jsx(Tr,{size:"16"}),b("TabLabels.ConnectProducts")]})})]}),t.jsx(F,{value:"Create Product",valueTransKey:"ProductActions.CreateProduct",icon:ve,variant:"info",onClick:()=>v("openCreateProductCard")})]})}),t.jsxs(De,{value:"purchaseProducts",children:[t.jsxs(Ie,{isLoading:x,className:k.purchaseProductsGrid,columns:vo(j,z,G,l),data:i.items,gridRequestModel:i,sortingItems:d,columnsPreferences:h,preferenceContext:"productReferences",skeletonQuantity:P==null?void 0:P.unitsAmount,onApplyColumns:T,onDefaultColumns:E,onGridRequestChange:y=>v("gridRequestChange",{updates:y,activeTab:G}),children:[t.jsx(de,{items:e,columnName:b("SectionTitles.Brand"),getId:y=>y.brandId,getName:y=>y.brandName,selected:(re=i==null?void 0:i.filter)==null?void 0:re.brands}),t.jsx(de,{items:r,columnName:b("SectionTitles.Category"),getId:y=>y.categoryId,getName:y=>y.categoryName,selected:(oe=i==null?void 0:i.filter)==null?void 0:oe.categories})]}),t.jsxs("div",{className:k.purchaseSummary,children:[t.jsx("span",{className:k.purchaseSummaryTitle,children:b("PurchaseForm.Labels.PurchaseSummary")}),t.jsxs("div",{className:k.purchaseSummaryItems,children:[t.jsxs("div",{children:[t.jsx("span",{className:k.purchaseSummaryTitle,children:b("PurchaseForm.Labels.Units")}),!fe.isNil(P==null?void 0:P.unitsAmount)&&t.jsx("span",{className:k.purchaseSummaryItem,children:`: ${P==null?void 0:P.unitsAmount}`})]}),t.jsxs("div",{children:[t.jsx("span",{className:k.purchaseSummaryTitle,children:b("PurchaseForm.Labels.Expense")}),!fe.isNil(P==null?void 0:P.expense)&&t.jsx("span",{className:k.purchaseSummaryItem,children:`: ${P==null?void 0:P.expense} ${P==null?void 0:P.currencyBrief}`})]}),t.jsxs("div",{children:[t.jsx("span",{className:k.purchaseSummaryTitle,children:b("PurchaseForm.Labels.ProjectedValue")}),!fe.isNil(P==null?void 0:P.valueAmount)&&t.jsx("span",{className:k.purchaseSummaryItem,children:`: ${P==null?void 0:P.valueAmount} ${P==null?void 0:P.currencyBrief}`})]})]})]})]}),t.jsx(De,{value:"connectProducts",children:t.jsxs(Ie,{isLoading:C,className:k.purchaseProductsGrid,columns:Go(j,z,G,l),data:s.items,gridRequestModel:s,sortingItems:d,columnsPreferences:h,preferenceContext:"productReferences",skeletonQuantity:m,onApplyColumns:T,onDefaultColumns:E,onGridRequestChange:y=>v("gridRequestChange",{updates:y,activeTab:G}),children:[t.jsx(de,{items:e,columnName:b("SectionTitles.Brand"),getId:y=>y.brandId,getName:y=>y.brandName,selected:(se=s==null?void 0:s.filter)==null?void 0:se.brands}),t.jsx(de,{items:r,columnName:b("SectionTitles.Category"),getId:y=>y.categoryId,getName:y=>y.categoryName,selected:(q=s==null?void 0:s.filter)==null?void 0:q.categories}),t.jsx(Fe,{traitOptions:S,traitType:"color"}),t.jsx(Fe,{traitOptions:L,traitType:"size"}),t.jsx(Lr,{context:"Deleted"})]})})]})})})}const Fo="_manageProductCard_1bv78_1",Mo="_manageProductCardContent_1bv78_1",Oo="_productDataBlock_1bv78_1",_o="_productDataBlockManage_1bv78_7",Bo="_productDataRow_1bv78_10",Ao="_productDataCell_1bv78_15",Ro="_traitsDataCell_1bv78_30",wo="_footerBlock_1bv78_38",zo="_productsForPurchaseForm_1bv78_42",f={manageProductCard:Fo,manageProductCardContent:Mo,productDataBlock:Oo,productDataBlockManage:_o,productDataRow:Bo,productDataCell:Ao,traitsDataCell:Ro,footerBlock:wo,productsForPurchaseForm:zo},qo="_purchaseProducts_1xbfo_1",Wo="_purchaseProductsForm_1xbfo_1",$o="_formItemsValid_1xbfo_17",U={purchaseProducts:qo,purchaseProductsForm:Wo,formItemsValid:$o};function Eo({data:u,currencies:x,taxes:C,activeTab:i,onSubmit:s,onDelete:h}){const{form:d}=We({values:u,defaultValues:Le,scheme:Ye,mode:Ee.SUBMIT});return t.jsx("div",{className:U.purchaseProducts,children:t.jsxs($e,{className:U.purchaseProductsForm,form:d,fullWidth:!0,primaryBtnProps:{value:"Save",icon:Re,variant:"secondary",minWidth:"fit-content",disabled:!d.formState.isValid},secondaryBtnProps:{value:null,icon:Ue,variant:"outline",minWidth:"fit-content",disabled:!(u!=null&&u.stockActionId)},onSubmit:s,onCancel:h,children:[t.jsx(Y,{className:U.formItem,name:"nettoPrice",render:({field:e})=>t.jsx(pe,{label:"Price",value:e.value,className:i==="connectProducts"&&e.value?U.formItemsValid:"",type:"number",onBeforeInput:r=>{/[0-9.,\-]/.test(r.nativeEvent.data??"")||r.preventDefault()},minWidth:"80px",maxWidth:"80px",placeholder:" "})}),t.jsx(Y,{name:"taxTypeId",render:({field:e})=>t.jsx(he,{label:"Tax",placeholder:" ",className:i==="connectProducts"&&e.value?U.formItemsValid:"",selected:e.value,items:C,hideFirstOption:!0,minWidth:"70px",maxWidth:"70px"})}),t.jsx(Y,{name:"currencyId",render:({field:e})=>t.jsx(he,{selected:e==null?void 0:e.value,items:x,className:i==="connectProducts"&&e.value?U.formItemsValid:"",label:"Currency",placeholder:" ",hideFirstOption:!0,minWidth:"80px",maxWidth:"80px"})}),t.jsx(Y,{name:"unitsAmount",render:({field:e})=>t.jsx(pe,{label:"Quantity",value:e.value,type:"number",onBeforeInput:r=>{/[0-9.,\-]/.test(r.nativeEvent.data??"")||r.preventDefault()},className:i==="connectProducts"&&e.value?U.formItemsValid:"",width:"70px",minWidth:"70px",maxWidth:"70px",placeholder:" "})})]})})}function Uo(u){return[{id:"add",header:"Add",minSize:100,maxSize:100,cell:({row:x,table:C})=>{const i=C.options.meta,s=h=>{h.stopPropagation(),h.preventDefault(),u("addRow",x.original)};return t.jsx("div",{onClick:h=>h.stopPropagation(),children:t.jsx(F,{icon:ve,onClick:s,disabled:i==null?void 0:i.isRowLoading(x.id)})})}},{accessorKey:"traitOptions",header:"Details",minSize:250,cell:({row:x})=>{const C=x.original.traitOptions||[],i=C.filter(h=>h.traitTypeId===2&&h.optionColor),s=C.filter(h=>h.traitTypeId===1&&h.optionName);return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[i.map((h,d)=>t.jsx("div",{style:{background:h.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${d}`)),s.map((h,d)=>t.jsx("span",{style:{fontSize:"0.875rem"},children:h.optionName},`size-${d}`))]})}},{id:"rowActions",header:"Actions",minSize:175,maxSize:175,cell:({row:x})=>t.jsx(F,{icon:Ve,value:"Manage Variant",variant:"secondary",onClick:()=>u("manageVariant",x.original)})}]}const xe={currencyId:void 0,nettoPrice:void 0,taxTypeId:void 0,unitsAmount:void 0};function Ko({isLoading:u,purchase:x,product:C,variants:i,currencies:s,taxes:h,isVariantGridLoading:d,productTraits:e,onAction:r}){var B,v,G,M,b,A,R,O;const[S,L]=X.useState([]),{translate:m}=Qe();X.useEffect(()=>{!i||i.length===0||L(i.map(H=>{var l;return{...H,id:H.variantId,expandableRows:((l=H.variantStockActions)==null?void 0:l.length)>0?H.variantStockActions:[xe]}}))},[i]);function j(H,l){switch(H){case"addRow":z(l.variantId);break;case"manageVariant":r("manageVariant",l);break;case"addStockAction":l.stockAction.stockActionId?r("updateStockAction",l):r("addStockAction",l);break}}function z(H){L(l=>l.map(T=>T.id===H?{...T,expandableRows:[...T.expandableRows||[],xe]}:T))}function P(H,l,T){return t.jsx("div",{className:f.productsForPurchaseForm,children:t.jsx(Eo,{data:l,taxes:Z(h,{text:"name",value:"id"}),currencies:Z(s,{text:"briefName",value:"id"}),isVariantGrid:!0,onSubmit:E=>{j("addStockAction",{purchase:x,row:H,formData:E,stockAction:l})},onDelete:()=>r("deleteStockAction",l)})})}return t.jsx(ze,{className:f.manageProductCard,title:m("CardTitles.ManageProductForPurchase",{date:Ae(x==null?void 0:x.date,"date")}),minWidth:"560px",maxWidth:"560px",isLoading:u,showFooter:!0,footerClassName:f.footerBlock,showPrimaryButton:!1,secondaryButtonTitle:"Back to Product list",secondaryButtonTitleTransKey:"ProductActions.BackToProductList",secondaryButtonProps:{icon:vr},onSecondaryButtonClick:()=>r("openPurchaseProductsCard"),children:t.jsxs("div",{className:f.manageProductCardContent,children:[t.jsxs("div",{className:`${f.productDataBlock} ${f.productDataBlockManage}`,children:[t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-title`,children:m("SectionTitles.Product")}),t.jsx(F,{className:f.productDataCell,value:"Manage Product",valueTransKey:"ProductActions.ManageProduct",icon:Ve,variant:"secondary",maxWidth:"160px",onClick:()=>r("manageProductData")})]}),t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-text`,children:m("ProductForm.Labels.ProductName")}),t.jsx("span",{className:`${f.productDataCell} she-text`,children:C==null?void 0:C.productName})]}),t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-text`,children:m("ProductForm.Labels.ProductCode")}),t.jsx("span",{className:`${f.productDataCell} she-text`,children:C==null?void 0:C.productCode})]}),t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-text`,children:m("SectionTitles.Category")}),t.jsxs("div",{className:f.productDataCell,children:[((B=C==null?void 0:C.productCategory)==null?void 0:B.thumbnail)&&t.jsx("img",{src:(v=C==null?void 0:C.productCategory)==null?void 0:v.thumbnail,alt:(G=C==null?void 0:C.productCategory)==null?void 0:G.categoryName}),t.jsx("span",{className:"she-text",children:(M=C==null?void 0:C.productCategory)==null?void 0:M.categoryName})]})]}),t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-text`,children:m("SectionTitles.Brand")}),t.jsxs("div",{className:f.productDataCell,children:[((b=C==null?void 0:C.brand)==null?void 0:b.thumbnail)&&t.jsx("img",{src:(A=C==null?void 0:C.brand)==null?void 0:A.thumbnail,alt:(R=C==null?void 0:C.brand)==null?void 0:R.brandName}),t.jsx("span",{className:"she-text",children:(O=C==null?void 0:C.brand)==null?void 0:O.brandName})]})]})]}),t.jsx(ye,{}),t.jsx("div",{className:f.productDataBlock,children:t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-title`,children:m("CardTitles.ProductPhotos")}),t.jsx(F,{className:f.productDataCell,icon:Sr,value:"Manage Photos",valueTransKey:"CardTitles.ManagePhotos",variant:"secondary",maxWidth:"160px",onClick:()=>r("manageProductPhotos")})]})}),t.jsx(ye,{}),t.jsx("div",{className:f.productDataBlock,children:t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-title`,children:(e==null?void 0:e.length)>0?m("ProductForm.Labels.ProductTraits"):m("ProductForm.Labels.ConfigureTraitsToCreateVariant")}),t.jsxs("div",{className:`${f.productDataCell} ${f.traitsDataCell}`,children:[(e==null?void 0:e.length)>0&&t.jsxs("span",{className:"she-text",children:[m("ProductForm.Labels.ProductDescribedByTraits")," ",e.map((H,l)=>t.jsxs(X.Fragment,{children:[t.jsx("b",{children:H.traitName}),l<e.length-1?", ":""]},H.traitId))]}),t.jsx(F,{icon:kr,value:"Manage Traits",valueTransKey:"ProductActions.ManageTraits",variant:"secondary",minWidth:"160px",maxWidth:"160px",onClick:()=>r("manageProductTraits")})]})]})}),(e==null?void 0:e.length)>0&&t.jsxs(t.Fragment,{children:[t.jsx(ye,{}),t.jsx("div",{className:f.productDataBlock,children:t.jsxs("div",{className:f.productDataRow,children:[t.jsx("span",{className:`${f.productDataCell} she-title`,children:m("ProductActions.ManageVariants")}),t.jsx("div",{className:f.productDataCell,children:t.jsx(F,{icon:ve,value:"Create Variant",valueTransKey:"ProductActions.CreateVariant",variant:"secondary",minWidth:"160px",maxWidth:"160px",onClick:()=>r("openAddVariantCard",C)})})]})}),t.jsx("div",{children:t.jsx(Ie,{isLoading:d,data:S,columns:Uo(j),enableExpansion:!0,renderExpandedContent:P,createEmptyExpandableRow:()=>xe,showHeader:!1,onAction:j},S.length)})]})]})})}function Os(){var j,z,P,B,v,G,M,b,A,R,O;const{handleCardAction:u,handleMultipleCardActions:x,keepOnlyCards:C,createRefCallback:i}=zr({selectActiveCards:H=>H[te.PURCHASE_PRODUCTS].activeCards,refreshAction:o.refreshActiveCards}),{state:s,appState:h,productsState:d,productsService:e,...r}=Jr(u,x,C),S=Object.values(pr).map(H=>({value:H,description:hr[H]})),{purchaseId:L}=lr();X.useEffect(()=>{r.getPurchaseProductsPageDataHandler(L),r.getPurchasesProductsGridDataHandler(L)},[L]),X.useEffect(()=>{r.getGridFiltersDataHandler()},[]);async function m(H,l){switch(H){case"addProductToPurchase":r.addProductToPurchaseHandler(l,L);break;case"updatePurchaseProduct":r.updatePurchaseProductHandler(l,L);break;case"openCreateProductCard":r.openCreateProductCardHandler();break;case"submitProductData":r.submitProductDataHandler(l);break;case"openCreateProductCategoryCard":r.openCreateProductCategoryCardHandler();break;case"checkCategoryName":r.checkCategoryNameHandler(l);break;case"createProductCategory":r.createProductCategoryHandler(l);break;case"openCreateProductBrandCard":r.openCreateProductBrandCardHandler();break;case"checkBrandName":r.checkBrandNameHandler(l);break;case"createProductBrand":r.createProductBrandHandler(l);break;case"uploadCategoryOrBrandPhoto":r.uploadCategoryOrBrandPhotoHandler(l);break;case"closeProductConfigurationCard":r.closeProductConfigurationCardHandler();break;case"generateProductCode":r.generateProductCodeHandler();break;case"checkProductCode":r.checkProductCodeHandler(l);break;case"openPurchaseProductsCard":r.openPurchaseProductsCardHandler(L);break;case"openManageProductCard":r.openManageProductCardHandler();break;case"manageProductData":r.manageProductDataHandler();break;case"manageProductPhotos":r.manageProductPhotosHandler();break;case"changePhotoPosition":r.changePhotoPositionHandler(l);break;case"deletePhoto":r.deletePhotoHandler(l);break;case"activatePhoto":r.setPhotoActivationStateHandler(l);break;case"openConnectImageCard":r.openConnectImageCardHandler(l);break;case"imageActions":r.imageActionsHandler(l);break;case"closeProductPhotsCard":r.closeProductPhotosCardHandler();break;case"closeConnectImageCard":r.closeConnectImageCardHandler();break;case"manageProductTraits":r.manageProductTraitsHandler();break;case"addTrait":r.addTraitHandler();break;case"manageTrait":r.manageTraitHandler(l);break;case"setProductTraits":r.setProductTraitsHandler(l);break;case"deleteTrait":r.deleteTraitHandler(l);break;case"createTrait":r.createTraitHandler(l);break;case"updateTrait":r.updateTraitHandler(l);break;case"updateOption":r.updateOptionHandler(l);break;case"addOption":r.addOptionHandler();break;case"deleteOption":r.deleteOptionHandler(l);break;case"dndTraitOption":r.dndTraitOptionHandler(l);break;case"closeProductTraitConfigurationCard":r.closeProductTraitConfigurationCardHandler();break;case"openAddVariantCard":r.openAddVariantCardHandler(l);break;case"addVariantGridAction":r.addVariantGridActionHandler(l);break;case"addVariant":r.addVariantHandler(l,L);break;case"addDuplicatedVariant":r.addDuplicatedVariantHandler(l,L);break;case"closeAddVariantCard":r.closeAddVariantCardHandler();break;case"addStockAction":r.addStockActionHandler(l);break;case"updateStockAction":r.updateStockActionHandler(l);break;case"deleteStockAction":r.deleteStockActionHandler(l,L);break;case"deleteStockActionInGrid":r.deleteStockActionInGridHandler(l);break;case"manageVariant":r.manageVariantHandler(l);break;case"updateVariantDetails":r.updateVariantDetailsHandler(l);break;case"updateVariantTraitOptions":r.updateVariantTraitOptionsHandler(l);break;case"selectPurchase":r.selectPurchaseHandler(l);break;case"searchSupplier":r.searchSupplierHandler(l);break;case"filterSuppliersByDate":r.filterSuppliersByDateHandle(l);break;case"openSupplierCard":r.openSupplierCardHandler();break;case"openSelectPurchaseCard":r.openSelectPurchaseCardHandler(s.purchaseGridRequestModel);break;case"openSelectEntityCard":r.openSelectEntityCardHandler();break;case"searchEntity":r.searchEntityHandle(l);break;case"selectCompany":r.selectCompanyHandle(l);break;case"detachSupplier":r.detachSupplierHandler();break;case"createPurchase":r.createPurchaseForSupplierHandler(l);break;case"increaseStockAmount":r.increaseStockAmountHandler(l);break;case"closeAddStockCard":r.closeAddStockCardHandler();break;case"closeSelectPurchaseCard":r.closeSelectPurchaseCardHandler();break;case"closeSupplierCard":r.closeSupplierCardHandler();break;case"closeSelectEntityCard":r.closeSelectEntityCardHandler();break;case"closeSupplierConfigurationCard":r.closeSupplierConfigurationCardHandler();break;case"disposeFromStock":r.disposeFromStockHandler(l);break;case"uploadPhotoToVariant":r.uploadPhotoToVariantHandler(l);break;case"addPhotoToVariant":r.addPhotoToVariantHandler(l);break;case"detachPhotoFromVariant":r.detachPhotoFromVariantHandler(l);break;case"dndVariantPhoto":r.dndVariantPhotoHandler(l);break;case"openAddStockCard":r.openAddStockCardHandler();break;case"openCreateEntityCard":r.openCreateEntityCardHandler();break;case"createCompany":r.createCompanyHandler(l);break;case"closeCreateCompanyCard":r.closeCreateCompanyCardHandler();break;case"manageCompany":r.manageCompanyHandler(l);break;case"updateCompany":r.updateCompanyHandler(l);break;case"deleteCompany":r.deleteCompanyHandler(l);break;case"closeCompanyConfigurationCard":r.closeCompanyConfigurationCardHandler();break;case"manageCompanyPhotos":r.manageCompanyPhotosHandler();break;case"uploadPhoto":r.uploadPhotoHandler(l);break;case"deleteCompanyPhoto":r.deleteCompanyPhotoHandler(l);break;case"closePhotosCard":r.closePhotosCardHandler(l);break;case"openLocationConfigurationCard":r.openLocationConfigurationCardHandler(l);break;case"createLocation":r.createLocationHandler(l);break;case"updateLocation":r.updateLocationHandler(l);break;case"deleteLocation":r.deleteLocationHandler(l);break;case"manageLocationPhotos":r.manageLocationPhotosHandler();break;case"deleteLocationPhoto":r.deleteLocationPhotoHandler(l);break;case"closeLocationConfigurationCard":r.closeLocationConfigurationCardHandler();break;case"openDisposeStockCard":r.openDisposeStockCardHandler();break;case"openVariantHistoryCard":r.openVariantHistoryCardHandler(l);break;case"openManageTraitsCard":r.openManageTraitsCardHandler();break;case"closeCreateProductCategoryCard":r.closeCreateProductCategoryCardHandler();break;case"closeCreateProductBrandCard":r.closeCreateProductBrandCardHandler();break;case"openVariantPhotosCard":r.openVariantPhotosCardHandler();break;case"closeVariantPhotosCard":r.closeVariantPhotosCardHandler();break;case"closeVariantConfigurationCard":r.closeVariantConfigurationCardHandler();break;case"closeVariantHistoryCard":r.closeVariantHistoryCardHandler();break;case"navigateToManageVariant":r.navigateToManageVariantHandler(l);break;case"refreshPurchaseProductsTab":r.refreshPurchaseProductsTabHandler(l);break;case"gridRequestChange":r.gridRequestChangeHandler(L,l);break;case"refreshConnectProductsTab":r.getVariantsForPurchaseGridDataHandler();break}}return t.jsxs(br,{className:_e.purchaseProductsPage,menuCollectionType:"purchases",menuTitle:"Report Purchase",itemId:Number(L),counter:d.purchaseCounters,activeCards:s.activeCards,children:[((j=s.activeCards)==null?void 0:j.includes("purchaseProductsCard"))&&t.jsx("div",{className:_e.purchaseProductsCard,ref:i("purchaseProductsCard"),children:t.jsx(Do,{isLoading:s.isPurchaseProductsCardLoading,isPurchaseProductsGridLoading:s.isPurchasesProductsGridLoading,isProductsGridLoading:s.isVariantsForPurchaseGridLoading,variantsGridRequestModel:s.variantsForPurchaseGridRequestModel,purchaseProductsGridRequestModel:s.purchasesProductsGridRequestModel,sortingOptions:S,preferences:h.preferences,brands:d.brands,categories:d.categories,colorsForFilter:d.colorsForFilter,sizesForFilter:d.sizesForFilter,variantsSkeletonQuantity:s.variantsForPurchaseGridRequestModel.pageSize,currencies:d.currenciesList,taxes:d.taxesList,purchaseSummary:s.purchaseSummary,purchaseId:L,onAction:m})}),((z=s.activeCards)==null?void 0:z.includes("manageProductCard"))&&t.jsx("div",{ref:i("manageProductCard"),children:t.jsx(Ko,{isLoading:s.isManageProductCardLoading,purchase:d.selectedPurchase,product:s.selectedProduct,variants:s.purchaseProductVariants,currencies:d.currenciesList,taxes:d.taxesList,isVariantGridLoading:s.isVariantGridLoading,productTraits:d.listOfTraitsWithOptionsForProduct,onAction:m})}),((P=s.activeCards)==null?void 0:P.includes("productConfigurationCard"))&&t.jsx("div",{ref:i("productConfigurationCard"),children:t.jsx(gr,{isLoading:s.isProductConfigurationCardLoading,product:s.selectedProduct,brandsList:d.brands,categoriesList:d.categories,countryCodesList:s.countryCodes,productCode:d.productCode,productId:(B=s.selectedProduct)==null?void 0:B.productId,showSecondaryButton:!0,onSecondaryButtonClick:()=>m("closeProductConfigurationCard"),onAction:m})}),s.activeCards.includes("createCategoryCard")&&t.jsx("div",{ref:i("createCategoryCard"),children:t.jsx(Pr,{isLoading:s.isCreateCategoryCardLoading,isPhotoUploaderLoading:d.isPhotoUploaderLoading,category:d.category,onAction:m})}),s.activeCards.includes("createBrandCard")&&t.jsx("div",{ref:i("createBrandCard"),children:t.jsx(fr,{isLoading:s.isCreateBrandCardLoading,isPhotoUploaderLoading:d.isPhotoUploaderLoading,brand:d.brand,onAction:m})}),s.activeCards.includes("productPhotosCard")&&t.jsx("div",{ref:i("productPhotosCard"),children:t.jsx(jr,{isLoading:s.isProductPhotosCardLoading,isImageUploaderLoading:s.isImageUploaderLoading,isGridLoading:d.isProductPhotosLoading,data:d.productPhotos,productCounter:null,contextId:s.selectedProduct.productId,showCloseButton:!0,onAction:m})}),s.activeCards.includes("connectImageCard")&&t.jsx("div",{ref:i("connectImageCard"),children:t.jsx(Nr,{isLoading:s.isConnectImageCardLoading,isGridLoading:s.isVariantsGridLoading,variants:d.productVariants,selectedPhoto:s.selectedPhoto,onAction:m,onSecondaryButtonClick:()=>u("connectImageCard")})}),s.activeCards.includes("chooseVariantTraitsCard")&&t.jsx("div",{ref:i("chooseVariantTraitsCard"),children:t.jsx(Gr,{isLoading:s.isChooseVariantTraitsCardLoading,items:d.traits,selectedItems:d.listOfTraitsWithOptionsForProduct,onAction:m,onSecondaryButtonClick:()=>u("chooseVariantTraitsCard")})}),s.activeCards.includes("productTraitConfigurationCard")&&t.jsx("div",{ref:i("productTraitConfigurationCard"),children:t.jsx(Dr,{isLoading:s.isProductTraitConfigurationCardLoading,isGridLoading:s.isTraitOptionsGridLoading,data:s.colorOptionsGridRequestModel,selectedTrait:s.selectedTrait,typesOfTraits:d.typesOfTraits,onSecondaryButtonClick:()=>u("productTraitConfigurationCard"),onAction:m})}),s.activeCards.includes("addVariantCard")&&t.jsx("div",{ref:i("addVariantCard"),children:t.jsx(Fr,{isLoading:s.isAddVariantCardLoading,traits:d.listOfTraitsWithOptionsForProduct,isDuplicateVariant:s.isDuplicateVariant,onAction:m})}),s.activeCards.includes("variantConfigurationCard")&&t.jsx("div",{ref:i("variantConfigurationCard"),children:t.jsx(Mr,{isLoading:s.isVariantConfigurationCardLoading,isVariantOptionsGridLoading:s.isVariantOptionsGridLoading,isVariantPhotoGridLoading:s.isVariantPhotoGridLoading,variant:d.selectedVariant,variantPhotos:s.variantPhotos,data:s.variantTraitsGridRequestModel,taxesList:d.taxesList,productCounter:d.productCounter,onAction:m,onGenerateProductCode:e.generateProductCodeHandler,onSecondaryButtonClick:()=>m("closeVariantConfigurationCard")})}),s.activeCards.includes("addStockCard")&&t.jsx("div",{ref:i("addStockCard"),children:t.jsx(Or,{isLoading:s.isAddStockCardLoading,taxTypes:d.taxesList,currencyTypes:d.currenciesList,variant:d.selectedVariant,purchase:s.selectedPurchase,onAction:m})}),s.activeCards.includes("selectPurchaseCard")&&t.jsx("div",{ref:i("selectPurchaseCard"),children:t.jsx(_r,{isLoading:s.setIsSelectPurchaseCardLoading,isGridLoading:s.setIsPurchaseGridLoading,purchases:s.purchaseGridRequestModel.items,onAction:m})}),s.activeCards.includes("supplierCard")&&t.jsx("div",{ref:i("supplierCard"),children:t.jsx(qr,{isLoading:s.isSupplierCardLoading,selectedPurchase:d.selectedPurchase,selectedSupplier:s.selectedCompany,onAction:m})}),((v=s.activeCards)==null?void 0:v.includes("selectEntityCard"))&&t.jsx("div",{ref:i("selectEntityCard"),children:t.jsx($r,{isLoading:s.isSelectEntityCardLoading,isGridLoading:s.isSuppliersGridLoading,entityName:"Company",entityCollection:(G=s.companiesGridRequestModel)==null?void 0:G.items,columns:Wr({onAction:m}),onAction:m})}),s.activeCards.includes("createCompanyCard")&&t.jsx("div",{ref:i("createCompanyCard"),children:t.jsx(Er,{isLoading:s.isCreateCompanyCardLoading,isPhotoUploaderLoading:s.isPhotoUploaderLoading,countryCodes:s.countryCodes,onAction:m})}),s.activeCards.includes("companyConfigurationCard")&&t.jsx("div",{ref:i("companyConfigurationCard"),children:t.jsx(Ur,{isLoading:s.isCompanyConfigurationCardLoading,isGridLoading:s.isLocationsGridLoading,company:s.managedCompany,countryCodes:s.countryCodes,onAction:m})}),s.activeCards.includes("companyPhotosCard")&&t.jsx("div",{ref:i("companyPhotosCard"),children:t.jsx(Oe,{isImageUploaderLoading:s.isPhotoUploaderLoading,data:(M=s.managedCompany)==null?void 0:M.photos,contextName:"Company",contextId:(b=s.managedCompany)==null?void 0:b.companyId,noDataText:"COMPANY HAS NO PHOTOS",showCloseButton:!0,columns:Kr({onAction:m}),onAction:m})}),s.activeCards.includes("locationConfigurationCard")&&t.jsx("div",{ref:i("locationConfigurationCard"),children:t.jsx(Qr,{isLoading:s.isCustomerAddressDetailsLoading,location:s.managedLocation,countryCodes:s.countryCodes,onAction:m})}),s.activeCards.includes("locationPhotosCard")&&t.jsx("div",{ref:i("locationPhotosCard"),children:t.jsx(Oe,{isImageUploaderLoading:s.isPhotoUploaderLoading,data:(A=s.managedLocation)==null?void 0:A.photos,contextName:"Location",contextId:(R=s.managedLocation)==null?void 0:R.locationId,noDataText:"LOCATION HAS NO PHOTOS",showCloseButton:!0,columns:Yr({onAction:m}),onAction:m})}),s.activeCards.includes("disposeStockCard")&&t.jsx("div",{ref:i("disposeStockCard"),children:t.jsx(Br,{isLoading:s.isDisposeStockCardLoading,variant:d.selectedVariant,onAction:m,onSecondaryButtonClick:()=>u("disposeStockCard")})}),s.activeCards.includes("variantHistoryCard")&&t.jsx("div",{ref:i("variantHistoryCard"),children:t.jsx(Ar,{isLoading:s.isVariantHistoryCardLoading,isGridLoading:s.isVariantHistoryGridLoading,variant:d.selectedVariant,data:s.variantHistory,onAction:m})}),s.activeCards.includes("variantPhotosCard")&&t.jsx("div",{ref:i("variantPhotosCard"),children:t.jsx(Rr,{isLoading:s.isVariantPhotosCardLoading,isVariantPhotoGridLoading:s.isVariantPhotoGridLoading,isProductPhotoGridLoading:s.isProductPhotoGridLoading,variantPhotos:s.variantPhotos,productPhotos:s.productPhotosForVariant,contextId:(O=d.selectedVariant)==null?void 0:O.variantId,onAction:m})}),s.activeCards.includes("manageTraitsCard")&&t.jsx("div",{ref:i("manageTraitsCard"),children:t.jsx(wr,{isLoading:s.isManageTraitsCardLoading,traits:d.listOfTraitsWithOptionsForProduct,variant:d.selectedVariant,onAction:m,onSecondaryButtonClick:()=>u("manageTraitsCard")})})]})}export{Os as PurchaseProductsPage};
