import{n as N,S as v,t as Ge,z as De,B as be,Z as D,bw as ke,$ as C,k as ve,A as O,bC as a,a1 as H,N as b,y as Ee,r as Re,j as l}from"./index-DybU9lv3.js";import{S as Ue,C as Te}from"./CompaniesListGridColumns-C2bC1dR8.js";import{S as Ne}from"./SelectEntityCard-E8PNnYAH.js";import{S as Oe}from"./SheContextSidebar-BKksk-en.js";import{u as je}from"./useToast-D6yqOzuN.js";import{u as qe}from"./useProductsPageService-CV8ADoIa.js";import{u as we}from"./chevron-up-C7ChJr01.js";import{u as Fe}from"./useCardActions-CTfPrRnB.js";import{C as Ae,a as Be,P as j,M as Ve,L as $e,b as ze}from"./ManageLocationPhotosGridColumns-C2u8kQwt.js";import"./SheCard-JWlyTss7.js";import"./useAppTranslation-NlALFuCP.js";import"./SheCardNotification-Yx-BMvzf.js";import"./ComponentViewEnum-Ba6F4129.js";import"./SheInput-CKzfybja.js";import"./SheDatePicker-ByjOO6gI.js";import"./settings-2-JTaowDGi.js";import"./SheSelect-DkAtzaWK.js";import"./select-BDB0m4xP.js";import"./SheTextarea-B6lhLebe.js";import"./plus-Dv0aUE5j.js";import"./trash-CFfYG3xN.js";import"./SheGrid-DvAOS33I.js";import"./folder-up-Cq6cKtKD.js";import"./SheFileUploader-BAVOSjtG.js";import"./index-CrhSJ2si.js";import"./AddressForm-JvxW60Zk.js";import"./types-Cs0d5Ub-.js";import"./form-CP3c_0ZX.js";import"./she-select-convertors-CdG-Ygpu.js";const Qe={};function Ye(p){const m=qe(),t=N(v.SUPPLIER),P=N(v.PRODUCTS),e=Ge(),y=De(),{addToast:s}=je(),{t:L}=we(),{openConfirmationDialog:h}=be(),[x]=D.useCreatePurchaseForSupplierMutation(),[M]=D.useUpdatePurchaseForSupplierMutation(),[G]=ke.useLazyGetSupplierDetailsQuery(),[S]=D.useDeletePurchaseMutation(),[d]=D.useLazyGetPurchaseDetailsQuery(),[g]=C.useGetListOfCompaniesForGridMutation(),[q]=ve.useLazyGetCountryCodeQuery(),[w]=C.useCreateCompanyMutation(),[E]=O.useUploadPhotoMutation(),[F]=C.useAddNewLocationToCompanyMutation(),[I]=C.useLazyGetCompanyDetailsQuery(),[A]=C.useDeleteCompanyMutation(),[R]=O.useDeletePhotoMutation(),[B]=C.useAddLocationToCompanyMutation(),[V]=C.useRestoreCompanyMutation(),[$]=C.useUpdateLocationDetailsMutation(),[z]=C.useDeleteLocationMutation(),[Q]=C.useChangePositionOfCompanyPhotoMutation(),[Y]=C.useChangePositionOfLocationPhotoMutation(),[Z]=C.useUpdateCompanyDetailsMutation();function _(o){return e(a.setIsSupplierCardLoading(!0)),x({date:o.selectedDate,supplierId:o.selectedCompany.companyId,documentNotes:o.purchaseNotes}).then(n=>{e(a.refreshPurchase(n.data)),e(H.refreshCreatedPurchase(n.data)),e(a.setIsSupplierCardLoading(!1)),n?(m.getPurchaseCountersHandler(n.data.purchaseId),y(`${b.PRODUCTS}${b.PURCHASE_PRODUCTS}/${n.data.purchaseId}`),s({text:L("SuccessMessages.PurchaseCreated"),type:"success"})):s({text:n.error.message,type:"error"})})}function J(o,n){return e(a.setIsSupplierCardLoading(!0)),M({purchaseId:o,model:n}).then(r=>{e(a.setIsSupplierCardLoading(!1)),e(a.refreshPurchase(r.data)),s(r?{text:L("SuccessMessages.PurchaseUpdated"),type:"success"}:{text:r.error.detail.message,type:"error"}),U()})}function k(o){return e(a.setIsCompaniesGridLoading(!0)),g(o).then(n=>{var i;e(a.setIsCompaniesGridLoading(!1));const r=(i=n.data.items)==null?void 0:i.map(c=>{var u;return{...c,isSelected:(c==null?void 0:c.companyId)===((u=t.selectedCompany)==null?void 0:u.companyId)}});return e(a.refreshCompaniesGridRequestModel({...n.data,items:r})),n.data})}function K(){if(t.countryCodes.length===0)return q().then(o=>{e(a.refreshCountryCodes(o.data))})}function W(o,n){return G({supplierId:o,locationId:n}).then(r=>r.data)}function X(){p("selectEntityCard",!0),k({})}function ee(){e(a.resetSelectedCompany()),p("selectEntityCard",!0),k(t.companiesGridRequestModel)}function ae(o){k({searchQuery:o})}function oe(){p("createCompanyCard",!0)}function te(o){p("selectEntityCard"),e(a.refreshSelectedCompany(o))}function ne(o){e(a.setIsCreateCompanyCardLoading(!0)),w(o.company).then(n=>{n.error?s({text:n.error.details.message,type:"error"}):(o.image.uploadModels.map(r=>{r.contextId=n.data.companyId,e(a.setIsPhotoUploaderLoading(!0)),E(r).then(i=>{e(a.setIsPhotoUploaderLoading(!1)),s(i?{text:L("SuccessMessages.ImageAdded"),type:"success"}:{text:i.error.details.message,type:"error"})})}),F({companyId:n.data.companyId,model:o.address}).then(()=>{e(a.setIsCreateCompanyCardLoading(!1)),p("createCompanyCard"),e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(r=>{e(a.setIsCompaniesGridLoading(!1));const i=r.data.items.map(c=>{var u;return{...c,isSelected:c.companyId===((u=t.selectedCompany)==null?void 0:u.companyId)}});e(a.refreshCompaniesGridRequestModel({...r.data,items:i}))})}),s({text:"Company created successfully",type:"success"}))})}function re(){p("createCompanyCard")}function se(o){p("companyConfigurationCard",!0),e(a.setIsCompanyConfigurationCardLoading(!0)),e(a.setIsLocationsGridLoading(!0)),I(o.companyId).then(n=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.refreshManagedCompany(n.data))})}function ie(o){e(a.setIsCompanyConfigurationCardLoading(!0)),Z({companyId:t.managedCompany.companyId,model:o}).then(n=>{e(a.setIsCompanyConfigurationCardLoading(!1)),n.error?s({text:"Failed to update company",type:"error"}):(e(a.refreshManagedCompany(n.data)),e(a.setIsSuppliersGridLoading(!0)),g(t.companiesGridRequestModel).then(r=>{e(a.setIsSuppliersGridLoading(!1));const i=r.data.items.map(c=>{var u;return{...c,isSelected:c.companyId===((u=t.selectedCompany)==null?void 0:u.companyId)}});e(a.refreshCompaniesGridRequestModel({...r.data,items:i}))}),s({text:"Company updated successfully",type:"success"}))})}async function de(o){await h({headerTitle:"Deleting company",text:`You are about to delete company ${o.companyName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&(e(a.setIsCompanyConfigurationCardLoading(!0)),A(o.companyId).then(r=>{if(r.error){s({text:"Failed to delete company",type:"error"});return}else s({text:"Company deleted successfully",type:"info"}),p("companyConfigurationCard"),e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.resetManagedCompany()),e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(i=>{e(a.setIsCompaniesGridLoading(!1));const c=i.data.items.map(u=>{var f;return{...u,isSelected:u.companyId===((f=t.selectedCompany)==null?void 0:f.companyId)}});e(a.refreshCompaniesGridRequestModel({...i.data,items:c}))}),t.selectedCompany.companyId===t.managedCompany.companyId&&e(a.resetSelectedCompany())}))}function ce(){p("companyConfigurationCard"),e(a.resetManagedCompany())}function pe(){p("companyPhotosCard",!0)}async function ue(o){await h({headerTitle:"Deleting company photo",text:"You are about to delete company photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&R(o.photoId).then(r=>{const i=t.managedCompany.photos.filter(c=>c.photoId!==o.photoId);e(a.refreshManagedCompany({...t.managedCompany,photos:i})),e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(c=>{e(a.setIsCompaniesGridLoading(!1));const u=c.data.items.map(f=>{var T;return{...f,isSelected:f.companyId===((T=t.selectedCompany)==null?void 0:T.companyId)}});e(a.refreshCompaniesGridRequestModel({...c.data,items:u}))}),r.error?s({text:"Photo not deleted",description:r.error.details.message,type:"error"}):s({text:"Photo deleted successfully",type:"success"})})}function le(o){return e(a.setIsPhotoUploaderLoading(!0)),E(o).then(n=>{var r;return n.error?(s({text:((r=n.error.data)==null?void 0:r.detail)||"Upload failed",type:"error"}),n):(n.data.photoId&&(e(a.setIsPhotoUploaderLoading(!1)),o.contextName==="Company"?(e(a.setIsSuppliersGridLoading(!0)),g(t.companiesGridRequestModel).then(i=>{e(a.setIsSuppliersGridLoading(!1));const c=i.data.items.map(u=>{var f;return{...u,isSelected:u.companyId===((f=t.selectedCompany)==null?void 0:f.companyId)}});e(a.refreshCompaniesGridRequestModel({...i.data,items:c}))}),e(a.refreshManagedCompany({...t.managedCompany,photos:[...t.managedCompany.photos||[],n.data]}))):e(a.refreshManagedLocation({...t.managedLocation,photos:[...t.managedLocation.photos||[],n.data]})),s({text:"Photos added successfully",type:"success"})),n)})}function Ce(o){switch(o.contextName){case"Company":Q({companyId:t.managedCompany.companyId,photoId:o.activeItem.photoId,index:o.newIndex}).then(n=>{n.error||(I(t.managedCompany.companyId).then(r=>{e(a.refreshManagedCompany(r.data))}),(o.newIndex===0||o.oldIndex===0)&&(e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(r=>{e(a.setIsCompaniesGridLoading(!1));const i=r.data.items.map(c=>{var u;return{...c,isSelected:c.companyId===((u=t.selectedCompany)==null?void 0:u.companyId)}});e(a.refreshCompaniesGridRequestModel({...r.data,items:i}))})))});break;case"Location":Y({locationId:t.managedLocation.locationId,photoId:o.activeItem.photoId,index:o.newIndex}).then(n=>{n.error||I(t.managedCompany.companyId).then(r=>{e(a.refreshManagedCompany(r.data))})});break}}function me(o){p(o==="Company"?"companyPhotosCard":"locationPhotosCard")}function ye(o){p("locationConfigurationCard",!0),e(o?a.refreshManagedLocation(o):a.resetManagedLocation())}function fe(o){e(a.setIsLocationConfigurationCardLoading(!0)),B({companyId:t.managedCompany.companyId,model:o}).then(n=>{var r;n.error?s({text:(r=n.error.data)==null?void 0:r.detail,type:"error"}):(p("locationConfigurationCard"),e(a.setIsCompanyConfigurationCardLoading(!0)),e(a.setIsLocationsGridLoading(!0)),I(t.managedCompany.companyId).then(i=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.refreshManagedCompany(i.data))}),s({text:"Location added successfully",type:"success"}))})}function he(o){e(a.setIsLocationConfigurationCardLoading(!0)),z(o.locationId).then(n=>{var r;n.error?s({text:(r=n.error.data)==null?void 0:r.detail,type:"error"}):(p("locationConfigurationCard"),e(a.setIsCompanyConfigurationCardLoading(!0)),e(a.setIsLocationsGridLoading(!0)),I(t.managedCompany.companyId).then(i=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.refreshManagedCompany(i.data))}),s({text:"Location deleted successfully",type:"success"}))})}function ge(o){e(a.setIsLocationConfigurationCardLoading(!0)),$({locationId:t.managedLocation.locationId,model:o}).then(n=>{e(a.setIsLocationConfigurationCardLoading(!1)),n.error?s({text:"Failed to update location",type:"error"}):(e(a.setIsCompanyConfigurationCardLoading(!0)),I(t.managedCompany.companyId).then(r=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.refreshManagedCompany(r.data))}),s({text:"Location updated successfully",type:"success"}))})}function Le(){p("locationPhotosCard",!0)}async function Ie(o){await h({headerTitle:"Deleting location photo",text:"You are about to delete location photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&R(o.photoId).then(r=>{const i=t.managedLocation.photos.filter(c=>c.photoId!==o.photoId);e(a.refreshManagedLocation({...t.managedLocation,photos:i})),r.error?s({text:"Photo not deleted",description:r.error.details.message,type:"error"}):s({text:"Photo deleted successfully",type:"success"})})}function Pe(){p("locationConfigurationCard"),e(a.resetManagedLocation())}function Se(o,n){e(a.setIsSupplierCardLoading(!0)),V(o.companyId).then(r=>{if(e(a.setIsSupplierCardLoading(!1)),r.error)s({text:r.error.message,type:"error"});else{if(W(o.supplierId,o.locationId).then(),P.selectedSupplier.supplierId===o.supplierId)return d(n).then(i=>{e(H.refreshSelectedPurchase(i.data)),e(a.refreshSelectedCompany({...i.data.company,locationId:i.data.location.locationId}))});s({text:"Supplier restored successfully",type:"success"})}})}async function He(o){await h({headerTitle:"Delete Purchase",text:`You are about to delete purchase "${o.purchaseId}".`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&await S(o.purchaseId).then(r=>{r.error?s({text:r.error.data.detail,type:"error"}):(y(b.PRODUCTS),s({text:"Purchase deleted successfully",type:"success"}))})}function U(){y(b.PRODUCTS),e(a.refreshActiveCards([]))}function xe(){p("selectEntityCard")}function Me(o){o?(e(a.setIsSupplierCardLoading(!0)),e(a.setIsProductMenuCardLoading(!0)),d(o).then(n=>{var r;e(H.refreshSelectedPurchase(n.data)),e(a.setIsSupplierCardLoading(!1)),e(a.refreshSelectedCompany({...n.data.supplier,locationId:(r=n.data.location)==null?void 0:r.locationId}))}),m.getPurchaseCountersHandler(Number(o)).then(()=>e(a.setIsProductMenuCardLoading(!1))),K()):e(a.resetSelectedCompany()),e(H.resetPurchaseCounters()),e(a.resetActiveCards()),e(H.refreshActiveTab("purchases"))}return{state:t,productsState:P,productsService:m,createPurchaseForSupplierHandler:_,updatePurchaseForSupplierHandler:J,deletePurchaseHandler:He,detachSupplierHandler:X,openCreateEntityCardHandler:oe,openSelectEntityCardHandler:ee,searchEntityHandler:ae,selectCompanyHandler:te,createCompanyHandler:ne,closeCreateCompanyCardHandler:re,manageCompanyHandler:se,updateCompanyHandler:ie,restoreCompanyHandler:Se,closeSupplierCardHandler:U,closeSelectEntityCardHandler:xe,deleteCompanyHandler:de,closeCompanyConfigurationCardHandler:ce,manageCompanyPhotosHandler:pe,getSupplierPageDataHandler:Me,deleteCompanyPhotoHandler:ue,uploadPhotoHandler:le,changePhotoPositionHandler:Ce,closePhotosCardHandler:me,openLocationConfigurationCardHandler:ye,createLocationHandler:fe,deleteLocationHandler:he,updateLocationHandler:ge,manageLocationPhotosHandler:Le,deleteLocationPhotoHandler:Ie,closeLocationConfigurationCardHandler:Pe}}function Ha(){var L,h,x,M,G;const{handleCardAction:p,createRefCallback:m}=Fe({selectActiveCards:S=>S[v.SUPPLIER].activeCards,refreshAction:a.refreshActiveCards}),{state:t,productsState:P,...e}=Ye(p),{purchaseId:y}=Ee();Re.useEffect(()=>{e.getSupplierPageDataHandler(y)},[y]);async function s(S,d){switch(S){case"createPurchase":e.createPurchaseForSupplierHandler(d);break;case"updatePurchase":e.updatePurchaseForSupplierHandler(d.purchaseId,{date:d.selectedDate,companyId:d.selectedSupplier.companyId,documentNotes:d.purchaseNotes});break;case"detachSupplier":e.detachSupplierHandler();break;case"openSelectEntityCard":e.openSelectEntityCardHandler();break;case"openCreateEntityCard":e.openCreateEntityCardHandler();break;case"searchEntity":e.searchEntityHandler(d);break;case"createCompany":e.createCompanyHandler(d);break;case"closeCreateCompanyCard":e.closeCreateCompanyCardHandler();break;case"selectCompany":e.selectCompanyHandler(d);break;case"manageCompany":e.manageCompanyHandler(d);break;case"updateCompany":e.updateCompanyHandler(d);break;case"deleteCompany":e.deleteCompanyHandler(d);break;case"closeCompanyConfigurationCard":e.closeCompanyConfigurationCardHandler();break;case"manageCompanyPhotos":e.manageCompanyPhotosHandler();break;case"uploadPhoto":e.uploadPhotoHandler(d);break;case"deleteCompanyPhoto":e.deleteCompanyPhotoHandler(d);break;case"changePhotoPosition":e.changePhotoPositionHandler(d);break;case"closePhotosCard":e.closePhotosCardHandler(d);break;case"openLocationConfigurationCard":e.openLocationConfigurationCardHandler(d);break;case"createLocation":e.createLocationHandler(d);break;case"updateLocation":e.updateLocationHandler(d);break;case"deleteLocation":e.deleteLocationHandler(d);break;case"closeLocationConfigurationCard":e.closeLocationConfigurationCardHandler();break;case"manageLocationPhotos":e.manageLocationPhotosHandler();break;case"deleteLocationPhoto":e.deleteLocationPhotoHandler(d);break;case"restoreCompany":e.restoreCompanyHandler(d,y);break;case"deletePurchase":e.deletePurchaseHandler(d);break;case"closeSupplierCard":e.closeSupplierCardHandler();break;case"closeSelectEntityCard":e.closeSelectEntityCardHandler();break}}return l.jsx("div",{className:Qe.supplierPage,children:l.jsxs(Oe,{menuCollectionType:"purchases",menuTitle:"Report Purchase",counter:P.purchaseCounters,itemId:Number(y),activeCards:t.activeCards,children:[l.jsx(Ue,{isLoading:t.isSupplierCardLoading,selectedPurchase:P.selectedPurchase,selectedSupplier:t.selectedCompany,onAction:s}),((L=t.activeCards)==null?void 0:L.includes("selectEntityCard"))&&l.jsx("div",{ref:m("selectEntityCard"),children:l.jsx(Ne,{isGridLoading:t.isCompaniesGridLoading,entityName:"Company",entityCollection:t.companiesGridRequestModel.items,columns:Te({onAction:s}),onAction:s})}),t.activeCards.includes("createCompanyCard")&&l.jsx("div",{ref:m("createCompanyCard"),children:l.jsx(Ae,{isLoading:t.isCreateCompanyCardLoading,isPhotoUploaderLoading:t.isPhotoUploaderLoading,countryCodes:t.countryCodes,onAction:s})}),t.activeCards.includes("companyConfigurationCard")&&l.jsx("div",{ref:m("companyConfigurationCard"),children:l.jsx(Be,{isLoading:t.isCompanyConfigurationCardLoading,isGridLoading:t.isLocationsGridLoading,company:t.managedCompany,countryCodes:t.countryCodes,onAction:s})}),t.activeCards.includes("companyPhotosCard")&&l.jsx("div",{ref:m("companyPhotosCard"),children:l.jsx(j,{isImageUploaderLoading:t.isPhotoUploaderLoading,data:(h=t.managedCompany)==null?void 0:h.photos,contextName:"Company",contextId:(x=t.managedCompany)==null?void 0:x.companyId,noDataText:"COMPANY HAS NO PHOTOS",showCloseButton:!0,columns:Ve({onAction:s}),onAction:s})}),t.activeCards.includes("locationConfigurationCard")&&l.jsx("div",{ref:m("locationConfigurationCard"),children:l.jsx($e,{isLoading:t.isCustomerAddressDetailsLoading,location:t.managedLocation,countryCodes:t.countryCodes,onAction:s})}),t.activeCards.includes("locationPhotosCard")&&l.jsx("div",{ref:m("locationPhotosCard"),children:l.jsx(j,{isImageUploaderLoading:t.isPhotoUploaderLoading,data:(M=t.managedLocation)==null?void 0:M.photos,contextName:"Location",contextId:(G=t.managedLocation)==null?void 0:G.locationId,noDataText:"LOCATION HAS NO PHOTOS",showCloseButton:!0,columns:ze({onAction:s}),onAction:s})})]})})}export{Ha as SupplierPage};
