import{d as T,S as v,k as Ge,p as De,q as be,H as D,bu as ke,I as C,c as ve,A as N,bA as a,K as H,N as b,o as Ee,r as Re,j as l}from"./index-INVZ2mfS.js";import{S as Ue,C as Te}from"./CompaniesListGridColumns-B8kaHsSr.js";import{S as Ne}from"./SelectEntityCard-D7zvIis3.js";import{S as Oe}from"./SheContextSidebar-DapeQkmS.js";import{u as je}from"./useToast-Dw0WbxuS.js";import{u as qe}from"./useProductsPageService-OxmoWn7P.js";import{u as we}from"./chevron-up-dtAOjP7D.js";import{u as Ae}from"./useCardActions-QIUEmqNN.js";import{C as Fe,a as Be,P as O,M as Ve,L as Qe,b as Ye}from"./ManageLocationPhotosGridColumns-reCELupL.js";import"./SheCard-DkQz__b5.js";import"./useAppTranslation-C--sAUS3.js";import"./SheCardNotification-C1P9DXgl.js";import"./ComponentViewEnum-Ba6F4129.js";import"./SheInput-cl4k9nFE.js";import"./SheDatePicker-C_b0cnXM.js";import"./settings-2-DGAFnTaZ.js";import"./SheSelect-BRn8vwzs.js";import"./select-B-GdMVMV.js";import"./SheTextarea-pzK8bwe3.js";import"./trash-CMoyQewc.js";import"./SheGrid-CoCGh6o9.js";import"./SheFileUploader-DhXC7-du.js";import"./AddressForm-BYrrTT-c.js";import"./types-DT-IQ5BK.js";import"./form-fWIGhw7a.js";import"./she-select-convertors-CdG-Ygpu.js";const $e={};function ze(p){const m=qe(),t=T(v.SUPPLIER),P=T(v.PRODUCTS),e=Ge(),y=De(),{addToast:s}=je(),{t:L}=we(),{openConfirmationDialog:h}=be(),[x]=D.useCreatePurchaseForSupplierMutation(),[M]=D.useUpdatePurchaseForSupplierMutation(),[G]=ke.useLazyGetSupplierDetailsQuery(),[S]=D.useDeletePurchaseMutation(),[d]=D.useLazyGetPurchaseDetailsQuery(),[g]=C.useGetListOfCompaniesForGridMutation(),[j]=ve.useLazyGetCountryCodeQuery(),[q]=C.useCreateCompanyMutation(),[E]=N.useUploadPhotoMutation(),[w]=C.useAddNewLocationToCompanyMutation(),[I]=C.useLazyGetCompanyDetailsQuery(),[A]=C.useDeleteCompanyMutation(),[R]=N.useDeletePhotoMutation(),[F]=C.useAddLocationToCompanyMutation(),[B]=C.useRestoreCompanyMutation(),[V]=C.useUpdateLocationDetailsMutation(),[Q]=C.useDeleteLocationMutation(),[Y]=C.useChangePositionOfCompanyPhotoMutation(),[$]=C.useChangePositionOfLocationPhotoMutation(),[z]=C.useUpdateCompanyDetailsMutation();function K(o){return e(a.setIsSupplierCardLoading(!0)),x({date:o.selectedDate,supplierId:o.selectedCompany.companyId,documentNotes:o.purchaseNotes}).then(n=>{e(a.refreshPurchase(n.data)),e(H.refreshCreatedPurchase(n.data)),e(a.setIsSupplierCardLoading(!1)),n?(m.getPurchaseCountersHandler(n.data.purchaseId),y(`${b.PRODUCTS}${b.PURCHASE_PRODUCTS}/${n.data.purchaseId}`),s({text:L("SuccessMessages.PurchaseCreated"),type:"success"})):s({text:n.error.message,type:"error"})})}function _(o,n){return e(a.setIsSupplierCardLoading(!0)),M({purchaseId:o,model:n}).then(r=>{e(a.refreshPurchase(r.data)),e(a.setIsSupplierCardLoading(!1)),s(r?{text:L("SuccessMessages.PurchaseUpdated"),type:"success"}:{text:r.error.detail.message,type:"error"})})}function k(o){return e(a.setIsCompaniesGridLoading(!0)),g(o).then(n=>{var i;e(a.setIsCompaniesGridLoading(!1));const r=(i=n.data.items)==null?void 0:i.map(c=>{var u;return{...c,isSelected:(c==null?void 0:c.companyId)===((u=t.selectedCompany)==null?void 0:u.companyId)}});return e(a.refreshCompaniesGridRequestModel({...n.data,items:r})),n.data})}function J(){if(t.countryCodes.length===0)return j().then(o=>{e(a.refreshCountryCodes(o.data))})}function W(o,n){return G({supplierId:o,locationId:n}).then(r=>r.data)}function X(){p("selectEntityCard",!0),k({})}function Z(){e(a.resetSelectedCompany()),p("selectEntityCard",!0),k(t.companiesGridRequestModel)}function ee(o){k({searchQuery:o})}function ae(){p("createCompanyCard",!0)}function oe(o){p("selectEntityCard"),e(a.refreshSelectedCompany(o))}function te(o){e(a.setIsCreateCompanyCardLoading(!0)),q(o.company).then(n=>{n.error?s({text:n.error.details.message,type:"error"}):(o.image.uploadModels.map(r=>{r.contextId=n.data.companyId,e(a.setIsPhotoUploaderLoading(!0)),E(r).then(i=>{e(a.setIsPhotoUploaderLoading(!1)),s(i?{text:L("SuccessMessages.ImageAdded"),type:"success"}:{text:i.error.details.message,type:"error"})})}),w({companyId:n.data.companyId,model:o.address}).then(()=>{e(a.setIsCreateCompanyCardLoading(!1)),p("createCompanyCard"),e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(r=>{e(a.setIsCompaniesGridLoading(!1));const i=r.data.items.map(c=>{var u;return{...c,isSelected:c.companyId===((u=t.selectedCompany)==null?void 0:u.companyId)}});e(a.refreshCompaniesGridRequestModel({...r.data,items:i}))})}),s({text:"Company created successfully",type:"success"}))})}function ne(){p("createCompanyCard")}function re(o){p("companyConfigurationCard",!0),e(a.setIsCompanyConfigurationCardLoading(!0)),e(a.setIsLocationsGridLoading(!0)),I(o.companyId).then(n=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.refreshManagedCompany(n.data))})}function se(o){e(a.setIsCompanyConfigurationCardLoading(!0)),z({companyId:t.managedCompany.companyId,model:o}).then(n=>{e(a.setIsCompanyConfigurationCardLoading(!1)),n.error?s({text:"Failed to update company",type:"error"}):(e(a.refreshManagedCompany(n.data)),e(a.setIsSuppliersGridLoading(!0)),g(t.companiesGridRequestModel).then(r=>{e(a.setIsSuppliersGridLoading(!1));const i=r.data.items.map(c=>{var u;return{...c,isSelected:c.companyId===((u=t.selectedCompany)==null?void 0:u.companyId)}});e(a.refreshCompaniesGridRequestModel({...r.data,items:i}))}),s({text:"Company updated successfully",type:"success"}))})}async function ie(o){await h({headerTitle:"Deleting company",text:`You are about to delete company ${o.companyName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&(e(a.setIsCompanyConfigurationCardLoading(!0)),A(o.companyId).then(r=>{if(r.error){s({text:"Failed to delete company",type:"error"});return}else s({text:"Company deleted successfully",type:"info"}),p("companyConfigurationCard"),e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.resetManagedCompany()),e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(i=>{e(a.setIsCompaniesGridLoading(!1));const c=i.data.items.map(u=>{var f;return{...u,isSelected:u.companyId===((f=t.selectedCompany)==null?void 0:f.companyId)}});e(a.refreshCompaniesGridRequestModel({...i.data,items:c}))}),t.selectedCompany.companyId===t.managedCompany.companyId&&e(a.resetSelectedCompany())}))}function de(){p("companyConfigurationCard"),e(a.resetManagedCompany())}function ce(){p("companyPhotosCard",!0)}async function pe(o){await h({headerTitle:"Deleting company photo",text:"You are about to delete company photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&R(o.photoId).then(r=>{const i=t.managedCompany.photos.filter(c=>c.photoId!==o.photoId);e(a.refreshManagedCompany({...t.managedCompany,photos:i})),e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(c=>{e(a.setIsCompaniesGridLoading(!1));const u=c.data.items.map(f=>{var U;return{...f,isSelected:f.companyId===((U=t.selectedCompany)==null?void 0:U.companyId)}});e(a.refreshCompaniesGridRequestModel({...c.data,items:u}))}),r.error?s({text:"Photo not deleted",description:r.error.details.message,type:"error"}):s({text:"Photo deleted successfully",type:"success"})})}function ue(o){return e(a.setIsPhotoUploaderLoading(!0)),E(o).then(n=>{var r;return n.error?(s({text:((r=n.error.data)==null?void 0:r.detail)||"Upload failed",type:"error"}),n):(n.data.photoId&&(e(a.setIsPhotoUploaderLoading(!1)),o.contextName==="Company"?(e(a.setIsSuppliersGridLoading(!0)),g(t.companiesGridRequestModel).then(i=>{e(a.setIsSuppliersGridLoading(!1));const c=i.data.items.map(u=>{var f;return{...u,isSelected:u.companyId===((f=t.selectedCompany)==null?void 0:f.companyId)}});e(a.refreshCompaniesGridRequestModel({...i.data,items:c}))}),e(a.refreshManagedCompany({...t.managedCompany,photos:[...t.managedCompany.photos||[],n.data]}))):e(a.refreshManagedLocation({...t.managedLocation,photos:[...t.managedLocation.photos||[],n.data]})),s({text:"Photos added successfully",type:"success"})),n)})}function le(o){switch(o.contextName){case"Company":Y({companyId:t.managedCompany.companyId,photoId:o.activeItem.photoId,index:o.newIndex}).then(n=>{n.error||(I(t.managedCompany.companyId).then(r=>{e(a.refreshManagedCompany(r.data))}),(o.newIndex===0||o.oldIndex===0)&&(e(a.setIsCompaniesGridLoading(!0)),g(t.companiesGridRequestModel).then(r=>{e(a.setIsCompaniesGridLoading(!1));const i=r.data.items.map(c=>{var u;return{...c,isSelected:c.companyId===((u=t.selectedCompany)==null?void 0:u.companyId)}});e(a.refreshCompaniesGridRequestModel({...r.data,items:i}))})))});break;case"Location":$({locationId:t.managedLocation.locationId,photoId:o.activeItem.photoId,index:o.newIndex}).then(n=>{n.error||I(t.managedCompany.companyId).then(r=>{e(a.refreshManagedCompany(r.data))})});break}}function Ce(o){p(o==="Company"?"companyPhotosCard":"locationPhotosCard")}function me(o){p("locationConfigurationCard",!0),e(o?a.refreshManagedLocation(o):a.resetManagedLocation())}function ye(o){e(a.setIsLocationConfigurationCardLoading(!0)),F({companyId:t.managedCompany.companyId,model:o}).then(n=>{var r;n.error?s({text:(r=n.error.data)==null?void 0:r.detail,type:"error"}):(p("locationConfigurationCard"),e(a.setIsCompanyConfigurationCardLoading(!0)),e(a.setIsLocationsGridLoading(!0)),I(t.managedCompany.companyId).then(i=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.refreshManagedCompany(i.data))}),s({text:"Location added successfully",type:"success"}))})}function fe(o){e(a.setIsLocationConfigurationCardLoading(!0)),Q(o.locationId).then(n=>{var r;n.error?s({text:(r=n.error.data)==null?void 0:r.detail,type:"error"}):(p("locationConfigurationCard"),e(a.setIsCompanyConfigurationCardLoading(!0)),e(a.setIsLocationsGridLoading(!0)),I(t.managedCompany.companyId).then(i=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.setIsLocationsGridLoading(!1)),e(a.refreshManagedCompany(i.data))}),s({text:"Location deleted successfully",type:"success"}))})}function he(o){e(a.setIsLocationConfigurationCardLoading(!0)),V({locationId:t.managedLocation.locationId,model:o}).then(n=>{e(a.setIsLocationConfigurationCardLoading(!1)),n.error?s({text:"Failed to update location",type:"error"}):(e(a.setIsCompanyConfigurationCardLoading(!0)),I(t.managedCompany.companyId).then(r=>{e(a.setIsCompanyConfigurationCardLoading(!1)),e(a.refreshManagedCompany(r.data))}),s({text:"Location updated successfully",type:"success"}))})}function ge(){p("locationPhotosCard",!0)}async function Le(o){await h({headerTitle:"Deleting location photo",text:"You are about to delete location photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&R(o.photoId).then(r=>{const i=t.managedLocation.photos.filter(c=>c.photoId!==o.photoId);e(a.refreshManagedLocation({...t.managedLocation,photos:i})),r.error?s({text:"Photo not deleted",description:r.error.details.message,type:"error"}):s({text:"Photo deleted successfully",type:"success"})})}function Ie(){p("locationConfigurationCard"),e(a.resetManagedLocation())}function Pe(o,n){e(a.setIsSupplierCardLoading(!0)),B(o.companyId).then(r=>{if(e(a.setIsSupplierCardLoading(!1)),r.error)s({text:r.error.message,type:"error"});else{if(W(o.supplierId,o.locationId).then(),P.selectedSupplier.supplierId===o.supplierId)return d(n).then(i=>{e(H.refreshSelectedPurchase(i.data)),e(a.refreshSelectedCompany({...i.data.company,locationId:i.data.location.locationId}))});s({text:"Supplier restored successfully",type:"success"})}})}async function Se(o){await h({headerTitle:"Delete Purchase",text:`You are about to delete purchase "${o.purchaseId}".`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&await S(o.purchaseId).then(r=>{r.error?s({text:r.error.data.detail,type:"error"}):(y(b.PRODUCTS),s({text:"Purchase deleted successfully",type:"success"}))})}function He(){y(b.PRODUCTS),e(a.refreshActiveCards([]))}function xe(){p("selectEntityCard")}function Me(o){o?(e(a.setIsSupplierCardLoading(!0)),e(a.setIsProductMenuCardLoading(!0)),d(o).then(n=>{var r;e(H.refreshSelectedPurchase(n.data)),e(a.setIsSupplierCardLoading(!1)),e(a.refreshSelectedCompany({...n.data.supplier,locationId:(r=n.data.location)==null?void 0:r.locationId}))}),m.getPurchaseCountersHandler(Number(o)).then(()=>e(a.setIsProductMenuCardLoading(!1))),J()):e(a.resetSelectedCompany()),e(H.resetPurchaseCounters()),e(a.resetActiveCards()),e(H.refreshActiveTab("purchases"))}return{state:t,productsState:P,productsService:m,createPurchaseForSupplierHandler:K,updatePurchaseForSupplierHandler:_,deletePurchaseHandler:Se,detachSupplierHandler:X,openCreateEntityCardHandler:ae,openSelectEntityCardHandler:Z,searchEntityHandler:ee,selectCompanyHandler:oe,createCompanyHandler:te,closeCreateCompanyCardHandler:ne,manageCompanyHandler:re,updateCompanyHandler:se,restoreCompanyHandler:Pe,closeSupplierCardHandler:He,closeSelectEntityCardHandler:xe,deleteCompanyHandler:ie,closeCompanyConfigurationCardHandler:de,manageCompanyPhotosHandler:ce,getSupplierPageDataHandler:Me,deleteCompanyPhotoHandler:pe,uploadPhotoHandler:ue,changePhotoPositionHandler:le,closePhotosCardHandler:Ce,openLocationConfigurationCardHandler:me,createLocationHandler:ye,deleteLocationHandler:fe,updateLocationHandler:he,manageLocationPhotosHandler:ge,deleteLocationPhotoHandler:Le,closeLocationConfigurationCardHandler:Ie}}function Ia(){var L,h,x,M,G;const{handleCardAction:p,createRefCallback:m}=Ae({selectActiveCards:S=>S[v.SUPPLIER].activeCards,refreshAction:a.refreshActiveCards}),{state:t,productsState:P,...e}=ze(p),{purchaseId:y}=Ee();Re.useEffect(()=>{e.getSupplierPageDataHandler(y)},[y]);async function s(S,d){switch(S){case"createPurchase":e.createPurchaseForSupplierHandler(d);break;case"updatePurchase":e.updatePurchaseForSupplierHandler(d.purchaseId,{date:d.selectedDate,companyId:d.selectedCompany.companyId,documentNotes:d.purchaseNotes});break;case"detachSupplier":e.detachSupplierHandler();break;case"openSelectEntityCard":e.openSelectEntityCardHandler();break;case"openCreateEntityCard":e.openCreateEntityCardHandler();break;case"searchEntity":e.searchEntityHandler(d);break;case"createCompany":e.createCompanyHandler(d);break;case"closeCreateCompanyCard":e.closeCreateCompanyCardHandler();break;case"selectCompany":e.selectCompanyHandler(d);break;case"manageCompany":e.manageCompanyHandler(d);break;case"updateCompany":e.updateCompanyHandler(d);break;case"deleteCompany":e.deleteCompanyHandler(d);break;case"closeCompanyConfigurationCard":e.closeCompanyConfigurationCardHandler();break;case"manageCompanyPhotos":e.manageCompanyPhotosHandler();break;case"uploadPhoto":e.uploadPhotoHandler(d);break;case"deleteCompanyPhoto":e.deleteCompanyPhotoHandler(d);break;case"changePhotoPosition":e.changePhotoPositionHandler(d);break;case"closePhotosCard":e.closePhotosCardHandler(d);break;case"openLocationConfigurationCard":e.openLocationConfigurationCardHandler(d);break;case"createLocation":e.createLocationHandler(d);break;case"updateLocation":e.updateLocationHandler(d);break;case"deleteLocation":e.deleteLocationHandler(d);break;case"closeLocationConfigurationCard":e.closeLocationConfigurationCardHandler();break;case"manageLocationPhotos":e.manageLocationPhotosHandler();break;case"deleteLocationPhoto":e.deleteLocationPhotoHandler(d);break;case"restoreCompany":e.restoreCompanyHandler(d,y);break;case"deletePurchase":e.deletePurchaseHandler(d);break;case"closeSupplierCard":e.closeSupplierCardHandler();break;case"closeSelectEntityCard":e.closeSelectEntityCardHandler();break}}return l.jsx("div",{className:$e.supplierPage,children:l.jsxs(Oe,{menuCollectionType:"purchases",menuTitle:"Report Purchase",counter:P.purchaseCounters,itemId:Number(y),activeCards:t.activeCards,children:[l.jsx(Ue,{isLoading:t.isSupplierCardLoading,selectedPurchase:P.selectedPurchase,selectedSupplier:t.selectedCompany,onAction:s}),((L=t.activeCards)==null?void 0:L.includes("selectEntityCard"))&&l.jsx("div",{ref:m("selectEntityCard"),children:l.jsx(Ne,{isGridLoading:t.isCompaniesGridLoading,entityName:"Company",entityCollection:t.companiesGridRequestModel.items,columns:Te({onAction:s}),onAction:s})}),t.activeCards.includes("createCompanyCard")&&l.jsx("div",{ref:m("createCompanyCard"),children:l.jsx(Fe,{isLoading:t.isCreateCompanyCardLoading,isPhotoUploaderLoading:t.isPhotoUploaderLoading,countryCodes:t.countryCodes,onAction:s})}),t.activeCards.includes("companyConfigurationCard")&&l.jsx("div",{ref:m("companyConfigurationCard"),children:l.jsx(Be,{isLoading:t.isCompanyConfigurationCardLoading,isGridLoading:t.isLocationsGridLoading,company:t.managedCompany,countryCodes:t.countryCodes,onAction:s})}),t.activeCards.includes("companyPhotosCard")&&l.jsx("div",{ref:m("companyPhotosCard"),children:l.jsx(O,{isImageUploaderLoading:t.isPhotoUploaderLoading,data:(h=t.managedCompany)==null?void 0:h.photos,contextName:"Company",contextId:(x=t.managedCompany)==null?void 0:x.companyId,noDataText:"COMPANY HAS NO PHOTOS",showCloseButton:!0,columns:Ve({onAction:s}),onAction:s})}),t.activeCards.includes("locationConfigurationCard")&&l.jsx("div",{ref:m("locationConfigurationCard"),children:l.jsx(Qe,{isLoading:t.isCustomerAddressDetailsLoading,location:t.managedLocation,countryCodes:t.countryCodes,onAction:s})}),t.activeCards.includes("locationPhotosCard")&&l.jsx("div",{ref:m("locationPhotosCard"),children:l.jsx(O,{isImageUploaderLoading:t.isPhotoUploaderLoading,data:(M=t.managedLocation)==null?void 0:M.photos,contextName:"Location",contextId:(G=t.managedLocation)==null?void 0:G.locationId,noDataText:"LOCATION HAS NO PHOTOS",showCloseButton:!0,columns:Ye({onAction:s}),onAction:s})})]})})}export{Ia as SupplierPage};
