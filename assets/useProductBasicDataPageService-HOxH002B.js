import{r as M,j as r,D as Ye,i as H,as as Z,e as E,m as Je,n as q,C as Xe,d as K,S as W,k as Ze,p as Ae,q as et,G as z,c as tt,I as _,A as V,K as y,ac as o,N as ot,bv as Q}from"./index-wSBNnuB8.js";import{S as R}from"./SheCard-bH-Mmfkw.js";import{o as at,c as rt,n as D,s as w,u as nt,S as st,a as F}from"./types-ChJVUntg.js";import{R as dt,S as k}from"./SheInput-LNN_iGxg.js";import{S as G,a as it,b as ct}from"./SheSelect-XCRVqNk7.js";import{C as lt}from"./SheCardNotification-DNhAQQpN.js";import{W as ut,n as mt}from"./SheContextSidebar-BsxFTrZ4.js";import{P as Y}from"./settings-2-DSTwlptS.js";import{c as O}from"./she-select-convertors-CdG-Ygpu.js";import{u as A,I as pt}from"./useAppTranslation-B6fVj9SN.js";import{S as ee}from"./SheFileUploader-p37o_Z2V.js";import{u as gt}from"./useProductsPageService-CwciQf7m.js";import{u as Ct}from"./useToast-DSTTjhYC.js";import{u as ft}from"./chevron-up-B-23HzTx.js";const yt="_productConfigurationFormCard_czqqu_1",ht="_productConfigurationForm_czqqu_1",J={productConfigurationFormCard:yt,productConfigurationForm:ht},It="_productConfigurationForm_15j2h_1",Pt="_componentWithButton_15j2h_9",xt="_formButton_15j2h_16",Lt="_formFooter_15j2h_19",j={productConfigurationForm:It,componentWithButton:Pt,formButton:xt,formFooter:Lt},Bt="field is required",Nt=at({productName:w().nonempty(Bt).min(2,"Min value length 2").max(50,"Max value length 50"),productCode:w().optional(),barcode:w().optional(),brandId:D().optional(),productCategoryId:D().optional(),countryOfOriginId:D().optional(),isActive:rt().optional()}),X={productId:null,productAppId:void 0,image:void 0,productCode:void 0,productName:void 0,productCategory:void 0,productCategoryId:void 0,brand:void 0,brandId:void 0,barcode:void 0,status:void 0,salePrice:void 0,variantsCount:void 0,stockAmount:void 0,countryId:void 0,isActive:!1,countryOfOriginId:void 0};function _t({data:c,categories:n,brands:d,countryCodes:e,productCode:l,selectedCategory:s,showSecondaryButton:P,onSubmit:L,onCancel:B,onAction:I}){const{form:N,isDisabled:C,setValue:m}=nt({values:c,defaultValues:X,scheme:Nt,mode:dt.CHANGE});return M.useEffect(()=>{c!=null&&c.productId?N.reset(c):N.reset(X)},[c]),M.useEffect(()=>{s&&m("productCategoryId",s)},[s]),M.useEffect(()=>{m("productCode",l)},[l]),r.jsxs(st,{form:N,className:j.productConfigurationForm,footerClassName:j.formFooter,footerPosition:Ye.RIGHT,primaryBtnProps:{value:c!=null&&c.productId?"Save":"Add Product",valueTransKey:c!=null&&c.productId?"CommonButtons.Save":"ProductActions.AddProduct",icon:lt,disabled:C},hideSecondaryBtn:!c||!c.productId||!P,onCancel:B,onSubmit:L,children:[r.jsx(F,{name:"productName",required:!0,render:({field:g})=>r.jsx(k,{value:g.value,label:"Product Name",labelTransKey:"ProductForm.Labels.ProductName",placeholder:"enter product name...",placeholderTransKey:"ProductForm.Placeholders.ProductName",autoFocus:!0,fullWidth:!0})}),r.jsxs("div",{className:j.componentWithButton,children:[r.jsx(F,{name:"productCode",render:({field:g})=>r.jsx(k,{value:g.value||"",label:"Product Code",labelTransKey:"ProductForm.Labels.ProductCode",placeholder:"enter product code...",placeholderTransKey:"ProductForm.Placeholders.ProductCode",fullWidth:!0,onDelay:x=>I("checkProductCode",x)})}),r.jsx(H,{className:j.formButton,icon:ut,type:"button",variant:"outline",onClick:()=>I("generateProductCode")})]}),r.jsx(F,{name:"barcode",render:({field:g})=>r.jsx(k,{value:g.value||"",label:"Product Barcode",labelTransKey:"ProductForm.Labels.ProductBarcode",placeholder:"enter product barcode...",placeholderTransKey:"ProductForm.Placeholders.ProductBarcode",fullWidth:!0})}),r.jsxs("div",{className:j.componentWithButton,children:[r.jsx(F,{name:"productCategoryId",render:({field:g})=>r.jsx(G,{items:n,selected:g.value,label:"Category Name",labelTransKey:"ProductForm.Labels.CategoryName",placeholder:"enter category name...",placeholderTransKey:"ProductForm.Placeholders.SelectCategory",hideFirstOption:!0,fullWidth:!0})}),r.jsx(H,{className:j.formButton,icon:Y,variant:"outline",type:"button",onClick:()=>I("openCreateProductCategoryCard")})]}),r.jsxs("div",{className:j.componentWithButton,children:[r.jsx(F,{name:"brandId",render:({field:g})=>r.jsx(G,{items:d,selected:g.value,label:"Brand Name",labelTransKey:"ProductForm.Labels.BrandName",placeholder:"enter brand name...",placeholderTransKey:"ProductForm.Placeholders.SelectBrand",hideFirstOption:!0,fullWidth:!0})}),r.jsx(H,{className:j.formButton,icon:Y,variant:"outline",type:"button",onClick:()=>I("openCreateProductBrandCard")})]}),r.jsx(F,{name:"countryOfOriginId",render:({field:g})=>r.jsx(G,{items:e,selected:g.value||s,label:"Country of origin",labelTransKey:"ProductForm.Labels.CountryOfOrigin",placeholder:"select country of origin...",placeholderTransKey:"ProductForm.Placeholders.CountryOfOrigin",hideFirstOption:!0,fullWidth:!0})}),r.jsx(F,{name:"isActive",render:({field:g})=>r.jsx(it,{checked:g.value,text:"Is Active",textTransKey:"ProductForm.Labels.IsActive",type:ct.SWITCH})})]})}function po({isLoading:c,product:n,productId:d,categoriesList:e,brandsList:l,countryCodesList:s,selectedCategory:P,productCode:L,showSecondaryButton:B,onAction:I}){return r.jsx(R,{className:J.productConfigurationFormCard,title:d?"Basic Product Data":"Create Product",titleTransKey:d?"CardTitles.BasicProductData":"CardTitles.CreateProduct",isLoading:c,showCloseButton:B,children:r.jsx("div",{className:J.productConfigurationForm,children:r.jsx(_t,{data:n,categories:O(e,{text:"categoryName",value:"categoryId"}),brands:O(l,{text:"brandName",value:"brandId"}),countryCodes:O(s,{text:"countryName",value:"countryId",icon:"flagIcon"}),selectedCategory:P,productCode:L,onAction:I,onSubmit:N=>I("submitProductData",N),onCancel:()=>I("gotoProductsPage")})})})}const vt="_createProductCategoryCard_6pz0n_1",St="_cardContent_6pz0n_1",jt="_uploadingBlockContainer_6pz0n_8",Tt="_uploadingItem_6pz0n_15",bt="_uploadingImageContainer_6pz0n_15",Ft="_uploadingItemImage_6pz0n_20",Mt="_uploadingItemTextBlock_6pz0n_26",Ht="_loadingBlock_6pz0n_38",T={createProductCategoryCard:vt,cardContent:St,uploadingBlockContainer:jt,uploadingItem:Tt,uploadingImageContainer:bt,uploadingItemImage:Ft,uploadingItemTextBlock:Mt,loadingBlock:Ht};function go({isLoading:c,isPhotoUploaderLoading:n,category:d,onAction:e}){const[l,s]=M.useState({}),P=M.useRef(null),{translate:L}=A();function B(){var x,b;const C=((x=P.current)==null?void 0:x.getSelectedFiles())||[],m=((b=P.current)==null?void 0:b.getUploadModels())||[],g={categoryName:d.categoryName,images:C,uploadModels:m};s(g),e==null||e("createProductCategory",g)}function I(){e==null||e("closeCreateProductCategoryCard")}const N=()=>{var C;return c&&(l!=null&&l.images)?l.images:((C=P.current)==null?void 0:C.getSelectedFiles())||[]};return r.jsx(R,{className:T.createProductCategoryCard,title:"Create Product Category",titleTransKey:"CardTitles.CreateProductCategory",isLoading:c,showCloseButton:!0,onSecondaryButtonClick:I,children:r.jsxs("div",{className:T.cardContent,children:[r.jsx(k,{label:"Category Name",labelTransKey:"ProductForm.Labels.CategoryName",placeholder:"enter category name...",placeholderTransKey:"ProductForm.Placeholders.CategoryName",errorMessage:d==null?void 0:d.error,fullWidth:!0,onDelay:C=>e("checkCategoryName",C)}),n?r.jsx("div",{className:T.uploadingBlockContainer,children:N().map((C,m)=>{const g=C instanceof File?URL.createObjectURL(C):C.result||C.path;return r.jsx("div",{className:"overflow-hidden rounded-md bg-secondary p-0 shadow-sm",children:r.jsxs("div",{className:`${T.uploadingItem} flex relative items-center justify-between p-2 pl-4`,children:[r.jsx("div",{className:T.uploadingImageContainer,children:r.jsx("img",{src:g,alt:`uploading-${C.name||`image-${m}`}`,className:T.uploadingItemImage,onLoad:()=>{C instanceof File&&URL.revokeObjectURL(g)}})}),r.jsxs("div",{className:T.uploadingItemTextBlock,children:[r.jsx("p",{className:"truncate text-sm",children:C.name||`${L("ProductForm.Labels.Image")} ${m+1}`}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[((C.size||0)/(1024*1024)).toFixed(2)," MB"]})]}),r.jsx(Z,{className:T.loadingBlock})]})},C.name||m)})}):r.jsx(ee,{isLoading:n,ref:P,contextName:"category",contextId:d==null?void 0:d.categoryId,fullWidth:!0,hideUploadButton:!0}),r.jsx(H,{value:"Add Category",valueTransKey:"ProductActions.AddCategory",disabled:!(d!=null&&d.categoryName)||!!(d!=null&&d.error),onClick:B})]})})}const kt="_createProductBrandCard_ii7aw_1",Dt="_cardContent_ii7aw_1",wt="_uploadingBlockContainer_ii7aw_8",Gt="_uploadingItem_ii7aw_15",Ot="_uploadingImageContainer_ii7aw_15",Rt="_uploadingItemImage_ii7aw_20",Ut="_uploadingItemTextBlock_ii7aw_26",$t="_loadingBlock_ii7aw_38",Et="_brandOwnerBlock_ii7aw_42",qt="_brandOwnerSelect_ii7aw_47",Kt="_brandOwnerSelectTitle_ii7aw_52",Wt="_selectedCompany_ii7aw_56",zt="_selectedCompanyDetails_ii7aw_61",Vt="_companyPhoto_ii7aw_67",Qt="_companyDesc_ii7aw_79",Yt="_companyNameTooltip_ii7aw_85",Jt="_companyName_ii7aw_85",Xt="_twoLineEllipsis_ii7aw_94",h={createProductBrandCard:kt,cardContent:Dt,uploadingBlockContainer:wt,uploadingItem:Gt,uploadingImageContainer:Ot,uploadingItemImage:Rt,uploadingItemTextBlock:Ut,loadingBlock:$t,brandOwnerBlock:Et,brandOwnerSelect:qt,brandOwnerSelectTitle:Kt,selectedCompany:Wt,selectedCompanyDetails:zt,companyPhoto:Vt,companyDesc:Qt,companyNameTooltip:Yt,companyName:Jt,twoLineEllipsis:Xt};function Co({isLoading:c,isPhotoUploaderLoading:n,brand:d,selectedCompany:e,onAction:l}){const[s,P]=M.useState({}),L=M.useRef(null),{translate:B}=A();function I(){var b,v;const m=((b=L.current)==null?void 0:b.getSelectedFiles())||[],g=((v=L.current)==null?void 0:v.getUploadModels())||[],x={brandName:d.brandName,images:m,uploadModels:g};P(x),l==null||l("createProductBrand",x)}function N(){l==null||l("closeCreateProductBrandCard")}const C=()=>{var m;return c&&(s!=null&&s.images)?s.images:((m=L.current)==null?void 0:m.getSelectedFiles())||[]};return r.jsx(R,{className:h.createProductBrandCard,title:"Create Product Brand",titleTransKey:"CardTitles.CreateProductBrand",isLoading:c,showCloseButton:!0,onSecondaryButtonClick:N,children:r.jsxs("div",{className:h.cardContent,children:[r.jsx(k,{label:"Brand Name",labelTransKey:"ProductForm.Labels.BrandName",placeholder:"enter brand name...",placeholderTransKey:"ProductForm.Placeholders.BrandName",errorMessage:d==null?void 0:d.error,fullWidth:!0,onDelay:m=>l("checkBrandName",m)}),n?r.jsx("div",{className:h.uploadingBlockContainer,children:C().map((m,g)=>{const x=m instanceof File?URL.createObjectURL(m):m.result||m.path;return r.jsx("div",{className:"overflow-hidden rounded-md bg-secondary p-0 shadow-sm",children:r.jsxs("div",{className:`${h.uploadingItem} flex relative items-center justify-between p-2 pl-4`,children:[r.jsx("div",{className:h.uploadingImageContainer,children:r.jsx("img",{src:x,alt:`uploading-${m.name||`image-${g}`}`,className:h.uploadingItemImage,onLoad:()=>{m instanceof File&&URL.revokeObjectURL(x)}})}),r.jsxs("div",{className:h.uploadingItemTextBlock,children:[r.jsx("p",{className:"truncate text-sm",children:m.name||`${B("ProductForm.Labels.Image")} ${g+1}`}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[((m.size||0)/(1024*1024)).toFixed(2)," MB"]})]}),r.jsx(Z,{className:h.loadingBlock})]})},m.name||g)})}):r.jsx(ee,{isLoading:n,ref:L,contextName:"brand",contextId:d==null?void 0:d.brandId,fullWidth:!0,hideUploadButton:!0}),r.jsx(E,{}),r.jsxs("div",{className:h.brandOwnerBlock,children:[r.jsxs("div",{className:h.brandOwnerSelect,children:[r.jsx("span",{className:`${h.brandOwnerSelectTitle} she-title`,children:"Brand owner"}),r.jsx(H,{variant:"secondary",icon:mt,value:"Select Company",onClick:()=>l("openSelectEntityCard")})]}),e&&r.jsx("div",{className:h.selectedCompany,children:r.jsxs("div",{className:h.selectedCompanyDetails,children:[r.jsx("div",{className:h.companyPhoto,children:e.thumbnailUrl?r.jsx("img",{src:e==null?void 0:e.thumbnailUrl,alt:e==null?void 0:e.companyName}):r.jsx(Je,{icon:pt})}),r.jsxs("div",{className:h.companyDesc,children:[r.jsx(q,{delayDuration:200,text:e==null?void 0:e.companyName,className:h.companyNameTooltip,children:r.jsx("span",{className:`${h.companyName} she-text`,children:e==null?void 0:e.companyName})}),(e==null?void 0:e.address)&&r.jsx(q,{delayDuration:200,text:e==null?void 0:e.address,className:"max-w-[150px]",children:r.jsx("span",{className:`${h.twoLineEllipsis} she-text`,children:e==null?void 0:e.address})})]}),r.jsx(H,{icon:Xe,value:"Manage",valueTransKey:"CommonButtons.Manage",variant:"secondary",onClick:()=>l("manageCompany",e)})]})})]}),r.jsx(E,{}),r.jsx(H,{value:"Add Brand",valueTransKey:"ProductActions.AddBrand",disabled:!(d!=null&&d.brandName)||!!(d!=null&&d.error),onClick:I})]})})}function fo(c){const n=K(W.PRODUCT_BASIC_DATA),d=K(W.PRODUCTS),e=Ze(),l=gt(),{addToast:s}=Ct(),P=Ae(),{t:L}=ft(),{openConfirmationDialog:B}=et(),[I]=z.useLazyGenerateProductCodeQuery(),[N]=z.useCheckProductCodeMutation(),[C]=tt.useLazyGetCountryCodeQuery(),[m]=_.useGetListOfCompaniesForGridMutation(),[g]=_.useCreateCompanyMutation(),[x]=V.useUploadPhotoMutation(),[b]=_.useAddNewLocationToCompanyMutation(),[v]=_.useLazyGetCompanyDetailsQuery(),[te]=_.useDeleteCompanyMutation(),[U]=V.useDeletePhotoMutation(),[oe]=_.useAddLocationToCompanyMutation(),[ae]=_.useUpdateCompanyDetailsMutation(),[re]=_.useChangePositionOfCompanyPhotoMutation(),[ne]=_.useChangePositionOfLocationPhotoMutation(),[se]=_.useUpdateLocationDetailsMutation(),[de]=_.useDeleteLocationMutation();function ie(t){d.products||(e(y.setIsItemsCardLoading(!0)),l.getTheProductsForGridHandler(t).then(()=>{e(y.setIsItemsCardLoading(!1))}))}function ce(){n.countryCodes.length===0&&C(void 0).then(t=>{e(o.refreshCountryCodes(t.data))})}function le(){d.brands.length===0&&l.getSimpleListOfAllBrandsHandler()}function ue(){d.categories.length===0&&l.getAllCategoriesByOrganizationHandler()}function me(t){var a;t?(!d.productCounter||((a=d.product)==null?void 0:a.productId)!==t)&&(e(y.setIsProductMenuCardLoading(!0)),l.getCountersForProductsHandler(t).then(()=>{e(y.setIsProductMenuCardLoading(!1))})):e(y.refreshProductCounter({}))}function pe(t){var a;t?(!d.product||((a=d.product)==null?void 0:a.productId)!==t)&&(e(o.setIsProductConfigurationCardLoading(!0)),l.getProductDetailsHandler(t).then(()=>{e(o.setIsProductConfigurationCardLoading(!1))})):e(y.refreshProduct({}))}function ge(t){l.itemCardHandler(t)}function Ce(t,a){console.log("UPDATE"),e(o.setIsProductConfigurationCardLoading(!0)),l.updateProductHandler(t,a).then(i=>{e(o.setIsProductConfigurationCardLoading(!1)),i.data?(e(y.refreshProduct(i.data)),d.product.productName!==a.productName&&l.getTheProductsForGridHandler(d.productsGridRequestModel,!0),s({text:"Product updated successfully",type:"success"})):s({text:"Product not updated",description:i.error.message,type:"error"})})}function fe(t){e(o.setIsProductConfigurationCardLoading(!0)),l.createNewProductHandler(t).then(a=>{e(o.setIsProductConfigurationCardLoading(!1)),a.data?(e(y.refreshSelectedProduct(a.data)),l.getTheProductsForGridHandler(d.productsGridRequestModel),P(`${Q.PRODUCTS}${Q.PRODUCT_BASIC_DATA}/${a.data.productId}`),l.getTheProductsForGridHandler(d.productsGridRequestModel,!0),s({text:"Product created successfully",type:"success"})):s({text:`${a.error.data.detail}`,type:"error"})})}function ye(t,a){t?Ce(t,a):fe(a)}function he(){P(ot.PRODUCTS)}function Ie(t){t&&l.checkCategoryNameHandler({categoryName:t}).then(a=>{a.error?e(y.refreshCategory({...n.category,error:a.error.data.detail})):e(y.refreshCategory({...n.category,categoryName:t}))})}function Pe(t){l.createNewCategoryHandler({categoryName:t.categoryName}).then(a=>{if(a.data){e(y.refreshCategories([...d.categories,a.data])),e(o.refreshSelectedCategory(a.data.categoryId)),e(y.setIsPhotoUploaderLoading(!0));const i=t.uploadModels.map(u=>(u.contextId=a.data.categoryId,l.uploadPhotoHandler(u)));Promise.all(i).then(u=>{u.forEach(p=>{var f;e(y.setIsPhotoUploaderLoading(!1)),p&&!p.error?(e(y.refreshCategory(null)),s({text:"Category created successfully",type:"success"})):s({text:(f=p==null?void 0:p.error)==null?void 0:f.data.detail,type:"error"})})}),c("createCategoryCard")}else s({text:`${a.error.data.detail}`,type:"error"})})}function xe(t){t&&l.checkBrandNameHandler({brandName:t}).then(a=>{a.error?e(y.refreshBrand({...n.brand,error:a.error.data.detail})):e(y.refreshBrand({...n.brand,brandName:t,error:null}))})}function Le(t){l.createBrandHandler({brandName:t.brandName,companyId:n.selectedCompany.companyId}).then(a=>{if(a.data){if(e(y.refreshBrands([...d.brands,a.data])),t.uploadModels.length>0){e(y.setIsPhotoUploaderLoading(!0));const i=t.uploadModels.map(u=>(u.contextId=a.data.brandId,l.uploadPhotoHandler(u)));Promise.all(i).then(u=>{u.forEach(p=>{var f;e(y.setIsPhotoUploaderLoading(!1)),p&&!p.error?e(y.refreshBrand(null)):s({text:(f=p==null?void 0:p.error)==null?void 0:f.data.detail,type:"error"})})})}c("createBrandCard"),s({text:"Brand created successfully",type:"success"}),e(o.resetSelectedCompany())}else s({text:`${a.error.data.detail}`,type:"error"})})}function Be(t){l.uploadPhotoHandler(t).then(a=>{t.contextId?a.data.photoId?s({text:"Photos added successfully",type:"success"}):s({text:`${a.error.data.detail}`,type:"error"}):s({text:t.contextName==="brand"?"Create brand first":"Create category first",type:"error"})})}function Ne(t){return I(null).then(a=>(e(t?y.refreshProduct({...d.product,productCode:a.data.code}):y.refreshProductCode(a.data.code)),a.data))}function _e(t){return N(t).then(a=>(a.error?s({text:`${a.error.data.detail}`,type:"error"}):s({text:"Product code is available",type:"success"}),a.data))}function ve(){c("selectEntityCard",!0),e(o.setIsCompaniesGridLoading(!0)),m(n.companiesGridRequestModel).then(t=>{e(o.setIsCompaniesGridLoading(!1));const a=t.data.items.map(i=>{var u;return{...i,isSelected:i.companyId===((u=n.selectedCompany)==null?void 0:u.companyId)}});e(o.refreshCompaniesGridRequestModel({...t.data,items:a}))})}function Se(t){e(o.setIsCompaniesGridLoading(!0)),m({searchQuery:t}).then(a=>{e(o.setIsCompaniesGridLoading(!1)),e(o.refreshCompaniesGridRequestModel(a.data))})}function je(t){c("selectEntityCard"),e(o.refreshSelectedCompany(t))}function Te(){c("createCompanyCard",!0)}function be(){c("selectEntityCard")}function Fe(t){e(o.setIsCreateCompanyCardLoading(!0)),g(t.company).then(a=>{a.error?s({text:a.error.details.message,type:"error"}):(t.image.uploadModels.map(i=>{i.contextId=a.data.companyId,e(o.setIsPhotoUploaderLoading(!0)),x(i).then(u=>{e(o.setIsPhotoUploaderLoading(!1)),s(u?{text:L("SuccessMessages.ImageAdded"),type:"success"}:{text:u.error.details.message,type:"error"})})}),b({companyId:a.data.companyId,model:t.address}).then(()=>{e(o.setIsCreateCompanyCardLoading(!1)),c("createCompanyCard"),e(o.setIsCompaniesGridLoading(!0)),m(n.companiesGridRequestModel).then(i=>{e(o.setIsCompaniesGridLoading(!1));const u=i.data.items.map(p=>{var f;return{...p,isSelected:p.companyId===((f=n.selectedCompany)==null?void 0:f.companyId)}});e(o.refreshCompaniesGridRequestModel({...i.data,items:u}))})}),s({text:"Company created successfully",type:"success"}))})}function Me(){c("createCompanyCard")}function He(t){c("companyConfigurationCard",!0),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),v(t.companyId).then(a=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(a.data))})}async function ke(t){await B({headerTitle:"Deleting company",text:`You are about to delete company ${t.companyName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&(e(o.setIsCompanyConfigurationCardLoading(!0)),te(t.companyId).then(i=>{if(i.error){s({text:"Failed to delete company",type:"error"});return}else s({text:"Company deleted successfully",type:"info"}),c("companyConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.resetManagedCompany()),e(o.setIsCompaniesGridLoading(!0)),m(n.companiesGridRequestModel).then(u=>{e(o.setIsCompaniesGridLoading(!1));const p=u.data.items.map(f=>{var S;return{...f,isSelected:f.companyId===((S=n.selectedCompany)==null?void 0:S.companyId)}});e(o.refreshCompaniesGridRequestModel({...u.data,items:p}))}),n.selectedCompany.companyId===n.managedCompany.companyId&&e(o.resetSelectedCompany())}))}function De(){c("companyConfigurationCard"),e(o.resetManagedCompany())}function we(){c("companyPhotosCard",!0)}function Ge(t){e(o.setIsCompanyConfigurationCardLoading(!0)),ae({companyId:n.managedCompany.companyId,model:t}).then(a=>{e(o.setIsCompanyConfigurationCardLoading(!1)),a.error?s({text:"Failed to update company",type:"error"}):(e(o.refreshManagedCompany(a.data)),e(o.setIsCompaniesGridLoading(!0)),m(n.companiesGridRequestModel).then(i=>{e(o.setIsCompaniesGridLoading(!1));const u=i.data.items.map(p=>{var f;return{...p,isSelected:p.companyId===((f=n.selectedCompany)==null?void 0:f.companyId)}});e(o.refreshCompaniesGridRequestModel({...i.data,items:u}))}),s({text:"Company updated successfully",type:"success"}))})}async function Oe(t){await B({headerTitle:"Deleting company photo",text:"You are about to delete company photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&U(t.photoId).then(i=>{const u=n.managedCompany.photos.filter(p=>p.photoId!==t.photoId);e(o.refreshManagedCompany({...n.managedCompany,photos:u})),e(o.setIsCompaniesGridLoading(!0)),m(n.companiesGridRequestModel).then(p=>{e(o.setIsCompaniesGridLoading(!1));const f=p.data.items.map(S=>{var $;return{...S,isSelected:S.companyId===(($=n.selectedCompany)==null?void 0:$.companyId)}});e(o.refreshCompaniesGridRequestModel({...p.data,items:f}))}),i.error?s({text:"Photo not deleted",description:i.error.details.message,type:"error"}):s({text:"Photo deleted successfully",type:"success"})})}function Re(t){return e(o.setIsPhotoUploaderLoading(!0)),x(t).then(a=>{var i;return a.error?(s({text:((i=a.error.data)==null?void 0:i.detail)||"Upload failed",type:"error"}),a):(a.data.photoId&&(e(o.setIsPhotoUploaderLoading(!1)),t.contextName==="Company"?(e(o.setIsCompaniesGridLoading(!0)),m(n.companiesGridRequestModel).then(u=>{e(o.setIsCompaniesGridLoading(!1));const p=u.data.items.map(f=>{var S;return{...f,isSelected:f.companyId===((S=n.selectedCompany)==null?void 0:S.companyId)}});e(o.refreshCompaniesGridRequestModel({...u.data,items:p}))}),e(o.refreshManagedCompany({...n.managedCompany,photos:[...n.managedCompany.photos||[],a.data]}))):e(o.refreshManagedLocation({...n.managedLocation,photos:[...n.managedLocation.photos||[],a.data]})),s({text:"Photos added successfully",type:"success"})),a)})}function Ue(t){switch(t.contextName){case"Company":re({companyId:n.managedCompany.companyId,photoId:t.activeItem.photoId,index:t.newIndex}).then(a=>{a.error||(v(n.managedCompany.companyId).then(i=>{e(o.refreshManagedCompany(i.data))}),(t.newIndex===0||t.oldIndex===0)&&(e(o.setIsSelectEntityCardLoading(!0)),e(o.setIsCompaniesGridLoading(!0)),m(n.companiesGridRequestModel).then(i=>{e(o.setIsSelectEntityCardLoading(!1)),e(o.setIsCompaniesGridLoading(!1));const u=i.data.items.map(p=>{var f;return{...p,isSelected:p.companyId===((f=n.selectedCompany)==null?void 0:f.companyId)}});e(o.refreshCompaniesGridRequestModel({...i.data,items:u}))})))});break;case"Location":ne({locationId:n.managedLocation.locationId,photoId:t.activeItem.photoId,index:t.newIndex}).then(a=>{a.error||v(n.managedCompany.companyId).then(i=>{e(o.refreshManagedCompany(i.data))})});break}}function $e(t){console.log("NAME",t),c(t==="Company"?"companyPhotosCard":"locationPhotosCard")}function Ee(t){c("locationConfigurationCard",!0),e(t?o.refreshManagedLocation(t):o.resetManagedLocation())}function qe(t){e(o.setIsLocationConfigurationCardLoading(!0)),oe({companyId:n.managedCompany.companyId,model:t}).then(a=>{var i;a.error?s({text:(i=a.error.data)==null?void 0:i.detail,type:"error"}):(c("locationConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),v(n.managedCompany.companyId).then(u=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(u.data))}),s({text:"Location added successfully",type:"success"}))})}function Ke(t){e(o.setIsLocationConfigurationCardLoading(!0)),de(t.locationId).then(a=>{var i;a.error?s({text:(i=a.error.data)==null?void 0:i.detail,type:"error"}):(c("locationConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),v(n.managedCompany.companyId).then(u=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(u.data))}),s({text:"Location deleted successfully",type:"success"}))})}function We(t){e(o.setIsLocationConfigurationCardLoading(!0)),se({locationId:n.managedLocation.locationId,model:t}).then(a=>{e(o.setIsLocationConfigurationCardLoading(!1)),a.error?s({text:"Failed to update location",type:"error"}):(e(o.setIsCompanyConfigurationCardLoading(!0)),v(n.managedCompany.companyId).then(i=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.refreshManagedCompany(i.data))}),s({text:"Location updated successfully",type:"success"}))})}function ze(){c("locationConfigurationCard"),e(o.resetManagedLocation())}async function Ve(t){await B({headerTitle:"Deleting location photo",text:"You are about to delete location photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&U(t.photoId).then(i=>{const u=n.managedLocation.photos.filter(p=>p.photoId!==t.photoId);e(o.refreshManagedLocation({...n.managedLocation,photos:u})),i.error?s({text:"Photo not deleted",description:i.error.details.message,type:"error"}):s({text:"Photo deleted successfully",type:"success"})})}function Qe(){c("locationPhotosCard",!0)}return{state:n,productsState:d,productsService:l,getProductsHandler:ie,getCategoriesHandler:le,getCountryCodesHandler:ce,getBrandsHandler:ue,getCountersForProductsHandler:me,getProductDetailsHandler:pe,itemCardClickHandler:ge,gotoProductsPageHandler:he,onSubmitProductDataHandler:ye,checkCategoryNameHandler:Ie,createNewCategoryHandler:Pe,checkBrandNameHandler:xe,createBrandHandler:Le,uploadCategoryOrBrandPhotoHandler:Be,generateProductCodeHandler:Ne,checkProductCodeHandler:_e,openSelectEntityCardHandler:ve,searchEntityHandler:Se,selectCompanyHandler:je,openCreateEntityCardHandler:Te,closeSelectEntityCardHandler:be,createCompanyHandler:Fe,closeCreateCompanyCardHandler:Me,manageCompanyHandler:He,deleteCompanyHandler:ke,closeCompanyConfigurationCardHandler:De,manageCompanyPhotosHandler:we,updateCompanyHandler:Ge,deleteCompanyPhotoHandler:Oe,uploadPhotoHandler:Re,changePhotoPositionHandler:Ue,closePhotosCardHandler:$e,openLocationConfigurationCardHandler:Ee,createLocationHandler:qe,deleteLocationHandler:Ke,updateLocationHandler:We,closeLocationConfigurationCardHandler:ze,deleteLocationPhotoHandler:Ve,manageLocationPhotosHandler:Qe}}export{go as C,po as P,Co as a,fo as u};
