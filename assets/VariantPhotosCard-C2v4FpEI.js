import{j as e,a6 as Re,a7 as Ve,k as f,a8 as De,a9 as oe,r as _,t as K,m as Y,x as de,L as Me,Q as He,z as ne,_ as ze,o as Ke,ah as Ae}from"./index-CqLEDb0h.js";import{i as ue,e as me,F as he,a as pe,b as xe,u as Ge}from"./form-BPwqqXcv.js";import{a as Ce,b as ge,c as je,d as ke,S as Pe}from"./select-DL5f33uf.js";import{S as I,R as Se}from"./SheInput-DbpOA7IC.js";import{S as A}from"./SheGrid-Fci2HgNW.js";import{S as B,a as $e}from"./SheForm-BPCdrBeX.js";import{S as D}from"./SheCard-CX5qtFRW.js";import{u as O,I as fe}from"./useAppTranslation-CsMEigHw.js";import{c as Le,W as Oe,o as Ue,t as We,u as Ee,I as qe,v as Qe,L as Ye}from"./SheContextSidebar-CL4FXvtg.js";import{P as R}from"./plus-Cg_Vlo1I.js";import{o as q,n as v,u as be,S as _e,a as V}from"./types-TQ-jcydJ.js";import{S as Q}from"./SheSelect-C_zn2LY0.js";import{c as re}from"./she-select-convertors-CdG-Ygpu.js";import{S as Je,C as Xe}from"./SheDatePicker-DFDs0SXU.js";import{C as Ze}from"./trash-Czml7Fyd.js";import{u as es}from"./chevron-up-DLJ1s3UP.js";import{S as ss}from"./SheFileUploader-DanH7GSt.js";import{p as ye}from"./placeholder-image-BgG3Yd5d.js";const ts="_variantConfigurationCard_p7gad_1",as="_variantConfigurationCardContent_p7gad_1",os="_variantConfigurationForm_p7gad_12",ns="_variantCodeFormRow_p7gad_17",rs="_priceFormRow_p7gad_27",cs="_priceFormRowItem_p7gad_31",ls="_stockDetailsBlock_p7gad_48",is="_buttonBlock_p7gad_53",ds="_stockDetailsTitle_p7gad_61",us="_stockBlock_p7gad_64",ms="_stockBlockRow_p7gad_68",hs="_stockBlockRowNumber_p7gad_76",ps="_variantGridBlock_p7gad_79",xs="_variantGridBlockHeader_p7gad_84",Cs="_expandableRow_p7gad_90",gs="_expandableRowIcon_p7gad_96",js="_expandableRowText_p7gad_99",p={variantConfigurationCard:ts,variantConfigurationCardContent:as,variantConfigurationForm:os,variantCodeFormRow:ns,priceFormRow:rs,priceFormRowItem:cs,stockDetailsBlock:ls,buttonBlock:is,stockDetailsTitle:ds,stockBlock:us,stockBlockRow:ms,stockBlockRowNumber:hs,variantGridBlock:ps,variantGridBlockHeader:xs,expandableRow:Cs,expandableRowIcon:gs,expandableRowText:js},ks=[{accessorKey:"optionColor",header:"Type",maxSize:100,minSize:100,cell:({row:n})=>e.jsx("span",{className:"she-text",children:n.original.optionColor===null?"Size":"Color"})},{accessorKey:"optionName",header:"Value",maxSize:150,minSize:150,cell:({row:n})=>e.jsx("div",{className:n.original.optionColor===null?"she-text":"",style:n.original.optionColor?{background:n.original.optionColor,width:"20px",height:"20px",borderRadius:"50%",alignSelf:"center"}:{alignSelf:"center"},children:n.original.optionColor===null?n.original.optionName:""})},{id:"traitName",header:"Name",minSize:100,cell:({row:n})=>e.jsx("div",{className:"she-text",children:n.original.traitName})}];function Ps({row:n,table:t,style:o,onAction:s}){const a=t.options.meta;return e.jsx("div",{style:o,children:e.jsxs(Re,{children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(f,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(Le,{}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(De,{align:"start",className:"w-[160px]",children:[e.jsx(oe,{onClick:()=>{queueMicrotask(()=>{s("detachFromVariant",n.id,a==null?void 0:a.setLoadingRow,n)})},children:"Detach photo"}),e.jsx(oe,{onClick:()=>{queueMicrotask(()=>{s("deletePhoto",n.id,a==null?void 0:a.setLoadingRow,n)})},children:"Delete photo"})]})]})})}const Ne=n=>[{accessorKey:"thumbnailUrl",header:"Preview",minSize:80,maxSize:80,cell:({row:t,table:o})=>{const s=t.getValue("thumbnailUrl"),a=o.options.meta;return e.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>n("image",t.id,a==null?void 0:a.setLoadingRow),children:e.jsx("img",{src:s,alt:"photo",className:"object-cover rounded-md w-full h-full",onError:c=>{c.currentTarget.src=ye}})})}},{accessorKey:"format",header:"Format",minSize:190,cell:({row:t})=>e.jsx("span",{className:"she-subtext",children:`${t.original.height}px x ${t.original.width}px`})},{id:"rowActions",header:"Actions",minSize:80,maxSize:80,cell:({row:t,table:o})=>e.jsx(Ps,{style:{paddingLeft:"30px"},row:t,onAction:n,table:o})}],ce=(n,t)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>n(...s),t)}};function Nt({isLoading:n,isVariantOptionsGridLoading:t,isVariantPhotoGridLoading:o,variant:s,variantPhotos:a,data:c,onAction:l,taxesList:u,productCounter:k,onGenerateProductCode:C,...P}){var X,Z,ee,se,te;const[j,d]=_.useState({variantName:(s==null?void 0:s.variantName)||"",variantCode:(s==null?void 0:s.variantCode)||"",salePrice:{brutto:(X=s==null?void 0:s.salePrice)==null?void 0:X.brutto,netto:(Z=s==null?void 0:s.salePrice)==null?void 0:Z.netto,taxTypeId:((ee=s==null?void 0:s.salePrice)==null?void 0:ee.taxTypeId)||((se=u==null?void 0:u[0])==null?void 0:se.id)}}),{translate:m}=O(),h=ks,S=Ne(Ie),g=ue({defaultValues:j}),{setValue:N,register:F,getValues:U}=g,G=Fe(s==null?void 0:s.traitOptions),J=_.useRef((s==null?void 0:s.variantId)||null),w=_.useRef(!1),M=_.useRef(null),W=_.useRef(ce(()=>{w.current&&g.handleSubmit($)()},1500));_.useEffect(()=>{W.current&&(W.current=ce(()=>{w.current&&g.handleSubmit($)()},1500))},[s==null?void 0:s.variantId]),_.useEffect(()=>{var r,i,b,y;if(J.current!==(s==null?void 0:s.variantId)){J.current=(s==null?void 0:s.variantId)||null;const z={variantName:(s==null?void 0:s.variantName)||"",variantCode:(s==null?void 0:s.variantCode)||"",salePrice:{brutto:(r=s==null?void 0:s.salePrice)==null?void 0:r.brutto,netto:(i=s==null?void 0:s.salePrice)==null?void 0:i.netto,taxTypeId:((b=s==null?void 0:s.salePrice)==null?void 0:b.taxTypeId)||((y=u==null?void 0:u[0])==null?void 0:y.id)}};d(z),g.reset(z),w.current=!1}},[s==null?void 0:s.variantId,s,u,g]);function Te(){C().then(r=>{g.setValue("variantCode",r.code,{shouldDirty:!0}),w.current=!0,g.handleSubmit($)()})}function H(){const r=U(),i=j;(r.variantName!==i.variantName||r.variantCode!==i.variantCode||r.salePrice.netto!==i.salePrice.netto||r.salePrice.brutto!==i.salePrice.brutto||r.salePrice.taxTypeId!==i.salePrice.taxTypeId)&&(w.current=!0,W.current())}function $(r){var ae;if(!w.current)return;let i=typeof r.salePrice.netto=="string"?Number(r.salePrice.netto):r.salePrice.netto||0,b=typeof r.salePrice.brutto=="string"?Number(r.salePrice.brutto):r.salePrice.brutto||0;const y=r.salePrice.taxTypeId,z=((ae=u.find(Be=>Be.id===y))==null?void 0:ae.value)??0;M.current==="netto"?b=+(i*(1+z)).toFixed(2):M.current==="brutto"&&(i=+(b/(1+z)).toFixed(2)),N("salePrice.netto",i,{shouldDirty:!1}),N("salePrice.brutto",b,{shouldDirty:!1});const ve={...r,salePrice:{netto:i,brutto:b,taxTypeId:y}};s&&l("updateVariantDetails",{formattedData:ve,variant:s}),d({variantName:r.variantName||"",variantCode:r.variantCode||"",salePrice:{netto:i,brutto:b,taxTypeId:y}}),w.current=!1}function Ie(r,i,b,y){l("detachPhotoFromVariant",y.original),l("deletePhoto",y.original)}function Fe(r){return(r==null?void 0:r.map(i=>{const b=[];return i.isRemoved&&b.push({id:`${i.id}-removed`,type:"removed",message:m("ValidationMessages.TraitOptionRemoved")}),i.isMissing&&b.push({id:`${i.id}-missing`,type:"missing",message:m("ValidationMessages.TraitOptionMissingConfiguration")}),{...i,expandableRows:b}}))||[]}function we(r){return e.jsx("div",{children:r.original.expandableRows.map(i=>e.jsxs("div",{className:p.expandableRow,children:[e.jsx(Y,{maxWidth:"20px",minWidth:"20px",className:p.expandableRowIcon,icon:$e}),e.jsx("span",{className:p.expandableRowText,children:i.message})]},i.id))})}return e.jsx(D,{className:p.variantConfigurationCard,title:"Manage Variant",titleTransKey:"CardTitles.ManageVariant",showCloseButton:!0,isLoading:n,showNotificationCard:!0,notificationCardProps:{title:"Delete Variant",titleTransKey:"CardTitles.DeleteVariant",text:"This variant will be deleted, it will no longer be available for sale but you will still see it in the orders where it sold",textTransKey:"ConfirmationMessages.DeleteVariant",onClick:()=>l("deleteVariant",s)},onSecondaryButtonClick:()=>l("closeVariantConfigurationCard"),...P,children:e.jsxs("div",{className:p.variantConfigurationCardContent,children:[e.jsx("div",{className:p.variantConfigurationForm,children:e.jsxs(B,{form:g,onSubmit:$,children:[e.jsx(B.Field,{name:"variantName",children:e.jsx(I,{label:"Optional Variant Name",labelTransKey:"ProductForm.Labels.OptionalVariantName",fullWidth:!0,onDelay:H})}),e.jsxs("div",{className:p.variantCodeFormRow,children:[e.jsx(B.Field,{name:"variantCode",label:m("ProductForm.Labels.VariantCode"),children:e.jsx("div",{children:e.jsx(I,{value:s==null?void 0:s.variantCode,...F("variantCode",{}),onDelay:H})})}),e.jsx(f,{icon:Oe,type:"button",variant:"outline",onClick:Te})]}),e.jsxs("div",{className:p.priceFormRow,children:[e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(B.Field,{label:m("ProductForm.Labels.SalePriceNetto"),name:"salePrice.netto",children:e.jsx(I,{type:"number",step:"any",...F("salePrice.netto",{onChange:()=>{M.current="netto",H()}})})})}),e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(me,{control:g.control,name:"salePrice.taxTypeId",render:({field:r})=>e.jsxs(he,{children:[e.jsx(pe,{children:m("ProductForm.Labels.VAT")}),e.jsxs(Ce,{onValueChange:i=>{r.onChange(Number(i)),M.current="netto",H()},value:r.value?r.value.toString():"",children:[e.jsx(xe,{children:e.jsx(ge,{children:e.jsx(je,{placeholder:m("SelectOptions.SelectVAT")})})}),e.jsx(ke,{children:u==null?void 0:u.map(i=>e.jsx(Pe,{value:i.id.toString(),children:e.jsx("div",{children:i.name})},i.id))})]})]})})}),e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(B.Field,{label:m("ProductForm.Labels.SalePriceBrutto"),name:"salePrice.brutto",children:e.jsx(I,{type:"number",step:"any",...F("salePrice.brutto",{onChange:()=>{M.current="brutto",H()}})})})})]})]})}),e.jsx(K,{}),e.jsxs("div",{className:p.stockDetailsBlock,children:[e.jsxs("div",{className:p.buttonBlock,children:[e.jsx("span",{className:`${p.stockDetailsTitle} she-title`,children:m("SectionTitles.StockDetails")}),e.jsx(f,{value:"Add",valueTransKey:"CommonButtons.Add",icon:R,variant:"secondary",onClick:()=>l("openAddStockCard")}),e.jsx(f,{value:"Dispose",valueTransKey:"StockActions.Dispose",icon:Ue,variant:"secondary",maxWidth:"100px",minWidth:"100px",onClick:()=>l("openDisposeStockCard")}),e.jsx(f,{value:"History",valueTransKey:"CommonButtons.History",icon:We,variant:"secondary",maxWidth:"100px",minWidth:"100px",onClick:()=>l("openVariantHistoryCard",s.variantId)})]}),e.jsxs("div",{className:p.stockBlock,children:[e.jsxs("div",{className:p.stockBlockRow,children:[e.jsx("span",{className:"she-text",children:m("StockForm.Labels.CurrentlyInStock",{stockAmount:""})}),e.jsx("span",{className:p.stockBlockRowNumber,children:s==null?void 0:s.stockAmount})]}),e.jsxs("div",{className:p.stockBlockRow,children:[e.jsx("span",{className:"she-text",children:m("ProductForm.Labels.UnitsSold")}),e.jsx("span",{className:p.stockBlockRowNumber,children:s==null?void 0:s.soldUnits})]})]})]}),e.jsxs("div",{className:p.variantGridBlock,children:[e.jsxs("div",{className:p.variantGridBlockHeader,children:[e.jsx("span",{className:"she-title",children:m("ProductForm.Labels.VariantTraits")}),e.jsx(f,{value:"Manage",valueTransKey:"CommonButtons.Manage",icon:Ee,variant:"secondary",onClick:()=>l("openManageTraitsCard")})]}),e.jsx("div",{children:e.jsx(A,{isLoading:t,showHeader:!1,columns:h,data:G,gridRequestModel:c,enableExpansion:!0,renderExpandedContent:we})})]}),e.jsxs("div",{className:p.variantGridBlock,children:[e.jsxs("div",{className:p.variantGridBlockHeader,children:[e.jsx("span",{className:"she-title",children:m("ProductForm.Labels.VariantPhotos")}),e.jsx(f,{value:"Manage",valueTransKey:"CommonButtons.Manage",icon:qe,variant:"secondary",onClick:()=>l("openVariantPhotosCard",s.variantId)})]}),((te=s==null?void 0:s.photos)==null?void 0:te.length)>0&&e.jsx("div",{children:e.jsx(A,{isLoading:o,enableDnd:!0,showHeader:!1,columns:S,data:a,gridRequestModel:c,skeletonQuantity:k==null?void 0:k.gallery,onNewItemPosition:(r,i)=>l("dndVariantPhoto",{newIndex:r,activeItem:i})})})]})]})})}const Ss="_addStockCard_5bzk4_1",fs="_addStockCardContent_5bzk4_5",bs="_connectedPurchase_5bzk4_27",_s="_connectedPurchaseInfo_5bzk4_32",ys="_connectedPurchaseHeader_5bzk4_37",Ns="_connectedPurchaseHeaderTitle_5bzk4_43",Ts="_connectedPurchaseSupplier_5bzk4_48",Is="_supplierInfo_5bzk4_54",Fs="_supplierInfoDetails_5bzk4_78",ws="_supplierInfoDetailsName_5bzk4_82",vs="_connectedPurchaseProductsSummary_5bzk4_85",Bs="_connectedPurchaseProductsSummaryTitle_5bzk4_92",Rs="_connectedPurchaseProductsSummaryHeaders_5bzk4_96",Vs="_connectedPurchaseProductsSummaryInfo_5bzk4_101",Ds="_unitsColumn_5bzk4_106",Ms="_expenseColumn_5bzk4_110",Hs="_valueColumn_5bzk4_113",zs="_purchaseDetails_5bzk4_116",Ks="_purchaseDetailsButtonBlock_5bzk4_121",As="_cardButtonBlock_5bzk4_130",x={addStockCard:Ss,addStockCardContent:fs,connectedPurchase:bs,connectedPurchaseInfo:_s,connectedPurchaseHeader:ys,connectedPurchaseHeaderTitle:Ns,connectedPurchaseSupplier:Ts,supplierInfo:Is,supplierInfoDetails:Fs,supplierInfoDetailsName:ws,connectedPurchaseProductsSummary:vs,connectedPurchaseProductsSummaryTitle:Bs,connectedPurchaseProductsSummaryHeaders:Rs,connectedPurchaseProductsSummaryInfo:Vs,unitsColumn:Ds,expenseColumn:Ms,valueColumn:Hs,purchaseDetails:zs,purchaseDetailsButtonBlock:Ks,cardButtonBlock:As},Gs="_addStockForm_15e7x_1",$s="_addStockFormRow_15e7x_7",le={addStockForm:Gs,addStockFormRow:$s},Ls=q({unitAmount:v().min(0,"Min value length 0"),priceModel:q({price:v(),taxTypeId:v(),priceType:v().optional(),currencyId:v()})}),Os={unitAmount:void 0,priceModel:{price:void 0,taxTypeId:void 0,priceType:void 0,currencyId:void 0},purchaseId:void 0};function Us({taxTypes:n,currencyTypes:t,onChange:o}){const{form:s}=be({defaultValues:Os,scheme:Ls,mode:Se.CHANGE});function a(c,l){setTimeout(()=>{o==null||o({unitsAmount:c.unitAmount,nettoPrice:c.priceModel.price,taxTypeId:c.priceModel.taxTypeId,currencyId:c.priceModel.currencyId},l)})}return e.jsxs(_e,{form:s,className:le.addStockForm,hideFooter:!0,onChange:a,children:[e.jsxs("div",{className:le.addStockFormRow,children:[e.jsx(V,{name:"priceModel.price",render:({field:c})=>e.jsx(I,{value:c.value,label:"Purchase Price",labelTransKey:"PurchaseForm.Labels.PurchasePrice",placeholder:"enter price netto...",type:"number",minWidth:"150px"})}),e.jsx(V,{name:"priceModel.currencyId",render:({field:c})=>e.jsx(Q,{items:t,selected:c.value,label:"Currency",placeholder:" ",hideFirstOption:!0,minWidth:"140px"})}),e.jsx(V,{name:"priceModel.taxTypeId",render:({field:c})=>e.jsx(Q,{items:n,selected:c.value,label:"VAT",placeholder:" ",hideFirstOption:!0,minWidth:"40px"})})]}),e.jsx(V,{name:"unitAmount",render:({field:c})=>e.jsx(I,{value:c.value,label:"Units",type:"number",placeholder:"enter unit amount...",fullWidth:!0})})]})}function Tt({isLoading:n,variant:t,onAction:o,taxTypes:s,purchase:a,currencyTypes:c,...l}){var h,S,g,N;const[u,k]=_.useState(null),[C,P]=_.useState(void 0),{translate:j}=O();function d(F,U){var G;k((G=U.formState)==null?void 0:G.isValid),P(F)}function m(){const F={priceModel:{variantId:t.variantId,unitsAmount:C.unitsAmount,nettoPrice:C.nettoPrice,taxTypeId:C.taxTypeId,currencyId:C.currencyId},purchaseId:Number(a.purchaseId)};o("increaseStockAmount",F)}return e.jsx(D,{className:x.addStockCard,title:"Add product to stock",titleTransKey:"StockActions.AddProductToStock",description:`${j("SectionTitles.Product")}: "${t==null?void 0:t.variantName}"`,isLoading:n,showCloseButton:!0,showFooter:!1,onSecondaryButtonClick:()=>o("closeAddStockCard"),...l,children:e.jsxs("div",{className:x.addStockCardContent,children:[e.jsx(Us,{currencyTypes:re(c,{text:"name",value:"id"}),taxTypes:re(s,{text:"name",value:"id"}),onChange:d}),e.jsx(K,{}),a?e.jsxs("div",{className:x.connectedPurchase,children:[e.jsxs("div",{className:x.connectedPurchaseInfo,children:[e.jsxs("div",{className:x.connectedPurchaseHeader,children:[e.jsxs("div",{className:x.connectedPurchaseHeaderTitle,children:[e.jsx("span",{className:"she-title",children:"Connected Purchase"}),e.jsxs("span",{className:"she-subtext",children:["If this is not the right purchase :"," "]})]}),e.jsx(f,{icon:Qe,variant:"secondary",value:"Replace Purchase",onClick:()=>o("openSelectPurchaseCard")})]}),e.jsxs("div",{className:x.connectedPurchaseSupplier,children:[e.jsxs("div",{className:x.supplierInfo,children:[e.jsx("div",{style:{width:"100%",maxWidth:"40px"},children:(h=a.supplier)!=null&&h.thumbnailUrl?e.jsx("img",{src:(S=a.supplier)==null?void 0:S.thumbnailUrl,alt:((g=a.supplier)==null?void 0:g.supplierName)||"Supplier"}):e.jsx(Y,{icon:fe})}),e.jsxs("div",{className:x.supplierInfoDetails,children:[e.jsx("span",{className:x.supplierInfoDetailsName,children:(N=a.supplier)==null?void 0:N.supplierName}),e.jsx("span",{className:"she-text",children:de(a.date,"date")})]})]}),e.jsx(f,{icon:Ye,variant:"ghost",value:"Purchase Details",txtColor:"#007AFF"})]})]}),e.jsxs("div",{className:x.connectedPurchaseProductsSummary,children:[e.jsx("span",{className:x.connectedPurchaseProductsSummaryTitle,children:"Products in purchase summary"}),e.jsx(K,{}),e.jsxs("div",{className:x.connectedPurchaseProductsSummaryHeaders,children:[e.jsx("span",{children:"Units"}),e.jsx("span",{children:"Expense"}),e.jsx("span",{children:"Projected value"})]}),e.jsx(K,{}),e.jsxs("div",{className:x.connectedPurchaseProductsSummaryInfo,children:[e.jsx("div",{className:x.unitsColumn,children:e.jsx("span",{children:a.unitsAmount})}),e.jsx("div",{className:x.expenseColumn,children:e.jsx("span",{children:`${a.expense} ${a.currencyBrief}`})}),e.jsx("div",{className:x.valueColumn,children:e.jsx("span",{children:`${a.orderValueAmount} ${a.currencyBrief}`})})]})]})]}):e.jsxs("div",{className:x.purchaseDetails,children:[e.jsx("span",{className:"she-title",children:"Purchase Details"}),e.jsx("span",{className:"she-text",children:"If you want to be able to track this stock change in the purchase section, please select the purchase this change is connected to."}),e.jsxs("div",{className:x.purchaseDetailsButtonBlock,children:[e.jsx(f,{icon:R,variant:"secondary",value:"Select Purchase",onClick:()=>o("openSelectPurchaseCard")}),e.jsx("span",{className:"she-text",children:"or"}),e.jsx(f,{icon:R,variant:"secondary",value:"Report Purchase",onClick:()=>o("openSupplierCard")})]})]}),e.jsx(K,{}),e.jsxs("div",{className:x.cardButtonBlock,children:[e.jsx(f,{icon:R,variant:"secondary",value:"Cancel",onClick:()=>o("closeAddStockCard")}),e.jsx(f,{icon:R,variant:"info",value:"Add to Stock",disabled:!a||!u,onClick:m})]})]})})}const Ws="_selectPurchaseCardContent_32tmq_1",Es={selectPurchaseCardContent:Ws},qs="_iconCheck_1wa1s_1",Qs={iconCheck:qs};function Ys({onAction:n}){return[{id:"select",header:"Select",minSize:58,maxSize:58,cell:({row:t,table:o})=>{const s=o.options.meta;return e.jsx("div",{onClick:a=>a.stopPropagation(),children:e.jsx(f,{className:t.original.isSelected===!0?Qs.iconCheck:"",icon:t.original.isSelected===!0?Me:He,variant:"ghost",onClick:()=>n("selectPurchase",t.original),disabled:s==null?void 0:s.isRowLoading(t.id)})})}},{id:"Purchase",header:"Purchase",minSize:200,cell:({row:t})=>{var l,u,k;const o=(l=t.original.supplier)==null?void 0:l.thumbnailUrl,s=(u=t.original.supplier)==null?void 0:u.supplierName,a=(k=t.original.location)==null?void 0:k.address,c=t.original.date;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",width:"100%"},children:[e.jsx("div",{style:{width:"100%",maxWidth:"40px"},children:o?e.jsx("img",{src:o,alt:s||"Supplier",className:"object-cover rounded-md w-full h-full",style:{width:"100%"}}):e.jsx(Y,{icon:fe})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsx(ne,{delayDuration:200,text:s,className:"max-w-[calc(240px)] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-text",children:s})}),a&&e.jsx(ne,{delayDuration:200,text:a,className:"max-w-[calc(240px)] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-subtext",children:a})}),c&&e.jsx("span",{className:"she-text",children:de(c,"date")})]})]})}}]}function It({isLoading:n,isGridLoading:t,purchases:o,onAction:s}){return e.jsx(D,{title:"Select Purchase",showCloseButton:!0,isLoading:n,onSecondaryButtonClick:()=>s("closeSelectPurchaseCard"),children:e.jsxs("div",{className:Es.selectPurchaseCardContent,children:[e.jsx(I,{isSearch:!0,fullWidth:!0,showClearBtn:!0,placeholder:"Search supplier...",onDelay:a=>s("searchSupplier",a),onClear:()=>s("searchSupplier",null)}),e.jsx(Je,{mode:Xe.RANGE,icon:Ze,fullWidth:!0,showClearBtn:!0,placeholder:"Pick purchase date range",onSelectDate:a=>{s("filterSuppliersByDate",a?{dateFrom:a.from,dateTo:a.to}:{})},onClear:()=>{s("filterSuppliersByDate",null)}}),e.jsx(A,{isLoading:t,showHeader:!1,columns:Ys({onAction:s}),data:o,skeletonQuantity:10})]})})}const Js={},ie="field is required",Xs=q({unitAmount:v({required_error:ie}).min(0,"min value length 0"),reason:v({required_error:ie})}),E=[{value:1,text:"Damaged",textTransKey:"StockForm.Labels.Damaged"},{value:2,text:"Lost",textTransKey:"StockForm.Labels.Lost"},{value:3,text:"Broken",textTransKey:"StockForm.Labels.Broken"}];function Ft({isLoading:n,variant:t,onAction:o,onSecondaryButtonClick:s,...a}){const{translate:c}=O(),l={reason:E[0].value,unitAmount:0},{form:u}=be({defaultValues:l,scheme:Xs,mode:Se.CHANGE}),k=Ge({control:u.control,name:"unitAmount"});function C(P){const j={...P,unitAmount:Number(P.unitAmount)};o==null||o("disposeFromStock",{variant:t,formattedData:j})}return e.jsx(D,{className:Js.disposeStockCard,title:`${c("StockActions.Dispose")} ${t==null?void 0:t.variantName} ${c("SectionTitles.Product")}`,isLoading:n,showCloseButton:!0,showFooter:!0,primaryButtonTitle:"Dispose",primaryButtonTitleTransKey:"StockActions.Dispose",primaryButtonDisabled:!u.formState.isValid||ze.isEqual(l,u.getValues())||Number(k)>Number(t==null?void 0:t.stockAmount),onPrimaryButtonClick:u.handleSubmit(C),onSecondaryButtonClick:s,...a,children:e.jsxs(_e,{form:u,text:c("StockForm.Labels.CurrentlyInStock",{stockAmount:(t==null?void 0:t.stockAmount)||0},"Currently in stock"),headerPosition:Ke.LEFT,hideFooter:!0,children:[e.jsx(V,{name:"unitAmount",render:({field:P})=>e.jsx(I,{value:P.value,label:"Units",labelTransKey:"PurchaseForm.Labels.Units",placeholder:"enter amount of units...",placeholderTransKey:"PurchaseForm.Placeholders.Units",min:0,errorMessage:k>(t==null?void 0:t.stockAmount)&&"You try to dispose more units the you have in stock",type:"number",fullWidth:!0})}),e.jsx(V,{name:"reason",render:({field:P})=>e.jsx(Q,{items:E,selected:P.value||E[0].value,label:"Reason",labelTransKey:"StockForm.Labels.Reason",fullWidth:!0,hideFirstOption:!0})})]})})}const Zs="_manageTraitsCard_1tjgt_1",et="_manageTraitsCardContent_1tjgt_1",st="_manageTraitsCardForm_1tjgt_1",L={manageTraitsCard:Zs,manageTraitsCardContent:et,manageTraitsCardForm:st};function wt({isLoading:n,traits:t,variant:o,onAction:s,onSecondaryButtonClick:a,...c}){const{t:l}=es(),u=(o==null?void 0:o.traitOptions)||[],k=t.reduce((d,m)=>{var S;const h=u.find(g=>g.traitName===m.traitName&&g.optionId!==null);return{...d,[m.traitId]:((S=h==null?void 0:h.optionId)==null?void 0:S.toString())||""}},{}),C=ue({defaultValues:k}),P=Object.values(C.watch()).some(d=>!d);_.useEffect(()=>{if(o!=null&&o.traitOptions){const d=t.reduce((m,h)=>{var g;const S=u.find(N=>N.traitName===h.traitName&&N.optionId!==null);return{...m,[h.traitId]:((g=S==null?void 0:S.optionId)==null?void 0:g.toString())||""}},{});Object.entries(d).forEach(([m,h])=>{C.setValue(m,h)})}},[o,t,u]);function j(d){const h={options:Object.values(d).filter(S=>S!=="").map(S=>Number(S))};s("updateVariantTraitOptions",{variant:o,submissionData:h})}return e.jsx(D,{className:L.manageTraitsCard,title:"Manage Traits",titleTransKey:"CardTitles.ManageTraits",showCloseButton:!0,isLoading:n,showFooter:!0,primaryButtonProps:{value:"Save Changes",valueTransKey:"CommonButtons.SaveChanges",variant:"info",icon:Ae,disabled:P},secondaryButtonTitle:"Cancel",secondaryButtonTitleTransKey:"CommonButtons.Cancel",onPrimaryButtonClick:C.handleSubmit(j),onSecondaryButtonClick:a,...c,children:e.jsxs("div",{className:L.manageTraitsCardContent,children:[e.jsx("div",{className:L.manageTraitsCardTextBlock,children:e.jsx("span",{className:"she-text",children:l("ProductForm.Labels.SelectTraitOptionsForVariant")})}),e.jsx("div",{children:e.jsx(B,{form:C,onSubmit:j,children:e.jsx("div",{className:L.manageTraitsCardForm,children:t.map(d=>e.jsx(me,{control:C.control,name:d.traitId.toString(),render:({field:m})=>e.jsxs(he,{children:[e.jsx(pe,{children:d.traitName}),e.jsxs(Ce,{onValueChange:m.onChange,value:m.value||"",children:[e.jsx(xe,{children:e.jsx(ge,{children:e.jsx(je,{placeholder:l("ProductForm.Placeholders.SelectTraitType",{traitType:d.traitTypeName.toLowerCase()})})})}),e.jsx(ke,{children:d.traitOptions.map(h=>e.jsx(Pe,{value:h.optionId.toString(),children:d.traitTypeId===2?e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{style:{width:"20px",height:"20px",background:(h==null?void 0:h.optionColor)||"#ccc",marginRight:"8px",borderRadius:"2px"}}),h.optionName]}):h.optionName},h.optionId))})]})]})},d.traitId))})})})]})})}const tt="_variantPhotosCard_35wfr_1",at="_variantPhotosCardContent_35wfr_1",ot="_managePhotos_35wfr_9",nt="_managePhotosTitle_35wfr_14",rt="_managePhotosGrid_35wfr_17",T={variantPhotosCard:tt,variantPhotosCardContent:at,managePhotos:ot,managePhotosTitle:nt,managePhotosGrid:rt},ct=n=>[{accessorKey:"thumbnailUrl",header:"Preview",minSize:80,maxSize:80,cell:({row:t,table:o})=>{const s=t.getValue("thumbnailUrl"),a=o.options.meta;return e.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>n("image",t.id,a==null?void 0:a.setLoadingRow),children:e.jsx("img",{src:s,alt:"photo",className:"object-cover rounded-md w-full h-full",onError:c=>{c.currentTarget.src=ye}})})}},{accessorKey:"format",header:"Format",minSize:235,cell:({row:t})=>e.jsx("span",{className:"she-subtext",children:`${t.original.height}px x ${t.original.width}px`})},{id:"rowActions",header:"",minSize:55,maxSize:55,cell:({row:t})=>e.jsx(f,{icon:R,variant:"secondary",onClick:()=>n("addToVariant",t.id,void 0,t)})}];function vt({isLoading:n,isVariantPhotoGridLoading:t,isProductPhotoGridLoading:o,variantPhotos:s,productPhotos:a,contextId:c,onAction:l,...u}){const{translate:k}=O();function C(j,d){switch(j){case"image":l("image",d);break;case"upload":l("uploadPhotoToVariant",d);break;case"delete":l("delete",d);break;case"detachFromVariant":l("detachPhotoFromVariant",d);break;case"addToVariant":l("addPhotoToVariant",d);break;case"dnd":const{newIndex:m,activeItem:h}=d;l("dndVariantPhoto",{newIndex:m,activeItem:h});break}}function P(j,d,m,h){switch(j){case"detachFromVariant":C("detachFromVariant",h.original);break;case"addToVariant":C("addToVariant",h.original);break}}return e.jsx(D,{className:T.variantPhotosCard,title:"Manage Photos",titleTransKey:"CardTitles.ManagePhotos",isLoading:n,showCloseButton:!0,showFooter:!1,onSecondaryButtonClick:()=>l("closeVariantPhotosCard"),...u,children:e.jsxs("div",{className:T.variantPhotosCardContent,children:[e.jsx(ss,{contextName:"variant",contextId:c,onUpload:j=>C("upload",j)}),e.jsxs("div",{className:T.managePhotos,children:[e.jsx("div",{className:`${T.managePhotosTitle} she-title`,children:e.jsx("span",{className:"she-title",children:k("ProductForm.Labels.VariantPhotos")})}),e.jsx("div",{className:T.managePhotosGrid,children:e.jsx(A,{isLoading:t,enableDnd:!0,showHeader:!1,columns:Ne(P),data:s,gridRequestModel:s,customMessage:"VARIANT HAS NO PHOTO",customMessageTransKey:"ProductMessages.NoVariantPhotos",onNewItemPosition:(j,d)=>C("dnd",{newIndex:j,activeItem:d})})})]}),e.jsxs("div",{className:T.managePhotos,children:[e.jsx("div",{className:`${T.managePhotosTitle} she-title`,children:e.jsx("span",{className:"she-title",children:k("ProductForm.Labels.OtherProductPhotos")})}),e.jsx("div",{className:T.managePhotosGrid,children:e.jsx(A,{isLoading:o,enableDnd:!1,showHeader:!1,showColumnsHeader:!1,columns:ct(P),data:a,customMessage:!s&&!a?"PRODUCT HAS NO PHOTO":"All product photos are already attached to the variant.",customMessageTransKey:!s&&!a?"ProductMessages.NoPhotos":"ProductMessages.AllPhotosAttachedToVariant",gridRequestModel:a})})]})]})})}export{Tt as A,Ft as D,wt as M,It as S,Nt as V,vt as a};
