import{j as n,s as J,f as P,e as k,x as Gt,w as Z,o as Ht,t as ee,h as Mt,n as F,S as L,z as bt,y as te,B as Ft,E as h,U as V,k as Nt,a3 as jt,H as b,a4 as r,a5 as _t,l as Dt,a6 as qt,N as K,q as re,X as Tt,r as Rt}from"./index-BgOJB3Ra.js";import{S as se}from"./SheCard-CCn2EH8C.js";import{S as R}from"./SheGrid-hOUOr1Dk.js";import{I as z,u as ae}from"./useAppTranslation-CT98VBjh.js";import{c as T}from"./ProductsInOrderGridColumns.module-DQJajK5A.js";import{P as Pt}from"./plus-CyuclygH.js";import{T as E,U as zt,G as Et,C as Bt,S as wt}from"./SheContextSidebar-DxIT1Qz7.js";import{c as Ut,a as W,C as Qt}from"./CustomerAddressCard-DVb_hlTK.js";import{u as $t}from"./useToast-Ci-3VyVD.js";import{u as Vt}from"./useOrdersPageService-CP7VX0yM.js";import{c as X,C as Kt}from"./CustomerCard-KDRwwK8b.js";import{S as Wt,a as Xt,b as Yt,c as Jt,d as Zt}from"./SelectOrderForShipmentCard-lQ3Vqixr.js";import{u as er}from"./useCardActions-BNVTR06e.js";import{S as tr}from"./SelectEntityCard-DhQNVQz6.js";import{C as rr}from"./CustomersListGridColumns-DgiW0dRj.js";import{G as sr,a as ar}from"./GridSortingEnum-Qa64oiYF.js";import{S as Y}from"./SheSelect-Cn4D1Pp5.js";import{S as nr,C as ir}from"./SheDatePicker-Cnw2Ng_w.js";import{G as dr}from"./GridDateRangeFilter-Dcq5qTGh.js";import"./SheCardNotification-DSQmZ-ff.js";import"./ComponentViewEnum-Ba6F4129.js";import"./SheInput-D1_7mt6S.js";import"./settings-2-Do0HRWMK.js";import"./chevron-up-uQrm97uW.js";import"./folder-up-tYay7GWq.js";import"./trash-C8ichjcO.js";import"./AddressForm-DpxRT1Wh.js";import"./types-mU7vaT1q.js";import"./form-GLT8k_Jx.js";import"./she-select-convertors-CdG-Ygpu.js";import"./select-COj3wnSU.js";const or={},cr="_shipmentDetailsCard_1yzra_1",lr="_shipmentDetailsCardContent_1yzra_5",mr="_shipmentAllocationBlock_1yzra_10",ur="_shipmentAllocationButtonBlock_1yzra_15",D={shipmentDetailsCard:cr,shipmentDetailsCardContent:lr,shipmentAllocationBlock:mr,shipmentAllocationButtonBlock:ur},hr="_shipmentStatus_1bezr_1",pr="_shipmentStatusAvailable_1bezr_11",Sr="_shipmentStatusNotAvailable_1bezr_17",q={shipmentStatus:hr,shipmentStatusAvailable:pr,shipmentStatusNotAvailable:Sr};function Cr(l){const e=i=>i==="New"||i==="Pending"?q.shipmentStatusAvailable:i==="Not Available"?q.shipmentStatusNotAvailable:"";return[{accessorKey:"queueDate",header:"Action Date",minSize:90,cell:({row:i})=>n.jsx("span",{children:J(i.getValue("queueDate"),"date")})},{id:"shipmentStatus",header:"Status",minSize:100,cell:({row:i})=>{const u=i.original.shipmentStatus;return n.jsx("div",{className:`${q.shipmentStatus} ${e(u)}`,children:n.jsx("span",{children:u})})}},{accessorKey:"service",header:"Service",minSize:100,cell:({row:i})=>{const u=i.original.service;return n.jsx("div",{children:u&&n.jsx("div",{children:u?n.jsx("img",{src:u,alt:i.original.variantName||"Variant",className:"object-cover rounded-md w-12 h-12"}):n.jsx(P,{icon:z,maxWidth:"30px"})})})}},{accessorKey:"trackingNumber",header:"Tracking Number",minSize:120,maxSize:120,cell:({row:i})=>n.jsx("span",{children:i.getValue("trackingNumber")})},{accessorKey:"quantityPacked",header:"Items",minSize:60,maxSize:60,cell:({row:i})=>n.jsx("span",{children:i.original.quantityPacked})},{id:"manage",header:"",minSize:120,maxSize:120,cell:({row:i,table:u})=>{const t=u.options.meta;return n.jsx("div",{onClick:d=>d.stopPropagation(),children:n.jsx(k,{icon:Gt,value:"Manage",variant:"secondary",onClick:()=>l("manageShipment",i.original,i.id,t==null?void 0:t.setLoadingRow),disabled:t==null?void 0:t.isRowLoading(i.id)})})}}]}const fr=[{id:"variantName",accessorFn:l=>l.variantName,header:"Product",minSize:100,cell:({row:l})=>{var i;const e=(i=l.original.photo)==null?void 0:i.thumbnailUrl;return n.jsxs("div",{className:T.productNameWrapper,children:[n.jsx("div",{className:T.productNameImageBlock,children:e?n.jsx("img",{src:e,alt:l.original.variantName||"Variant",className:T.productNameImage}):n.jsx(P,{icon:z,maxWidth:"30px"})}),n.jsx("div",{children:n.jsx(Z,{delayDuration:200,text:l.getValue("variantName"),className:"max-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap",children:n.jsx("span",{children:l.getValue("variantName")})})})]})}},{accessorKey:"traitOptions",header:"Traits",minSize:100,maxSize:100,cell:({row:l})=>{const e=l.original.traitOptions||[],i=e.filter(t=>t.traitTypeId===2&&t.optionColor),u=e.filter(t=>t.traitTypeId===1&&t.optionName);return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[i.map((t,d)=>n.jsx("div",{style:{background:t.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${d}`)),u.map((t,d)=>n.jsx("span",{style:{fontSize:"0.875rem"},children:t.optionName},`size-${d}`))]})}},{id:"qtyOrdered",header:"Qty ordered",minSize:100,maxSize:100,cell:({row:l})=>n.jsx("span",{children:l.original.qtyOrdered})},{id:"qtyToShip",header:"Qty to ship",minSize:100,maxSize:100,cell:({row:l})=>n.jsx("span",{children:l.original.qtyToShip})},{id:"qtyShipped",header:"Qty shipped",minSize:100,maxSize:100,cell:({row:l})=>n.jsx("span",{children:l.original.qtyShipped})}];function gr({isLoading:l,isProductsGridLoading:e,isShipmentsGridLoading:i,products:u,shipments:t,onAction:d}){const{translate:f}=ae();return n.jsx(se,{className:D.shipmentDetailsCard,title:"Shipment details",titleTransKey:"CardTitles.ShipmentDetails",isLoading:l,children:n.jsxs("div",{className:D.shipmentDetailsCardContent,children:[n.jsx(R,{isLoading:e,showHeader:!1,columns:fr,skeletonQuantity:5,data:u,customMessage:"No items in order",customMessageTransKey:"ShipmentMessages.NoItemsInShipment"}),n.jsx(Ht,{}),n.jsxs("div",{className:D.shipmentAllocationBlock,children:[n.jsx("span",{className:"she-title",children:f("ShipmentForm.Labels.ShipmentAllocation")}),n.jsxs("div",{className:D.shipmentAllocationButtonBlock,children:[n.jsx(k,{value:"Create Shipment",valueTransKey:"OrderActions.CreateShipment",icon:Pt,variant:"info",onClick:()=>d("createShipment")}),n.jsx("span",{children:f("SpecialText.Or")}),n.jsx(k,{value:"Select Shipment",valueTransKey:"OrderActions.SelectShipment",icon:E,variant:"default",onClick:()=>d("selectShipment")})]})]}),n.jsx(R,{isLoading:i,showHeader:!1,columns:Cr(d),skeletonQuantity:5,data:t,customMessage:"No item is scheduled for delivery",customMessageTransKey:"ShipmentMessages.NoItemsScheduledForDelivery"})]})})}function Ir(l){const e=ee(),{addToast:i}=$t(),u=Mt(),t=F(L.ORDER_SHIPMENT),d=bt(),{orderId:f}=te(),c=Vt(),S=F(L.ORDERS),x=F(L.APP),{openConfirmationDialog:O}=Ft(),[C]=h.useLazyGetOrderDetailsQuery(),[N]=h.useCreateShipmentMutation(),[j]=h.useUpdateShipmentDatesMutation(),[G]=h.useUpdateShipmentCustomerMutation(),[_]=h.useUpdateShipmentAddressMutation(),[H]=h.useGetShipmentsListForForGridMutation(),[p]=h.useLazyGetShipmentsListForOrderQuery(),[B]=h.useGetListOfCustomersForGridMutation(),[ne]=h.useConnectShipmentToOrderMutation(),[ie]=h.useLazyGetShipmentDetailsQuery(),[de]=V.useUpdateUserPreferencesMutation(),[oe]=V.useResetUserPreferencesMutation(),[ce]=h.useDisconnectOrderFromShipmentMutation(),[Er]=h.useAddVariantsToShipmentMutation(),[le]=h.useRemoveVariantFromShipmentMutation(),[me]=h.useCreateShipmentForOrderMutation(),[Br]=h.useUpdateStockActionForShipmentMutation(),[ue]=h.useConfirmPackedProductsMutation(),[w]=h.useGetCustomerAddressesForGridMutation(),[he]=h.useLazyGetCustomerDetailsQuery(),[pe]=h.useCreateCustomerMutation(),[Se]=h.useUpdateCustomerMutation(),[Ce]=Nt.useLazyGetCountryCodeQuery(),[fe]=h.useUpdateCustomerAddressMutation(),[ge]=h.useCreateCustomerAddressMutation(),[U]=h.useGetListOfOrdersForGridMutation(),[Ie]=h.useAddOrderToShipmentMutation(),[ve]=h.useLazyGetShipmentStatusForOrderQuery(),[ye]=h.useAddShipmentStockActionWithQuantityMutation(),[Ae]=h.useIncreaseShipmentStockActionMutation(),[xe]=h.useDecreaseShipmentStockActionMutation(),[Oe]=h.useAddAllStockActionsToPackageMutation(),[Le]=h.useAddVariantToShipmentMutation(),[ke]=h.useCancelShipmentMutation(),[Ge]=h.useReturnShipmentStatusToPreviousMutation(),[He]=jt.useLazyGetDeliveryServicesListQuery(),[Me]=h.useConfirmDeliveryDataMutation();function be(s){return C(s).then(a=>(e(b.refreshSelectedOrder(a.data)),e(r.refreshSelectedCustomer({...a.data.customer,customerId:a.data.customerId})),a))}function Fe(s){e(r.setIsProductsGridLoading(!0)),c.getListOfStockActionsForGridHandler(s,S.stockActionsGridRequestModel).then(()=>{e(r.setIsProductsGridLoading(!1))})}function M(s){return e(r.setIsSelectShipmentForOrderGridLoading(!0)),H(s).then(a=>(e(r.setIsSelectShipmentForOrderGridLoading(!1)),e(r.refreshShipmentsGridRequestModel(a.data)),a))}function Ne(s){return e(r.setIsOrderShipmentsGridLoading(!0)),p(s).then(a=>(e(r.setIsOrderShipmentsGridLoading(!1)),e(r.refreshOrderShipments(a.data)),a))}function je(s){return l("selectEntityCard",!0),B(s).then(a=>{const o=a.data.items.map(m=>{var g,v;const I=t.activeCardForCustomers==="shipmentConfigurationCard"?(g=t.selectedShipment)==null?void 0:g.customerId:(v=t.selectedCustomer)==null?void 0:v.customerId;return{...m,isSelected:m.customerId===I}});return e(b.refreshCustomersGridRequestModel({...a.data,items:o})),a.data})}function _e(){return l("shipmentConfigurationCard",!0),e(r.setIsShipmentConfigurationCardLoading(!0)),e(r.resetSelectedCustomer()),N().then(s=>(e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(s.data)),s))}function De(s,a){return j({shipmentId:s,model:a}).then(o=>{var m;return o.error?i({text:(m=o==null?void 0:o.error)==null?void 0:m.message,type:"error"}):i({text:"Shipment successfully updated",type:"success"}),o})}function qe(s,a){return G({shipmentId:s,model:a}).then(o=>{var m;o.error?i({text:(m=o==null?void 0:o.error)==null?void 0:m.message,type:"error"}):Q(t.selectedShipment.shipmentId).then(I=>{I.error||i({text:"Shipment successfully updated",type:"success"})})})}function Te(s){return _({shipmentId:t.selectedShipment.shipmentId,model:{addressId:s}}).then(a=>{var o;if(a.error)i({text:(o=a==null?void 0:a.error)==null?void 0:o.message,type:"error"});else{l("selectCustomerAddressCard"),e(r.refreshSelectedShipment({...t.selectedShipment,deliveryAddress:a.data,deliveryAddressId:a.data.addressId}));const m=t.addressesGridRequestModel.items.map(I=>({...I,isSelected:I.addressId===a.data.addressId}));e(r.refreshAddressesGridRequestModel({...t.addressesGridRequestModel,items:m})),i({text:"Shipment successfully updated",type:"success"})}return a})}function Re(s,a){return ne({shipmentId:s,orderId:a}).then(o=>{var m;return o.error?i({text:(m=o==null?void 0:o.error)==null?void 0:m.message,type:"error"}):(e(r.refreshOrderShipments([...t.orderShipments,o.data])),i({text:"Shipment successfully added to order",type:"success"})),o})}function Q(s){return t.activeCards.includes("shipmentConfigurationCard")||l("shipmentConfigurationCard",!0),e(r.refreshActiveCardForCustomers("shipmentConfigurationCard")),e(r.setIsShipmentConfigurationCardLoading(!0)),ie(s).then(a=>{var o;if(e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshOrderShipments(_t(s,t.orderShipments,"shipmentId"))),a!=null&&a.data){const m={...a.data,orderItems:((o=a.data.orderItems)==null?void 0:o.filter(I=>I.orderedAmount!==0))||[]};return e(r.refreshSelectedShipment(m)),m}return a})}function Pe(s){if(l("selectEntityCard"),t.activeCardForCustomers==="selectShipmentForOrderCard"){e(r.refreshSelectedCustomer(s));const a={...t.shipmentsGridRequestModel,filter:{...t.shipmentsGridRequestModel.filter,customers:[s.customerId]}};e(r.refreshShipmentsGridRequestModel(a)),M(a)}else if(t.activeCardForCustomers==="selectOrderForShipmentCard"){e(r.refreshSelectedCustomer(s));const a={...t.ordersGridRequestModel,filter:{...t.ordersGridRequestModel.filter,customerId:s.customerId}};e(r.refreshOrdersGridRequestModel(a)),e(r.setIsOrdersGridLoading(!0)),U(a).then(o=>{e(r.setIsOrdersGridLoading(!1)),e(r.refreshOrdersGridRequestModel(o.data))})}else G({shipmentId:t.selectedShipment.shipmentId,model:s}).then(a=>{var o;a.error?i({text:(o=a==null?void 0:a.error)==null?void 0:o.message,type:"error"}):(e(r.refreshSelectedShipment({...t.selectedShipment,customer:s,customerId:s.customerId})),i({text:"Shipment successfully updated",type:"success"}))})}function ze(){const s={...t.shipmentsGridRequestModel,filter:{customers:[t.selectedCustomer.customerId]}};e(r.refreshShipmentsGridRequestModel(s)),M(s),e(r.refreshActiveCardForCustomers("selectShipmentForOrderCard"))}function Ee(){e(r.resetSelectedCustomer());const s={...t.shipmentsGridRequestModel,filter:{...t.shipmentsGridRequestModel.filter,customers:[]}};e(r.refreshShipmentsGridRequestModel(s)),M(s)}function $(s){return de(s).then(()=>{u.getUserPreferencesHandler()})}function Be(s){return oe(s).then(()=>{u.getUserPreferencesHandler()})}function we(s){M(s)}function Ue(s){const a=Dt.merge({},x.preferences,s);e(qt.refreshPreferences(a)),$(a)}function Qe(s,a){return e(r.setIsShipmentConfigurationCardLoading(!0)),ce({shipmentId:s,orderId:a}).then(o=>{var m;return e(r.setIsShipmentConfigurationCardLoading(!1)),o.error?i({text:(m=o==null?void 0:o.error)==null?void 0:m.message,type:"error"}):(e(r.refreshSelectedShipment(o.data)),i({text:"Order successfully deleted from shipment",type:"success"})),o.data})}function $e(s){return le(s).then(a=>{e(r.refreshSelectedShipment(a.data))})}function Ve(){l("shipmentConfigurationCard"),e(r.resetActiveCardForCustomers())}function Ke(){l("customerCard",!0)}function We(s){return e(r.setIsSelectEntityGridLoading(!0)),B({...S.CustomersGridRequestModel,searchQuery:s}).then(a=>{e(r.setIsSelectEntityGridLoading(!1));const o=a.data.items.map(m=>{var g,v;const I=t.activeCards.includes("shipmentConfigurationCard")?(g=t.selectedShipment)==null?void 0:g.customerId:(v=t.selectedCustomer)==null?void 0:v.customerId;return{...m,isSelected:m.customerId===I}});e(b.refreshCustomersGridRequestModel({...a.data,items:o}))})}function Xe(){l("selectEntityCard")}function Ye(){l("selectShipmentForOrderCard"),e(r.resetActiveCardForCustomers())}function Je(s){return l("shipmentConfigurationCard",!0),e(r.setIsShipmentConfigurationCardLoading(!0)),e(r.resetSelectedCustomer()),me(s).then(a=>(e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(a.data)),e(r.refreshOrderShipments([{...a.data,queueDate:a.data.queuePacking,quantityPacked:0},...t.orderShipments])),a))}function Ze(){e(r.setIsShipmentConfigurationCardLoading(!0)),ue(t.selectedShipment.shipmentId).then(s=>{e(r.setIsShipmentConfigurationCardLoading(!1)),s.error||e(r.refreshSelectedShipment(s.data))})}function et(s){return e(r.setIsCustomerAddressesGridLoading(!0)),w({model:t.addressesGridRequestModel,id:s}).then(a=>{if(e(r.setIsCustomerAddressesGridLoading(!1)),!a.error)return e(r.refreshAddressesGridRequestModel(a.data)),a})}function tt(s){l("selectCustomerAddressCard",!0),e(r.setIsCustomerAddressesGridLoading(!0)),et(s).then(a=>{if(e(r.setIsCustomerAddressesGridLoading(!1)),a.data){const o=a.data.items.map(m=>({...m,isSelected:m.addressId===t.selectedShipment.deliveryAddressId}));e(r.refreshAddressesGridRequestModel({...t.addressesGridRequestModel,items:o}))}})}function rt(s){e(r.setIsCustomerAddressesGridLoading(!0)),w({model:{searchQuery:s},id:t.selectedShipment.customerId}).then(a=>{if(e(r.setIsCustomerAddressesGridLoading(!1)),a.data){const o=a.data.items.map(m=>({...m,isSelected:m.addressId===t.selectedShipment.deliveryAddressId}));e(r.refreshAddressesGridRequestModel({...t.addressesGridRequestModel,items:o}))}})}function st(){l("selectCustomerAddressCard")}function at(s){l("customerCard",!0),he(t.activeCards.includes("ShipmentConfigurationCard")?t.selectedShipment.customerId:s.customerId).then(a=>{e(r.refreshManagedCustomer(a.data))})}function nt(s){const a=X(s);return e(r.setIsCustomerCardLoading(!0)),pe(a).then(o=>{if(e(r.setIsCustomerCardLoading(!1)),!o.error)return i({text:"New customer created successfully",type:"info"}),l("customerCard"),e(b.refreshCustomersGridRequestModel({...S.customersGridRequestModel,items:[o.data,...S.customersGridRequestModel.items]})),o.data})}function it(s){var o;const a=X(s);return e(r.setIsCustomerCardLoading(!0)),Se({id:(o=t.managedCustomer)==null?void 0:o.customerId,model:a}).then(m=>{if(e(r.setIsCustomerCardLoading(!1)),!m.error){l("customerCard"),e(r.resetManagedCustomer());const g=S.customersGridRequestModel.items.map(v=>v.customerId===m.data.customerId?m.data:v).map(v=>({...v,isSelected:v.customerId===t.activeCards.includes("shipmentConfigurationCard")||t.activeCards.includes("selectOrderForShipmentCard")?t.selectedShipment.customerId:v.customerId===t.selectedCustomer.customerId}));return e(b.refreshCustomersGridRequestModel({...S.customersGridRequestModel,items:g})),t.activeCards.includes("shipmentConfigurationCard")&&t.selectedShipment.customerId===m.data.customerId?e(r.refreshSelectedShipment({...t.selectedShipment,customer:m.data,customerId:m.data.customerId})):t.selectedCustomer.customerId===m.data.customerId&&e(r.refreshSelectedCustomer(m.data)),i({text:"Customer updated successfully",type:"info"}),m.data}})}function dt(){l("customerCard"),e(r.resetManagedCustomer())}function ot(s){l("customerAddressCard",!0),Ce(null).then(a=>{a.data&&e(r.refreshCountryCodesList(a.data))}),s&&e(r.refreshManagedAddress(s))}function ct(s){const a=Ut(s.alias,s.addressLine1,s.addressLine2,s.city,s.state,s.postalCode,s.countryId);return s.addressId?lt(a):mt(a)}function lt(s){const a=W(s);return e(r.setIsCustomerAddressCardLoading(!0)),fe({id:t.managedAddress.addressId,model:a}).then(o=>{if(e(r.setIsCustomerAddressCardLoading(!1)),o.error)return;const I=t.addressesGridRequestModel.items.map(g=>g.addressId===o.data.addressId?o.data:g).map(g=>({...g,isSelected:g.addressId===t.selectedShipment.deliveryAddressId}));e(r.refreshAddressesGridRequestModel({...t.addressesGridRequestModel,items:I})),t.selectedShipment.deliveryAddressId===o.data.addressId&&e(r.refreshSelectedShipment({...t.selectedShipment,deliveryAddress:o.data,deliveryAddressId:o.data.addressId})),e(r.resetManagedAddress()),l("customerAddressCard"),i({text:"Customer address updated successfully",type:"info"})})}function mt(s){const a=W(s);return e(r.setIsCustomerAddressCardLoading(!0)),ge({id:t.selectedCustomer.customerId,model:a}).then(o=>{if(e(r.setIsCustomerAddressCardLoading(!1)),!o.error){const I=[o.data,...t.addressesGridRequestModel.items].map(g=>({...g,isSelected:g.addressId===t.selectedShipment.deliveryAddressId}));e(r.refreshAddressesGridRequestModel({...t.addressesGridRequestModel,items:I})),i({text:"New customer address created successfully",type:"info"}),e(r.resetManagedAddress()),l("customerAddressCard")}})}function ut(){l("customerAddressCard"),e(r.resetManagedAddress())}function ht(){var s;l("selectOrderForShipmentCard",!0),e(r.setIsOrdersGridLoading(!0)),U({...t.ordersGridRequestModel,filter:{customerId:(s=t.selectedCustomer)==null?void 0:s.customerId}}).then(a=>{e(r.setIsOrdersGridLoading(!1)),e(r.refreshOrdersGridRequestModel(a.data))}),e(r.refreshActiveCardForCustomers("selectOrderForShipmentCard"))}function pt(s){l("selectOrderForShipmentCard"),e(r.setIsShipmentConfigurationCardLoading(!0)),Ie({shipmentId:t.selectedShipment.shipmentId,orderId:s.id}).then(a=>{var o;e(r.setIsShipmentConfigurationCardLoading(!1)),a.error?i({text:(o=a==null?void 0:a.error)==null?void 0:o.message,type:"error"}):(e(r.refreshSelectedShipment(a.data)),i({text:"Order successfully connected to shipment",type:"info"}))})}function St(){l("selectOrderForShipmentCard"),e(r.refreshActiveCardForCustomers("shipmentConfigurationCard"))}function Ct(s){e(r.setIsProductsGridLoading(!0)),ve(s).then(a=>{e(r.setIsProductsGridLoading(!1)),e(r.refreshOrderStockActions(a.data))})}function ft(s){d(`${K.SALES}${K.ORDER_DETAILS}/${s}`)}function gt(s){e(r.setIsShipmentConfigurationCardLoading(!0)),Ae(s).then(a=>{e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(a.data))})}function It(s){e(r.setIsShipmentConfigurationCardLoading(!0)),xe(s).then(a=>{e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(a.data))})}function vt(s){e(r.setIsShipmentConfigurationCardLoading(!0)),ye({stockActionId:s.stockActionId,model:{quantity:s.quantityToPack}}).then(a=>{e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(a.data))})}function yt(s){return e(r.setIsShipmentConfigurationCardLoading(!0)),Le({shipmentId:t.selectedShipment.shipmentId,stockActionId:s}).then(a=>{e(r.setIsShipmentConfigurationCardLoading(!1)),a.error||e(r.refreshSelectedShipment(a.data))})}function At(){e(r.setIsShipmentConfigurationCardLoading(!0)),Oe(t.selectedShipment.shipmentId).then(s=>{e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(s.data))})}async function xt(){await O({headerTitle:"Cancel Shipment",text:`You are about to cancel shipment "${t.selectedShipment.shipmentId}".`,primaryButtonValue:"Cancel Shipment",secondaryButtonValue:"Cancel"})&&(e(r.setIsShipmentConfigurationCardLoading(!0)),await ke(t.selectedShipment.shipmentId).then(a=>{e(r.setIsShipmentConfigurationCardLoading(!1)),a.error?i({text:a.error.data.detail,type:"error"}):(e(r.refreshSelectedShipment(a.data)),i({text:"Shipment canceled successfully",type:"success"}))}))}function Ot(){e(r.setIsShipmentConfigurationCardLoading(!0)),Ge(t.selectedShipment.shipmentId).then(s=>{e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(s.data))})}function Lt(){He().then(s=>{e(r.refreshDeliveryServicesList(s.data))})}function kt(s){e(r.setIsShipmentConfigurationCardLoading(!0)),Me({shipmentId:t.selectedShipment.shipmentId,model:{trackNumber:s.trackNumber,deliveryServiceId:s.deliveryServiceId,addressItemId:s.deliveryAddressId}}).then(a=>{e(r.setIsShipmentConfigurationCardLoading(!1)),e(r.refreshSelectedShipment(a.data))})}return{getOrderDetailsHandler:be,getShipmentsListForOrderHandler:Ne,getOrderStockActionsListForGrid:Fe,createShipmentHandler:_e,updateShipmentDatesHandler:De,updateShipmentCustomerHandler:qe,updateShipmentAddressHandler:Te,getShipmentsListForForGridHandler:M,connectShipmentToOrderHandler:Re,getShipmentDetailsHandler:Q,getListOfCustomersForGridHandler:je,selectCustomerHandler:Pe,selectShipmentHandler:ze,showAllShipmentsHandler:Ee,updateUserPreferencesHandler:$,resetUserPreferencesHandler:Be,shipmentsGridRequestChangeHandle:we,applyShipmentsGridColumns:Ue,disconnectOrderFromShipmentHandler:Qe,addVariantToShipmentHandler:yt,addAllVariantsToShipmentHandler:At,removeVariantFromShipmentHandler:$e,closeShipmentConfigurationCardHandler:Ve,openCreateEntityCardHandler:Ke,searchEntityHandle:We,closeSelectEntityCardHandler:Xe,closeSelectShipmentForOrderCardHandler:Ye,createShipmentForOrderHandler:Je,confirmPackedProductsHandler:Ze,openSelectAddressCardHandler:tt,searchAddressHandle:rt,closeSelectAddressCardHandler:st,openCustomerCardHandler:at,createCustomerHandler:nt,updateCustomerHandler:it,closeCustomerCardHandler:dt,manageAddressHandler:ot,resolveCustomerAddressData:ct,closeCustomerAddressCardHandler:ut,openSelectOrderForShipmentCardHandler:ht,closeSelectOrderForShipmentCardHandler:St,addOrderToShipmentHandler:pt,getShipmentStatusForOrderHandler:Ct,navigateToOrderHandler:ft,increaseShipmentStockActionHandler:gt,decreaseShipmentStockActionHandler:It,changePackedOrderItemQuantityHandler:vt,cancelShipmentHandler:xt,returnShipmentStatusToPreviousHandler:Ot,getDeliveryServicesListHandler:Lt,confirmDeliveryDataHandler:kt}}const vr="_selectShipmentForOrderCard_1sp2s_1",yr="_selectShipmentForOrderCardContent_1sp2s_5",Ar="_customerBlockContainer_1sp2s_10",xr="_customerBlock_1sp2s_10",Or="_customerInfo_1sp2s_20",Lr="_customerInfoAvatarBlock_1sp2s_26",kr="_avatarImage_1sp2s_31",Gr="_avatarInitials_1sp2s_34",Hr="_customerName_1sp2s_47",A={selectShipmentForOrderCard:vr,selectShipmentForOrderCardContent:yr,customerBlockContainer:Ar,customerBlock:xr,customerInfo:Or,customerInfoAvatarBlock:Lr,avatarImage:kr,avatarInitials:Gr,customerName:Hr},Mr="_customerNameBlock_c3ncm_1",br="_noImageIcon_c3ncm_7",Fr="_avatarInitials_c3ncm_14",Nr="_shipmentStatus_c3ncm_28",jr="_shipmentStatusAvailable_c3ncm_38",_r="_shipmentStatusNotAvailable_c3ncm_44",Dr="_deliveryAddress_c3ncm_50",qr="_alias_c3ncm_55",Tr="_address_c3ncm_58",Rr="_selectButton_c3ncm_62",y={customerNameBlock:Mr,noImageIcon:br,avatarInitials:Fr,shipmentStatus:Nr,shipmentStatusAvailable:jr,shipmentStatusNotAvailable:_r,deliveryAddress:Dr,alias:qr,address:Tr,selectButton:Rr};function Pr(l){const e=i=>i==="New"||i==="Pending"?y.shipmentStatusAvailable:i==="Not Available"?y.shipmentStatusNotAvailable:"";return[{id:"customer",accessorFn:i=>i.variantName,header:"customer",minSize:120,cell:({row:i})=>{var d,f;const u=(d=i.original.customer)==null?void 0:d.thumbnailUrl,t=(f=i.original.customer)==null?void 0:f.customerName;return n.jsxs("div",{className:y.customerNameBlock,children:[u?n.jsx("img",{src:u,alt:t||"Customer",className:"object-cover rounded-md w-full h-full",style:{width:"48px",height:"48px"}}):t?n.jsx("div",{className:y.avatarInitials,children:re(t)}):n.jsx("div",{className:y.noImageIcon,children:n.jsx(P,{icon:z,maxWidth:"30px"})}),n.jsx(Z,{delayDuration:200,text:t,className:"max-w-[100%] overflow-hidden text-ellipsis whitespace-nowrap",children:n.jsx("span",{className:"she-text",children:t})})]})}},{id:"queueDate",header:"Queue Date",minSize:100,maxSize:100,cell:({row:i})=>n.jsx("span",{children:J(i.original.queueDate,"date")})},{id:"shipmentStatus",header:"Status",minSize:100,maxSize:100,cell:({row:i})=>{const u=i.original.shipmentStatus;return n.jsx("div",{className:`${y.shipmentStatus} ${e(u)}`,children:n.jsx("span",{children:u})})}},{id:"deliveryAddress",header:"Address",minSize:100,cell:({row:i})=>{var f,c,S;const u=(f=i.original.deliveryAddress)==null?void 0:f.alias,t=(c=i.original.deliveryAddress)==null?void 0:c.addressLine1,d=(S=i.original.deliveryAddress)==null?void 0:S.city;return n.jsxs("div",{className:y.deliveryAddress,children:[n.jsx("span",{className:`${y.alias} she-text`,children:u}),n.jsx("span",{className:`${y.address} she-text`,children:t}),n.jsx("span",{className:`${y.address} she-text`,children:d})]})}},{id:"quantityPacked",header:"Qty Packed",minSize:100,maxSize:100,cell:({row:i})=>n.jsx("span",{children:i.original.quantityPacked})},{id:"select",header:"",minSize:110,maxSize:110,cell:({row:i})=>n.jsx("div",{className:y.selectButton,onClick:u=>u.stopPropagation(),children:n.jsx(k,{icon:E,value:"Select",variant:"secondary",onClick:()=>l("connectShipmentToOrder",i.original)})})}]}function zr({isLoading:l,isGridLoading:e,shipmentsGridRequestModel:i,services:u,customer:t,onAction:d}){var x,O;const{translate:f}=ae();function c(){return Object.values(Wt).map(C=>({value:C,text:Xt[C]}))}function S(){return Object.values(sr).map(C=>({value:C,description:ar[C]}))}return n.jsx(se,{className:A.selectShipmentForOrderCard,title:"Select shipment for order",titleTransKey:"CardTitles.SelectShipmentForOrder",showCloseButton:!0,isLoading:l,onSecondaryButtonClick:()=>d("closeSelectShipmentForOrderCard"),children:n.jsxs("div",{className:A.selectShipmentForOrderCardContent,children:[n.jsxs("div",{className:A.customerBlockContainer,children:[n.jsx("span",{className:"she-text",children:f("ShipmentForm.Labels.ShowPendingShipments")}),n.jsxs("div",{className:A.customerBlock,children:[n.jsxs("div",{className:A.customerInfo,children:[t&&n.jsxs("div",{className:A.customerInfoAvatarBlock,children:[t!=null&&t.thumbnailUrl?n.jsx("img",{src:t==null?void 0:t.thumbnailUrl,alt:(t==null?void 0:t.name)||(t==null?void 0:t.customerName),className:A.avatarImage}):n.jsx("div",{className:A.avatarInitials,children:re((t==null?void 0:t.name)||(t==null?void 0:t.customerName))}),n.jsx("span",{className:`${A.customerName} she-subtext`,children:(t==null?void 0:t.name)||(t==null?void 0:t.customerName)})]}),n.jsx(k,{value:t?"Change Customer":"Select Customer",valueTransKey:t?"SpecialText.ChangeCustomer":"OrderActions.SelectCustomer",icon:zt,variant:"secondary",onClick:()=>d("changeCustomer")})]}),n.jsx(k,{value:"Show All",valueTransKey:"SpecialText.ShowAll",icon:Tt,variant:"secondary",onClick:()=>d("showAllShipments")})]})]}),n.jsxs(R,{gridRequestModel:i,data:i==null?void 0:i.items,columns:Pr(d),sortingItems:S(),skeletonQuantity:(x=i==null?void 0:i.items)==null?void 0:x.length,customMessage:"No shipments created yet",customMessageTransKey:"ShipmentMessages.NoShipmentsCreated",isLoading:e,onApplyColumns:C=>d("applyColumns",C),onDefaultColumns:()=>d("resetColumns"),onGridRequestChange:C=>d("gridRequestChange",C),children:[n.jsx(Y,{items:u,placeholder:"Service",placeholderTransKey:"SelectOptions.Service",icon:E,minWidth:"150px",onSelect:C=>d("gridRequestChange",{deliveryServiceId:C})}),n.jsx(Y,{items:c(),selected:(O=i.filter)==null?void 0:O.status,placeholder:"Status",placeholderTransKey:"SelectOptions.Status",icon:Et,minWidth:"150px",hideFirstOption:!0,onSelect:C=>d("gridRequestChange",{shipmentStatus:C})}),n.jsx(nr,{placeholder:"Date",placeholderTransKey:"SelectOptions.Date",mode:ir.RANGE,icon:Bt,minWidth:"150px",onSelectDate:C=>d("gridRequestChange",{startDate:C.from.toISOString(),endDate:C.to.toISOString()})}),n.jsx(dr,{})]})]})})}function vs(){var x,O,C,N,j,G,_;const{handleCardAction:l,handleMultipleCardActions:e,createRefCallback:i}=er({selectActiveCards:H=>H[L.ORDER_SHIPMENT].activeCards,refreshAction:r.refreshActiveCards}),{orderId:u}=te(),t=ee(),d=F(L.ORDER_SHIPMENT),f=F(L.ORDERS),c=Ir(l);Rt.useEffect(()=>{(!f.selectedOrder||f.selectedOrder.id!==u)&&c.getOrderDetailsHandler(Number(u)),c.getShipmentStatusForOrderHandler(Number(u)),c.getShipmentsListForOrderHandler(u),c.getDeliveryServicesListHandler(),t(r.refreshSelectedShipment({})),t(r.refreshActiveCards([]))},[u]);async function S(H,p){switch(H){case"createShipment":c.createShipmentForOrderHandler(Number(u));break;case"closeShipmentConfigurationCard":c.closeShipmentConfigurationCardHandler();break;case"changeShipmentDate":c.updateShipmentDatesHandler(d.selectedShipment.shipmentId,p);break;case"changeCustomer":c.getListOfCustomersForGridHandler({...f.customersGridRequestModel,searchQuery:p});break;case"selectCustomer":c.selectCustomerHandler(p);break;case"searchEntity":c.searchEntityHandle(p);break;case"openCreateEntityCard":c.openCreateEntityCardHandler();break;case"closeSelectEntityCard":c.closeSelectEntityCardHandler();break;case"selectAddress":c.updateShipmentAddressHandler(p);break;case"selectShipment":{e({shipmentConfigurationCard:!1,selectShipmentForOrderCard:!0}),c.selectShipmentHandler();break}case"showAllShipments":c.showAllShipmentsHandler();break;case"connectShipmentToOrder":c.connectShipmentToOrderHandler(p.shipmentId,Number(u));break;case"manageShipment":c.getShipmentDetailsHandler(p.shipmentId);break;case"closeSelectShipmentForOrderCard":c.closeSelectShipmentForOrderCardHandler();break;case"applyColumns":c.applyShipmentsGridColumns(p);break;case"resetColumns":c.resetUserPreferencesHandler("shipments");break;case"gridRequestChange":c.shipmentsGridRequestChangeHandle(p);break;case"removeOrderFromShipment":c.disconnectOrderFromShipmentHandler(d.selectedShipment.shipmentId,p.orderId);break;case"addItemToShipment":c.addVariantToShipmentHandler(p);break;case"addAllItemsToShipment":c.addAllVariantsToShipmentHandler();break;case"removeItemFromShipment":c.removeVariantFromShipmentHandler(p.stockActionId);break;case"changePackedOrderItemQuantity":c.changePackedOrderItemQuantityHandler(p);break;case"decreasePackedOrderItemQuantity":c.decreaseShipmentStockActionHandler(p);break;case"increasePackedOrderItemQuantity":c.increaseShipmentStockActionHandler(p);break;case"confirmPackedProducts":c.confirmPackedProductsHandler();break;case"openSelectAddressCard":c.openSelectAddressCardHandler(p);break;case"searchAddress":c.searchAddressHandle(p);break;case"closeSelectAddressCard":c.closeSelectAddressCardHandler();break;case"manageCustomer":c.openCustomerCardHandler(p);break;case"openCustomerCard":c.openCustomerCardHandler();break;case"createCustomer":c.createCustomerHandler(p);break;case"updateCustomer":c.updateCustomerHandler(p);break;case"closeCustomerCard":c.closeCustomerCardHandler();break;case"manageAddress":c.manageAddressHandler(p);break;case"submitCustomerAddressData":c.resolveCustomerAddressData(p);break;case"closeCustomerAddressCard":c.closeCustomerAddressCardHandler();break;case"openSelectOrderForShipmentCard":c.openSelectOrderForShipmentCardHandler();break;case"connectOrderToShipment":c.addOrderToShipmentHandler(p);break;case"closeSelectOrderForShipmentCard":c.closeSelectOrderForShipmentCardHandler();break;case"navigateToOrder":c.navigateToOrderHandler(p);break;case"cancelShipment":c.cancelShipmentHandler();break;case"returnShipmentStatusToPrevious":c.returnShipmentStatusToPreviousHandler();break;case"confirmDeliveryData":c.confirmDeliveryDataHandler(p);break}}return n.jsx("div",{className:or.orderShipmentPage,children:n.jsxs(wt,{menuCollectionType:"order",menuTitle:"Order",itemId:Number(u),counter:f.productCounter,activeCards:d.activeCards,children:[n.jsx(gr,{isLoading:d.isShipmentDetailsCardLoading,products:d.orderStockActions,shipments:d.orderShipments,customer:d.selectedCustomer,isProductsGridLoading:d.isProductsGridLoading,isShipmentsGridLoading:d.isOrderShipmentsGridLoading,onAction:S}),d.activeCards.includes("selectShipmentForOrderCard")&&n.jsx("div",{ref:i("selectShipmentForOrderCard"),children:n.jsx(zr,{isLoading:d.isSelectShipmentForOrderCardLoading,isGridLoading:d.isSelectShipmentForOrderGridLoading,shipmentsGridRequestModel:d.shipmentsGridRequestModel,customer:d.selectedCustomer,onAction:S})}),d.activeCards.includes("shipmentConfigurationCard")&&n.jsx("div",{ref:i("shipmentConfigurationCard"),children:n.jsx(Yt,{isLoading:d.isShipmentConfigurationCardLoading,shipment:d.selectedShipment,deliveryServices:d.deliveryServicesList,onAction:S})}),((x=d.activeCards)==null?void 0:x.includes("selectOrderForShipmentCard"))&&n.jsx("div",{ref:i("selectOrderForShipmentCard"),children:n.jsx(Jt,{isLoading:d.isSelectOrderForShipmentCardLoading,isGridLoading:d.isOrdersGridLoading,customer:d.selectedCustomer,ordersGridRequestModel:d.ordersGridRequestModel,onAction:S})}),((O=d.activeCards)==null?void 0:O.includes("selectEntityCard"))&&n.jsx("div",{ref:i("selectEntityCard"),children:n.jsx(tr,{isLoading:d.isSelectEntityCardLoading,isGridLoading:d.isSelectEntityGridLoading,entityName:"Customer",entityCollection:f.customersGridRequestModel.items,columns:rr({onAction:S}),onAction:S})}),((C=d.activeCards)==null?void 0:C.includes("selectCustomerAddressCard"))&&n.jsx("div",{ref:i("selectCustomerAddressCard"),children:n.jsx(Zt,{isLoading:d.isSelectCustomerAddressCardLoading,isGridLoading:d.isCustomerAddressesGridLoading,customer:(N=d.selectedShipment)==null?void 0:N.customer,addressesList:(j=d.addressesGridRequestModel)==null?void 0:j.items,onAction:S})}),((G=d.activeCards)==null?void 0:G.includes("customerCard"))&&n.jsx("div",{ref:i("customerCard"),children:n.jsx(Kt,{isLoading:d.isCustomerCardLoading,customer:d.managedCustomer,showCloseButton:!0,hideNotificationCard:!0,onAction:S})}),((_=d.activeCards)==null?void 0:_.includes("customerAddressCard"))&&n.jsx("div",{ref:i("customerAddressCard"),children:n.jsx(Qt,{isLoading:d.isCustomerAddressCardLoading,customerAddress:d.managedAddress,countryList:d.countryCodesList,onAction:S})})]})})}export{vs as OrderShipmentPage};
