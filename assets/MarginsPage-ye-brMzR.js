import{j as e,D as tn,o as ee,e as _,ai as sn,x as ne,f as L,aa as on,w as H,I as ln,J as cn,t as dn,B as un,n as G,S as D,Y as M,bE as s,l as gn,a6 as mn,a5 as pn,y as fn,r as R}from"./index-v5GGPS6e.js";import{G as hn,a as Cn}from"./GridSortingEnum-Qa64oiYF.js";import{S as O}from"./SheCard-DUpPneq_.js";import{o as w,s as Mn,c as U,b as N,u as re,S as ae,a as P}from"./types-DA1wkxsE.js";import{a as q,b as Q,S as In}from"./SheSelect-BbnKVWds.js";import{R as te,S as T}from"./SheInput-BT1klCBM.js";import{u as ie,I as xn}from"./useAppTranslation-jpbbUimH.js";import{s as se,t as yn,u as Fn,S as Pn}from"./SheContextSidebar-C_Gphi_y.js";import{P as _n}from"./plus-BHA-Jqz6.js";import{T as Sn,C as V}from"./SheCardNotification-CZ1fqJcv.js";import{G as J}from"./GridItemsFilter-BZETgKXY.js";import{G as Y}from"./GridTraitsFilter-CR7fRmS6.js";import{S as vn}from"./SheGrid-C6cojZjL.js";import{p as jn}from"./placeholder-image-BgG3Yd5d.js";import{c as bn}from"./she-select-convertors-CdG-Ygpu.js";import{S as Tn}from"./SelectEntityCard-EZ2PPWL1.js";import{u as Nn}from"./useProductsPageService-Bh-jaP9R.js";import{u as kn}from"./useToast-BqsCn1V6.js";import{u as Ln}from"./useCardActions-BGyQFRx5.js";import"./ComponentViewEnum-Ba6F4129.js";import"./form-a5y8IacV.js";import"./select-CIah2o3E.js";import"./chevron-up-DlhFtVmB.js";import"./settings-2-Bxi9_zd_.js";import"./folder-up-DTuIADAp.js";import"./trash-Cz1xV_GI.js";const Hn="_marginPage_1buxd_1",Dn="_salePriceManagementCard_1buxd_1",X={marginPage:Hn,salePriceManagementCard:Dn},An="_marginForPurchaseCard_13z9v_1",Bn="_marginForPurchaseCardContent_13z9v_1",Gn="_electedMarginBlock_13z9v_1",Rn="_marginDetails_13z9v_7",En="_marginActions_13z9v_12",zn="_marginActionsTitleBlock_13z9v_18",$n="_marginIsDeletedTitle_13z9v_22",wn="_marginActionsButtonBlock_13z9v_25",Vn="_marginIsDeletedBlock_13z9v_29",F={marginForPurchaseCard:An,marginForPurchaseCardContent:Bn,electedMarginBlock:Gn,marginDetails:Rn,marginActions:En,marginActionsTitleBlock:zn,marginIsDeletedTitle:$n,marginActionsButtonBlock:wn,marginIsDeletedBlock:Vn},On="_marginConfiguration_1m4iu_1",Wn="_marginConfigurationForm_1m4iu_1",Kn="_formFooterOneButton_1m4iu_5",Un="_formFooterTwoButton_1m4iu_8",qn="_marginConfigurationTitle_1m4iu_11",Qn="_marginConfigurationText_1m4iu_15",Jn="_marginConfigurationFormItem_1m4iu_21",Yn="_percentInputBlock_1m4iu_25",Xn="_percentInputSymbol_1m4iu_29",Zn="_percentInput_1m4iu_25",h={marginConfiguration:On,marginConfigurationForm:Wn,formFooterOneButton:Kn,formFooterTwoButton:Un,marginConfigurationTitle:qn,marginConfigurationText:Qn,marginConfigurationFormItem:Jn,percentInputBlock:Yn,percentInputSymbol:Xn,percentInput:Zn},er="field is required",nr=w({marginName:Mn().nonempty(er).min(2,"min value length 2"),marginRule:w({desiredProfit:N().optional(),plannedDiscount:N().optional(),fixedCosts:N().optional(),roundTo:U().optional(),nearest9:U().optional()})}),rr={desiredProfit:null,plannedDiscount:null,fixedCosts:null,roundTo:!1,nearest9:!1},Z={marginName:null,marginRule:{...rr}};function oe({className:o,data:i,isConfigurationCard:c=!0,onSubmit:n,onCancel:l}){const{form:m}=re({values:i,defaultValues:Z,scheme:nr,mode:te.CHANGE});return e.jsx("div",{className:`${h.marginConfiguration} ${o}`,children:e.jsxs(ae,{className:h.marginConfigurationForm,form:m,defaultValues:Z,formPosition:tn.CENTER,fullWidth:!0,hideSecondaryBtn:!c,primaryBtnProps:{value:i?"Save Changes":"Create Margin",bgColor:"#007AFF"},footerClassName:c?h.formFooterTwoButton:h.formFooterOneButton,onSubmit:n,onCancel:l,children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`${h.marginConfigurationText} she-text`,children:"This configuration allows you to automatically calculate the target prices based on conditions you set up and the product purchase price"}),e.jsx(P,{name:"marginName",className:h.marginConfigurationFormItem,render:({field:u})=>e.jsx(T,{label:"Margin Name",value:u.value,fullWidth:!0,placeholder:"Enter margin name..."})}),e.jsx(ee,{})]}),e.jsx("span",{className:`${h.marginConfigurationTitle} she-title`,children:c?"Configure Margin Details":"Adjust margin details for this purchase"}),e.jsx(P,{name:"marginRule.desiredProfit",label:"Desired profit (in %)",className:h.marginConfigurationFormItem,render:({field:u})=>e.jsxs("div",{className:h.percentInputBlock,children:[e.jsx("span",{className:`${h.percentInputSymbol} she-text`,children:"%"}),e.jsx(T,{className:h.percentInput,placeholder:"Enter profit...",value:u.value,type:"text",fullWidth:!0,inputMode:"decimal",onBeforeInput:t=>{const g=t.nativeEvent.data??"";/[0-9.,]/.test(g)||t.preventDefault()},onChange:t=>{const g=typeof t=="string"?t.replace(",","."):t;u.onChange(g)}})]})}),e.jsx("span",{className:`${h.marginConfigurationText} she-subtext`,children:"The profit is calculated based on the purchase price, other percentages do not intersect with it, but they result in single total"}),e.jsx(P,{name:"marginRule.plannedDiscount",label:"Planned discount (in %)",className:h.marginConfigurationFormItem,render:({field:u})=>e.jsxs("div",{className:h.percentInputBlock,children:[e.jsx("span",{className:`${h.percentInputSymbol} she-text`,children:"%"}),e.jsx(T,{className:h.percentInput,placeholder:"Enter planned discount...",value:u.value,type:"text",fullWidth:!0,inputMode:"decimal",onBeforeInput:t=>{const g=t.nativeEvent.data??"";/[0-9.,]/.test(g)||t.preventDefault()},onChange:t=>{const g=typeof t=="string"?t.replace(",","."):t;u.onChange(g)}})]})}),e.jsx("span",{className:`${h.marginConfigurationText} she-subtext`,children:"Planned discount is the part of the price you are planning to eventually reduce. For example, you can add 20 pln to the price of an item, so later, you could reduce the price automatically up to this amount. If you don’t want to budget for discount, just leave the field empty."}),e.jsx(P,{name:"marginRule.fixedCosts",className:h.marginConfigurationFormItem,render:({field:u})=>e.jsx(T,{label:"Fixed costs (in PLN)",value:u.value,fullWidth:!0,placeholder:"Netto price",type:"number"})}),e.jsx("span",{className:`${h.marginConfigurationText} she-subtext`,children:"If you have fixed costs associated with every single purchase, this is a place to add them in. The fixed costs are for example cost of package, or fraction of the shipping fee. If you don’t want to count that in, leave the field empty."}),e.jsx(P,{name:"marginRule.roundTo",render:({field:u})=>e.jsx(q,{text:"Round Brutto price to full number",description:"(This configuration rounds up all cents to full number)",type:Q.SWITCH,checked:u.value})}),e.jsx(P,{name:"marginRule.nearest9",render:({field:u})=>e.jsx(q,{text:"Jump the price to nearest 9",description:"(This configuration changes the last digit of the price to nearest 9. For example 61 will become 59, but 39 will become 39)",type:Q.SWITCH,checked:u.value})})]})})}function ar({isLoading:o,margin:i,onAction:c}){var l;const{translate:n}=ie();return e.jsx(O,{className:F.marginForPurchaseCard,title:"Margin For Purchase",titleTransKey:"CardTitles.MarginForPurchase",isLoading:o,children:e.jsxs("div",{className:F.marginForPurchaseCardContent,children:[e.jsxs("div",{className:F.electedMarginBlock,children:[e.jsx("span",{className:"she-text",children:n("MarginForm.Labels.SelectMarginForPurchase")}),e.jsx(_,{value:"Select Margin",valueTransKey:"MarginActions.SelectMargin",icon:sn,variant:"secondary",onClick:()=>c("openSelectMarginCard")})]}),i&&e.jsxs("div",{className:F.marginDetails,children:[e.jsxs("div",{className:F.marginActions,children:[e.jsx("div",{className:F.marginActionsTitleBlock,children:e.jsx("span",{className:`${i.isDeleted?F.marginIsDeletedTitle:""} she-title`,children:i.marginName})}),e.jsxs("div",{className:F.marginActionsButtonBlock,children:[((l=i==null?void 0:i.marginRule)==null?void 0:l.modified)&&e.jsx(_,{icon:se,txtColor:"#fff",bgColor:"#007AFF",onClick:()=>c("restoreMarginRules",i.marginId)}),e.jsx(_,{value:"Manage",valueTransKey:"ProductActions.Manage",icon:ne,variant:"secondary",onClick:()=>c("manageMargin",i)})]})]}),i.isDeleted&&e.jsx("div",{className:F.marginIsDeletedBlock,children:e.jsx("span",{className:"she-text",children:n("MarginMessages.MarginIsDeleted")})}),e.jsx(ee,{}),e.jsx(oe,{data:i,isConfigurationCard:!1,onSubmit:m=>c("updateSelectedMargin",m)})]})]})})}const tr="_marginConfigurationCard_1lpz0_1",ir="_marginConfigurationCardContent_1lpz0_1",sr="_marginConfigurationCardForm_1lpz0_7",E={marginConfigurationCard:tr,marginConfigurationCardContent:ir,marginConfigurationCardForm:sr};function or({isLoading:o,margin:i,onAction:c}){return e.jsx(O,{className:E.marginConfigurationCard,title:i?"Manage Margin":"Create Margin",titleTransKey:i?"CardTitles.ManageMargin":"CardTitles.CreateMargin",showCloseButton:!0,isLoading:o,showNotificationCard:i,notificationCardProps:{title:i!=null&&i.isDeleted?"RestoreMargin":"Delete Margin",titleTransKey:i!=null&&i.isDeleted?"CardTitles.RestoreMargin":"CardTitles.DeleteMargin",text:i!=null&&i.isDeleted?"The margin was deleted and is no longer manageable.":"This margin will be deleted and will no longer be available for selection or automatic connection",textTransKey:i!=null&&i.isDeleted?"ConfirmationMessages.RestoreMargin":"ConfirmationMessages.DeleteMargin",buttonText:i!=null&&i.isDeleted?"Restore":"Delete",buttonTextTransKey:i!=null&&i.isDeleted?"CommonButtons.Restore":"CommonButtons.Delete",buttonColor:i!=null&&i.isDeleted?"#38BF5E":"#EF4343",buttonIcon:i!=null&&i.isDeleted?_n:Sn,onClick:()=>i!=null&&i.isDeleted?c("restoreMargin",i):c("deleteMargin",i)},onSecondaryButtonClick:()=>c("closeMarginConfigurationCard"),children:e.jsx("div",{className:E.marginConfigurationCardContent,children:e.jsx(oe,{className:E.marginConfigurationCardForm,data:i,onSubmit:n=>c(i?"updateMargin":"createMargin",n),onCancel:()=>c("closeMarginConfigurationCard")})})})}const lr="_salePriceManagementCard_1pmum_1",cr="_salePriceManagementCardContent_1pmum_4",dr="_buttonBlock_1pmum_9",z={salePriceManagementCard:lr,salePriceManagementCardContent:cr,buttonBlock:dr},ur="_imageBlock_6u768_1",gr="_productName_6u768_10",mr="_productCode_6u768_20",$={imageBlock:ur,productName:gr,productCode:mr},pr="_marginItemsFormWrapper_152jo_1",fr="_marginItemsForm_152jo_1",hr="_marginItemsFormItem_152jo_8",Cr="_inputChanged_152jo_12",Mr="_selectChanged_152jo_15",Ir="_marginItemsFormText_152jo_18",xr="_marginItemsFormInput_152jo_22",yr="_marginItemsFormIcon_152jo_26",Fr="_arrowIcon_152jo_34",Pr="_arrowIconActive_152jo_41",_r="_lockIcon_152jo_44",Sr="_undoIcon_152jo_48",vr="_undoIconActive_152jo_53",jr="_formButtonNotActive_152jo_57",p={marginItemsFormWrapper:pr,marginItemsForm:fr,marginItemsFormItem:hr,inputChanged:Cr,selectChanged:Mr,marginItemsFormText:Ir,marginItemsFormInput:xr,marginItemsFormIcon:yr,arrowIcon:Fr,arrowIconActive:Pr,lockIcon:_r,undoIcon:Sr,undoIconActive:vr,formButtonNotActive:jr},br=w({marginPrice:N().optional(),taxTypeId:N().optional()}),Tr={marginItemId:null,stockActionId:null,variantId:null,thumbnailUrl:"",productId:null,variantCode:"",variantName:"",traitOptions:[],purchasePrice:"",currentPrice:null,taxTypeId:null,marginPrice:null,unitsAmount:null,taxTypeChanged:!1,marginPriceChanged:!1,taxChangesNotApplied:!1,locked:!1,isChanged:!1,marginPriceApplied:!1};function Nr({data:o,taxes:i,onMarginItemChange:c,onApply:n}){const{form:l}=re({values:o,defaultValues:Tr,scheme:br,mode:te.SUBMIT});return e.jsx("div",{className:p.marginItemsFormWrapper,children:e.jsxs(ae,{className:p.marginItemsForm,form:l,fullWidth:!0,hideFooter:!0,children:[e.jsx(P,{name:"taxTypeId",className:`${p.marginItemsFormItem} ${p.marginItemsFormInput}`,render:({field:m})=>e.jsx(In,{className:o!=null&&o.taxTypeChanged?p.selectChanged:"",placeholder:" ",selected:(m==null?void 0:m.value)||(o==null?void 0:o.taxTypeId),items:i,hideFirstOption:!0,minWidth:"70px",maxWidth:"70px",onSelect:()=>{c(l.getValues())}})}),e.jsx("div",{className:`${p.marginItemsFormItem} ${p.marginItemsFormIcon} ${o.taxTypeChanged?p.arrowIconActive:p.arrowIcon}`,children:e.jsx(L,{icon:yn,color:"#007AFF",onClick:()=>{c({...o,taxChangesNotApplied:!0})}})}),e.jsx(P,{name:"marginPrice",className:`${p.marginItemsFormItem} ${p.marginItemsFormInput}`,render:({field:m})=>e.jsx(T,{value:m.value,className:o!=null&&o.marginPriceChanged?p.inputChanged:"",minWidth:"70px",maxWidth:"70px",autoFocus:o.selectedItem,delayTime:1500,onDelay:()=>{c(l.getValues())}})}),e.jsx(L,{icon:Fn,color:o.locked?"#007AFF":"#E4E4E7",className:`${p.marginItemsFormItem} ${p.marginItemsFormIcon} ${p.lockIcon}`,onClick:()=>c({...o,locked:!(o!=null&&o.locked)})}),e.jsx(L,{icon:se,color:o.isChanged?"#EF4343":"#E4E4E7",className:`${p.marginItemsFormItem} ${p.marginItemsFormIcon} ${o.isChanged?p.undoIconActive:p.undoIcon}`,onClick:()=>c({...o,isChanged:!1})}),e.jsxs("span",{className:`${p.marginItemsFormText} she-text`,children:[o.unitsAmount," ",o.unitsAmount===1?"unit":"units"]}),e.jsx(_,{className:o!=null&&o.marginPriceApplied?p.formButtonNotActive:"",value:o!=null&&o.marginPriceApplied?"Applied":"Apply",icon:o!=null&&o.marginPriceApplied?V:on,txtColor:o!=null&&o.marginPriceApplied?"#38BF5E":"",variant:o!=null&&o.marginPriceApplied?"ghost":"secondary",onClick:()=>n(o==null?void 0:o.marginItemId)})]})})}function kr(o,i){return[{accessorKey:"thumbnailUrl",header:"Image",minSize:80,maxSize:80,cell:({row:c,table:n})=>{const l=c.getValue("thumbnailUrl"),m=n.options.meta;return e.jsx("div",{className:$.imageBlock,onClick:()=>i("image",c.id,m==null?void 0:m.setLoadingRow),children:l?e.jsx("img",{src:l||jn,alt:c.getValue("variantName"),className:"object-cover rounded-md w-full h-full"}):e.jsx(L,{icon:xn})})}},{accessorKey:"variantCode",header:"Code",minSize:60,maxSize:150,cell:({row:c})=>e.jsx(H,{delayDuration:200,text:c.getValue("variantCode"),children:e.jsx("span",{className:$.productCode,children:c.getValue("variantCode")})})},{accessorKey:"variantName",header:"Product Name",minSize:100,cell:({row:c})=>e.jsx(H,{delayDuration:200,text:c.getValue("variantName"),children:e.jsx("span",{className:$.productName,children:c.getValue("variantName")})})},{accessorKey:"traitOptions",header:"Details",minSize:80,maxSize:200,cell:({row:c})=>{const n=c.original.traitOptions||[],l=n.filter(u=>u.traitTypeId===2&&u.optionColor),m=n.filter(u=>u.traitTypeId===1&&u.optionName);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[l.map((u,t)=>e.jsx("div",{style:{background:u.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${t}`)),m.map((u,t)=>e.jsx("span",{style:{fontSize:"0.875rem"},children:u.optionName},`size-${t}`))]})}},{accessorKey:"purchasePrice",header:"Purchase Price",minSize:120,maxSize:200,enableHiding:!1,cell:({row:c})=>e.jsx("span",{children:c.getValue("purchasePrice")})},{accessorKey:"currentPrice",header:()=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"80px"},children:[e.jsx("span",{style:{textWrap:"wrap"},children:"Current Price"}),e.jsx(H,{showDefaultIcon:!0})]}),minSize:100,maxSize:200,enableHiding:!1,cell:({row:c})=>e.jsx("span",{children:c.getValue("currentPrice")})},{id:"form",accessorKey:"",minSize:460,maxSize:460,enableHiding:!1,header:()=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{style:{marginLeft:"3px",marginRight:"92px"},children:"Tax"}),e.jsx("span",{style:{marginRight:"84px"},children:"Margin Price"}),e.jsx("span",{children:"Quantity"})]}),cell:({row:c})=>e.jsx(Nr,{data:c.original,taxes:bn(o,{text:"name",value:"id"}),currentPrice:c.getValue("currentPrice"),onMarginItemChange:n=>{i("updateMarginItem",n)},onApply:n=>i("applyMarginItem",n)})}]}function Lr({isLoading:o,isGridLoading:i,preferences:c,sortingOptions:n,brands:l,categories:m,colors:u,sizes:t,taxes:g,gridRequestModel:C,onAction:I}){var v,j;const{translate:S}=ie();return e.jsxs("div",{className:z.salePriceManagementCard,children:[e.jsx(O,{className:z.salePriceManagementCardContent,title:"Sale Price Management",titleTransKey:"CardTitles.SalePriceManagement",isLoading:o,children:e.jsxs(vn,{isLoading:i,columns:kr(g,I),data:C==null?void 0:C.items,sortingItems:n,columnsPreferences:c,gridRequestModel:C,preferenceContext:"salePriceManagementReferences",skeletonQuantity:C==null?void 0:C.pageSize,onApplyColumns:f=>I("applyColumns",f),onDefaultColumns:()=>I("resetColumns"),onGridRequestChange:f=>I("gridRequestChange",f),children:[e.jsx(J,{items:l,columnName:S("SectionTitles.Brand"),getId:f=>f.brandId,getName:f=>f.brandName,selected:(v=C==null?void 0:C.filter)==null?void 0:v.brands}),e.jsx(J,{items:m,columnName:S("SectionTitles.Category"),getId:f=>f.categoryId,getName:f=>f.categoryName,selected:(j=C==null?void 0:C.filter)==null?void 0:j.categories}),e.jsx(Y,{traitOptions:u,traitType:"color"}),e.jsx(Y,{traitOptions:t,traitType:"size"})]})}),e.jsxs("div",{className:z.buttonBlock,children:[e.jsx(_,{value:"Apply visible prices",valueTransKey:"SpecialText.ApplyVisiblePrices",icon:V,variant:"info",onClick:()=>I("applyVisibleMarginItems")}),e.jsx(_,{value:"Apply all prices",valueTransKey:"SpecialText.ApplyAllPrices",icon:V,variant:"info",onClick:()=>I("applyAllMarginItems")})]})]})}const Hr="_iconCheck_1wa1s_1",Dr={iconCheck:Hr};function Ar({onAction:o}){return[{id:"select",header:"Select",minSize:70,maxSize:70,cell:({row:i,table:c})=>{const n=c.options.meta,l=m=>{m.stopPropagation(),m.preventDefault(),o("selectMargin",i.original)};return e.jsx("div",{onClick:m=>m.stopPropagation(),children:e.jsx(_,{className:i.original.isSelected===!0?Dr.iconCheck:"",icon:i.original.isSelected===!0?ln:cn,variant:"ghost",onClick:l,disabled:n==null?void 0:n.isRowLoading(i.id)})})}},{id:"marginName",header:"Margin name",minSize:150,cell:({row:i})=>e.jsx(H,{delayDuration:200,text:i.original.marginName,className:"max-w-[100%] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-text",children:i.original.marginName})})},{id:"manage",header:"Actions",minSize:120,maxSize:120,cell:({row:i,table:c})=>{const n=c.options.meta;return e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsx(_,{icon:ne,value:"Manage",variant:"secondary",onClick:()=>o("manageMargin",i.original),disabled:n==null?void 0:n.isRowLoading(i.id)})})}}]}function Br(o,i,c){const n=dn(),{addToast:l}=kn(),{openConfirmationDialog:m}=un(),u=Nn(),t=G(D.MARGINS),g=G(D.PRODUCTS),C=G(D.APP),[I]=M.useGetMarginsListForGridMutation(),[S]=M.useGetMarginItemsListForGridMutation(),[v]=M.useLazyGetAllMarginsQuery(),[j]=M.useLazyGetMarginForPurchaseQuery(),[f]=M.useLazyGetMarginDetailsQuery(),[x]=M.useCreateMarginMutation(),[le]=M.useUpdateMarginMutation(),[ce]=M.useCreateMarginRulesMutation(),[de]=M.useDeleteMarginMutation(),[ue]=M.useRestoreMarginMutation(),[ge]=M.useConnectMarginToPurchaseMutation(),[me]=M.useDetachMarginMutation(),[pe]=M.useRestoreMarginRuleToDefaultMutation(),[fe]=M.useUpdateMarginItemMutation(),[he]=M.useApplyMarginItemMutation(),[Ce]=M.useUpdateMarginRulesForPurchaseMutation(),[Me]=M.useApplyVisibleMarginItemsMutation(),[Ie]=M.useApplyAllMarginItemsMutation();function k(a){return I(a).then(r=>(n(s.refreshMarginsList(r.data.items)),r.data))}function W(a,r){return S({purchaseId:a,model:r}).then(d=>(n(s.refreshMarginItemsGridRequestModel(d.data)),d.data))}function xe(){return v().then(a=>(n(s.refreshMarginsList(a.data)),a.data))}function A(a){return j(a).then(r=>r.data)}function ye(a){return f(a).then(r=>r.data)}function Fe(a){return x(a).then(r=>r.data)}function Pe(a,r){return le({marginId:a,model:r}).then(d=>d.data)}function K(a,r){return ce({marginId:a,model:r}).then(d=>d.data)}function _e(a){return de(a).then(r=>r)}function Se(a){return ue(a).then(r=>r)}function ve(a,r){return ge({purchaseId:a,marginId:r}).then(d=>d.data)}function je(a){return me(a).then(r=>r.data)}function be(a){return pe(a).then(r=>r.data)}function Te(a,r){return fe({marginItemId:a,model:r}).then(d=>d.data)}function Ne(a){return he(a).then(r=>r.data)}function ke(a,r){return Ce({purchaseId:a,model:r}).then(d=>d.data)}function Le(a,r){return Me({purchaseId:a,model:r}).then(d=>d.data)}function He(a){return Ie(a).then(r=>r.data)}function De(a,r){W(a,r)}function Ae(){i({selectEntityCard:!0,salePriceManagementCard:!1}),n(s.setIsSelectMarginCardLoading(!0)),k(t.marginsGridRequestModel).then(a=>{n(s.setIsSelectMarginCardLoading(!1)),n(s.setIsMarginListGridLoading(!1));const r=a.items.map(d=>({...d,isSelected:d.marginId===t.selectedMargin.marginId}));n(s.refreshMarginsList(r))})}function Be(a){n(s.setIsMarginListGridLoading(!0)),k({...t.marginsGridRequestModel,searchQuery:a}).then(r=>{n(s.setIsMarginListGridLoading(!1));const d=r.items.map(y=>({...y,isSelected:y.marginId===t.selectedMargin.marginId}));n(s.refreshMarginsList(d))})}function Ge(a,r){n(s.setIsMarginForPurchaseCardLoading(!0)),ve(r,a.marginId).then(d=>{n(s.setIsMarginForPurchaseCardLoading(!1)),o("selectEntityCard"),d?(n(s.refreshActiveCards(null)),n(s.refreshSelectedMargin(d)),B(r),l({text:"Margin selected successfully",type:"success"})):l({text:`${d.error.data.detail}`,type:"error"})})}function Re(a){n(s.setIsMarginForPurchaseCardLoading(!0)),je(a).then(r=>{n(s.setIsMarginForPurchaseCardLoading(!1)),r.error?l({text:`${r.error.data.detail}`,type:"error"}):(n(s.resetSelectedMargin()),l({text:"Margin detached successfully",type:"success"}))})}function Ee(a){n(s.setIsMarginConfigurationCardLoading(!0)),Fe({marginName:a.marginName}).then(r=>{r?(K(r.marginId,a.marginRule).then(()=>{n(s.setIsMarginConfigurationCardLoading(!1)),n(s.setIsMarginListGridLoading(!0)),n(s.setIsSelectMarginCardLoading(!0)),k(t.marginsGridRequestModel).then(d=>{n(s.setIsSelectMarginCardLoading(!1)),n(s.setIsMarginListGridLoading(!1));const y=d.items.map(b=>({...b,isSelected:b.marginId===t.selectedMargin.marginId}));n(s.refreshMarginsList(y))})}),o("marginConfigurationCard"),l({text:"Margin created successfully",type:"success"})):l({text:`${r.error.data.detail}`,type:"error"})})}function ze(a){n(s.setIsMarginConfigurationCardLoading(!0)),Promise.all([Pe(t.managedMargin.marginId,{marginName:a.marginName}),K(t.managedMargin.marginId,a.marginRule)]).then(([r,d])=>{n(s.setIsMarginConfigurationCardLoading(!1)),r.marginName!==t.managedMargin.marginName&&(n(s.setIsSelectMarginCardLoading(!0)),k(t.marginsGridRequestModel).then(()=>{n(s.setIsSelectMarginCardLoading(!1))})),r&&d?(o("marginConfigurationCard"),l({text:"Default margin has been updated",type:"success"})):l({text:`${r.error.data.detail||d.error.data.detail}`,type:"error"})})}function $e(a,r){n(s.setIsMarginForPurchaseCardLoading(!0)),ke(r,a.marginRule).then(d=>{n(s.setIsMarginForPurchaseCardLoading(!1)),d.error?l({text:`${d.error.data.detail}`,type:"error"}):(n(s.refreshSelectedMargin({...t.selectedMargin,marginRule:d})),B(r),l({text:"Margin updated successfully",type:"success"}))})}function we(a){i({marginConfigurationCard:!0,salePriceManagementCard:!1}),n(s.setIsMarginConfigurationCardLoading(!0)),ye(a.marginId).then(r=>{n(s.setIsMarginConfigurationCardLoading(!1)),r?(n(s.refreshManagedMargin(r)),n(s.refreshMarginsList(pn(a.marginId,t.marginsList,"marginId")))):o("marginConfigurationCard")})}async function Ve(a,r){await m({headerTitle:"Deleting margin rule",text:"You are about to delete the margin rule. The prices that were previously calculated using this margin, will remain intact. The margin will no longer be applied to new purchases.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&_e(a.marginId).then(y=>{y.error?l({text:y.error.data.detail,type:"error"}):(n(s.refreshManagedMargin({...t.managedMargin,isDeleted:!0})),t.selectedMargin.marginId===a.marginId&&(n(s.setIsMarginForPurchaseCardLoading(!0)),A(r).then(b=>{n(s.setIsMarginForPurchaseCardLoading(!1)),n(s.refreshSelectedMargin(b))})),l({text:"Margin deleted successfully",type:"success"}))})}function Oe(a,r){n(s.setIsMarginConfigurationCardLoading(!0)),Se(a.marginId).then(d=>{n(s.setIsMarginConfigurationCardLoading(!1)),d.error?l({text:d.error.data.detail,type:"error"}):(n(s.refreshManagedMargin({...t.managedMargin,isDeleted:!1})),t.selectedMargin.marginId===a.marginId&&(n(s.setIsMarginForPurchaseCardLoading(!0)),A(r).then(y=>{n(s.setIsMarginForPurchaseCardLoading(!1)),n(s.refreshSelectedMargin(y))})),l({text:"Margin restored successfully",type:"success"}))})}function We(a){n(s.setIsMarginForPurchaseCardLoading(!0)),be(a).then(r=>{n(s.setIsMarginForPurchaseCardLoading(!1)),r.error?l({text:r.error.data.detail,type:"error"}):(n(s.refreshSelectedMargin(r)),l({text:"Margin restored successfully",type:"success"}))})}function Ke(a){const r=t.marginItemsGridRequestModel.items.map(d=>d.marginItemId===a.marginItemId?{...a,selectedItem:!0}:{...d,selectedItem:!1});n(s.refreshMarginItemsGridRequestModel({...t.marginItemsGridRequestModel,items:r})),Te(a.marginItemId,a).then(d=>{const y=t.marginItemsGridRequestModel.items.map(b=>b.marginItemId===a.marginItemId?{...d,selectedItem:!0}:{...b,selectedItem:!1});n(s.refreshMarginItemsGridRequestModel({...t.marginItemsGridRequestModel,items:y}))})}function Ue(a){Ne(a).then(r=>{if(r){const d=t.marginItemsGridRequestModel.items.map(y=>y.marginItemId===r.marginItemId?r:y);n(s.refreshMarginItemsGridRequestModel({...t.marginItemsGridRequestModel,items:d}))}else l({text:r.error.data.detail,type:"error"})})}function qe(a){n(s.setIsMarginProductsGridLoading(!0)),Le(a,t.marginItemsGridRequestModel).then(r=>{n(s.setIsMarginProductsGridLoading(!1)),r?(n(s.refreshMarginItemsGridRequestModel(r)),l({text:"Visible margin items applied successfully",type:"success"})):l({text:r.error.data.detail,type:"error"})})}function Qe(a){n(s.setIsMarginProductsGridLoading(!0)),He(a).then(r=>{n(s.setIsMarginProductsGridLoading(!1)),r?(n(s.refreshMarginItemsGridRequestModel(r)),l({text:"All margin items applied successfully",type:"success"})):l({text:r.error.data.detail,type:"error"})})}function Je(){n(s.resetManagedMargin()),o("marginConfigurationCard",!0)}function Ye(){o("selectEntityCard")}function Xe(){o("selectMarginCard")}function Ze(){o("marginConfigurationCard")}function en(a){const r=gn.merge({},C.preferences,a);n(mn.refreshPreferences(r)),u.updateUserPreferencesHandler(r)}function nn(){u.resetUserPreferencesHandler("salePriceManagement")}function rn(a){n(s.resetSelectedMargin()),n(s.setIsMarginForPurchaseCardLoading(!0)),A(a).then(r=>{n(s.setIsMarginForPurchaseCardLoading(!1)),n(s.refreshSelectedMargin(r))}),g.purchaseCounters||(n(s.setIsProductMenuCardLoading(!0)),u.getPurchaseCountersHandler(Number(a)).then(()=>n(s.setIsProductMenuCardLoading(!1)))),t.marginsList.length===0&&xe(),g.taxesList.length===0&&u.getTaxesListHandler(),g.brands.length===0&&u.getBrandsForFilterHandler(),g.categories.length===0&&u.getCategoriesForFilterHandler(),(g.sizesForFilter.length===0||g.colorsForFilter.length===0)&&u.getTraitsForFilterHandler(),c(["salePriceManagementCard"])}function B(a){n(s.setIsMarginProductsGridLoading(!0)),W(a,t.marginItemsGridRequestModel).then(()=>{n(s.setIsMarginProductsGridLoading(!1))})}function an(){t.activeCards.length===0&&o("salePriceManagementCard",!0)}return{state:t,appState:C,productsState:g,gridRequestChangeHandle:De,openSelectMarginCardHandle:Ae,searchEntityHandle:Be,selectMarginHandle:Ge,detachMarginHandle:Re,createMarginHandle:Ee,updateMarginHandle:ze,updateSelectedMarginHandler:$e,manageMarginHandle:we,deleteMarginHandle:Ve,restoreMarginHandle:Oe,restoreMarginRulesHandle:We,updateMarginItemHandle:Ke,applyMarginItemItemHandle:Ue,openCreateEntityCardHandle:Je,closeSelectEntityCardHandle:Ye,closeSelectMarginCardHandle:Xe,closeMarginConfigurationCardHandle:Ze,applyColumnsHandle:en,resetColumnsHandle:nn,applyVisibleMarginItemsHandle:qe,applyAllMarginItemsHandle:Qe,getMarginPageDataHandle:rn,getMarginItemsListHandle:B,keepSalePriceManagementCardOpenHandle:an}}function ca(){var S,v,j;const{handleCardAction:o,handleMultipleCardActions:i,keepOnlyCards:c,createRefCallback:n}=Ln({selectActiveCards:f=>f[D.MARGINS].activeCards,refreshAction:s.refreshActiveCards}),{state:l,appState:m,productsState:u,...t}=Br(o,i,c),{purchaseId:g}=fn(),C=Object.values(hn).map(f=>({value:f,description:Cn[f]}));R.useEffect(()=>{t.getMarginPageDataHandle(g)},[g]),R.useEffect(()=>{t.getMarginItemsListHandle(g)},[]),R.useEffect(()=>{t.keepSalePriceManagementCardOpenHandle()},[l.activeCards]);async function I(f,x){switch(f){case"openSelectMarginCard":t.openSelectMarginCardHandle();break;case"searchEntity":t.searchEntityHandle(x);break;case"selectMargin":t.selectMarginHandle(x,g);break;case"detachMargin":t.detachMarginHandle(g);break;case"createMargin":t.createMarginHandle(x);break;case"updateMargin":t.updateMarginHandle(x);break;case"updateSelectedMargin":t.updateSelectedMarginHandler(x,g);break;case"manageMargin":t.manageMarginHandle(x);break;case"deleteMargin":t.deleteMarginHandle(x,g);break;case"restoreMargin":t.restoreMarginHandle(x,g);break;case"restoreMarginRules":t.restoreMarginRulesHandle(g);break;case"updateMarginItem":t.updateMarginItemHandle(x);break;case"applyMarginItem":t.applyMarginItemItemHandle(x);break;case"openCreateEntityCard":t.openCreateEntityCardHandle();break;case"closeSelectEntityCard":t.closeSelectEntityCardHandle();break;case"closeSelectMarginCard":t.closeSelectMarginCardHandle();break;case"closeMarginConfigurationCard":t.closeMarginConfigurationCardHandle();break;case"applyColumns":t.applyColumnsHandle(x);break;case"resetColumns":t.resetColumnsHandle();break;case"gridRequestChange":t.gridRequestChangeHandle(g,x);break;case"applyVisibleMarginItems":t.applyVisibleMarginItemsHandle(g);break;case"applyAllMarginItems":t.applyAllMarginItemsHandle(g);break}}return e.jsx("div",{className:X.marginPage,children:e.jsxs(Pn,{menuCollectionType:"purchases",menuTitle:"Manage Product",itemId:Number(g),counter:u.purchaseCounters,activeCards:l.activeCards,children:[e.jsx(ar,{isLoading:l.isMarginForPurchaseCardLoading,margin:l.selectedMargin,onAction:I}),((S=l.activeCards)==null?void 0:S.includes("salePriceManagementCard"))&&e.jsx("div",{className:X.salePriceManagementCard,ref:n("salePriceManagementCard"),children:e.jsx(Lr,{isLoading:l.isSalePriceManagementCardLoading,isGridLoading:l.isMarginProductsGridLoading,preferences:m.preferences,brands:u.brands,categories:u.categories,sizes:u.sizesForFilter,colors:u.colorsForFilter,taxes:u.taxesList,sortingOptions:C,gridRequestModel:l.marginItemsGridRequestModel,onAction:I})}),((v=l.activeCards)==null?void 0:v.includes("selectEntityCard"))&&e.jsx("div",{ref:n("selectEntityCard"),children:e.jsx(Tn,{isLoading:l.isSelectMarginCardLoading,isGridLoading:l.isMarginListGridLoading,entityName:"Margin",entityCollection:l.marginsList,columns:Ar({onAction:I}),onAction:I})}),((j=l.activeCards)==null?void 0:j.includes("marginConfigurationCard"))&&e.jsx("div",{ref:n("marginConfigurationCard"),children:e.jsx(or,{isLoading:l.isMarginConfigurationCardLoading,margin:l.managedMargin,onAction:I})})]})})}export{ca as MarginsPage};
