import{c as D,bF as N,d as j,S as v,k as T,a as U,bk as Y,p as W,r as b,bG as t,bH as d,N as k,bj as q,bI as $,j as e,as as Z,aN as _,i as z}from"./index-QVa4z7_S.js";import{i as K,e as Q,F as J,b as X}from"./form-BdZzBDsU.js";import{a as ee,b as te,c as oe,d as ae,S as ne}from"./select-bYJQrbdN.js";import{S as p}from"./SheForm-BmC3Qvqt.js";import{u as re}from"./useToast-AtOl6Lcj.js";import{u as se}from"./useIsMobile-Df6K6ic3.js";import{u as ie}from"./chevron-up-DICsDMcg.js";const ue="_authPage_1o0p0_1",de="_authPageWrapper_1o0p0_8",le="_authPageLoadingBlock_1o0p0_20",he="_authHeader_1o0p0_24",ce="_authHeaderLogo_1o0p0_33",me="_authContent_1o0p0_37",ge="_authInputBlock_1o0p0_40",pe="_phoneInput_1o0p0_43",fe="_phoneInputItems_1o0p0_49",Ne="_countryCodeInput_1o0p0_55",Fe="_passwordInput_1o0p0_64",_e="_forgotPasswordLink_1o0p0_67",Se="_changePhoneNumber_1o0p0_77",be="_formItem_1o0p0_87",xe="_formButton_1o0p0_100",Ie="_facebookButtonBlock_1o0p0_110",Pe="_authContentBorder_1o0p0_117",Ce="_footerText_1o0p0_133",we="_authPageLoading_1o0p0_20",Ve="_isMobile_1o0p0_149",s={authPage:ue,authPageWrapper:de,authPageLoadingBlock:le,authHeader:he,authHeaderLogo:ce,authContent:me,authInputBlock:ge,phoneInput:pe,phoneInputItems:fe,countryCodeInput:Ne,passwordInput:Fe,forgotPasswordLink:_e,changePhoneNumber:Se,formItem:be,formButton:xe,facebookButtonBlock:Ie,authContentBorder:Pe,footerText:Ce,authPageLoading:we,isMobile:Ve};function Le(){const[a]=D.useLazyGetCountryCodeQuery(),[o]=N.useUserSignInMutation(),[x]=N.useUserSignUpMutation(),[l]=N.useForgotPasswordMutation(),[m]=N.useResetPasswordMutation(),[c]=N.useConfirmSignInNumberMutation(),[P]=N.useVerifySignUpNumberMutation(),[C]=N.useConfirmSignUpPhoneNumberMutation(),[w]=N.useVerifySignInNumberMutation(),S=j(v.AUTH),u=T(),{refreshToken:F}=U(),h=Y(),n=W(),[I,f]=b.useState(y(S.authFormView));b.useEffect(()=>{const r=new URLSearchParams(h.search);r.has("change-password")&&g(t.CHANGE_PASSWORD);const i=r.get("token");i&&u(d.setResetToken(i))},[h]);function V(){return u(d.setLoading(!0)),a(null).then(r=>(u(d.setLoading(!1)),r.data&&u(d.setCountryCode(r.data)),r))}function L(r){return u(d.setLoading(!0)),o(r).then(i=>{if(u(d.setLoading(!1)),i.error)return i;F(i.data.token),A()})}function R(r){return u(d.setLoading(!0)),c(r).then(i=>{if(u(d.setLoading(!1)),i.error)return i;F(i.data.token),n(k.DASHBOARD)})}function A(){return u(d.setLoading(!0)),w(null).then(r=>{if(u(d.setLoading(!1)),r.error)return g(t.VERIFY_PHONE_NUMBER),r;g(t.VERIFY_CODE),u(d.setHiddenPhoneNumber(r.data.hiddenPhoneNumber))})}function H(r){return u(d.setLoading(!0)),x(r).then(i=>{if(u(d.setLoading(!1)),i.error)return i;F(i.data.token),g(t.VERIFY_PHONE_NUMBER)})}function O(r){return u(d.setLoading(!0)),P(r).then(i=>{if(u(d.setLoading(!1)),i.error)return i;g(t.VERIFY_CODE)})}function G(r){return u(d.setLoading(!0)),C(r).then(i=>{var E;if(u(d.setLoading(!1)),i.error)return F((E=i==null?void 0:i.data)==null?void 0:E.token),g(t.SIGN_UP),i;n(k.DASHBOARD)})}function B(r){return u(d.setLoading(!0)),l(r).then(i=>(u(d.setLoading(!1)),i.error||g(t.SIGN_IN),i))}function M(r){return u(d.setLoading(!0)),r.resetToken=S.resetToken,m(r).then(i=>{u(d.setLoading(!1)),g(t.SIGN_IN)})}function g(r){u(d.setAuthFormView(r)),f(y(r))}function y(r){switch(r){case t.SIGN_UP:return{title:"Sign up with your email",subTitle:"Enter your information to join",facebookButtonText:"Sign up with Facebook",buttonText:"Sign up",footerText:"Already have account?",footerLink:"Sign in"};case t.SIGN_IN:return{title:"Sign in with your email",subTitle:"Enter your information to sign in",facebookButtonText:"Sign in with Facebook",forgotPasswordLink:"Forgot password",buttonText:"Sign in",footerText:"Don’t have an account yet? ",footerLink:"Sign up"};case t.FORGOT_PASSWORD:return{title:"Forgot password",subTitle:"Enter your email to reset password",buttonText:"Send reset link",footerText:"Already have account?",footerLink:"Sign in"};case t.CHANGE_PASSWORD:return{title:"Change password",subTitle:"Enter your new password",buttonText:"Change password"};case t.VERIFY_CODE:return{title:"Verify Your Identity",subTitle:"We’ve sent a text message to:",buttonText:"Continue",changePhoneNumberLink:"Change",footerText:"Didn’t receive a code? ",footerLink:"Resend"};case t.VERIFY_PHONE_NUMBER:return{title:"Verify Your Identity",subTitle:"Please provide phone number so we could send you a message",buttonText:"Send"}}}return{...S,formStaticText:I,getCountryCodeHandler:V,userSignInHandler:L,verifySignInNumberHandler:A,confirmSignInNumberHandler:R,userSignUpHandler:H,verifySignupNumberHandler:O,confirmSignUpPhoneNumberHandler:G,forgotPasswordHandler:B,resetPasswordHandler:M,authFormViewChangeHandler:g}}const Ae="/shelfie/assets/AuthLogo-Bb-l_AyC.png";function He(){var F;const{t:a}=ie(),o=Le(),x=T(),l=j(v.AUTH),{addToast:m}=re(),c=K({defaultValues:{email:"",password:"",confirmPassword:"",firstName:"",lastName:"",phoneNumber:"",verifyPhoneNumber:null,code:((F=l==null?void 0:l.countryCode)==null?void 0:F[0])||null,phoneCodeModel:null}}),P=se(),C=c.watch("phoneNumber"),w=c.watch("phoneCodeModel.phoneCode");b.useEffect(()=>{q.removeLocalStorage($.TOKEN),(async()=>{const n=await o.getCountryCodeHandler();x(d.setCountryCode(n.data)),c.setValue("phoneCodeModel",l.countryCode[0])})()},[l.countryCode]),b.useEffect(()=>{o.authFormView===t.FORGOT_PASSWORD&&c.reset()},[o.authFormView]),b.useEffect(()=>{(async()=>{const n=await o.getCountryCodeHandler();x(d.setCountryCode(n.data)),c.reset({...c.getValues(),phoneCodeModel:n.data[0]})})()},[]);function S(){switch(o.authFormView){case t.SIGN_IN:o.authFormViewChangeHandler(t.SIGN_UP),c.reset();break;case t.SIGN_UP:o.authFormViewChangeHandler(t.SIGN_IN),c.reset();break;case t.VERIFY_CODE:l.hiddenPhoneNumber?o.verifySignInNumberHandler():o.confirmSignUpPhoneNumberHandler(c.getValues());break;case t.FORGOT_PASSWORD:o.authFormViewChangeHandler(t.SIGN_IN),c.reset();break}}function u(h){switch(o.authFormView){case t.SIGN_IN:o.userSignInHandler(h).then(n=>{n&&m({text:n.error.data.title,type:"error"})});break;case t.SIGN_UP:o.userSignUpHandler(h).then(n=>{n.error&&m({text:n.error.data.detail,type:"error"})});break;case t.FORGOT_PASSWORD:o.forgotPasswordHandler(h).then(n=>{n.error?m({text:n.error.data.detail,type:"error"}):m({text:n.data.message,type:"success"})});break;case t.CHANGE_PASSWORD:o.resetPasswordHandler(h);break;case t.VERIFY_PHONE_NUMBER:o.verifySignupNumberHandler(h).then(n=>{n.error&&m({text:n.error.data.detail,type:"error"})});break;case t.VERIFY_CODE:l.hiddenPhoneNumber?o.confirmSignInNumberHandler(h).then(n=>{n.error&&m({text:n.error.data.detail,type:"error"})}):o.confirmSignUpPhoneNumberHandler(h).then(n=>{n.error&&m({text:n.error.data.detail,type:"error"})});break}}return e.jsxs("div",{className:`${s.authPage} ${P?s.isMobile:""}`,children:[e.jsxs("div",{className:`${s.authPageWrapper} ${l.isLoading?s.authPageLoading:""}`,children:[l.isLoading&&e.jsx(Z,{className:s.authPageLoadingBlock}),e.jsxs("div",{className:s.authHeader,children:[e.jsx("img",{className:s.authHeaderLogo,src:Ae,alt:"shelfie-logo"}),e.jsx("span",{className:"she-title",children:o.formStaticText.title}),e.jsx("span",{className:"she-subtext",children:o.formStaticText.subTitle})]}),e.jsxs("div",{className:s.authContent,children:[e.jsx("div",{className:s.authInputBlock,children:e.jsxs(p,{form:c,onSubmit:u,children:[o.authFormView===t.SIGN_UP&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.formItem,children:e.jsx(p.Field,{rules:{required:a("AuthForm.Validation.FirstNameRequired"),minLength:{value:3,message:a("AuthForm.Validation.FirstNameMinLength")},maxLength:{value:50,message:a("AuthForm.Validation.FirstNameMaxLength")}},name:"firstName",label:a("AuthForm.Labels.FirstName"),children:e.jsx(_,{placeholder:a("AuthForm.Placeholders.FirstName")})})}),e.jsx("div",{className:s.formItem,children:e.jsx(p.Field,{rules:{required:a("AuthForm.Validation.LastNameRequired"),minLength:{value:3,message:a("AuthForm.Validation.LastNameMinLength")},maxLength:{value:50,message:a("AuthForm.Validation.LastNameMaxLength")}},name:"lastName",label:a("AuthForm.Labels.LastName"),children:e.jsx(_,{placeholder:a("AuthForm.Placeholders.LastName")})})})]}),(o.authFormView===t.SIGN_IN||o.authFormView===t.SIGN_UP||o.authFormView===t.FORGOT_PASSWORD)&&e.jsx(e.Fragment,{children:e.jsx("div",{className:s.formItem,children:e.jsx(p.Field,{rules:{required:a("AuthForm.Validation.EmailRequired"),pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:a("AuthForm.Validation.EmailInvalid")},minLength:{value:5,message:a("AuthForm.Validation.EmailMinLength")},maxLength:{value:50,message:a("AuthForm.Validation.EmailMaxLength")}},name:"email",label:a("AuthForm.Labels.Email"),children:e.jsx(_,{placeholder:a("AuthForm.Placeholders.Email")})})})}),(o.authFormView===t.SIGN_IN||o.authFormView===t.SIGN_UP||o.authFormView===t.CHANGE_PASSWORD)&&e.jsx("div",{className:s.formItem,children:e.jsx(p.Field,{rules:{required:a("AuthForm.Validation.PasswordRequired"),minLength:{value:8,message:a("AuthForm.Validation.PasswordMinLength")},pattern:{value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z\d]).{8,}$/,message:"Password must contain at least one uppercase letter,  one lowercase letter, one digit and one special character."}},name:"password",label:a("AuthForm.Labels.Password"),children:e.jsx(_,{className:s.passwordInput,type:"password",placeholder:a("AuthForm.Placeholders.Password")})})}),e.jsx("div",{className:s.forgotPasswordLink,children:o.authFormView===t.SIGN_IN&&e.jsx("span",{className:"she-text-link",onClick:()=>o.authFormViewChangeHandler(o.authFormView===t.SIGN_IN?t.FORGOT_PASSWORD:t.SIGN_IN),children:o.formStaticText.forgotPasswordLink})}),o.authFormView===t.CHANGE_PASSWORD&&e.jsx("div",{className:s.formItem,children:e.jsx(p.Field,{rules:{required:a("AuthForm.Validation.ConfirmPasswordRequired"),validate:(h,n)=>h===n.password||a("AuthForm.Validation.PasswordsDoNotMatch")},name:"confirmPassword",label:a("AuthForm.Labels.ConfirmPassword"),children:e.jsx(_,{type:"password",placeholder:a("AuthForm.Placeholders.ConfirmPassword")})})}),(o.authFormView===t.VERIFY_PHONE_NUMBER||o.authFormView===t.VERIFY_CODE)&&e.jsxs("div",{className:s.phoneInput,children:[e.jsx("span",{className:`${s.phoneNumberTitle} she-title`,children:a("AuthForm.Labels.PhoneNumber")}),e.jsxs("div",{className:s.phoneInputItems,children:[!l.hiddenPhoneNumber&&e.jsx("div",{className:s.formItem,children:e.jsx(Q,{control:c.control,name:"phoneCodeModel",rules:{required:a("AuthForm.Validation.CountryCodeRequired")},render:({field:h})=>{var n,I;return e.jsx(J,{className:s.countryCodeInput,children:e.jsxs(ee,{disabled:o.authFormView===t.VERIFY_CODE,onValueChange:f=>{const V=l.countryCode.find(L=>L.phoneCode===f);h.onChange(V)},value:o.authFormView===t.VERIFY_CODE?w:((n=h.value)==null?void 0:n.phoneCode)||"",children:[e.jsx(X,{children:e.jsx(te,{children:e.jsx(oe,{defaultValue:(I=l.countryCode[0])==null?void 0:I.phoneCode})})}),e.jsx(ae,{children:l.countryCode.map(f=>e.jsx(ne,{value:f.phoneCode,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:f.flagIcon}}),f.phoneCode]})},f.countryId))})]})})}})}),e.jsx("div",{className:s.formItem,style:l.hiddenPhoneNumber?{width:"100%"}:null,children:e.jsx(p.Field,{rules:l.hiddenPhoneNumber?null:{required:a("AuthForm.Validation.PhoneNumberRequired"),minLength:{value:8,message:a("AuthForm.Validation.PhoneNumberMinLength")},maxLength:{value:9,message:a("AuthForm.Validation.PhoneNumberMaxLength")}},name:"phoneNumber",label:l.hiddenPhoneNumber?a("AuthForm.Labels.PhoneNumber"):null,children:e.jsx(_,{disabled:o.authFormView===t.VERIFY_CODE,placeholder:o.authFormView===t.VERIFY_CODE?l.hiddenPhoneNumber?`Phone ending in ${l.hiddenPhoneNumber}`:C:a("AuthForm.Placeholders.PhoneNumber"),style:l.hiddenPhoneNumber?{marginTop:"10px"}:null})})}),!l.hiddenPhoneNumber&&e.jsx("div",{className:s.changePhoneNumber,children:e.jsx("span",{className:"she-text-link",onClick:()=>o.authFormViewChangeHandler(t.VERIFY_PHONE_NUMBER),children:o.formStaticText.changePhoneNumberLink})})]})]}),o.authFormView===t.VERIFY_CODE&&e.jsx("div",{className:s.formItem,children:e.jsx(p.Field,{rules:{required:a("AuthForm.Validation.VerificationCodeRequired"),minLength:{value:6,message:a("AuthForm.Validation.VerificationCodeLength")},maxLength:{value:6,message:a("AuthForm.Validation.VerificationCodeLength")}},name:"code",label:a("AuthForm.Labels.VerificationCode"),children:e.jsx(_,{type:"number",placeholder:a("AuthForm.Placeholders.VerificationCode")})})}),e.jsx("div",{className:s.formButton,children:e.jsx(p.Submit,{children:o.formStaticText.buttonText})})]})}),(o.authFormView===t.SIGN_IN||o.authFormView===t.SIGN_UP)&&e.jsxs("div",{className:s.facebookButtonBlock,children:[e.jsx("div",{className:s.authContentBorder,children:a("AuthForm.StaticText.Or")}),e.jsx(z,{variant:"outline",children:o.formStaticText.facebookButtonText})]})]})]}),e.jsxs("div",{className:`${s.footerText} ${l.isLoading?s.authPageLoading:""}`,children:[(o.authFormView===t.SIGN_IN||o.authFormView===t.SIGN_UP||o.authFormView===t.VERIFY_CODE||o.authFormView===t.FORGOT_PASSWORD)&&e.jsxs("span",{children:[o.formStaticText.footerText," "]}),e.jsx("span",{className:"she-text-link",onClick:S,children:o.formStaticText.footerLink})]})]})}export{He as default};
