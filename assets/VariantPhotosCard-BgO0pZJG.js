import{j as e,L as Ve,Q as De,e as f,V as He,W as ne,r as b,o as G,f as Y,s as ue,J as Me,K as ze,w as re,_ as Ke,D as Ge,ab as Ae}from"./index-DybU9lv3.js";import{i as me,e as he,F as pe,a as xe,b as Ce,u as $e}from"./form-CP3c_0ZX.js";import{a as ge,b as ke,c as je,d as Pe,S as Se}from"./select-BDB0m4xP.js";import{S as I,R as fe}from"./SheInput-CKzfybja.js";import{S as H}from"./SheGrid-DvAOS33I.js";import{S as R,a as Le}from"./SheForm-C58I0rY3.js";import{S as v}from"./SheCard-JWlyTss7.js";import{u as A,I as ye}from"./useAppTranslation-NlALFuCP.js";import{E as Oe,W as Ue,M as Ee,l as We,B as qe,I as Qe,R as Je,L as Ye}from"./SheContextSidebar-BKksk-en.js";import{P as V}from"./plus-Dv0aUE5j.js";import{o as Q,n as B,u as be,S as _e,a as D}from"./types-Cs0d5Ub-.js";import{S as J}from"./SheSelect-DkAtzaWK.js";import{c as ce}from"./she-select-convertors-CdG-Ygpu.js";import{S as Xe,C as Ze}from"./SheDatePicker-ByjOO6gI.js";import{C as es}from"./trash-CFfYG3xN.js";import{u as ss}from"./chevron-up-C7ChJr01.js";import{S as ts}from"./SheFileUploader-BAVOSjtG.js";import{p as Ne}from"./placeholder-image-BgG3Yd5d.js";const os="_variantConfigurationCard_p7gad_1",as="_variantConfigurationCardContent_p7gad_1",ns="_variantConfigurationForm_p7gad_12",rs="_variantCodeFormRow_p7gad_17",cs="_priceFormRow_p7gad_27",is="_priceFormRowItem_p7gad_31",ls="_stockDetailsBlock_p7gad_48",ds="_buttonBlock_p7gad_53",us="_stockDetailsTitle_p7gad_61",ms="_stockBlock_p7gad_64",hs="_stockBlockRow_p7gad_68",ps="_stockBlockRowNumber_p7gad_76",xs="_variantGridBlock_p7gad_79",Cs="_variantGridBlockHeader_p7gad_84",gs="_expandableRow_p7gad_90",ks="_expandableRowIcon_p7gad_96",js="_expandableRowText_p7gad_99",p={variantConfigurationCard:os,variantConfigurationCardContent:as,variantConfigurationForm:ns,variantCodeFormRow:rs,priceFormRow:cs,priceFormRowItem:is,stockDetailsBlock:ls,buttonBlock:ds,stockDetailsTitle:us,stockBlock:ms,stockBlockRow:hs,stockBlockRowNumber:ps,variantGridBlock:xs,variantGridBlockHeader:Cs,expandableRow:gs,expandableRowIcon:ks,expandableRowText:js},Ps=[{accessorKey:"optionColor",header:"Type",maxSize:100,minSize:100,cell:({row:a})=>e.jsx("span",{className:"she-text",children:a.original.optionColor===null?"Size":"Color"})},{accessorKey:"optionName",header:"Value",maxSize:150,minSize:150,cell:({row:a})=>e.jsx("div",{className:a.original.optionColor===null?"she-text":"",style:a.original.optionColor?{background:a.original.optionColor,width:"20px",height:"20px",borderRadius:"50%",alignSelf:"center"}:{alignSelf:"center"},children:a.original.optionColor===null?a.original.optionName:""})},{id:"traitName",header:"Name",minSize:100,cell:({row:a})=>e.jsx("div",{className:"she-text",children:a.original.traitName})}];function Ss({row:a,table:t,style:n,onAction:s}){const o=t.options.meta;return e.jsx("div",{style:n,children:e.jsxs(Ve,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(f,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(Oe,{}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(He,{align:"start",className:"w-[160px]",children:[e.jsx(ne,{onClick:()=>{queueMicrotask(()=>{s("detachFromVariant",a.id,o==null?void 0:o.setLoadingRow,a)})},children:"Detach photo"}),e.jsx(ne,{onClick:()=>{queueMicrotask(()=>{s("deletePhoto",a.id,o==null?void 0:o.setLoadingRow,a)})},children:"Delete photo"})]})]})})}const Te=a=>[{accessorKey:"thumbnailUrl",header:"Preview",minSize:80,maxSize:80,cell:({row:t,table:n})=>{const s=t.getValue("thumbnailUrl"),o=n.options.meta;return e.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>a("image",t.id,o==null?void 0:o.setLoadingRow),children:e.jsx("img",{src:s,alt:"photo",className:"object-cover rounded-md w-full h-full",onError:r=>{r.currentTarget.src=Ne}})})}},{accessorKey:"format",header:"Format",minSize:190,cell:({row:t})=>e.jsx("span",{className:"she-subtext",children:`${t.original.height}px x ${t.original.width}px`})},{id:"rowActions",header:"Actions",minSize:80,maxSize:80,cell:({row:t,table:n})=>e.jsx(Ss,{style:{paddingLeft:"30px"},row:t,onAction:a,table:n})}],ie=(a,t)=>{let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>a(...s),t)}};function Bt({isLoading:a,isVariantOptionsGridLoading:t,isVariantPhotoGridLoading:n,variant:s,variantPhotos:o,data:r,onAction:c,taxesList:u,productCounter:j,onGenerateProductCode:C,...P}){var Z,ee,se,te,oe;const[k,d]=b.useState({variantName:(s==null?void 0:s.variantName)||"",variantCode:(s==null?void 0:s.variantCode)||"",salePrice:{brutto:(Z=s==null?void 0:s.salePrice)==null?void 0:Z.brutto,netto:(ee=s==null?void 0:s.salePrice)==null?void 0:ee.netto,taxTypeId:((se=s==null?void 0:s.salePrice)==null?void 0:se.taxTypeId)||((te=u==null?void 0:u[0])==null?void 0:te.id)}}),{translate:m}=A(),h=Ps,S=Te(we),g=me({defaultValues:k}),{setValue:N,register:w,getValues:U}=g,$=Fe(s==null?void 0:s.traitOptions),X=b.useRef((s==null?void 0:s.variantId)||null),F=b.useRef(!1),M=b.useRef(null),E=b.useRef(ie(()=>{F.current&&g.handleSubmit(L)()},1500));b.useEffect(()=>{E.current&&(E.current=ie(()=>{F.current&&g.handleSubmit(L)()},1500))},[s==null?void 0:s.variantId]),b.useEffect(()=>{var i,l,y,_;if(X.current!==(s==null?void 0:s.variantId)){X.current=(s==null?void 0:s.variantId)||null;const K={variantName:(s==null?void 0:s.variantName)||"",variantCode:(s==null?void 0:s.variantCode)||"",salePrice:{brutto:(i=s==null?void 0:s.salePrice)==null?void 0:i.brutto,netto:(l=s==null?void 0:s.salePrice)==null?void 0:l.netto,taxTypeId:((y=s==null?void 0:s.salePrice)==null?void 0:y.taxTypeId)||((_=u==null?void 0:u[0])==null?void 0:_.id)}};d(K),g.reset(K),F.current=!1}},[s==null?void 0:s.variantId,s,u,g]);function Ie(){C().then(i=>{g.setValue("variantCode",i.code,{shouldDirty:!0}),F.current=!0,g.handleSubmit(L)()})}function z(){const i=U(),l=k;(i.variantName!==l.variantName||i.variantCode!==l.variantCode||i.salePrice.netto!==l.salePrice.netto||i.salePrice.brutto!==l.salePrice.brutto||i.salePrice.taxTypeId!==l.salePrice.taxTypeId)&&(F.current=!0,E.current())}function L(i){var ae;if(!F.current)return;let l=typeof i.salePrice.netto=="string"?Number(i.salePrice.netto):i.salePrice.netto||0,y=typeof i.salePrice.brutto=="string"?Number(i.salePrice.brutto):i.salePrice.brutto||0;const _=i.salePrice.taxTypeId,K=((ae=u.find(Re=>Re.id===_))==null?void 0:ae.value)??0;M.current==="netto"?y=+(l*(1+K)).toFixed(2):M.current==="brutto"&&(l=+(y/(1+K)).toFixed(2)),N("salePrice.netto",l,{shouldDirty:!1}),N("salePrice.brutto",y,{shouldDirty:!1});const ve={...i,salePrice:{netto:l,brutto:y,taxTypeId:_}};s&&c("updateVariantDetails",{formattedData:ve,variant:s}),d({variantName:i.variantName||"",variantCode:i.variantCode||"",salePrice:{netto:l,brutto:y,taxTypeId:_}}),F.current=!1}function we(i,l,y,_){c("detachPhotoFromVariant",_.original),c("deletePhoto",_.original)}function Fe(i){return(i==null?void 0:i.map(l=>{const y=[];return l.isRemoved&&y.push({id:`${l.id}-removed`,type:"removed",message:m("ValidationMessages.TraitOptionRemoved")}),l.isMissing&&y.push({id:`${l.id}-missing`,type:"missing",message:m("ValidationMessages.TraitOptionMissingConfiguration")}),{...l,expandableRows:y}}))||[]}function Be(i){return e.jsx("div",{children:i.original.expandableRows.map(l=>e.jsxs("div",{className:p.expandableRow,children:[e.jsx(Y,{maxWidth:"20px",minWidth:"20px",className:p.expandableRowIcon,icon:Le}),e.jsx("span",{className:p.expandableRowText,children:l.message})]},l.id))})}return e.jsx(v,{className:p.variantConfigurationCard,title:"Manage Variant",titleTransKey:"CardTitles.ManageVariant",showCloseButton:!0,isLoading:a,showNotificationCard:!0,notificationCardProps:{title:"Delete Variant",titleTransKey:"CardTitles.DeleteVariant",text:"This variant will be deleted, it will no longer be available for sale but you will still see it in the orders where it sold",textTransKey:"ConfirmationMessages.DeleteVariant",onClick:()=>c("deleteVariant",s)},onSecondaryButtonClick:()=>c("closeVariantConfigurationCard"),...P,children:e.jsxs("div",{className:p.variantConfigurationCardContent,children:[e.jsx("div",{className:p.variantConfigurationForm,children:e.jsxs(R,{form:g,onSubmit:L,children:[e.jsx(R.Field,{name:"variantName",children:e.jsx(I,{label:"Optional Variant Name",labelTransKey:"ProductForm.Labels.OptionalVariantName",fullWidth:!0,onDelay:z})}),e.jsxs("div",{className:p.variantCodeFormRow,children:[e.jsx(R.Field,{name:"variantCode",label:m("ProductForm.Labels.VariantCode"),children:e.jsx("div",{children:e.jsx(I,{value:s==null?void 0:s.variantCode,...w("variantCode",{}),onDelay:z})})}),e.jsx(f,{icon:Ue,type:"button",variant:"outline",onClick:Ie})]}),e.jsxs("div",{className:p.priceFormRow,children:[e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(R.Field,{label:m("ProductForm.Labels.SalePriceNetto"),name:"salePrice.netto",children:e.jsx(I,{type:"number",step:"any",...w("salePrice.netto",{onChange:()=>{M.current="netto",z()}})})})}),e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(he,{control:g.control,name:"salePrice.taxTypeId",render:({field:i})=>e.jsxs(pe,{children:[e.jsx(xe,{children:m("ProductForm.Labels.VAT")}),e.jsxs(ge,{onValueChange:l=>{i.onChange(Number(l)),M.current="netto",z()},value:i.value?i.value.toString():"",children:[e.jsx(Ce,{children:e.jsx(ke,{children:e.jsx(je,{placeholder:m("SelectOptions.SelectVAT")})})}),e.jsx(Pe,{children:u==null?void 0:u.map(l=>e.jsx(Se,{value:l.id.toString(),children:e.jsx("div",{children:l.name})},l.id))})]})]})})}),e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(R.Field,{label:m("ProductForm.Labels.SalePriceBrutto"),name:"salePrice.brutto",children:e.jsx(I,{type:"number",step:"any",...w("salePrice.brutto",{onChange:()=>{M.current="brutto",z()}})})})})]})]})}),e.jsx(G,{}),e.jsxs("div",{className:p.stockDetailsBlock,children:[e.jsxs("div",{className:p.buttonBlock,children:[e.jsx("span",{className:`${p.stockDetailsTitle} she-title`,children:m("SectionTitles.StockDetails")}),e.jsx(f,{value:"Add",valueTransKey:"CommonButtons.Add",icon:V,variant:"secondary",onClick:()=>c("openAddStockCard")}),e.jsx(f,{value:"Dispose",valueTransKey:"StockActions.Dispose",icon:Ee,variant:"secondary",maxWidth:"100px",minWidth:"100px",onClick:()=>c("openDisposeStockCard")}),e.jsx(f,{value:"History",valueTransKey:"CommonButtons.History",icon:We,variant:"secondary",maxWidth:"100px",minWidth:"100px",onClick:()=>c("openVariantHistoryCard",s.variantId)})]}),e.jsxs("div",{className:p.stockBlock,children:[e.jsxs("div",{className:p.stockBlockRow,children:[e.jsx("span",{className:"she-text",children:m("StockForm.Labels.CurrentlyInStock",{stockAmount:""})}),e.jsx("span",{className:p.stockBlockRowNumber,children:s==null?void 0:s.stockAmount})]}),e.jsxs("div",{className:p.stockBlockRow,children:[e.jsx("span",{className:"she-text",children:m("ProductForm.Labels.UnitsSold")}),e.jsx("span",{className:p.stockBlockRowNumber,children:s==null?void 0:s.soldUnits})]})]})]}),e.jsxs("div",{className:p.variantGridBlock,children:[e.jsxs("div",{className:p.variantGridBlockHeader,children:[e.jsx("span",{className:"she-title",children:m("ProductForm.Labels.VariantTraits")}),e.jsx(f,{value:"Manage",valueTransKey:"CommonButtons.Manage",icon:qe,variant:"secondary",onClick:()=>c("openManageTraitsCard")})]}),e.jsx("div",{children:e.jsx(H,{isLoading:t,showHeader:!1,columns:h,data:$,gridRequestModel:r,enableExpansion:!0,renderExpandedContent:Be})})]}),e.jsxs("div",{className:p.variantGridBlock,children:[e.jsxs("div",{className:p.variantGridBlockHeader,children:[e.jsx("span",{className:"she-title",children:m("ProductForm.Labels.VariantPhotos")}),e.jsx(f,{value:"Manage",valueTransKey:"CommonButtons.Manage",icon:Qe,variant:"secondary",onClick:()=>c("openVariantPhotosCard",s.variantId)})]}),((oe=s==null?void 0:s.photos)==null?void 0:oe.length)>0&&e.jsx("div",{children:e.jsx(H,{isLoading:n,enableDnd:!0,showHeader:!1,columns:S,data:o,gridRequestModel:r,skeletonQuantity:j==null?void 0:j.gallery,onNewItemPosition:(i,l)=>c("dndVariantPhoto",{newIndex:i,activeItem:l})})})]})]})})}const fs="_addStockCard_5bzk4_1",ys="_addStockCardContent_5bzk4_5",bs="_connectedPurchase_5bzk4_27",_s="_connectedPurchaseInfo_5bzk4_32",Ns="_connectedPurchaseHeader_5bzk4_37",Ts="_connectedPurchaseHeaderTitle_5bzk4_43",Is="_connectedPurchaseSupplier_5bzk4_48",ws="_supplierInfo_5bzk4_54",Fs="_supplierInfoDetails_5bzk4_78",Bs="_supplierInfoDetailsName_5bzk4_82",vs="_connectedPurchaseProductsSummary_5bzk4_85",Rs="_connectedPurchaseProductsSummaryTitle_5bzk4_92",Vs="_connectedPurchaseProductsSummaryHeaders_5bzk4_96",Ds="_connectedPurchaseProductsSummaryInfo_5bzk4_101",Hs="_unitsColumn_5bzk4_106",Ms="_expenseColumn_5bzk4_110",zs="_valueColumn_5bzk4_113",Ks="_purchaseDetails_5bzk4_116",Gs="_purchaseDetailsButtonBlock_5bzk4_121",As="_cardButtonBlock_5bzk4_130",x={addStockCard:fs,addStockCardContent:ys,connectedPurchase:bs,connectedPurchaseInfo:_s,connectedPurchaseHeader:Ns,connectedPurchaseHeaderTitle:Ts,connectedPurchaseSupplier:Is,supplierInfo:ws,supplierInfoDetails:Fs,supplierInfoDetailsName:Bs,connectedPurchaseProductsSummary:vs,connectedPurchaseProductsSummaryTitle:Rs,connectedPurchaseProductsSummaryHeaders:Vs,connectedPurchaseProductsSummaryInfo:Ds,unitsColumn:Hs,expenseColumn:Ms,valueColumn:zs,purchaseDetails:Ks,purchaseDetailsButtonBlock:Gs,cardButtonBlock:As},$s="_addStockForm_15e7x_1",Ls="_addStockFormRow_15e7x_7",le={addStockForm:$s,addStockFormRow:Ls},Os=Q({unitAmount:B().min(0,"Min value length 0"),priceModel:Q({price:B(),taxTypeId:B(),priceType:B().optional(),currencyId:B()})}),Us={unitAmount:void 0,priceModel:{price:void 0,taxTypeId:void 0,priceType:void 0,currencyId:void 0},purchaseId:void 0};function Es({taxTypes:a,currencyTypes:t,onChange:n}){const{form:s}=be({defaultValues:Us,scheme:Os,mode:fe.CHANGE});function o(r,c){setTimeout(()=>{n==null||n({unitsAmount:r.unitAmount,nettoPrice:r.priceModel.price,taxTypeId:r.priceModel.taxTypeId,currencyId:r.priceModel.currencyId},c)})}return e.jsxs(_e,{form:s,className:le.addStockForm,hideFooter:!0,onChange:o,children:[e.jsxs("div",{className:le.addStockFormRow,children:[e.jsx(D,{name:"priceModel.price",render:({field:r})=>e.jsx(I,{value:r.value,label:"Purchase Price",labelTransKey:"PurchaseForm.Labels.PurchasePrice",placeholder:"enter price netto...",type:"number",minWidth:"150px"})}),e.jsx(D,{name:"priceModel.currencyId",render:({field:r})=>e.jsx(J,{items:t,selected:r.value,label:"Currency",placeholder:" ",hideFirstOption:!0,minWidth:"140px"})}),e.jsx(D,{name:"priceModel.taxTypeId",render:({field:r})=>e.jsx(J,{items:a,selected:r.value,label:"VAT",placeholder:" ",hideFirstOption:!0,minWidth:"40px"})})]}),e.jsx(D,{name:"unitAmount",render:({field:r})=>e.jsx(I,{value:r.value,label:"Units",type:"number",placeholder:"enter unit amount...",fullWidth:!0})})]})}function vt({isLoading:a,variant:t,onAction:n,taxTypes:s,purchase:o,currencyTypes:r,...c}){var h,S,g,N;const[u,j]=b.useState(null),[C,P]=b.useState(void 0),{translate:k}=A();function d(w,U){var $;j(($=U.formState)==null?void 0:$.isValid),P(w)}function m(){const w={priceModel:{variantId:t.variantId,unitsAmount:C.unitsAmount,nettoPrice:C.nettoPrice,taxTypeId:C.taxTypeId,currencyId:C.currencyId},purchaseId:Number(o.purchaseId)};n("increaseStockAmount",w)}return e.jsx(v,{className:x.addStockCard,title:"Add product to stock",titleTransKey:"StockActions.AddProductToStock",description:`${k("SectionTitles.Product")}: "${t==null?void 0:t.variantName}"`,isLoading:a,showCloseButton:!0,showFooter:!1,onSecondaryButtonClick:()=>n("closeAddStockCard"),...c,children:e.jsxs("div",{className:x.addStockCardContent,children:[e.jsx(Es,{currencyTypes:ce(r,{text:"name",value:"id"}),taxTypes:ce(s,{text:"name",value:"id"}),onChange:d}),e.jsx(G,{}),o?e.jsxs("div",{className:x.connectedPurchase,children:[e.jsxs("div",{className:x.connectedPurchaseInfo,children:[e.jsxs("div",{className:x.connectedPurchaseHeader,children:[e.jsxs("div",{className:x.connectedPurchaseHeaderTitle,children:[e.jsx("span",{className:"she-title",children:"Connected Purchase"}),e.jsxs("span",{className:"she-subtext",children:["If this is not the right purchase :"," "]})]}),e.jsx(f,{icon:Je,variant:"secondary",value:"Replace Purchase",onClick:()=>n("openSelectPurchaseCard")})]}),e.jsxs("div",{className:x.connectedPurchaseSupplier,children:[e.jsxs("div",{className:x.supplierInfo,children:[e.jsx("div",{style:{width:"100%",maxWidth:"40px"},children:(h=o.supplier)!=null&&h.thumbnailUrl?e.jsx("img",{src:(S=o.supplier)==null?void 0:S.thumbnailUrl,alt:((g=o.supplier)==null?void 0:g.supplierName)||"Supplier"}):e.jsx(Y,{icon:ye})}),e.jsxs("div",{className:x.supplierInfoDetails,children:[e.jsx("span",{className:x.supplierInfoDetailsName,children:(N=o.supplier)==null?void 0:N.supplierName}),e.jsx("span",{className:"she-text",children:ue(o.date,"date")})]})]}),e.jsx(f,{icon:Ye,variant:"ghost",value:"Purchase Details",txtColor:"#007AFF"})]})]}),e.jsxs("div",{className:x.connectedPurchaseProductsSummary,children:[e.jsx("span",{className:x.connectedPurchaseProductsSummaryTitle,children:"Products in purchase summary"}),e.jsx(G,{}),e.jsxs("div",{className:x.connectedPurchaseProductsSummaryHeaders,children:[e.jsx("span",{children:"Units"}),e.jsx("span",{children:"Expense"}),e.jsx("span",{children:"Projected value"})]}),e.jsx(G,{}),e.jsxs("div",{className:x.connectedPurchaseProductsSummaryInfo,children:[e.jsx("div",{className:x.unitsColumn,children:e.jsx("span",{children:o.unitsAmount})}),e.jsx("div",{className:x.expenseColumn,children:e.jsx("span",{children:`${o.expense} ${o.currencyBrief}`})}),e.jsx("div",{className:x.valueColumn,children:e.jsx("span",{children:`${o.orderValueAmount} ${o.currencyBrief}`})})]})]})]}):e.jsxs("div",{className:x.purchaseDetails,children:[e.jsx("span",{className:"she-title",children:"Purchase Details"}),e.jsx("span",{className:"she-text",children:"If you want to be able to track this stock change in the purchase section, please select the purchase this change is connected to."}),e.jsxs("div",{className:x.purchaseDetailsButtonBlock,children:[e.jsx(f,{icon:V,variant:"secondary",value:"Select Purchase",onClick:()=>n("openSelectPurchaseCard")}),e.jsx("span",{className:"she-text",children:"or"}),e.jsx(f,{icon:V,variant:"secondary",value:"Report Purchase",onClick:()=>n("openSupplierCard")})]})]}),e.jsx(G,{}),e.jsxs("div",{className:x.cardButtonBlock,children:[e.jsx(f,{icon:V,variant:"secondary",value:"Cancel",onClick:()=>n("closeAddStockCard")}),e.jsx(f,{icon:V,variant:"info",value:"Add to Stock",disabled:!o||!u,onClick:m})]})]})})}const Ws="_selectPurchaseCardContent_32tmq_1",qs={selectPurchaseCardContent:Ws},Qs="_iconCheck_1wa1s_1",Js={iconCheck:Qs};function Ys({onAction:a}){return[{id:"select",header:"Select",minSize:58,maxSize:58,cell:({row:t,table:n})=>{const s=n.options.meta;return e.jsx("div",{onClick:o=>o.stopPropagation(),children:e.jsx(f,{className:t.original.isSelected===!0?Js.iconCheck:"",icon:t.original.isSelected===!0?Me:ze,variant:"ghost",onClick:()=>a("selectPurchase",t.original),disabled:s==null?void 0:s.isRowLoading(t.id)})})}},{id:"Purchase",header:"Purchase",minSize:200,cell:({row:t})=>{var c,u,j;const n=(c=t.original.supplier)==null?void 0:c.thumbnailUrl,s=(u=t.original.supplier)==null?void 0:u.supplierName,o=(j=t.original.location)==null?void 0:j.address,r=t.original.date;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",width:"100%"},children:[e.jsx("div",{style:{width:"100%",maxWidth:"40px"},children:n?e.jsx("img",{src:n,alt:s||"Supplier",className:"object-cover rounded-md w-full h-full",style:{width:"100%"}}):e.jsx(Y,{icon:ye})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsx(re,{delayDuration:200,text:s,className:"max-w-[calc(240px)] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-text",children:s})}),o&&e.jsx(re,{delayDuration:200,text:o,className:"max-w-[calc(240px)] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-subtext",children:o})}),r&&e.jsx("span",{className:"she-text",children:ue(r,"date")})]})]})}}]}function Rt({isLoading:a,isGridLoading:t,purchases:n,onAction:s}){return e.jsx(v,{title:"Select Purchase",showCloseButton:!0,isLoading:a,onSecondaryButtonClick:()=>s("closeSelectPurchaseCard"),children:e.jsxs("div",{className:qs.selectPurchaseCardContent,children:[e.jsx(I,{isSearch:!0,fullWidth:!0,showClearBtn:!0,placeholder:"Search supplier...",onDelay:o=>s("searchSupplier",o),onClear:()=>s("searchSupplier",null)}),e.jsx(Xe,{mode:Ze.RANGE,icon:es,fullWidth:!0,showClearBtn:!0,placeholder:"Pick purchase date range",onSelectDate:o=>{s("filterSuppliersByDate",o?{dateFrom:o.from,dateTo:o.to}:{})},onClear:()=>{s("filterSuppliersByDate",null)}}),e.jsx(H,{isLoading:t,showHeader:!1,columns:Ys({onAction:s}),data:n,skeletonQuantity:10})]})})}const Xs={},de="field is required",Zs=Q({unitAmount:B({required_error:de}).min(0,"min value length 0"),reason:B({required_error:de})}),W=[{value:1,text:"Damaged",textTransKey:"StockForm.Labels.Damaged"},{value:2,text:"Lost",textTransKey:"StockForm.Labels.Lost"},{value:3,text:"Broken",textTransKey:"StockForm.Labels.Broken"}];function Vt({isLoading:a,variant:t,onAction:n,onSecondaryButtonClick:s,...o}){const{translate:r}=A(),c={reason:W[0].value,unitAmount:0},{form:u}=be({defaultValues:c,scheme:Zs,mode:fe.CHANGE}),j=$e({control:u.control,name:"unitAmount"});function C(P){const k={...P,unitAmount:Number(P.unitAmount)};n==null||n("disposeFromStock",{variant:t,formattedData:k})}return e.jsx(v,{className:Xs.disposeStockCard,title:`${r("StockActions.Dispose")} ${t==null?void 0:t.variantName} ${r("SectionTitles.Product")}`,isLoading:a,showCloseButton:!0,showFooter:!0,primaryButtonTitle:"Dispose",primaryButtonTitleTransKey:"StockActions.Dispose",primaryButtonDisabled:!u.formState.isValid||Ke.isEqual(c,u.getValues())||Number(j)>Number(t==null?void 0:t.stockAmount),onPrimaryButtonClick:u.handleSubmit(C),onSecondaryButtonClick:s,...o,children:e.jsxs(_e,{form:u,text:r("StockForm.Labels.CurrentlyInStock",{stockAmount:(t==null?void 0:t.stockAmount)||0},"Currently in stock"),headerPosition:Ge.LEFT,hideFooter:!0,children:[e.jsx(D,{name:"unitAmount",render:({field:P})=>e.jsx(I,{value:P.value,label:"Units",labelTransKey:"PurchaseForm.Labels.Units",placeholder:"enter amount of units...",placeholderTransKey:"PurchaseForm.Placeholders.Units",min:0,errorMessage:j>(t==null?void 0:t.stockAmount)&&"You try to dispose more units the you have in stock",type:"number",fullWidth:!0})}),e.jsx(D,{name:"reason",render:({field:P})=>e.jsx(J,{items:W,selected:P.value||W[0].value,label:"Reason",labelTransKey:"StockForm.Labels.Reason",fullWidth:!0,hideFirstOption:!0})})]})})}const et="_stockHistoryCard_10pfr_1",st="_stockHistoryCardContent_10pfr_1",tt="_stockHistoryGrid_10pfr_1",q={stockHistoryCard:et,stockHistoryCardContent:st,stockHistoryGrid:tt},ot=[{accessorKey:"amountUnit",header:"Units",minSize:60,maxSize:60,cell:({row:a})=>e.jsx("span",{className:"she-text",children:a.original.amountUnit})},{accessorKey:"actionType",header:"Action",minSize:100,maxSize:100,cell:({row:a})=>e.jsx("span",{className:"she-text",children:a.original.actionType})},{id:"createdDate",header:"Date",minSize:100,maxSize:100,cell:({row:a})=>e.jsx("span",{className:"she-text",children:a.original.createdDate})},{id:"status",header:"Status",minSize:100,cell:({row:a})=>e.jsx("span",{className:"she-text",children:e.jsx("span",{className:"she-text",children:`${a.original.stockDocument.DocumentType} ${a.original.stockDocument.DocumentId}`})})}];function Dt({isLoading:a,isGridLoading:t,variant:n,data:s,onAction:o,...r}){const{translate:c}=A();return e.jsx(v,{className:q.stockHistoryCard,title:c("CardTitles.StockHistory",{variantName:n==null?void 0:n.variantName}),showCloseButton:!0,showFooter:!0,isLoading:a,showPrimaryButton:!1,secondaryButtonTitle:"CLOSE",onSecondaryButtonClick:()=>o("closeVariantHistoryCard"),...r,children:e.jsx("div",{className:q.stockHistoryCardContent,children:e.jsx("div",{className:q.stockHistoryGrid,children:e.jsx(H,{isLoading:t,showHeader:!1,columns:ot,data:s})})})})}const at="_manageTraitsCard_1tjgt_1",nt="_manageTraitsCardContent_1tjgt_1",rt="_manageTraitsCardForm_1tjgt_1",O={manageTraitsCard:at,manageTraitsCardContent:nt,manageTraitsCardForm:rt};function Ht({isLoading:a,traits:t,variant:n,onAction:s,onSecondaryButtonClick:o,...r}){const{t:c}=ss(),u=(n==null?void 0:n.traitOptions)||[],j=t.reduce((d,m)=>{var S;const h=u.find(g=>g.traitName===m.traitName&&g.optionId!==null);return{...d,[m.traitId]:((S=h==null?void 0:h.optionId)==null?void 0:S.toString())||""}},{}),C=me({defaultValues:j}),P=Object.values(C.watch()).some(d=>!d);b.useEffect(()=>{if(n!=null&&n.traitOptions){const d=t.reduce((m,h)=>{var g;const S=u.find(N=>N.traitName===h.traitName&&N.optionId!==null);return{...m,[h.traitId]:((g=S==null?void 0:S.optionId)==null?void 0:g.toString())||""}},{});Object.entries(d).forEach(([m,h])=>{C.setValue(m,h)})}},[n,t,u]);function k(d){const h={options:Object.values(d).filter(S=>S!=="").map(S=>Number(S))};s("updateVariantTraitOptions",{variant:n,submissionData:h})}return e.jsx(v,{className:O.manageTraitsCard,title:"Manage Traits",titleTransKey:"CardTitles.ManageTraits",showCloseButton:!0,isLoading:a,showFooter:!0,primaryButtonProps:{value:"Save Changes",valueTransKey:"CommonButtons.SaveChanges",variant:"info",icon:Ae,disabled:P},secondaryButtonTitle:"Cancel",secondaryButtonTitleTransKey:"CommonButtons.Cancel",onPrimaryButtonClick:C.handleSubmit(k),onSecondaryButtonClick:o,...r,children:e.jsxs("div",{className:O.manageTraitsCardContent,children:[e.jsx("div",{className:O.manageTraitsCardTextBlock,children:e.jsx("span",{className:"she-text",children:c("ProductForm.Labels.SelectTraitOptionsForVariant")})}),e.jsx("div",{children:e.jsx(R,{form:C,onSubmit:k,children:e.jsx("div",{className:O.manageTraitsCardForm,children:t.map(d=>e.jsx(he,{control:C.control,name:d.traitId.toString(),render:({field:m})=>e.jsxs(pe,{children:[e.jsx(xe,{children:d.traitName}),e.jsxs(ge,{onValueChange:m.onChange,value:m.value||"",children:[e.jsx(Ce,{children:e.jsx(ke,{children:e.jsx(je,{placeholder:c("ProductForm.Placeholders.SelectTraitType",{traitType:d.traitTypeName.toLowerCase()})})})}),e.jsx(Pe,{children:d.traitOptions.map(h=>e.jsx(Se,{value:h.optionId.toString(),children:d.traitTypeId===2?e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{style:{width:"20px",height:"20px",background:(h==null?void 0:h.optionColor)||"#ccc",marginRight:"8px",borderRadius:"2px"}}),h.optionName]}):h.optionName},h.optionId))})]})]})},d.traitId))})})})]})})}const ct="_variantPhotosCard_35wfr_1",it="_variantPhotosCardContent_35wfr_1",lt="_managePhotos_35wfr_9",dt="_managePhotosTitle_35wfr_14",ut="_managePhotosGrid_35wfr_17",T={variantPhotosCard:ct,variantPhotosCardContent:it,managePhotos:lt,managePhotosTitle:dt,managePhotosGrid:ut},mt=a=>[{accessorKey:"thumbnailUrl",header:"Preview",minSize:80,maxSize:80,cell:({row:t,table:n})=>{const s=t.getValue("thumbnailUrl"),o=n.options.meta;return e.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>a("image",t.id,o==null?void 0:o.setLoadingRow),children:e.jsx("img",{src:s,alt:"photo",className:"object-cover rounded-md w-full h-full",onError:r=>{r.currentTarget.src=Ne}})})}},{accessorKey:"format",header:"Format",minSize:235,cell:({row:t})=>e.jsx("span",{className:"she-subtext",children:`${t.original.height}px x ${t.original.width}px`})},{id:"rowActions",header:"",minSize:55,maxSize:55,cell:({row:t})=>e.jsx(f,{icon:V,variant:"secondary",onClick:()=>a("addToVariant",t.id,void 0,t)})}];function Mt({isLoading:a,isVariantPhotoGridLoading:t,isProductPhotoGridLoading:n,variantPhotos:s,productPhotos:o,contextId:r,onAction:c,...u}){const{translate:j}=A();function C(k,d){switch(k){case"image":c("image",d);break;case"upload":c("uploadPhotoToVariant",d);break;case"delete":c("delete",d);break;case"detachFromVariant":c("detachPhotoFromVariant",d);break;case"addToVariant":c("addPhotoToVariant",d);break;case"dnd":const{newIndex:m,activeItem:h}=d;c("dndVariantPhoto",{newIndex:m,activeItem:h});break}}function P(k,d,m,h){switch(k){case"detachFromVariant":C("detachFromVariant",h.original);break;case"addToVariant":C("addToVariant",h.original);break}}return e.jsx(v,{className:T.variantPhotosCard,title:"Manage Photos",titleTransKey:"CardTitles.ManagePhotos",isLoading:a,showCloseButton:!0,showFooter:!1,onSecondaryButtonClick:()=>c("closeVariantPhotosCard"),...u,children:e.jsxs("div",{className:T.variantPhotosCardContent,children:[e.jsx(ts,{contextName:"variant",contextId:r,onUpload:k=>C("upload",k)}),e.jsxs("div",{className:T.managePhotos,children:[e.jsx("div",{className:`${T.managePhotosTitle} she-title`,children:e.jsx("span",{className:"she-title",children:j("ProductForm.Labels.VariantPhotos")})}),e.jsx("div",{className:T.managePhotosGrid,children:e.jsx(H,{isLoading:t,enableDnd:!0,showHeader:!1,columns:Te(P),data:s,gridRequestModel:s,customMessage:"VARIANT HAS NO PHOTO",customMessageTransKey:"ProductMessages.NoVariantPhotos",onNewItemPosition:(k,d)=>C("dnd",{newIndex:k,activeItem:d})})})]}),e.jsxs("div",{className:T.managePhotos,children:[e.jsx("div",{className:`${T.managePhotosTitle} she-title`,children:e.jsx("span",{className:"she-title",children:j("ProductForm.Labels.OtherProductPhotos")})}),e.jsx("div",{className:T.managePhotosGrid,children:e.jsx(H,{isLoading:n,enableDnd:!1,showHeader:!1,showColumnsHeader:!1,columns:mt(P),data:o,customMessage:!s&&!o?"PRODUCT HAS NO PHOTO":"All product photos are already attached to the variant.",customMessageTransKey:!s&&!o?"ProductMessages.NoPhotos":"ProductMessages.AllPhotosAttachedToVariant",gridRequestModel:o})})]})]})})}export{vt as A,Vt as D,Ht as M,Rt as S,Bt as V,Dt as a,Mt as b};
