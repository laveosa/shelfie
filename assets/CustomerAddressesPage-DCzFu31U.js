import{a as L,S as P,p as K,ae as g,U as b,q as O,E as Q,b as $,aj as d,al as k,l as W,j as a,z as D,k as R,B as Y,r as G,H as J,a3 as X,am as Z}from"./index-CqLEDb0h.js";import{G as ee,a as se}from"./GridSortingEnum-Qa64oiYF.js";import{A as re}from"./AddressForm-Dn6PYovg.js";import{c as te,a as M,C as de}from"./CustomerAddressCard-DS9bKXaZ.js";import{u as oe}from"./useToast-BWT7QgMZ.js";import{S as ae}from"./SheCard-CX5qtFRW.js";import{S as ne}from"./SheGrid-Fci2HgNW.js";import{u as ue}from"./useAppTranslation-CsMEigHw.js";import{P as ie}from"./plus-Cg_Vlo1I.js";import{S as ce}from"./SheContextSidebar-CL4FXvtg.js";import"./types-TQ-jcydJ.js";import"./form-BPwqqXcv.js";import"./SheInput-DbpOA7IC.js";import"./ComponentViewEnum-Ba6F4129.js";import"./SheSelect-C_zn2LY0.js";import"./select-DL5f33uf.js";import"./chevron-up-DLJ1s3UP.js";import"./she-select-convertors-CdG-Ygpu.js";import"./SheCardNotification-BVOYMQJ2.js";import"./settings-2-BKZv0M77.js";import"./folder-up-D4AQ9V_0.js";import"./trash-Czml7Fyd.js";const le={};function me(){const e=L(P.CUSTOMERS),t=L(P.APP),r=K(),[m]=g.useUpdateCustomerAddressMutation(),[C]=g.useCreateCustomerAddressMutation(),[u]=g.useLazyGetCustomerAddressDetailsQuery(),[f]=g.useDeleteCustomerAddressMutation(),[p]=g.useGetCustomerAddressesForGridMutation(),[H]=b.useUpdateUserPreferencesMutation(),[y]=b.useResetUserPreferencesMutation(),[S]=O.useLazyGetCountryCodeQuery(),[v]=g.useLazyGetCustomerInfoQuery(),{customerId:n}=Q(),{addToast:i}=oe(),A=$();function x(s){return r(d.setIsCustomerAddressesLoading(!0)),p({model:s,id:Number(n)}).then(o=>{if(r(d.setIsCustomerAddressesLoading(!1)),!o.error){const c=o.data.items.filter(l=>!l.isDeleted);r(d.refreshCustomerAddressesGridRequestModel(o.data)),r(d.refreshCustomerAddresses(c))}return o})}function U(s){const o=te(s.alias,s.addressLine1,s.addressLine2,s.city,s.state,s.postalCode,s.countryId);return s.addressId?w(o):z(o)}function w(s){const o=M(s);return r(d.setIsCustomerAddressDetailsLoading(!0)),m({id:e.selectedCustomerAddressId,model:o}).then(c=>{if(r(d.setIsCustomerAddressDetailsLoading(!1)),!c.error){const l=e.customerAddresses.map(h=>h.addressId===e.selectedCustomerAddressId?c.data:h);return r(d.refreshCustomerAddresses(l)),I(),i({text:"Customer address updated successfully",type:"info"}),c.data}})}function z(s){const o=M(s);return r(d.setIsCustomerAddressDetailsLoading(!0)),C({id:Number(n),model:o}).then(c=>{if(r(d.setIsCustomerAddressDetailsLoading(!1)),!c.error){i({text:"New customer address created successfully",type:"info"});const l=[c.data,...e.customerAddresses];return I(),r(d.refreshCustomerAddresses(l)),c.data}})}function N(s){const o=e.customerAddresses.find(l=>l.addressId===s),c=e.customerAddresses.filter(l=>l.addressId!==s);return r(d.refreshCustomerAddresses(k(c))),I(),f(s).then(l=>{if(l.error){if(o&&!e.customerAddresses.some(h=>h.addressId===o.addressId)){const h=[...e.customerAddresses,o];r(d.refreshCustomerAddresses(k(h)))}i({text:"Failed to delete customer address",type:"error"});return}else return i({text:"Customer address deleted successfully",type:"info"}),l.data})}function T(s){return u(s).then(o=>o.data)}function q(s){r(d.setCreateCustomerAddress(!1)),r(d.refreshSelectedCustomerAddress(s)),r(d.refreshSelectedCustomerAddressId(s.addressId))}function I(){r(d.refreshActiveCards([])),r(d.refreshSelectedCustomerAddressId(null)),r(d.refreshSelectedCustomerAddress(null))}function B(){r(d.setCreateCustomerAddress(!0)),r(d.refreshSelectedCustomerAddress(re)),r(d.refreshSelectedCustomerAddressId(null))}function E(){return S(null).then(s=>(s.data&&r(d.refreshCountryList(s.data)),s))}function F(s){return v(s).then(o=>{const c=o.data;return r(d.refreshCustomerCounter(c)),o.data})}function _(s){const o=W.merge({},t.preferences,s);return H(o).then(()=>{A.getUserPreferencesHandler()})}function V(s){return y(s).then(()=>{A.getUserPreferencesHandler()})}return{state:e,appState:t,actions:d,customerId:n,dispatch:r,getCustomerAddressDetailsHandler:T,deleteCustomerAddressHandler:N,getCustomerAddressesForGridHandler:x,onManageCustomerAddressHandler:q,onCloseCustomerAddressCardHandler:I,onCreateCustomerAddressHandler:B,getCountryCodeHandler:E,resolveCustomerAddressData:U,getCustomerInfoHandler:F,updateUserPreferencesHandler:_,resetUserPreferencesHandler:V}}const Ce="_customerAddressesCard_1kinp_1",Ae="_customerAddressesCardHeader_1kinp_1",pe="_headerButtonBlock_1kinp_6",j={customerAddressesCard:Ce,customerAddressesCardHeader:Ae,headerButtonBlock:pe};function fe(e){return[{accessorKey:"addressId",header:"ID",minSize:60,maxSize:60},{id:"alias",accessorFn:t=>t.alias,header:"Alias",minSize:150,cell:({row:t})=>a.jsx("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:a.jsx("div",{children:a.jsx(D,{delayDuration:200,text:t.getValue("alias"),className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap",children:a.jsx("span",{children:t.getValue("alias")})})})})},{accessorKey:"city",header:"City",minSize:100,cell:({row:t})=>a.jsx(D,{delayDuration:200,text:t.original.city,className:"max-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap",children:a.jsx("span",{children:t.original.city})})},{accessorKey:"addressLine1",header:"Address",minSize:100,cell:({row:t})=>a.jsx(D,{delayDuration:200,text:t.getValue("addressLine1"),className:"max-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap",children:a.jsx("span",{children:t.getValue("addressLine1")})})},{accessorKey:"postalCode",header:"Postal Code",minSize:120,maxSize:120,cell:({row:t})=>a.jsx("span",{children:t.getValue("postalCode")})},{id:"manage",header:"",minSize:120,maxSize:120,cell:({row:t,table:r})=>{const m=r.options.meta,C=u=>{u.stopPropagation(),u.preventDefault(),e("manageCustomerAddress",t.original)};return a.jsx("div",{onClick:u=>u.stopPropagation(),children:a.jsx(R,{icon:Y,variant:"secondary",onClick:C,disabled:m==null?void 0:m.isRowLoading(t.id),children:"Manage"})})}}]}function he({isLoading:e,onAction:t,addresses:r,gridRequestModel:m,sortingOptions:C,preferences:u}){const{translate:f}=ue();return a.jsxs(ae,{className:j.customerAddressesCard,minWidth:"850px",showHeader:!1,children:[a.jsxs("div",{className:j.customerAddressesCardHeader,children:[a.jsx("div",{className:"she-title",children:f("CardTitles.CustomerAddresses")}),a.jsx("div",{className:j.headerButtonBlock,children:a.jsx(R,{value:"Create Address",valueTransKey:"CustomerActions.CreateAddress",icon:ie,variant:"default",onClick:()=>t("createCustomerAddress")})})]}),a.jsx(ne,{isLoading:e,columns:fe(t),data:r,gridRequestModel:m,sortingItems:C,columnsPreferences:u,preferenceContext:"productReferences",skeletonQuantity:3,onApplyColumns:p=>t("applyColumns",p),onDefaultColumns:()=>t("resetColumns"),onGridRequestChange:p=>t("getCustomerAddressesForGrid",p)})]})}function Be(){var v;const{state:e,appState:t,actions:r,customerId:m,dispatch:C,...u}=me(),f=G.useRef({}),{openConfirmationDialog:p}=J(),H=Object.values(ee).map(n=>({value:n,description:se[n]}));G.useEffect(()=>{var n,i;u.getCustomerAddressesForGridHandler(e.customerAddressesGridRequestModel),((n=e.countryList)==null?void 0:n.length)===0&&u.getCountryCodeHandler(),((i=e.customerCounter)==null?void 0:i.addressesAmount)===void 0&&m&&u.getCustomerInfoHandler(Number(m))},[]);function y(n,i){let A;switch(i){case"open":A=e.activeCards.includes(n)?e.activeCards:[...e.activeCards,n];break;case"close":A=e.activeCards.filter(x=>x!==n);break;case"toggle":default:A=e.activeCards.includes(n)?e.activeCards.filter(x=>x!==n):[...e.activeCards,n];break}Z(f.current,n),C(r.refreshActiveCards(A))}async function S(n,i){switch(n){case"manageCustomerAddress":u.onManageCustomerAddressHandler(i),y("customerAddressCard","open"),C(r.refreshCustomerAddresses(X(i.addressId,e.customerAddresses,"addressId")));break;case"deleteCustomerAddress":if(!await p({headerTitle:"Deleting customer address",text:`You are about to delete customer address ${i.alias}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"}))return;u.deleteCustomerAddressHandler(i);break;case"createCustomerAddress":u.onCreateCustomerAddressHandler(),y("customerAddressCard","open");break;case"getCustomerAddressesForGrid":u.getCustomerAddressesForGridHandler(i);break;case"closeCustomerAddressCard":u.onCloseCustomerAddressCardHandler(),C(r.refreshCustomerAddresses(k(e.customerAddresses)));break;case"submitCustomerAddressData":u.resolveCustomerAddressData(i);break;case"applyColumns":u.updateUserPreferencesHandler(i);break;case"resetColumns":u.resetUserPreferencesHandler("products");break}}return a.jsx("div",{id:"CustomerAddressesPage",className:le.customerAddressesPage,children:a.jsxs(ce,{menuCollectionType:"customer",menuTitle:"Customer",counter:e.customerCounter,itemId:Number(m),activeCards:e.activeCards,children:[a.jsx(he,{isLoading:e.isCustomerAddressesLoading,addresses:e.customerAddresses,gridRequestModel:e.customerAddressesGridRequestModel,preferences:t.preferences,onAction:S,sortingOptions:H}),((v=e.activeCards)==null?void 0:v.includes("customerAddressCard"))&&a.jsx("div",{ref:n=>{f.current.customerAddressCard=n},children:a.jsx(de,{isLoading:e.isCustomerAddressDetailsLoading,customerAddress:e.selectedCustomerAddress,countryList:e.countryList,onAction:S})})]})})}export{Be as CustomerAddressesPage};
