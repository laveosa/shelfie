import{t as je,z as Ne,n as O,S as L,B as Qe,E as o,k as Ve,a3 as we,H as G,a9 as t,N as q,y as Ue,r as ze,j as p}from"./index-BShB5fhp.js";import{u as Be}from"./useCardActions-Btvxmtw2.js";import{c as _e,a as F,C as $e}from"./CustomerAddressCard-vzUb6bfO.js";import{u as We}from"./useToast-CdMBstYU.js";import{c as x,C as Ye}from"./CustomerCard-CxvNj3B3.js";import{b as Je,c as Ke,d as Xe}from"./SelectOrderForShipmentCard-qn0MBEKH.js";import{S as Ze}from"./SheContextSidebar-BCLuoTkA.js";import{S as et}from"./SelectEntityCard-BeInK5mT.js";import{C as tt}from"./CustomersListGridColumns-DKcX1UBF.js";import"./AddressForm-BOzU4MIv.js";import"./types-mtm9cZvm.js";import"./form-CHktgBl9.js";import"./SheInput-c5Qiy30C.js";import"./useAppTranslation-zSXCVuIB.js";import"./chevron-up-Drj9YO3e.js";import"./ComponentViewEnum-Ba6F4129.js";import"./SheSelect-Bk-ryUsW.js";import"./select-C7cYjRvE.js";import"./plus-CHP6QOSb.js";import"./SheCard-B6vQIC0s.js";import"./SheCardNotification-D3N47frH.js";import"./she-select-convertors-CdG-Ygpu.js";import"./SheDatePicker-2fKvD8lZ.js";import"./settings-2-gwc_wogu.js";import"./SheGrid-CbfBzlki.js";import"./GridSortingEnum-Qa64oiYF.js";import"./GridDateRangeFilter-DA6xMva2.js";import"./trash-BKRTX9MF.js";import"./folder-up-BdkQKupl.js";const rt={};function st(c){const e=je(),f=Ne(),{addToast:i}=We(),r=O(L.SHIPMENT_DETAILS),S=O(L.ORDERS),{openConfirmationDialog:C}=Qe(),[y]=o.useCreateShipmentMutation(),[v]=o.useUpdateShipmentDatesMutation(),[g]=o.useUpdateShipmentCustomerMutation(),[H]=o.useUpdateShipmentAddressMutation(),[I]=o.useGetListOfCustomersForGridMutation(),[M]=o.useConnectShipmentToOrderMutation(),[k]=o.useLazyGetShipmentDetailsQuery(),[A]=o.useDisconnectOrderFromShipmentMutation(),[u]=o.useRemoveVariantFromShipmentMutation(),[T]=o.useConfirmPackedProductsMutation(),[D]=o.useGetCustomerAddressesForGridMutation(),[E]=o.useLazyGetCustomerDetailsQuery(),[P]=o.useCreateCustomerMutation(),[j]=o.useUpdateCustomerMutation(),[N]=Ve.useLazyGetCountryCodeQuery(),[Q]=o.useUpdateCustomerAddressMutation(),[V]=o.useCreateCustomerAddressMutation(),[R]=o.useGetListOfOrdersForGridMutation(),[w]=o.useAddOrderToShipmentMutation(),[U]=o.useAddShipmentStockActionWithQuantityMutation(),[z]=o.useIncreaseShipmentStockActionMutation(),[B]=o.useDecreaseShipmentStockActionMutation(),[_]=o.useAddAllStockActionsToPackageMutation(),[$]=o.useAddVariantToShipmentMutation(),[W]=o.useCancelShipmentMutation(),[Y]=o.useReturnShipmentStatusToPreviousMutation(),[J]=we.useLazyGetDeliveryServicesListQuery(),[K]=o.useConfirmDeliveryDataMutation();function X(d){return c("selectEntityCard",!0),I(d).then(s=>{const n=s.data.items.map(a=>{var m,h;const l=r.activeCardForCustomers==="shipmentConfigurationCard"?(m=r.selectedShipment)==null?void 0:m.customerId:(h=r.selectedCustomer)==null?void 0:h.customerId;return{...a,isSelected:a.customerId===l}});return e(G.refreshCustomersGridRequestModel({...s.data,items:n})),s.data})}function Z(){return c("shipmentConfigurationCard",!0),e(t.setIsShipmentConfigurationCardLoading(!0)),e(t.resetSelectedCustomer()),y().then(d=>(e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(d.data)),d))}function ee(d,s){return v({shipmentId:d,model:s}).then(n=>{var a;return n.error?i({text:(a=n==null?void 0:n.error)==null?void 0:a.message,type:"error"}):i({text:"Shipment successfully updated",type:"success"}),n})}function te(d,s){return g({shipmentId:d,model:s}).then(n=>{var a;n.error?i({text:(a=n==null?void 0:n.error)==null?void 0:a.message,type:"error"}):b(r.selectedShipment.shipmentId).then(l=>{l.error||i({text:"Shipment successfully updated",type:"success"})})})}function re(d){return H({shipmentId:r.selectedShipment.shipmentId,model:{addressId:d}}).then(s=>{var n;if(s.error)i({text:(n=s==null?void 0:s.error)==null?void 0:n.message,type:"error"});else{c("selectCustomerAddressCard"),e(t.refreshSelectedShipment({...r.selectedShipment,deliveryAddress:s.data,deliveryAddressId:s.data.addressId}));const a=r.addressesGridRequestModel.items.map(l=>({...l,isSelected:l.addressId===s.data.addressId}));e(t.refreshAddressesGridRequestModel({...r.addressesGridRequestModel,items:a})),i({text:"Shipment successfully updated",type:"success"})}return s})}function se(d,s){return M({shipmentId:d,orderId:s}).then(n=>{var a;return n.error?i({text:(a=n==null?void 0:n.error)==null?void 0:a.message,type:"error"}):(e(t.refreshOrderShipments([...r.orderShipments,n.data])),i({text:"Shipment successfully added to order",type:"success"})),n})}function b(d){return r.activeCards.includes("shipmentConfigurationCard")||c("shipmentConfigurationCard",!0),e(t.refreshActiveCardForCustomers("shipmentConfigurationCard")),e(t.setIsShipmentConfigurationCardLoading(!0)),k(d).then(s=>{var n;if(e(t.setIsShipmentConfigurationCardLoading(!1)),s!=null&&s.data){const a={...s.data,orderItems:((n=s.data.orderItems)==null?void 0:n.filter(l=>l.orderedAmount!==0))||[]};return e(t.refreshSelectedShipment(a)),a}return s})}function de(d){if(c("selectEntityCard"),r.activeCardForCustomers==="selectOrderForShipmentCard"){e(t.refreshSelectedCustomer(d));const s={...r.ordersGridRequestModel,filter:{...r.ordersGridRequestModel.filter,customerId:d.customerId}};e(t.refreshOrdersGridRequestModel(s)),e(t.setIsOrdersGridLoading(!0)),R(s).then(n=>{e(t.setIsOrdersGridLoading(!1)),e(t.refreshOrdersGridRequestModel(n.data))})}else g({shipmentId:r.selectedShipment.shipmentId,model:d}).then(s=>{var n;s.error?i({text:(n=s==null?void 0:s.error)==null?void 0:n.message,type:"error"}):(e(t.refreshSelectedShipment({...r.selectedShipment,customer:d,customerId:d.customerId})),i({text:"Shipment successfully updated",type:"success"}))})}function ne(d,s){return e(t.setIsShipmentConfigurationCardLoading(!0)),A({shipmentId:d,orderId:s}).then(n=>{var a;return e(t.setIsShipmentConfigurationCardLoading(!1)),n.error?i({text:(a=n==null?void 0:n.error)==null?void 0:a.message,type:"error"}):(e(t.refreshSelectedShipment(n.data)),i({text:"Order successfully deleted from shipment",type:"success"})),n.data})}function ie(d){return e(t.setIsShipmentConfigurationCardLoading(!0)),u(d).then(s=>{e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(s.data))})}function ae(){c("shipmentConfigurationCard"),e(t.resetActiveCardForCustomers())}function oe(){c("customerCard",!0)}function ce(d){return e(t.setIsSelectEntityGridLoading(!0)),I({...S.CustomersGridRequestModel,searchQuery:d}).then(s=>{e(t.setIsSelectEntityGridLoading(!1));const n=s.data.items.map(a=>{var m,h;const l=r.activeCards.includes("shipmentConfigurationCard")?(m=r.selectedShipment)==null?void 0:m.customerId:(h=r.selectedCustomer)==null?void 0:h.customerId;return{...a,isSelected:a.customerId===l}});e(G.refreshCustomersGridRequestModel({...s.data,items:n}))})}function ue(){c("selectEntityCard")}function me(){e(t.setIsShipmentConfigurationCardLoading(!0)),T(r.selectedShipment.shipmentId).then(d=>{e(t.setIsShipmentConfigurationCardLoading(!1)),d.error||e(t.refreshSelectedShipment(d.data))})}function le(d){return e(t.setIsCustomerAddressesGridLoading(!0)),D({model:r.addressesGridRequestModel,id:d}).then(s=>{if(e(t.setIsCustomerAddressesGridLoading(!1)),!s.error)return e(t.refreshAddressesGridRequestModel(s.data)),s})}function pe(d){c("selectCustomerAddressCard",!0),e(t.setIsCustomerAddressesGridLoading(!0)),le(d).then(s=>{if(e(t.setIsCustomerAddressesGridLoading(!1)),s.data){const n=s.data.items.map(a=>({...a,isSelected:a.addressId===r.selectedShipment.deliveryAddressId}));e(t.refreshAddressesGridRequestModel({...r.addressesGridRequestModel,items:n}))}})}function he(d){e(t.setIsCustomerAddressesGridLoading(!0)),D({model:{searchQuery:d},id:r.selectedShipment.customerId}).then(s=>{if(e(t.setIsCustomerAddressesGridLoading(!1)),s.data){const n=s.data.items.map(a=>({...a,isSelected:a.addressId===r.selectedShipment.deliveryAddressId}));e(t.refreshAddressesGridRequestModel({...r.addressesGridRequestModel,items:n}))}})}function Ce(){c("selectCustomerAddressCard")}function Se(d){c("customerCard",!0),E(r.activeCards.includes("ShipmentConfigurationCard")?r.selectedShipment.customerId:d.customerId).then(s=>{e(t.refreshManagedCustomer(s.data))})}function fe(d){const s=x(d);return e(t.setIsCustomerCardLoading(!0)),P(s).then(n=>{if(e(t.setIsCustomerCardLoading(!1)),!n.error)return i({text:"New customer created successfully",type:"info"}),c("customerCard"),e(G.refreshCustomersGridRequestModel({...S.customersGridRequestModel,items:[n.data,...S.customersGridRequestModel.items]})),n.data})}function ge(d){var n;const s=x(d);return e(t.setIsCustomerCardLoading(!0)),j({id:(n=r.managedCustomer)==null?void 0:n.customerId,model:s}).then(a=>{if(e(t.setIsCustomerCardLoading(!1)),!a.error){c("customerCard"),e(t.resetManagedCustomer());const m=S.customersGridRequestModel.items.map(h=>h.customerId===a.data.customerId?a.data:h).map(h=>({...h,isSelected:h.customerId===r.managedCustomer.customerId}));return e(G.refreshCustomersGridRequestModel({...S.customersGridRequestModel,items:m})),r.selectedShipment.customerId===a.data.customerId&&e(t.refreshSelectedShipment({...r.selectedShipment,customer:a.data,customerId:a.data.customerId})),i({text:"Customer updated successfully",type:"info"}),a.data}})}function Ie(){c("customerCard"),e(t.resetManagedCustomer())}function Ae(d){c("customerAddressCard",!0),N(null).then(s=>{s.data&&e(t.refreshCountryCodesList(s.data))}),d&&e(t.refreshManagedAddress(d))}function Le(d){const s=_e(d.alias,d.addressLine1,d.addressLine2,d.city,d.state,d.postalCode,d.countryId);return d.addressId?ye(s):ve(s)}function ye(d){const s=F(d);return e(t.setIsCustomerAddressCardLoading(!0)),Q({id:r.managedAddress.addressId,model:s}).then(n=>{if(e(t.setIsCustomerAddressCardLoading(!1)),n.error)return;const l=r.addressesGridRequestModel.items.map(m=>m.addressId===n.data.addressId?n.data:m).map(m=>({...m,isSelected:m.addressId===r.selectedShipment.deliveryAddressId}));e(t.refreshAddressesGridRequestModel({...r.addressesGridRequestModel,items:l})),r.selectedShipment.deliveryAddressId===n.data.addressId&&e(t.refreshSelectedShipment({...r.selectedShipment,deliveryAddress:n.data,deliveryAddressId:n.data.addressId})),e(t.resetManagedAddress()),c("customerAddressCard"),i({text:"Customer address updated successfully",type:"info"})})}function ve(d){const s=F(d);return e(t.setIsCustomerAddressCardLoading(!0)),V({id:r.selectedCustomer.customerId,model:s}).then(n=>{if(e(t.setIsCustomerAddressCardLoading(!1)),!n.error){const l=[n.data,...r.addressesGridRequestModel.items].map(m=>({...m,isSelected:m.addressId===r.selectedShipment.deliveryAddressId}));e(t.refreshAddressesGridRequestModel({...r.addressesGridRequestModel,items:l})),i({text:"New customer address created successfully",type:"info"}),e(t.resetManagedAddress()),c("customerAddressCard")}})}function He(){c("customerAddressCard"),e(t.resetManagedAddress())}function Me(){var d;c("selectOrderForShipmentCard",!0),e(t.setIsOrdersGridLoading(!0)),R({...r.ordersGridRequestModel,filter:{customerId:(d=r.selectedCustomer)==null?void 0:d.customerId}}).then(s=>{e(t.setIsOrdersGridLoading(!1)),e(t.refreshOrdersGridRequestModel(s.data))}),e(t.refreshActiveCardForCustomers("selectOrderForShipmentCard"))}function ke(d){c("selectOrderForShipmentCard"),e(t.setIsShipmentConfigurationCardLoading(!0)),w({shipmentId:r.selectedShipment.shipmentId,orderId:d.id}).then(s=>{var n;e(t.setIsShipmentConfigurationCardLoading(!1)),s.error?i({text:(n=s==null?void 0:s.error)==null?void 0:n.message,type:"error"}):(e(t.refreshSelectedShipment(s.data)),i({text:"Order successfully connected to shipment",type:"info"}))})}function Ge(){c("selectOrderForShipmentCard"),e(t.refreshActiveCardForCustomers("shipmentConfigurationCard"))}function Oe(d){f(`${q.SALES}${q.ORDER_DETAILS}/${d}`)}function De(d){e(t.setIsShipmentConfigurationCardLoading(!0)),z(d).then(s=>{e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(s.data))})}function Re(d){e(t.setIsShipmentConfigurationCardLoading(!0)),B(d).then(s=>{e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(s.data))})}function be(d){e(t.setIsShipmentConfigurationCardLoading(!0)),U({stockActionId:d.stockActionId,model:{quantity:d.quantityToPack}}).then(s=>{e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(s.data))})}function qe(d){return e(t.setIsShipmentConfigurationCardLoading(!0)),$({shipmentId:r.selectedShipment.shipmentId,stockActionId:d}).then(s=>{e(t.setIsShipmentConfigurationCardLoading(!1)),s.error||e(t.refreshSelectedShipment(s.data))})}function Fe(){e(t.setIsShipmentConfigurationCardLoading(!0)),_(r.selectedShipment.shipmentId).then(d=>{e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(d.data))})}async function xe(){await C({headerTitle:"Cancel Shipment",text:`You are about to cancel shipment "${r.selectedShipment.shipmentId}".`,primaryButtonValue:"Cancel Shipment",secondaryButtonValue:"Cancel"})&&(e(t.setIsShipmentConfigurationCardLoading(!0)),await W(r.selectedShipment.shipmentId).then(s=>{e(t.setIsShipmentConfigurationCardLoading(!1)),s.error?i({text:s.error.data.detail,type:"error"}):(e(t.refreshSelectedShipment(s.data)),i({text:"Shipment canceled successfully",type:"success"}))}))}function Te(){e(t.setIsShipmentConfigurationCardLoading(!0)),Y(r.selectedShipment.shipmentId).then(d=>{e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(d.data))})}function Ee(){J().then(d=>{e(t.refreshDeliveryServicesList(d.data))})}function Pe(d){e(t.setIsShipmentConfigurationCardLoading(!0)),K({shipmentId:r.selectedShipment.shipmentId,model:{trackNumber:d.trackNumber,deliveryServiceId:d.deliveryServiceId,addressItemId:d.deliveryAddressId}}).then(s=>{e(t.setIsShipmentConfigurationCardLoading(!1)),e(t.refreshSelectedShipment(s.data))})}return{createShipmentHandler:Z,updateShipmentDatesHandler:ee,updateShipmentCustomerHandler:te,updateShipmentAddressHandler:re,connectShipmentToOrderHandler:se,getShipmentDetailsHandler:b,getListOfCustomersForGridHandler:X,selectCustomerHandler:de,disconnectOrderFromShipmentHandler:ne,addVariantToShipmentHandler:qe,addAllVariantsToShipmentHandler:Fe,removeVariantFromShipmentHandler:ie,closeShipmentConfigurationCardHandler:ae,openCreateEntityCardHandler:oe,searchEntityHandle:ce,closeSelectEntityCardHandler:ue,confirmPackedProductsHandler:me,openSelectAddressCardHandler:pe,searchAddressHandle:he,closeSelectAddressCardHandler:Ce,openCustomerCardHandler:Se,createCustomerHandler:fe,updateCustomerHandler:ge,closeCustomerCardHandler:Ie,manageAddressHandler:Ae,resolveCustomerAddressData:Le,closeCustomerAddressCardHandler:He,openSelectOrderForShipmentCardHandler:Me,closeSelectOrderForShipmentCardHandler:Ge,addOrderToShipmentHandler:ke,navigateToOrderHandler:Oe,increaseShipmentStockActionHandler:De,decreaseShipmentStockActionHandler:Re,changePackedOrderItemQuantityHandler:be,cancelShipmentHandler:xe,returnShipmentStatusToPreviousHandler:Te,getDeliveryServicesListHandler:Ee,confirmDeliveryDataHandler:Pe}}function Ft(){var y,v,g,H,I,M,k;const{handleCardAction:c,createRefCallback:e}=Be({selectActiveCards:A=>A[L.SHIPMENT_DETAILS].activeCards,refreshAction:t.refreshActiveCards}),{shipmentId:f}=Ue(),i=O(L.SHIPMENT_DETAILS),r=st(c),S=O(L.ORDERS);ze.useEffect(()=>{(!i.selectedShipment||i.selectedShipment.id!==f)&&r.getShipmentDetailsHandler(Number(f)),r.getShipmentDetailsHandler(Number(f)),r.getDeliveryServicesListHandler()},[f]);async function C(A,u){switch(A){case"createShipment":c("shipmentConfigurationCard",!0),r.createShipmentHandler();break;case"closeShipmentConfigurationCard":r.closeShipmentConfigurationCardHandler();break;case"changeShipmentDate":r.updateShipmentDatesHandler(i.selectedShipment.shipmentId,u);break;case"changeCustomer":r.getListOfCustomersForGridHandler({...S.customersGridRequestModel,searchQuery:u});break;case"selectCustomer":r.selectCustomerHandler(u);break;case"searchEntity":r.searchEntityHandle(u);break;case"openCreateEntityCard":r.openCreateEntityCardHandler();break;case"closeSelectEntityCard":r.closeSelectEntityCardHandler();break;case"selectAddress":r.updateShipmentAddressHandler(u);break;case"removeOrderFromShipment":r.disconnectOrderFromShipmentHandler(i.selectedShipment.shipmentId,u.orderId);break;case"addItemToShipment":r.addVariantToShipmentHandler(u);break;case"addAllItemsToShipment":r.addAllVariantsToShipmentHandler();break;case"removeItemFromShipment":r.removeVariantFromShipmentHandler(u.stockActionId);break;case"changePackedOrderItemQuantity":r.changePackedOrderItemQuantityHandler(u);break;case"decreasePackedOrderItemQuantity":r.decreaseShipmentStockActionHandler(u);break;case"increasePackedOrderItemQuantity":r.increaseShipmentStockActionHandler(u);break;case"confirmPackedProducts":r.confirmPackedProductsHandler();break;case"openSelectAddressCard":r.openSelectAddressCardHandler(u);break;case"searchAddress":r.searchAddressHandle(u);break;case"closeSelectAddressCard":r.closeSelectAddressCardHandler();break;case"manageCustomer":r.openCustomerCardHandler(u);break;case"openCustomerCard":r.openCustomerCardHandler();break;case"createCustomer":r.createCustomerHandler(u);break;case"updateCustomer":r.updateCustomerHandler(u);break;case"closeCustomerCard":r.closeCustomerCardHandler();break;case"manageAddress":r.manageAddressHandler(u);break;case"submitCustomerAddressData":r.resolveCustomerAddressData(u);break;case"closeCustomerAddressCard":r.closeCustomerAddressCardHandler();break;case"openSelectOrderForShipmentCard":r.openSelectOrderForShipmentCardHandler();break;case"connectOrderToShipment":r.addOrderToShipmentHandler(u);break;case"closeSelectOrderForShipmentCard":r.closeSelectOrderForShipmentCardHandler();break;case"navigateToOrder":r.navigateToOrderHandler(u);break;case"cancelShipment":r.cancelShipmentHandler();break;case"returnShipmentStatusToPrevious":r.returnShipmentStatusToPreviousHandler();break;case"confirmDeliveryData":r.confirmDeliveryDataHandler(u);break}}return p.jsx("div",{className:rt.shipmentDetailsPage,children:p.jsxs(Ze,{hideSidebarBlock:!0,activeCards:i.activeCards,children:[p.jsx(Je,{isLoading:i.isShipmentConfigurationCardLoading,shipment:i.selectedShipment,deliveryServices:i.deliveryServicesList,onAction:C}),((y=i.activeCards)==null?void 0:y.includes("selectOrderForShipmentCard"))&&p.jsx("div",{ref:e("selectOrderForShipmentCard"),children:p.jsx(Ke,{isLoading:i.isSelectOrderForShipmentCardLoading,isGridLoading:i.isOrdersGridLoading,customer:i.selectedCustomer,ordersGridRequestModel:i.ordersGridRequestModel,onAction:C})}),((v=i.activeCards)==null?void 0:v.includes("selectEntityCard"))&&p.jsx("div",{ref:e("selectEntityCard"),children:p.jsx(et,{isLoading:i.isSelectEntityCardLoading,isGridLoading:i.isSelectEntityGridLoading,entityName:"Customer",entityCollection:S.customersGridRequestModel.items,columns:tt({onAction:C}),onAction:C})}),((g=i.activeCards)==null?void 0:g.includes("selectCustomerAddressCard"))&&p.jsx("div",{ref:e("selectCustomerAddressCard"),children:p.jsx(Xe,{isLoading:i.isSelectCustomerAddressCardLoading,isGridLoading:i.isCustomerAddressesGridLoading,customer:(H=i.selectedShipment)==null?void 0:H.customer,addressesList:(I=i.addressesGridRequestModel)==null?void 0:I.items,onAction:C})}),((M=i.activeCards)==null?void 0:M.includes("customerCard"))&&p.jsx("div",{ref:e("customerCard"),children:p.jsx(Ye,{isLoading:i.isCustomerCardLoading,customer:i.managedCustomer,showCloseButton:!0,hideNotificationCard:!0,onAction:C})}),((k=i.activeCards)==null?void 0:k.includes("customerAddressCard"))&&p.jsx("div",{ref:e("customerAddressCard"),children:p.jsx($e,{isLoading:i.isCustomerAddressCardLoading,customerAddress:i.managedAddress,countryList:i.countryCodesList,onAction:C})})]})})}export{Ft as ShipmentDetailsPage};
