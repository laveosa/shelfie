import{d as T,S as b,q as E,b as L,p as M,a0 as d,o as N,a6 as t,N as l,r as A,j as p}from"./index-BgQa47gg.js";import{c as g,C as R}from"./CustomerCard-BeJL-n6B.js";import{u as U}from"./useToast-Ddu7z5Z2.js";import{S as O}from"./SheContextSidebar-DsZqgJ7j.js";import"./types-B685w38Y.js";import"./form-cGuroVqV.js";import"./SheInput-DR7d3r4D.js";import"./useAppTranslation-WsuOvhO_.js";import"./chevron-up-BnFDI10H.js";import"./ComponentViewEnum-Ba6F4129.js";import"./settings-2-BTVyb-Qp.js";import"./SheCard-TmbF1_I2.js";import"./SheCardNotification-DnnZbXEU.js";import"./trash-hroypMYd.js";const P={};function $(){const r=T(b.CUSTOMERS),{openConfirmationDialog:c}=E(),e=L(),m=M(),[n]=d.useUpdateCustomerMutation(),[i]=d.useCreateCustomerMutation(),[S]=d.useLazyGetCustomerDetailsQuery(),[D]=d.useLazyGetCustomerInfoQuery(),[I]=d.useDeleteCustomerMutation(),{customerId:f}=N(),{addToast:C}=U();function h(s){var o;const a=g(s);return e(t.setIsCustomerBasicDataLoading(!0)),n({id:(o=r.selectedCustomer)==null?void 0:o.customerId,model:a}).then(u=>{if(e(t.setIsCustomerBasicDataLoading(!1)),!u.error)return C({text:"Customer updated successfully",type:"info"}),u.data})}function y(s){const a=g(s);return e(t.setIsCustomerBasicDataLoading(!0)),i(a).then(o=>{var u;if(e(t.setIsCustomerBasicDataLoading(!1)),!o.error)return C({text:"New customer created successfully",type:"info"}),e(t.refreshSelectedCustomer(o.data)),e(t.refreshCustomers([o.data,...r.customers])),m(`${l.CUSTOMERS}/${l.CUSTOMER_BASIC_DATA}/${(u=o.data)==null?void 0:u.customerId}`),o.data})}function B(){if(r.selectedCustomer)return r.selectedCustomer;if(f)return e(t.setIsCustomerBasicDataLoading(!0)),S(Number(f)).then(s=>(e(t.setIsCustomerBasicDataLoading(!1)),e(t.refreshSelectedCustomer(s.data)),s.data))}function x(){e(t.resetSelectedCustomer()),m(`${l.CUSTOMERS}`)}function v(s){return D(s).then(a=>{const o=a.data;return e(t.refreshCustomerCounter(o)),a.data})}async function H(s){await c({headerTitle:"Deleting customer",text:`You are about to delete customer ${s.customerName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&I(s.id).then(o=>{if(o.error){C({text:"Failed to delete customer",type:"error"});return}else C({text:"Customer deleted successfully",type:"info"}),e(t.refreshCustomers(r.customers.filter(u=>u.customerId!==s.customerId))),m(`${l.CUSTOMERS}`)})}return{state:r,actions:t,customerId:f,updateCustomerHandler:h,createCustomerHandler:y,getCustomerHandler:B,onCancelHandler:x,getCustomerInfoHandler:v,deleteCustomerHandler:H}}function X(){const{state:r,customerId:c,...e}=$();A.useEffect(()=>{var n;e.getCustomerHandler(),((n=r.customerCounter)==null?void 0:n.addressesAmount)===void 0&&c&&e.getCustomerInfoHandler(Number(c))},[]);async function m(n,i){switch(n){case"deleteCustomer":e.deleteCustomerHandler(i);break;case"createCustomer":e.createCustomerHandler(i);break;case"updateCustomer":e.updateCustomerHandler(i);break;case"closeCustomerCard":e.onCancelHandler();break}}return p.jsx("div",{id:"CustomerBasicDataPage",className:P.customerBasicDataPage,children:p.jsx(O,{menuCollectionType:"customer",menuTitle:"Customer",counter:r.customerCounter,itemId:Number(c),activeCards:r.activeCards,children:p.jsx(R,{isLoading:r.isCustomerBasicDataLoading,customer:r.selectedCustomer,onAction:m})})})}export{X as CustomerBasicDataPage};
