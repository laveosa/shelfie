import{n as le,S as ae,t as Be,z as Jt,B as er,Z as W,A as ge,Y as Pe,$ as _,k as ar,bD as o,a1 as V,a6 as tr,s as Ae,N as Ne,j as r,f as He,X as rr,e as F,ab as Re,L as or,Q as sr,V as nr,W as ee,I as ir,w as $,x as Ve,r as X,ah as dr,_ as fe,l as cr,a7 as ur,o as ye,y as lr}from"./index-DybU9lv3.js";import{G as pr,a as hr}from"./GridSortingEnum-Qa64oiYF.js";import{u as we}from"./useProductsPageService-CV8ADoIa.js";import{u as mr}from"./useToast-D6yqOzuN.js";import{u as Cr,P as gr,C as Pr,a as fr}from"./useProductBasicDataPageService-PTVF36XO.js";import{u as yr}from"./chevron-up-C7ChJr01.js";import{S as xr,T as Ir,a as Ge,b as De}from"./SheTabs-DgCGOGr2.js";import{S as ze}from"./SheCard-JWlyTss7.js";import{G as ie}from"./GridItemsFilter-Cyzt5niH.js";import{G as Fe}from"./GridTraitsFilter-CH61fR0m.js";import{G as Lr}from"./GridShowItemsFilter-tNmzy64w.js";import{S as Ie}from"./SheGrid-DvAOS33I.js";import{o as Hr,b as de,u as qe,S as We,a as Y,d as ce}from"./types-Cs0d5Ub-.js";import{e as Me}from"./form-CP3c_0ZX.js";import{R as $e,S as pe}from"./SheInput-CKzfybja.js";import{S as he}from"./SheSelect-DkAtzaWK.js";import{T as Ee}from"./SheCardNotification-Yx-BMvzf.js";import{E as Vr,A as vr,q as Sr,r as br,S as kr}from"./SheContextSidebar-BKksk-en.js";import{c as Z}from"./she-select-convertors-CdG-Ygpu.js";import{I as Ue,u as Ke}from"./useAppTranslation-NlALFuCP.js";import{p as Tr}from"./placeholder-image-BgG3Yd5d.js";import{L as jr}from"./trash-CFfYG3xN.js";import{P as ve}from"./plus-Dv0aUE5j.js";import{P as Nr,C as Gr}from"./ConnectImageCard-CRmRwdUG.js";import{C as Dr,P as Fr,A as Mr}from"./AddVariantCard-BO3eTi0x.js";import{V as Or,A as _r,S as Br,D as Ar,a as Rr,b as wr,M as zr}from"./VariantPhotosCard-BgO0pZJG.js";import{u as qr}from"./useCardActions-CTfPrRnB.js";import{S as Wr,C as $r}from"./CompaniesListGridColumns-C2bC1dR8.js";import{S as Er}from"./SelectEntityCard-E8PNnYAH.js";import{C as Ur,a as Kr,P as Oe,M as Qr,L as Yr,b as Xr}from"./ManageLocationPhotosGridColumns-C2u8kQwt.js";import"./SheFileUploader-BAVOSjtG.js";import"./index-CrhSJ2si.js";import"./ComponentViewEnum-Ba6F4129.js";import"./settings-2-JTaowDGi.js";import"./select-BDB0m4xP.js";import"./folder-up-Cq6cKtKD.js";import"./ChooseVariantTraitsCard.module-DPmE-6dq.js";import"./SheForm-C58I0rY3.js";import"./SheDatePicker-ByjOO6gI.js";import"./SheTextarea-B6lhLebe.js";import"./AddressForm-JvxW60Zk.js";const Zr="_purchaseProductsPage_830lg_1",Jr="_purchaseProductsCard_830lg_1",_e={purchaseProductsPage:Zr,purchaseProductsCard:Jr};function eo(u,x,C){const i=le(ae.PURCHASE_PRODUCTS),s=le(ae.PRODUCTS),h=le(ae.APP),d=we(),e=Be(),{addToast:t}=mr(),S=Jt(),{openConfirmationDialog:L}=er(),m=Cr(u),{t:j}=yr(),[z]=W.useGetListOfPurchaseProductsForGridMutation(),[P]=W.useAddVariantToPurchaseProductsMutation(),[B]=W.useUpdatePurchaseProductMutation(),[v]=W.useDeleteStockActionMutation(),[G]=W.useLazyGetPurchaseSummaryQuery(),[M]=ge.useDeletePhotoMutation(),[k]=Pe.useAttachProductPhotoToVariantMutation(),[A]=Pe.useDetachVariantPhotoMutation(),[R]=ge.useSetPhotoActivationStateMutation(),[O]=W.useGetListOfPurchasesForGridMutation(),[H]=W.useLazyGetPurchaseDetailsQuery(),[l]=W.useCreatePurchaseForSupplierMutation(),[T]=_.useGetListOfCompaniesForGridMutation(),[E]=Pe.useGetVariantsForGridMutation(),[te]=ar.useLazyGetCountryCodeQuery(),[re]=_.useAddNewLocationToCompanyMutation(),[oe]=_.useCreateCompanyMutation(),[q]=_.useLazyGetCompanyDetailsQuery(),[y]=_.useDeleteCompanyMutation(),[D]=_.useAddLocationToCompanyMutation(),[me]=ge.useUploadPhotoMutation(),[Xe]=_.useUpdateCompanyDetailsMutation(),[Ze]=_.useChangePositionOfCompanyPhotoMutation(),[Je]=_.useChangePositionOfLocationPhotoMutation(),[ea]=_.useUpdateLocationDetailsMutation(),[aa]=_.useDeleteLocationMutation();function K(a,n){return z({id:a,model:n}).then(c=>(e(o.refreshPurchasesProductsGridRequestModel(c.data)),e(o.refreshPurchaseProducts(c.data.items)),c.data))}function Se(a,n){return P({id:a,model:n}).then(c=>c.data)}function be(a,n){return B({id:a,model:n}).then(c=>c)}function ke(a){return v(a).then(n=>n.data)}function se(a){return G(a).then(n=>(e(o.refreshPurchaseSummary(n.data)),n.data))}function ta(a){s.selectedPurchase||d.getPurchaseDetailsHandler(a),s.purchaseCounters||(e(o.setIsProductMenuCardLoading(!0)),d.getPurchaseCountersHandler(Number(a)).then(()=>e(o.setIsProductMenuCardLoading(!1)))),s.currenciesList.length===0&&d.getCurrenciesListHandler(),s.taxesList.length===0&&d.getTaxesListHandler(),d.getTraitsForFilterHandler(),C(["purchaseProductsCard"]),e(V.refreshActiveTab("purchases"))}function ra(a){s.createdPurchase||(e(o.setIsPurchasesProductsGridLoading(!0)),Promise.all([K(a,i.purchasesProductsGridRequestModel),se(a)]).then(()=>{e(o.setIsPurchasesProductsGridLoading(!1))})),e(o.refreshPurchasesProductsGridRequestModel({}))}function oa(){Object.keys(i.variantsForPurchaseGridRequestModel).length===0&&(e(o.setIsVariantsForPurchaseGridLoading(!0)),E(i.variantsForPurchaseGridRequestModel).then(a=>{e(o.setIsVariantsForPurchaseGridLoading(!1)),e(o.refreshVariantsForPurchaseGridRequestModel(a.data)),e(o.refreshVariants(a.data.items))}))}function sa(){s.brands.length===0&&d.getBrandsForFilterHandler(),s.categories.length===0&&d.getCategoriesForFilterHandler(),J(),(i.sizesForFilter.length===0||i.colorsForFilter.length===0)&&d.getTraitsForFilterHandler(),e(o.refreshActiveCards(null))}function J(){i.countryCodes.length===0&&te().then(a=>{e(o.refreshCountryCodes(a.data))})}function na(a,n){Se(n,{variantId:a.variantId,...a.data}).then(c=>{c?(d.getPurchaseCountersHandler(Number(n)),t({text:"Variant added successfully",type:"success"})):t({text:`${c.error.data.detail}`,type:"error"})})}function ia(a,n){e(o.refreshPurchasesProductsGridRequestModel({...i.purchasesProductsGridRequestModel,items:i.purchasesProductsGridRequestModel.items.map(c=>c.stockActionId===a.stockActionId?{...c,unitsAmount:a.data.unitsAmount,stockDocumentPrice:{...c.stockDocumentPrice,currencyId:a.data.currencyId,taxTypeId:a.data.taxTypeId,netto:a.data.nettoPrice}}:c)})),be(a.stockActionId,a.data).then(c=>{c.error?(K(n,i.purchasesProductsGridRequestModel),t({text:`${c.error.data.detail}`,type:"error"})):(se(n),t({text:"Product updated successfully",type:"success"}))})}function da(){e(o.resetSelectedProduct()),x({purchaseProductsCard:!1,productConfigurationCard:!0})}function ca(a){e(o.setIsProductConfigurationCardLoading(!0)),d.createNewProductHandler(a).then(n=>{e(o.setIsProductConfigurationCardLoading(!1)),n.error?t({text:`${n.error.data.detail}`,type:"error"}):(x({productConfigurationCard:!1,manageProductCard:!0}),e(o.refreshSelectedProduct(n.data)),t({text:"Product created successfully",type:"success"}))})}function ua(){u("createCategoryCard",!0)}function la(a){m.checkCategoryNameHandler(a)}function pa(a){m.createNewCategoryHandler(a),u("createCategoryCard")}function ha(){u("createBrandCard",!0)}function ma(a){m.checkBrandNameHandler(a)}function Ca(a){m.createBrandHandler(a),u("createBrandCard")}function ga(a){m.uploadCategoryOrBrandPhotoHandler(a)}function Pa(){i.activeCards.includes("manageProductCard")?u("productConfigurationCard"):C(["purchaseProductsCard"])}function fa(){m.generateProductCodeHandler()}function ya(a){d.checkProductCodeHandler({code:a})}function xa(a){C(["purchaseProductsCard"]),e(o.setIsPurchasesProductsGridLoading(!0)),Promise.all([K(a,i.purchasesProductsGridRequestModel),se(a)]).then(()=>{e(o.setIsPurchasesProductsGridLoading(!1))})}function Ia(){u("manageProductCard"),e(o.setIsManageProductCardLoading(!0)),Promise.all([d.getListOfTraitsWithOptionsForProductHandler(s.selectedProduct.productId),d.getPurchaseProductVariantsHandler(i.selectedPurchase.purchaseId,s.selectedProduct.productId)]).then(([a,n])=>{e(o.setIsManageProductCardLoading(!1)),e(o.refreshPurchaseProductVariantsGridRequestModel(n)),e(o.refreshPurchaseProductVariants(n.items))})}function La(){u("productConfigurationCard",!0)}function Ha(){u("productPhotosCard",!0),e(o.setIsProductPhotosCardLoading(!0)),d.getProductPhotosHandler(Number(i.selectedProduct.productId)).then(()=>{e(o.setIsProductPhotosCardLoading(!1))})}function Va(a){return e(o.setIsPhotoUploaderLoading(!0)),me(a).then(n=>{var c;return n.error?(t({text:((c=n.error.data)==null?void 0:c.detail)||"Upload failed",type:"error"}),n):(n.data.photoId&&(e(o.setIsPhotoUploaderLoading(!1)),a.contextName==="Company"?(e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(p=>{e(o.setIsSuppliersGridLoading(!1));const g=p.data.items.map(I=>{var w;return{...I,isSelected:I.companyId===((w=i.selectedCompany)==null?void 0:w.companyId)}});e(o.refreshCompaniesGridRequestModel({...p.data,items:g}))}),e(o.refreshManagedCompany({...i.managedCompany,photos:[...i.managedCompany.photos||[],n.data]}))):e(o.refreshManagedLocation({...i.managedLocation,photos:[...i.managedLocation.photos||[],n.data]})),t({text:"Photos added successfully",type:"success"})),n)})}function va(a){switch(a.contextName){case"Company":Ze({companyId:i.managedCompany.companyId,photoId:a.activeItem.photoId,index:a.newIndex}).then(n=>{n.error||(q(i.managedCompany.companyId).then(c=>{e(o.refreshManagedCompany(c.data))}),(a.newIndex===0||a.oldIndex===0)&&(e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(c=>{e(o.setIsSuppliersGridLoading(!1));const p=c.data.items.map(g=>{var I;return{...g,isSelected:g.companyId===((I=i.selectedCompany)==null?void 0:I.companyId)}});e(o.refreshCompaniesGridRequestModel({...c.data,items:p}))})))});break;case"Location":Je({locationId:i.managedLocation.locationId,photoId:a.activeItem.photoId,index:a.newIndex}).then(n=>{n.error||q(i.managedCompany.companyId).then(c=>{e(o.refreshManagedCompany(c.data))})});break;default:d.changePhotoPositionForVariantHandler(s.selectedVariant.variantId,a.activeItem.photoId,a.newIndex).then(()=>{e(o.setIsVariantPhotoGridLoading(!0)),(a.newIndex===0||a.oldIndex===0)&&d.getVariantsForGridHandler(s.gridRequestModel).then(n=>e(V.refreshVariants(n.items))),d.getVariantDetailsHandler(s.selectedVariant.variantId).then(n=>{e(o.setIsVariantPhotoGridLoading(!1)),e(V.refreshSelectedVariant(n)),e(V.refreshVariantPhotos(n==null?void 0:n.photos))})})}}async function Sa(a){await L({headerTitle:"Deleting product photo",text:"You are about to delete product photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&M(a.photoId).then(c=>{c?(e(V.refreshProductPhotos(s.productPhotos.filter(p=>p.photoId!==a.photoId))),t({text:"Photo deleted successfully",type:"success"})):t({text:"Photo not deleted",type:"error"})})}function ba(a){return R({contextName:"Product",contextId:i.selectedProduct.productId,photoId:a.photoId,model:{isActive:!a.isActive}}).then(n=>{n.error||e(V.refreshProductPhotos(s.productPhotos.map(c=>c.photoId===a.photoId?{...c,isActive:!a.isActive}:c)))})}function ka(){u("productPhotosCard")}function Ta(a){e(V.refreshProductPhotos(tr(a.photoId,s.productPhotos,"photoId"))),e(o.refreshSelectedPhoto(a)),e(V.refreshProductVariants(s.productVariants.map(n=>{var p;const c=(p=a.variants)==null?void 0:p.some(g=>g.variantId===n.variantId);return{...n,isActive:c}}))),u("connectImageCard",!0)}function ja(a){a.row.original.isActive?je(a):Te(a)}function Te(a){return k({variantId:a.row.original.variantId,photoId:i.selectedPhoto.photoId}).then(n=>{if(!n.error){const c=s.productVariants.map(p=>p.variantId===a.row.original.variantId?{...p,isActive:!0}:p);e(V.refreshProductVariants(c))}})}function je(a){return A({id:a.row.original.variantId,photoId:i.selectedPhoto.photoId}).then(n=>{if(!n.error){const c=s.productVariants.map(p=>p.variantId===a.row.original.variantId?{...p,isActive:!1}:p);e(V.refreshProductVariants(c))}})}function Na(){u("connectImageCard")}function Ga(){u("chooseVariantTraitsCard",!0),e(o.setIsChooseVariantTraitsCardLoading(!0)),Promise.all([d.getListOfAllTraitsHandler(),d.getListOfTraitsWithOptionsForProductHandler(i.selectedProduct.productId)]).then(()=>{e(o.setIsChooseVariantTraitsCardLoading(!1))})}function Da(){e(o.setIsProductTraitConfigurationCardLoading(!0)),e(o.resetSelectedTrait()),d.getListOfTypesOfTraitsHandler().then(()=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),u("productTraitConfigurationCard",!0),e(o.refreshSelectedTrait({}))})}function Fa(a){u("productTraitConfigurationCard",!0),e(o.setIsProductTraitConfigurationCardLoading(!0)),e(o.setIsTraitOptionsGridLoading(!0)),Promise.all([d.getTraitHandler(a),d.getOptionsForTraitHandler(a),d.getListOfTypesOfTraitsHandler()]).then(([n,c,p])=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),e(o.setIsTraitOptionsGridLoading(!1)),e(o.refreshSelectedTrait(n)),e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:c.filter(g=>!g.isDeleted)}))})}function Ma(a){e(o.refreshSelectedTraitsIds(a)),e(o.setIsChooseVariantTraitsCardLoading(!0)),d.setProductTraitsHandler(i.selectedProduct.productId,a).then(n=>{e(o.setIsChooseVariantTraitsCardLoading(!1)),n?(x({chooseVariantTraitsCard:!1,productTraitConfigurationCard:!1}),d.getListOfTraitsWithOptionsForProductHandler(i.selectedProduct.productId),t({text:"Traits set successfully",type:"success"})):t({text:"Traits not set",description:n.error.message,type:"error"})})}async function Oa(a){if(await L({headerTitle:"Deleting trait",text:`You are about to remove the trait ${a.traitName}. All products connected to it will loose the configuration and will require your attention to map it to the new trait.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})){e(o.setIsChooseVariantTraitsCardLoading(!0));try{await d.deleteTraitHandler(a.traitId),await Promise.all([d.getListOfTraitsWithOptionsForProductHandler(i.selectedProduct.productId),d.getListOfAllTraitsHandler()]),t({text:"Trait deleted successfully",type:"success"})}catch(c){t({text:c.message||"Failed to delete trait",type:"error"})}finally{e(o.setIsChooseVariantTraitsCardLoading(!1)),u("productTraitConfigurationCard")}}}function _a(a){e(o.setIsProductTraitConfigurationCardLoading(!0)),d.createNewTraitHandler(a).then(n=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),n?(e(o.refreshSelectedTrait(n)),d.getOptionsForTraitHandler(n.traitId).then(c=>{e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:c.filter(p=>!p.isDeleted)}))}),d.getListOfAllTraitsHandler(),t({text:"Trait created successfully",type:"success"})):t({text:"Trait not created",description:n.error.message,type:"error"})})}function Ba(a){e(o.setIsProductTraitConfigurationCardLoading(!0)),d.updateTraitHandler(i.selectedTrait.traitId,a).then(n=>{e(o.setIsProductTraitConfigurationCardLoading(!1)),n?(d.getListOfAllTraitsHandler(),t({text:"Trait updated successfully",type:"success"})):t({text:"Trait not updated",description:n.error.message,type:"error"})})}function Aa(a){d.updateOptionsForTraitHandler(a.optionId,a.updatedModel).then(n=>{n?(e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:i.colorOptionsGridRequestModel.items.map(c=>c.optionId===n.optionId?n:c)})),t({text:"Option updated successfully",type:"success"})):t({text:"Option not updated",description:n.error.message,type:"error"})})}function Ra(){e(o.setIsTraitOptionsGridLoading(!0)),d.createNewOptionForTraitHandler(i.selectedTrait.traitId,{optionColor:"#fff",optionName:"Default option"}).then(a=>{e(o.setIsTraitOptionsGridLoading(!1)),a?(e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:[...i.colorOptionsGridRequestModel.items,a]})),d.getListOfAllTraitsHandler(),t({text:"Option created successfully",type:"success"})):t({text:"Option not created",description:a.error.message,type:"error"})})}async function wa(a){await L({headerTitle:"Deleting option",text:`You are about to remove the option ${a.optionName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&d.deleteOptionsForTraitHandler(a.optionId).then(c=>{var p;c.error?t({text:(p=c.error)==null?void 0:p.message,type:"error"}):(d.getListOfAllTraitsHandler().then(g=>{e(V.refreshTraits(g))}),e(o.refreshColorOptionsGridRequestModel({...i.colorOptionsGridRequestModel,items:i.colorOptionsGridRequestModel.items.filter(g=>g.optionId!==a.optionId)})),t({text:"Option deleted successfully",type:"success"}))})}function za(a){d.changePositionOfTraitOptionHandler(a.selectedTrait.traitId,a.activeItem.optionId,a.newIndex)}function qa(){u("productTraitConfigurationCard")}function Wa(a){u("addVariantCard",!0),e(o.setIsAddVariantCardLoading(!0)),d.getListOfTraitsWithOptionsForProductHandler(a.productId).then(()=>{e(o.setIsAddVariantCardLoading(!1))})}function $a(a){C(["manageProductCard"]),e(o.setIsProductConfigurationCardLoading(!0)),e(o.setIsVariantGridLoading(!0)),Promise.all([d.getProductDetailsHandler(a.productId),d.getListOfTraitsWithOptionsForProductHandler(a.productId),d.getPurchaseProductVariantsHandler(s.selectedPurchase.purchaseId,a.productId)]).then(([n,c,p])=>{e(o.setIsProductConfigurationCardLoading(!1)),e(o.setIsVariantGridLoading(!1)),n?e(o.refreshSelectedProduct(n)):(x({purchaseProductsCard:!0,manageProductCard:!1}),t({text:"Something gone wrong",type:"error"})),e(o.refreshPurchaseProductVariants(p))})}function Ea(a,n){e(o.setIsAddVariantCardLoading(!0)),d.checkVariantCombinationHandler(i.selectedProduct.productId,a).then(c=>{c?d.createVariantHandler(i.selectedProduct.productId,a).then(p=>{e(o.setIsAddVariantCardLoading(!1)),p?(u("addVariantCard"),d.getPurchaseProductVariantsHandler(n,i.selectedProduct.productId).then(g=>{e(o.refreshPurchaseProductVariants(g))}),t({text:"Variant added successfully",type:"success"})):t({text:"Variant not added",description:p.error.message,type:"error"})}):(e(o.setIsAddVariantCardLoading(!1)),e(o.refreshIsDuplicateVariant(!0)))})}function Ua(a,n){e(o.setIsAddVariantCardLoading(!0)),d.createVariantHandler(i.selectedProduct.productId,a).then(c=>{e(o.setIsAddVariantCardLoading(!1)),c?(u("addVariantCard"),d.getPurchaseProductVariantsHandler(n,i.selectedProduct.productId).then(p=>{e(o.refreshPurchaseProductVariants(p))}),t({text:"Variant added successfully",type:"success"})):t({text:"Variant not added",description:c.error.message,type:"error"})}),e(o.refreshIsDuplicateVariant(!1))}function Ka(){e(o.refreshIsDuplicateVariant(!1)),u("addVariantCard")}function Qa(a){Se(a.purchase.purchaseId,{...a.formData,variantId:a.row.original.variantId}).then(n=>{n.error?t({text:n.error.message,type:"error"}):(e(o.refreshPurchaseProductVariants(i.purchaseProductVariants.map(c=>c.variantId===a.row.original.variantId?{...c,variantStockActions:[...c.variantStockActions||[],n]}:c))),t({text:"Stock action added successfully",type:"success"}))})}function Ya(a){be(a.stockAction.stockActionId,a.formData).then(n=>{n.error?t({text:n.error.message,type:"error"}):t({text:"Stock action updated successfully",type:"success"})})}function Xa(a,n){e(o.setIsVariantGridLoading(!0)),ke(a.stockActionId).then(c=>{e(o.setIsVariantsGridLoading(!1)),c?(d.getPurchaseProductVariantsHandler(s.selectedPurchase.purchaseId,i.selectedProduct.productId).then(p=>{e(o.setIsVariantGridLoading(!1)),e(o.refreshPurchaseProductVariants(p))}),K(n,i.purchasesProductsGridRequestModel),e(o.refreshPurchaseSummary({...i.purchaseSummary,unitsAmount:c.unitsAmount,expense:c.expense,valueAmount:c.valueAmount})),t({text:"Stock action deleted successfully",type:"success"})):t({text:c.error.message,type:"error"})})}function Za(a){ke(a.stockActionId).then(n=>{n.error?t({text:n.error.message,type:"error"}):(e(o.refreshPurchaseProducts(i.purchaseProducts.filter(c=>c.stockActionId!==a.stockActionId))),e(o.refreshPurchaseSummary({...i.purchaseSummary,unitsAmount:n.unitsAmount,expense:n.expense,valueAmount:n.valueAmount})),t({text:"Stock action deleted successfully",type:"success"}))})}function Ja(a){C(["manageProductCard","variantConfigurationCard"]),e(o.setIsVariantConfigurationCardLoading(!0)),e(o.setIsVariantOptionsGridLoading(!0)),e(o.setIsVariantPhotoGridLoading(!0)),Promise.all([d.getVariantDetailsHandler(a.variantId),d.getProductDetailsHandler(a.productId),d.getListOfTraitsWithOptionsForProductHandler(a.productId),d.getPurchaseProductVariantsHandler(s.selectedPurchase.purchaseId,a.productId)]).then(([n,c,p,g])=>{e(o.setIsVariantConfigurationCardLoading(!1)),e(o.setIsVariantOptionsGridLoading(!1)),e(o.setIsVariantPhotoGridLoading(!1)),e(o.refreshSelectedProduct(c)),n?(e(V.refreshSelectedVariant(n)),e(o.refreshVariantPhotos(n==null?void 0:n.photos)),e(o.setIsProductPhotoGridLoading(!0)),e(o.refreshPurchaseProductVariants(g)),d.getProductPhotosForVariantHandler(a.productId,a.variantId).then(I=>{e(o.setIsProductPhotoGridLoading(!1)),e(o.refreshProductPhotosForVariant(I))})):(t({text:"Variant not found",type:"error"}),u("variantConfigurationCard"))})}function et(a){e(o.setIsVariantConfigurationCardLoading(!0)),d.updateVariantDetailsHandler(a.variant.variantId,a.formattedData).then(n=>{e(o.setIsVariantConfigurationCardLoading(!1)),n?(e(V.refreshSelectedVariant(n)),t({text:"Variant updated successfully",type:"success"})):t({text:"Variant not updated",description:n.error.message,type:"error"})})}function at(a){e(o.setIsManageTraitsCardLoading(!0)),d.updateVariantTraitOptionsHandler(a.variant.variantId,a.submissionData).then(n=>{e(o.setIsManageTraitsCardLoading(!1)),n?(d.getProductVariantsHandler(i.selectedProduct.productId).then(c=>{e(V.refreshProductVariants(c))}),d.getVariantDetailsHandler(a.variant.variantId).then(c=>{e(V.refreshSelectedVariant(c))}),t({text:"Variant trait options updated successfully",type:"success"})):t({text:"Variant trait options not updated",description:n.error.message,type:"error"})})}function tt(a){e(o.setIsDisposeStockCardLoading(!0)),d.disposeVariantFromStockHandler(a.variant.variantId,a.formattedData).then(n=>{e(o.setIsDisposeStockCardLoading(!1)),t(n?{text:"Variant disposed successfully",type:"success"}:{text:"Variant not disposed",description:n.error.message,type:"error"})})}function rt(a){e(o.setIsVariantPhotosCardLoading(!0)),me(a).then(n=>{e(o.setIsVariantPhotosCardLoading(!1)),n.error?t({text:"Photo not uploaded",description:n.error.message,type:"error"}):(e(o.refreshVariantPhotos([...i.variantPhotos,n.data])),e(V.refreshSelectedVariant({...s.selectedVariant,photos:[...s.selectedVariant.photos,n.data]})),t({text:"Photo uploaded successfully",type:"success"}))})}function ot(a){d.attachProductPhotoToVariantHandler(s.selectedVariant.variantId,a.photoId).then(n=>{if(e(o.setIsVariantPhotosCardLoading(!1)),!n.error){const c=i.productPhotosForVariant.find(p=>p.photoId===a.photoId);if(c){const p=i.variantPhotos??[],g=p.some(I=>I.photoId===c.photoId)?p:[...p,c];e(o.refreshVariantPhotos(g)),e(o.refreshProductPhotosForVariant(i.productPhotosForVariant.filter(I=>I.photoId!==a.photoId)))}t({text:"Photo added to variant successfully",type:"success"})}})}async function st(a){await L({headerTitle:"Detach photo from variant",text:`You are about to detach photo from variant  "${s.selectedVariant.variantName}".`,primaryButtonValue:"Detach",secondaryButtonValue:"Cancel"})&&await d.detachVariantPhotoHandler(s.selectedVariant.variantId,a.photoId).then(c=>{if(c.error)t({text:"Photo not added to variant",description:c.error.message,type:"error"});else{const p=i.variantPhotos??[],g=p.find(I=>I.photoId===a.photoId);if(g){const I=i.productPhotosForVariant??[],w=I.some(Ce=>Ce.photoId===g.photoId)?I:[...I,g];e(o.refreshProductPhotosForVariant(w));const ne=p.filter(Ce=>Ce.photoId!==a.photoId);e(o.refreshVariantPhotos(ne))}t({text:"Photo was detached successfully",type:"success"})}})}function nt(a){d.changePhotoPositionForVariantHandler(s.selectedVariant.variantId,a.activeItem.photoId,a.newIndex).then(()=>{e(o.setIsVariantPhotoGridLoading(!0)),d.getVariantDetailsHandler(s.selectedVariant.variantId).then(n=>{e(o.setIsVariantPhotoGridLoading(!1)),e(V.refreshSelectedVariant(n)),e(o.refreshVariantPhotos(n==null?void 0:n.photos))})})}function it(){u("addStockCard",!0),e(o.setIsAddStockCardLoading(!0)),d.getCurrenciesListHandler().then(a=>{e(o.setIsAddStockCardLoading(!1)),e(V.refreshCurrenciesList(a))})}function dt(){u("disposeStockCard",!0)}function ct(a){u("variantHistoryCard",!0),e(o.setIsVariantHistoryCardLoading(!0)),e(o.setIsVariantHistoryGridLoading(!0)),Promise.all([d.getVariantStockHistoryHandler(a),d.getVariantDetailsHandler(a)]).then(([n,c])=>{const p=n.map(g=>({...g,createdDate:Ae(g.createdDate,"date")}));e(o.setIsVariantHistoryCardLoading(!1)),e(o.setIsVariantHistoryGridLoading(!1)),e(o.refreshVariantHistory(p)),e(V.refreshSelectedVariant(c))})}function ut(){u("manageTraitsCard",!0)}function lt(){u("createCategoryCard")}function pt(){u("createBrandCard")}function ht(){u("variantPhotosCard",!0)}function mt(){u("variantPhotosCard")}function Ct(){u("variantConfigurationCard")}function gt(){u("variantHistoryCard")}function Pt(a){d.getVariantDetailsHandler(a.variantId).then(n=>{e(V.refreshSelectedVariant(n)),e(V.refreshVariantPhotos(n.photos)),e(V.refreshActiveTab("products")),S(`${Ne.PRODUCTS}${Ne.MANAGE_VARIANTS}/${a==null?void 0:a.productId}`)})}function ft(a){u("selectPurchaseCard"),e(o.refreshSelectedPurchase(a))}function yt(a){e(o.setIsPurchaseGridLoading(!0)),O({...i.purchaseGridRequestModel,searchQuery:a}).then(n=>{if(n.error)return;const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.purchaseId===((g=i.selectedPurchase)==null?void 0:g.purchaseId)}});e(o.refreshPurchaseGridRequestModel({...n.data,items:c}))})}function xt(a){e(o.setIsPurchaseGridLoading(!0)),O({...i.purchaseGridRequestModel,filter:a}).then(n=>{if(n.error)return;const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.purchaseId===((g=i.selectedPurchase)==null?void 0:g.purchaseId)}});e(o.refreshPurchaseGridRequestModel({...n.data,items:c}))})}function It(a){return e(o.setIsSupplierCardLoading(!0)),l({date:a.selectedDate,supplierId:i.selectedCompany.companyId,documentNotes:a.purchaseNotes}).then(n=>{e(o.refreshSelectedPurchase(n.data)),e(o.setIsSupplierCardLoading(!1)),t(n?{text:j("SuccessMessages.PurchaseCreated"),type:"success"}:{text:n.error.message,type:"error"})})}function Lt(a){u("selectPurchaseCard",!0),O(a).then(n=>{if(n.error)return;const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.purchaseId===((g=i.selectedPurchase)==null?void 0:g.purchaseId)}});e(o.refreshPurchaseGridRequestModel({...n.data,items:c}))})}function Ht(){u("supplierCard",!0)}function Vt(){e(V.resetSelectedSupplier()),u("selectEntityCard",!0),i.countryCodes||J(),e(o.setIsSelectEntityCardLoading(!0)),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(a=>{e(o.setIsSelectEntityCardLoading(!1)),e(o.setIsSuppliersGridLoading(!1));const n=a.data.items.map(c=>{var p;return{...c,isSelected:c.companyId===((p=i.selectedCompany)==null?void 0:p.companyId)}});e(o.refreshCompaniesGridRequestModel({...a.data,items:n}))})}function vt(a){e(o.setIsSuppliersGridLoading(!0)),T({...i.companiesGridRequestModel,searchQuery:a}).then(n=>{e(o.setIsSuppliersGridLoading(!1));const c=n.data.items.map(p=>{var g;return{...p,isSelected:p.companyId===((g=i.selectedCompany)==null?void 0:g.companyId)}});e(o.refreshCompaniesGridRequestModel({...n.data,items:c}))})}function St(a){u("selectEntityCard"),e(o.refreshSelectedCompany(a))}function bt(){if(u("selectEntityCard",!0),i.companiesGridRequestModel===null)e(o.setIsSelectEntityCardLoading(!0)),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(a=>{e(o.setIsSelectEntityCardLoading(!1)),e(o.setIsSuppliersGridLoading(!1));const n=a.data.items.map(c=>{var p;return{...c,isSelected:c.companyId===((p=i.selectedCompany)==null?void 0:p.companyId)}});e(o.refreshCompaniesGridRequestModel({...a.data,items:n}))});else{const a=i.companiesGridRequestModel.items.map(n=>{var c;return{...n,isSelected:n.companyId===((c=i.selectedCompany)==null?void 0:c.companyId)}});e(o.refreshCompaniesGridRequestModel({...i.companiesGridRequestModel,items:a}))}}function kt(){u("supplierCard")}function Tt(){u("selectEntityCard")}function jt(){u("supplierConfigurationCard")}function Nt(a){e(o.setIsAddStockCardLoading(!0)),P({id:a.purchaseId,model:a.priceModel}).then(n=>{e(o.setIsAddStockCardLoading(!1)),H(a.purchaseId).then(c=>{e(o.refreshSelectedPurchase(c.data))}),n?(u("addStockCard"),t({text:"Stock increased successfully",type:"success"})):t({text:"Stock not increased",description:n.error.message,type:"error"})})}function Gt(){u("addStockCard"),e(o.resetSelectedPurchase())}function Dt(a){K(a,i.purchasesProductsGridRequestModel),se(a)}function Ft(a,n){n.activeTab==="purchaseProducts"?K(a,n.updates):E(n.updates).then(c=>{e(o.refreshVariantsForPurchaseGridRequestModel(c.data))})}function Mt(){u("createCompanyCard",!0),J()}function Ot(a){e(o.setIsCreateCompanyCardLoading(!0)),oe(a.company).then(n=>{n.error?t({text:n.error.details.message,type:"error"}):(a.image.uploadModels.map(c=>{c.contextId=n.data.companyId,e(o.setIsImageUploaderLoading(!0)),me(c).then(p=>{e(o.setIsImageUploaderLoading(!1)),t(p?{text:j("SuccessMessages.ImageAdded"),type:"success"}:{text:p.error.details.message,type:"error"})})}),re({companyId:n.data.companyId,model:a.address}).then(()=>{e(o.setIsCreateCompanyCardLoading(!1)),u("createCompanyCard"),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(c=>{e(o.setIsSuppliersGridLoading(!1));const p=c.data.items.map(g=>{var I;return{...g,isSelected:g.companyId===((I=i.selectedCompany)==null?void 0:I.companyId)}});e(o.refreshCompaniesGridRequestModel({...c.data,items:p}))})}),t({text:"Company created successfully",type:"success"}))})}function _t(){u("createCompanyCard")}function Bt(a){u("companyConfigurationCard",!0),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),J(),q(a.companyId).then(n=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(n.data))})}function At(a){e(o.setIsCompanyConfigurationCardLoading(!0)),Xe({companyId:i.managedCompany.companyId,model:a}).then(n=>{e(o.setIsCompanyConfigurationCardLoading(!1)),n.error?t({text:"Failed to update company",type:"error"}):(e(o.refreshManagedCompany(n.data)),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(c=>{e(o.setIsSuppliersGridLoading(!1));const p=c.data.items.map(g=>{var I;return{...g,isSelected:g.companyId===((I=i.selectedCompany)==null?void 0:I.companyId)}});e(o.refreshCompaniesGridRequestModel({...c.data,items:p}))}),t({text:"Company updated successfully",type:"success"}))})}async function Rt(a){await L({headerTitle:"Deleting company",text:`You are about to delete company ${a.companyName}.`,primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&(e(o.setIsCompanyConfigurationCardLoading(!0)),y(a.companyId).then(c=>{if(c.error){t({text:"Failed to delete company",type:"error"});return}else t({text:"Company deleted successfully",type:"info"}),u("companyConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.resetManagedCompany()),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(p=>{e(o.setIsSuppliersGridLoading(!1));const g=p.data.items.map(I=>{var w;return{...I,isSelected:I.companyId===((w=i.selectedCompany)==null?void 0:w.companyId)}});e(o.refreshCompaniesGridRequestModel({...p.data,items:g}))}),i.selectedCompany.companyId===i.managedCompany.companyId&&e(o.resetSelectedCompany())}))}function wt(){u("companyConfigurationCard"),e(o.resetManagedCompany())}function zt(){u("companyPhotosCard",!0)}async function qt(a){await L({headerTitle:"Deleting company photo",text:"You are about to delete company photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&M(a.photoId).then(c=>{const p=i.managedCompany.photos.filter(g=>g.photoId!==a.photoId);e(o.refreshManagedCompany({...i.managedCompany,photos:p})),e(o.setIsSuppliersGridLoading(!0)),T(i.companiesGridRequestModel).then(g=>{e(o.setIsSuppliersGridLoading(!1));const I=g.data.items.map(w=>{var ne;return{...w,isSelected:w.companyId===((ne=i.selectedCompany)==null?void 0:ne.companyId)}});e(o.refreshCompaniesGridRequestModel({...g.data,items:I}))}),c.error?t({text:"Photo not deleted",description:c.error.details.message,type:"error"}):t({text:"Photo deleted successfully",type:"success"})})}function Wt(a){u(a==="Company"?"companyPhotosCard":"locationPhotosCard")}function $t(a){u("locationConfigurationCard",!0),J(),e(a?o.refreshManagedLocation(a):o.resetManagedLocation())}function Et(a){e(o.setIsLocationConfigurationCardLoading(!0)),D({companyId:i.managedCompany.companyId,model:a}).then(n=>{var c;n.error?t({text:(c=n.error.data)==null?void 0:c.detail,type:"error"}):(u("locationConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),q(i.managedCompany.companyId).then(p=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(p.data))}),t({text:"Location added successfully",type:"success"}))})}function Ut(a){e(o.setIsLocationConfigurationCardLoading(!0)),aa(a.locationId).then(n=>{var c;n.error?t({text:(c=n.error.data)==null?void 0:c.detail,type:"error"}):(u("locationConfigurationCard"),e(o.setIsCompanyConfigurationCardLoading(!0)),e(o.setIsLocationsGridLoading(!0)),q(i.managedCompany.companyId).then(p=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.setIsLocationsGridLoading(!1)),e(o.refreshManagedCompany(p.data))}),t({text:"Location deleted successfully",type:"success"}))})}function Kt(){u("locationPhotosCard",!0)}function Qt(a){e(o.setIsLocationConfigurationCardLoading(!0)),ea({locationId:i.managedLocation.locationId,model:a}).then(n=>{e(o.setIsLocationConfigurationCardLoading(!1)),n.error?t({text:"Failed to update location",type:"error"}):(e(o.setIsCompanyConfigurationCardLoading(!0)),q(i.managedCompany.companyId).then(c=>{e(o.setIsCompanyConfigurationCardLoading(!1)),e(o.refreshManagedCompany(c.data))}),t({text:"Location updated successfully",type:"success"}))})}async function Yt(a){await L({headerTitle:"Deleting location photo",text:"You are about to delete location photo.",primaryButtonValue:"Delete",secondaryButtonValue:"Cancel"})&&M(a.photoId).then(c=>{const p=i.managedLocation.photos.filter(g=>g.photoId!==a.photoId);e(o.refreshManagedLocation({...i.managedLocation,photos:p})),c.error?t({text:"Photo not deleted",description:c.error.details.message,type:"error"}):t({text:"Photo deleted successfully",type:"success"})})}function Xt(){u("locationConfigurationCard"),e(o.resetManagedLocation())}function Zt(){u("selectPurchaseCard")}return{state:i,appState:h,productsState:s,productsService:d,getPurchaseProductsPageDataHandler:ta,getPurchasesProductsGridDataHandler:ra,getVariantsForPurchaseGridDataHandler:oa,getGridFiltersDataHandler:sa,addProductToPurchaseHandler:na,updatePurchaseProductHandler:ia,openCreateProductCardHandler:da,submitProductDataHandler:ca,openCreateProductCategoryCardHandler:ua,checkCategoryNameHandler:la,createProductCategoryHandler:pa,openCreateProductBrandCardHandler:ha,checkBrandNameHandler:ma,createProductBrandHandler:Ca,uploadCategoryOrBrandPhotoHandler:ga,closeProductConfigurationCardHandler:Pa,generateProductCodeHandler:fa,checkProductCodeHandler:ya,openPurchaseProductsCardHandler:xa,openManageProductCardHandler:Ia,manageProductDataHandler:La,manageProductPhotosHandler:Ha,uploadPhotoHandler:Va,changePhotoPositionHandler:va,deletePhotoHandler:Sa,setPhotoActivationStateHandler:ba,closeProductPhotosCardHandler:ka,openConnectImageCardHandler:Ta,imageActionsHandler:ja,attachImageToVariantHandler:Te,detachImageFromVariantHandler:je,closeConnectImageCardHandler:Na,manageProductTraitsHandler:Ga,addTraitHandler:Da,manageTraitHandler:Fa,setProductTraitsHandler:Ma,deleteTraitHandler:Oa,createTraitHandler:_a,updateTraitHandler:Ba,updateOptionHandler:Aa,addOptionHandler:Ra,deleteOptionHandler:wa,dndTraitOptionHandler:za,closeProductTraitConfigurationCardHandler:qa,openAddVariantCardHandler:Wa,addVariantGridActionHandler:$a,addVariantHandler:Ea,addDuplicatedVariantHandler:Ua,closeAddVariantCardHandler:Ka,addStockActionHandler:Qa,updateStockActionHandler:Ya,deleteStockActionHandler:Xa,deleteStockActionInGridHandler:Za,manageVariantHandler:Ja,updateVariantDetailsHandler:et,updateVariantTraitOptionsHandler:at,disposeFromStockHandler:tt,uploadPhotoToVariantHandler:rt,addPhotoToVariantHandler:ot,detachPhotoFromVariantHandler:st,dndVariantPhotoHandler:nt,openAddStockCardHandler:it,openDisposeStockCardHandler:dt,openVariantHistoryCardHandler:ct,openManageTraitsCardHandler:ut,closeCreateProductCategoryCardHandler:lt,closeCreateProductBrandCardHandler:pt,openVariantPhotosCardHandler:ht,closeVariantPhotosCardHandler:mt,closeVariantConfigurationCardHandler:Ct,closeVariantHistoryCardHandler:gt,navigateToManageVariantHandler:Pt,selectPurchaseHandler:ft,searchSupplierHandler:yt,filterSuppliersByDateHandle:xt,openSelectPurchaseCardHandler:Lt,openSupplierCardHandler:Ht,openSelectEntityCardHandler:Vt,searchEntityHandle:vt,selectCompanyHandle:St,detachSupplierHandler:bt,createPurchaseForSupplierHandler:It,closeSupplierCardHandler:kt,closeSelectEntityCardHandler:Tt,closeSupplierConfigurationCardHandler:jt,increaseStockAmountHandler:Nt,closeAddStockCardHandler:Gt,refreshPurchaseProductsTabHandler:Dt,gridRequestChangeHandler:Ft,openCreateEntityCardHandler:Mt,createCompanyHandler:Ot,closeCreateCompanyCardHandler:_t,manageCompanyHandler:Bt,updateCompanyHandler:At,deleteCompanyHandler:Rt,manageCompanyPhotosHandler:zt,closeCompanyConfigurationCardHandler:wt,deleteCompanyPhotoHandler:qt,closePhotosCardHandler:Wt,openLocationConfigurationCardHandler:$t,createLocationHandler:Et,deleteLocationHandler:Ut,manageLocationPhotosHandler:Kt,updateLocationHandler:Qt,deleteLocationPhotoHandler:Yt,closeLocationConfigurationCardHandler:Xt,closeSelectPurchaseCardHandler:Zt}}const ao="_purchaseProductsCard_1lsai_1",to="_purchaseProductsCardContent_1lsai_5",ro="_tabItemsWrapper_1lsai_5",oo="_tabItems_1lsai_5",so="_tabItemTrigger_1lsai_17",no="_tabBlock_1lsai_27",io="_purchaseSummary_1lsai_35",co="_purchaseSummaryTitle_1lsai_44",uo="_purchaseSummaryItems_1lsai_47",b={purchaseProductsCard:ao,purchaseProductsCardContent:to,tabItemsWrapper:ro,tabItems:oo,tabItemTrigger:so,tabBlock:no,purchaseSummary:io,purchaseSummaryTitle:co,purchaseSummaryItems:uo},lo="_productName_1bem4_1",po="_productCode_1bem4_5",ho="_productCategory_1bem4_13",mo="_productBrand_1bem4_13",ue={productName:lo,productCode:po,productCategory:ho,productBrand:mo},Co="_purchaseProducts_1w6nz_1",go="_purchaseProductsForm_1w6nz_1",Po="_purchaseFormItemTaxCurrency_1w6nz_12",fo="_purchaseFormItemNettoPrice_1w6nz_17",yo="_purchaseFormItemQuantity_1w6nz_22",xo="_purchaseProductsFormIcon_1w6nz_27",Io="_variantGridButtonBlock_1w6nz_32",Lo="_formItemsValid_1w6nz_36",Ho="_buttonValid_1w6nz_40",N={purchaseProducts:Co,purchaseProductsForm:go,purchaseFormItemTaxCurrency:Po,purchaseFormItemNettoPrice:fo,purchaseFormItemQuantity:yo,purchaseProductsFormIcon:xo,variantGridButtonBlock:Io,formItemsValid:Lo,buttonValid:Ho},Qe=Hr({nettoPrice:de(),currencyId:de().optional(),taxTypeId:de().optional(),unitsAmount:de()}),Le={nettoPrice:void 0,currencyId:void 0,taxTypeId:void 0,unitsAmount:void 0};function Ye({data:u,currencies:x,taxes:C,activeTab:i,isVariantGrid:s=!1,onSubmit:h,onDelete:d,onCancel:e}){const{form:t,isValid:S}=qe({values:u,defaultValues:Le,scheme:Qe,mode:$e.CHANGE});function L(){h(t.getValues())}return r.jsx("div",{className:N.purchaseProducts,children:r.jsxs(We,{form:t,className:N.purchaseProductsForm,defaultValues:Le,fullWidth:!0,hidePrimaryBtn:!0,hideSecondaryBtn:!0,onSubmit:h,onCancel:e,children:[r.jsx(Y,{name:"nettoPrice",className:N.purchaseFormItemNettoPrice,render:({field:m})=>r.jsx(ce,{className:N.purchaseFormItemNettoPrice,children:r.jsx(pe,{value:m.value,className:i==="connectProducts"&&m.value?N.formItemsValid:"",type:"number",min:0,minWidth:"100px",maxWidth:"100px",placeholder:"0"})})}),r.jsx(Me,{control:t.control,name:"currencyId",render:({field:m})=>r.jsx(ce,{className:N.purchaseFormItemTaxCurrency,children:r.jsx(he,{selected:(u==null?void 0:u.currencyId)||(m==null?void 0:m.value),className:i==="connectProducts"&&m.value?N.formItemsValid:"",placeholder:" ",items:x,hideFirstOption:!0,minWidth:"70px",maxWidth:"70px",onSelect:j=>{m.onChange(j),t.trigger("currencyId")}})})}),r.jsx(Me,{control:t.control,name:"taxTypeId",render:({field:m})=>r.jsx(ce,{className:N.purchaseFormItemTaxCurrency,children:r.jsx(he,{placeholder:" ",className:i==="connectProducts"&&m.value?N.formItemsValid:"",selected:m.value||(u==null?void 0:u.taxTypeId),items:C,hideFirstOption:!0,minWidth:"70px",maxWidth:"70px",onSelect:j=>{m.onChange(j),t.trigger("taxTypeId")}})})}),r.jsx(He,{className:N.purchaseProductsFormIcon,icon:rr}),r.jsx(Y,{name:"unitsAmount",className:N.purchaseFormItemTaxCurrency,render:({field:m})=>r.jsx(ce,{className:N.purchaseFormItemQuantity,children:r.jsx(pe,{value:m.value,className:i==="connectProducts"&&m.value?N.formItemsValid:"",type:"number",min:0,hideErrorMessage:!0,width:"80px",minWidth:"80px",maxWidth:"80px",placeholder:"0"})})}),s?r.jsxs("div",{className:N.variantGridButtonBlock,children:[r.jsx(F,{icon:Re,variant:"secondary",value:"Save"}),r.jsx(F,{icon:Ee,type:"button",variant:"secondary",disabled:!u.stockActionId,onClick:d})]}):r.jsx(F,{className:i==="connectProducts"&&S?N.buttonValid:"",style:{marginLeft:"10px"},value:i==="connectProducts"?"Add":"Update",variant:"ghost",type:"submit",disabled:i==="connectProducts"?!S:!1,onClick:()=>L()})]})})}function Vo({row:u,table:x,onAction:C}){return x.options.meta,r.jsxs(or,{children:[r.jsx(sr,{asChild:!0,children:r.jsxs(F,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[r.jsx(Vr,{}),r.jsx("span",{className:"sr-only",children:"Open menu"})]})}),r.jsxs(nr,{align:"start",className:"w-[160px]",children:[r.jsx(ee,{onClick:()=>C("addVariant",u),children:"Add additional variants"}),r.jsx(ee,{onClick:()=>C("manageVariant",u),children:"Manage variant"}),r.jsx(ee,{onClick:()=>C("transferToPurchase",u),children:"Transfer to purchase"}),r.jsx(ee,{onClick:()=>C("removeFromStock",u),children:"Remove from stock"}),r.jsx(ee,{onClick:()=>C("stockChangeHistory",u),children:"Stock change history"})]})]})}function vo(u,x,C,i){return[{accessorKey:"photo",header:"Image",minSize:56,maxSize:56,cell:({row:s})=>{const h=s.getValue("photo");return r.jsx(He,{icon:(h==null?void 0:h.thumbnailUrl)||Ue,className:"m-auto",style:{...!(h!=null&&h.thumbnailUrl)&&{padding:"10px"}},color:"#64748b",iconView:ir.BUTTON})}},{accessorKey:"variantCode",header:"Code",minSize:60,maxSize:60,cell:({row:s})=>r.jsx($,{delayDuration:200,text:s.getValue("variantCode"),children:r.jsx("span",{className:ue.productCode,children:s.getValue("variantCode")})})},{accessorKey:"variantName",header:"Product Name",minSize:150,cell:({row:s})=>r.jsx($,{delayDuration:200,text:s.getValue("variantName"),children:r.jsx("span",{className:ue.productName,children:s.getValue("variantName")})})},{accessorKey:"productCategory",header:"Category",minSize:100,cell:({row:s})=>{var d,e;const h=s.getValue("productCategory");return r.jsx($,{delayDuration:200,text:(h==null?void 0:h.categoryName)||"N/A",children:r.jsxs("div",{className:ue.productCategory,children:[((d=s.original.productCategory)==null?void 0:d.thumbnail)&&r.jsx("img",{src:(e=s.original.productCategory)==null?void 0:e.thumbnail,alt:s.original.productCategory.categoryName}),r.jsx("span",{children:(h==null?void 0:h.categoryName)||"N/A"})]})})}},{accessorKey:"brand",header:"Brand",minSize:60,cell:({row:s})=>{var d,e;const h=s.getValue("brand");return r.jsx($,{delayDuration:200,text:(h==null?void 0:h.brandName)||"N/A",children:r.jsx("div",{className:ue.productBrand,children:((d=s.original.brand)==null?void 0:d.thumbnail)&&r.jsx("img",{src:(e=s.original.brand)==null?void 0:e.thumbnail,alt:s.original.brand.brandName})})})}},{accessorKey:"traitOptions",header:"Details",minSize:60,maxSize:150,cell:({row:s})=>{const h=s.original.traitOptions||[],d=h.filter(t=>t.traitTypeId===2&&t.optionColor),e=h.filter(t=>t.traitTypeId===1&&t.optionName);return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[d.map((t,S)=>r.jsx("div",{style:{background:t.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${S}`)),e.map((t,S)=>r.jsx("span",{style:{fontSize:"0.875rem"},children:t.optionName},`size-${S}`))]})}},{accessorKey:"",minSize:500,maxSize:500,header:C==="connectProducts"?"Quantity to add":"Quantity in purchase",cell:({row:s})=>{const h=s.original.stockActionId,d={unitsAmount:s.original.unitsAmount,currencyId:Number(s.original.stockDocumentPrice.currencyId),taxTypeId:Number(s.original.stockDocumentPrice.taxTypeId),nettoPrice:s.original.stockDocumentPrice.netto};return r.jsx(Ye,{activeTab:C,taxes:Z(x,{text:"name",value:"id"}),currencies:Z(u,{text:"briefName",value:"id"}),data:d,onSubmit:e=>{i("updatePurchaseProduct",{data:e,stockActionId:h})}})}},{id:"rowActions",header:"",minSize:50,maxSize:50,cell:({row:s,table:h})=>r.jsx("div",{style:{display:"flex",justifyContent:"center"},children:r.jsx(Vo,{row:s,onAction:i,table:h})})}]}const So="_productName_zht6d_1",bo="_productCode_zht6d_5",ko="_noImageIcon_zht6d_9",To="_productCategory_zht6d_13",jo="_productBrand_zht6d_13",No="_gridButton_zht6d_26",Q={productName:So,productCode:bo,noImageIcon:ko,productCategory:To,productBrand:jo,gridButton:No};function Go(u,x,C,i){return[{accessorKey:"photo",header:"Image",minSize:80,maxSize:80,cell:({row:s,table:h})=>{const d=s.getValue("photo"),e=h.options.meta;return r.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>i("image",s.id,e==null?void 0:e.setLoadingRow),children:d?r.jsx("img",{src:(d==null?void 0:d.thumbnailUrl)||Tr,alt:s.getValue("variantName"),className:"object-cover rounded-md w-full h-full"}):r.jsx(He,{icon:Ue,className:Q.noImageIcon})})}},{accessorKey:"variantCode",header:"Code",minSize:70,maxSize:150,cell:({row:s})=>r.jsx($,{delayDuration:200,text:s.getValue("variantCode"),children:r.jsx("span",{className:Q.productCode,children:s.getValue("variantCode")})})},{accessorKey:"variantName",header:"Product Name",minSize:70,cell:({row:s})=>r.jsx($,{delayDuration:200,text:s.getValue("variantName"),children:r.jsx("span",{className:Q.productName,children:s.getValue("variantName")})})},{accessorKey:"productCategory",header:"Category",minSize:70,cell:({row:s})=>{var d,e;const h=s.getValue("productCategory");return r.jsx($,{delayDuration:200,text:(h==null?void 0:h.categoryName)||"N/A",children:r.jsxs("div",{className:Q.productCategory,children:[((d=s.original.productCategory)==null?void 0:d.thumbnail)&&r.jsx("img",{src:(e=s.original.productCategory)==null?void 0:e.thumbnail,alt:s.original.productCategory.categoryName}),r.jsx("span",{children:(h==null?void 0:h.categoryName)||"N/A"})]})})}},{accessorKey:"brand",header:"Brand",minSize:70,cell:({row:s})=>{var d,e;const h=s.getValue("brand");return r.jsx($,{delayDuration:200,text:(h==null?void 0:h.brandName)||"N/A",children:r.jsxs("div",{className:Q.productBrand,children:[((d=s.original.brand)==null?void 0:d.thumbnail)&&r.jsx("img",{src:(e=s.original.brand)==null?void 0:e.thumbnail,alt:s.original.brand.brandName}),r.jsx("span",{children:(h==null?void 0:h.brandName)||"N/A"})]})})}},{accessorKey:"traitOptions",header:"Details",minSize:60,maxSize:150,cell:({row:s})=>{const h=s.original.traitOptions||[],d=h.filter(t=>t.traitTypeId===2&&t.optionColor),e=h.filter(t=>t.traitTypeId===1&&t.optionName);return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[d.map((t,S)=>r.jsx("div",{style:{background:t.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${S}`)),e.map((t,S)=>r.jsx("span",{style:{fontSize:"0.875rem"},children:t.optionName},`size-${S}`))]})}},{id:"nettoPriceGroup",accessorKey:"",minSize:480,maxSize:480,header:()=>r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{style:{marginRight:"40px"},children:"Netto Price"}),r.jsx("span",{style:{marginRight:"22px"},children:"Currency"}),r.jsx("span",{style:{marginRight:"85px"},children:"Tax"}),r.jsx("span",{children:"Quantity"})]}),cell:({row:s})=>{const h=s.original.variantId;return r.jsx(Ye,{activeTab:C,taxes:Z(x,{text:"name",value:"id"}),currencies:Z(u,{text:"briefName",value:"id"}),onSubmit:d=>{i("addProductToPurchase",{data:d,variantId:h})}})}},{id:"manage",minSize:120,maxSize:120,cell:({row:s})=>r.jsx("div",{className:Q.gridButton,onClick:h=>h.stopPropagation(),children:r.jsx(F,{style:{marginLeft:"20px"},icon:Ve,value:"Manage",variant:"secondary",onClick:()=>i("navigateToManageVariant",s.original)})})}]}function Do({isLoading:u,isPurchaseProductsGridLoading:x,isProductsGridLoading:C,purchaseProductsGridRequestModel:i,variantsGridRequestModel:s,preferences:h,sortingOptions:d,brands:e,categories:t,colorsForFilter:S,sizesForFilter:L,variantsSkeletonQuantity:m,currencies:j,taxes:z,purchaseSummary:P,purchaseId:B,onAction:v}){var te,re,oe,q;const[G,M]=X.useState("purchaseProducts"),{translate:k}=Ke(),A=we(),R=Be(),O=le(ae.APP);function H(y){y!==G&&(M(y),R(o.refreshActiveTab(y)),y==="purchaseProducts"&&v("refreshPurchaseProductsTab",B),y==="connectProducts"&&v("refreshConnectProductsTab",B))}function l(y,D){switch(y){case"addProductToPurchase":v("addProductToPurchase",D);break;case"updatePurchaseProduct":v("updatePurchaseProduct",D);break;case"addVariant":v("addVariantGridAction",D.original);break;case"manageVariant":v("manageVariant",D.original);break;case"transferToPurchase":console.log("transferToPurchase");break;case"removeFromStock":v("deleteStockActionInGrid",D.original);break;case"stockChangeHistory":v("openVariantHistoryCard",D.original.variantId);break;case"navigateToManageVariant":v("navigateToManageVariant",D);break}}function T(y){const D=cr.merge({},O.preferences,y);R(ur.refreshPreferences(D)),A.updateUserPreferencesHandler(D)}function E(){A.resetUserPreferencesHandler("products")}return r.jsx(ze,{className:b.purchaseProductsCard,title:"Manage Purchases",titleTransKey:"CardTitles.ManagePurchases",showHeader:!1,isLoading:u,children:r.jsx("div",{className:b.purchaseProductsCardContent,children:r.jsxs(xr,{defaultValue:"purchaseProducts",onValueChange:H,children:[r.jsx("div",{className:b.tabItemsWrapper,children:r.jsxs(Ir,{className:b.tabItems,children:[r.jsxs("div",{children:[r.jsx(Ge,{className:b.tabItemTrigger,value:"purchaseProducts",children:r.jsxs("div",{className:b.tabBlock,children:[r.jsx(dr,{size:"16"})," ",k("TabLabels.PurchaseProducts")]})}),r.jsx(Ge,{className:b.tabItemTrigger,value:"connectProducts",children:r.jsxs("div",{className:b.tabBlock,children:[r.jsx(jr,{size:"16"}),k("TabLabels.ConnectProducts")]})})]}),r.jsx(F,{value:"Create Product",valueTransKey:"ProductActions.CreateProduct",icon:ve,variant:"info",onClick:()=>v("openCreateProductCard")})]})}),r.jsxs(De,{value:"purchaseProducts",children:[r.jsxs(Ie,{isLoading:x,className:b.purchaseProductsGrid,columns:vo(j,z,G,l),data:i.items,gridRequestModel:i,sortingItems:d,columnsPreferences:h,preferenceContext:"productReferences",skeletonQuantity:P==null?void 0:P.unitsAmount,onApplyColumns:T,onDefaultColumns:E,onGridRequestChange:y=>v("gridRequestChange",{updates:y,activeTab:G}),children:[r.jsx(ie,{items:e,columnName:k("SectionTitles.Brand"),getId:y=>y.brandId,getName:y=>y.brandName,selected:(te=i==null?void 0:i.filter)==null?void 0:te.brands}),r.jsx(ie,{items:t,columnName:k("SectionTitles.Category"),getId:y=>y.categoryId,getName:y=>y.categoryName,selected:(re=i==null?void 0:i.filter)==null?void 0:re.categories})]}),r.jsxs("div",{className:b.purchaseSummary,children:[r.jsx("span",{className:b.purchaseSummaryTitle,children:k("PurchaseForm.Labels.PurchaseSummary")}),r.jsxs("div",{className:b.purchaseSummaryItems,children:[r.jsxs("div",{children:[r.jsx("span",{className:b.purchaseSummaryTitle,children:k("PurchaseForm.Labels.Units")}),!fe.isNil(P==null?void 0:P.unitsAmount)&&r.jsx("span",{className:b.purchaseSummaryItem,children:`: ${P==null?void 0:P.unitsAmount}`})]}),r.jsxs("div",{children:[r.jsx("span",{className:b.purchaseSummaryTitle,children:k("PurchaseForm.Labels.Expense")}),!fe.isNil(P==null?void 0:P.expense)&&r.jsx("span",{className:b.purchaseSummaryItem,children:`: ${P==null?void 0:P.expense} ${P==null?void 0:P.currencyBrief}`})]}),r.jsxs("div",{children:[r.jsx("span",{className:b.purchaseSummaryTitle,children:k("PurchaseForm.Labels.ProjectedValue")}),!fe.isNil(P==null?void 0:P.valueAmount)&&r.jsx("span",{className:b.purchaseSummaryItem,children:`: ${P==null?void 0:P.valueAmount} ${P==null?void 0:P.currencyBrief}`})]})]})]})]}),r.jsx(De,{value:"connectProducts",children:r.jsxs(Ie,{isLoading:C,className:b.purchaseProductsGrid,columns:Go(j,z,G,l),data:s.items,gridRequestModel:s,sortingItems:d,columnsPreferences:h,preferenceContext:"productReferences",skeletonQuantity:m,onApplyColumns:T,onDefaultColumns:E,onGridRequestChange:y=>v("gridRequestChange",{updates:y,activeTab:G}),children:[r.jsx(ie,{items:e,columnName:k("SectionTitles.Brand"),getId:y=>y.brandId,getName:y=>y.brandName,selected:(oe=s==null?void 0:s.filter)==null?void 0:oe.brands}),r.jsx(ie,{items:t,columnName:k("SectionTitles.Category"),getId:y=>y.categoryId,getName:y=>y.categoryName,selected:(q=s==null?void 0:s.filter)==null?void 0:q.categories}),r.jsx(Fe,{traitOptions:S,traitType:"color"}),r.jsx(Fe,{traitOptions:L,traitType:"size"}),r.jsx(Lr,{context:"Deleted"})]})})]})})})}const Fo="_manageProductCard_1bv78_1",Mo="_manageProductCardContent_1bv78_1",Oo="_productDataBlock_1bv78_1",_o="_productDataBlockManage_1bv78_7",Bo="_productDataRow_1bv78_10",Ao="_productDataCell_1bv78_15",Ro="_traitsDataCell_1bv78_30",wo="_footerBlock_1bv78_38",zo="_productsForPurchaseForm_1bv78_42",f={manageProductCard:Fo,manageProductCardContent:Mo,productDataBlock:Oo,productDataBlockManage:_o,productDataRow:Bo,productDataCell:Ao,traitsDataCell:Ro,footerBlock:wo,productsForPurchaseForm:zo},qo="_purchaseProducts_1xbfo_1",Wo="_purchaseProductsForm_1xbfo_1",$o="_formItemsValid_1xbfo_17",U={purchaseProducts:qo,purchaseProductsForm:Wo,formItemsValid:$o};function Eo({data:u,currencies:x,taxes:C,activeTab:i,onSubmit:s,onDelete:h}){const{form:d}=qe({values:u,defaultValues:Le,scheme:Qe,mode:$e.SUBMIT});return r.jsx("div",{className:U.purchaseProducts,children:r.jsxs(We,{className:U.purchaseProductsForm,form:d,fullWidth:!0,primaryBtnProps:{value:"Save",icon:Re,variant:"secondary",minWidth:"fit-content",disabled:!d.formState.isValid},secondaryBtnProps:{value:null,icon:Ee,variant:"outline",minWidth:"fit-content",disabled:!(u!=null&&u.stockActionId)},onSubmit:s,onCancel:h,children:[r.jsx(Y,{className:U.formItem,name:"nettoPrice",render:({field:e})=>r.jsx(pe,{label:"Price",value:e.value,className:i==="connectProducts"&&e.value?U.formItemsValid:"",type:"number",onBeforeInput:t=>{/[0-9.,\-]/.test(t.nativeEvent.data??"")||t.preventDefault()},minWidth:"80px",maxWidth:"80px",placeholder:" "})}),r.jsx(Y,{name:"taxTypeId",render:({field:e})=>r.jsx(he,{label:"Tax",placeholder:" ",className:i==="connectProducts"&&e.value?U.formItemsValid:"",selected:e.value,items:C,hideFirstOption:!0,minWidth:"70px",maxWidth:"70px"})}),r.jsx(Y,{name:"currencyId",render:({field:e})=>r.jsx(he,{selected:e==null?void 0:e.value,items:x,className:i==="connectProducts"&&e.value?U.formItemsValid:"",label:"Currency",placeholder:" ",hideFirstOption:!0,minWidth:"80px",maxWidth:"80px"})}),r.jsx(Y,{name:"unitsAmount",render:({field:e})=>r.jsx(pe,{label:"Quantity",value:e.value,type:"number",onBeforeInput:t=>{/[0-9.,\-]/.test(t.nativeEvent.data??"")||t.preventDefault()},className:i==="connectProducts"&&e.value?U.formItemsValid:"",width:"70px",minWidth:"70px",maxWidth:"70px",placeholder:" "})})]})})}function Uo(u){return[{id:"add",header:"Add",minSize:100,maxSize:100,cell:({row:x,table:C})=>{const i=C.options.meta,s=h=>{h.stopPropagation(),h.preventDefault(),u("addRow",x.original)};return r.jsx("div",{onClick:h=>h.stopPropagation(),children:r.jsx(F,{icon:ve,onClick:s,disabled:i==null?void 0:i.isRowLoading(x.id)})})}},{accessorKey:"traitOptions",header:"Details",minSize:250,cell:({row:x})=>{const C=x.original.traitOptions||[],i=C.filter(h=>h.traitTypeId===2&&h.optionColor),s=C.filter(h=>h.traitTypeId===1&&h.optionName);return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",verticalAlign:"middle"},children:[i.map((h,d)=>r.jsx("div",{style:{background:h.optionColor,minWidth:"20px",minHeight:"20px",borderRadius:"50%",border:"2px solid #ccc"}},`color-${d}`)),s.map((h,d)=>r.jsx("span",{style:{fontSize:"0.875rem"},children:h.optionName},`size-${d}`))]})}},{id:"rowActions",header:"Actions",minSize:175,maxSize:175,cell:({row:x})=>r.jsx(F,{icon:Ve,value:"Manage Variant",variant:"secondary",onClick:()=>u("manageVariant",x.original)})}]}const xe={currencyId:void 0,nettoPrice:void 0,taxTypeId:void 0,unitsAmount:void 0};function Ko({isLoading:u,purchase:x,product:C,variants:i,currencies:s,taxes:h,isVariantGridLoading:d,productTraits:e,onAction:t}){var B,v,G,M,k,A,R,O;const[S,L]=X.useState([]),{translate:m}=Ke();X.useEffect(()=>{!i||i.length===0||L(i.map(H=>{var l;return{...H,id:H.variantId,expandableRows:((l=H.variantStockActions)==null?void 0:l.length)>0?H.variantStockActions:[xe]}}))},[i]);function j(H,l){switch(H){case"addRow":z(l.variantId);break;case"manageVariant":t("manageVariant",l);break;case"addStockAction":l.stockAction.stockActionId?t("updateStockAction",l):t("addStockAction",l);break}}function z(H){L(l=>l.map(T=>T.id===H?{...T,expandableRows:[...T.expandableRows||[],xe]}:T))}function P(H,l,T){return r.jsx("div",{className:f.productsForPurchaseForm,children:r.jsx(Eo,{data:l,taxes:Z(h,{text:"name",value:"id"}),currencies:Z(s,{text:"briefName",value:"id"}),isVariantGrid:!0,onSubmit:E=>{j("addStockAction",{purchase:x,row:H,formData:E,stockAction:l})},onDelete:()=>t("deleteStockAction",l)})})}return r.jsx(ze,{className:f.manageProductCard,title:m("CardTitles.ManageProductForPurchase",{date:Ae(x==null?void 0:x.date,"date")}),minWidth:"560px",maxWidth:"560px",isLoading:u,showFooter:!0,footerClassName:f.footerBlock,showPrimaryButton:!1,secondaryButtonTitle:"Back to Product list",secondaryButtonTitleTransKey:"ProductActions.BackToProductList",secondaryButtonProps:{icon:vr},onSecondaryButtonClick:()=>t("openPurchaseProductsCard"),children:r.jsxs("div",{className:f.manageProductCardContent,children:[r.jsxs("div",{className:`${f.productDataBlock} ${f.productDataBlockManage}`,children:[r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-title`,children:m("SectionTitles.Product")}),r.jsx(F,{className:f.productDataCell,value:"Manage Product",valueTransKey:"ProductActions.ManageProduct",icon:Ve,variant:"secondary",maxWidth:"160px",onClick:()=>t("manageProductData")})]}),r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-text`,children:m("ProductForm.Labels.ProductName")}),r.jsx("span",{className:`${f.productDataCell} she-text`,children:C==null?void 0:C.productName})]}),r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-text`,children:m("ProductForm.Labels.ProductCode")}),r.jsx("span",{className:`${f.productDataCell} she-text`,children:C==null?void 0:C.productCode})]}),r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-text`,children:m("SectionTitles.Category")}),r.jsxs("div",{className:f.productDataCell,children:[((B=C==null?void 0:C.productCategory)==null?void 0:B.thumbnail)&&r.jsx("img",{src:(v=C==null?void 0:C.productCategory)==null?void 0:v.thumbnail,alt:(G=C==null?void 0:C.productCategory)==null?void 0:G.categoryName}),r.jsx("span",{className:"she-text",children:(M=C==null?void 0:C.productCategory)==null?void 0:M.categoryName})]})]}),r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-text`,children:m("SectionTitles.Brand")}),r.jsxs("div",{className:f.productDataCell,children:[((k=C==null?void 0:C.brand)==null?void 0:k.thumbnail)&&r.jsx("img",{src:(A=C==null?void 0:C.brand)==null?void 0:A.thumbnail,alt:(R=C==null?void 0:C.brand)==null?void 0:R.brandName}),r.jsx("span",{className:"she-text",children:(O=C==null?void 0:C.brand)==null?void 0:O.brandName})]})]})]}),r.jsx(ye,{}),r.jsx("div",{className:f.productDataBlock,children:r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-title`,children:m("CardTitles.ProductPhotos")}),r.jsx(F,{className:f.productDataCell,icon:Sr,value:"Manage Photos",valueTransKey:"CardTitles.ManagePhotos",variant:"secondary",maxWidth:"160px",onClick:()=>t("manageProductPhotos")})]})}),r.jsx(ye,{}),r.jsx("div",{className:f.productDataBlock,children:r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-title`,children:(e==null?void 0:e.length)>0?m("ProductForm.Labels.ProductTraits"):m("ProductForm.Labels.ConfigureTraitsToCreateVariant")}),r.jsxs("div",{className:`${f.productDataCell} ${f.traitsDataCell}`,children:[(e==null?void 0:e.length)>0&&r.jsxs("span",{className:"she-text",children:[m("ProductForm.Labels.ProductDescribedByTraits")," ",e.map((H,l)=>r.jsxs(X.Fragment,{children:[r.jsx("b",{children:H.traitName}),l<e.length-1?", ":""]},H.traitId))]}),r.jsx(F,{icon:br,value:"Manage Traits",valueTransKey:"ProductActions.ManageTraits",variant:"secondary",minWidth:"160px",maxWidth:"160px",onClick:()=>t("manageProductTraits")})]})]})}),(e==null?void 0:e.length)>0&&r.jsxs(r.Fragment,{children:[r.jsx(ye,{}),r.jsx("div",{className:f.productDataBlock,children:r.jsxs("div",{className:f.productDataRow,children:[r.jsx("span",{className:`${f.productDataCell} she-title`,children:m("ProductActions.ManageVariants")}),r.jsx("div",{className:f.productDataCell,children:r.jsx(F,{icon:ve,value:"Create Variant",valueTransKey:"ProductActions.CreateVariant",variant:"secondary",minWidth:"160px",maxWidth:"160px",onClick:()=>t("openAddVariantCard",C)})})]})}),r.jsx("div",{children:r.jsx(Ie,{isLoading:d,data:S,columns:Uo(j),enableExpansion:!0,renderExpandedContent:P,createEmptyExpandableRow:()=>xe,showHeader:!1,onAction:j},S.length)})]})]})})}function Os(){var j,z,P,B,v,G,M,k,A,R,O;const{handleCardAction:u,handleMultipleCardActions:x,keepOnlyCards:C,createRefCallback:i}=qr({selectActiveCards:H=>H[ae.PURCHASE_PRODUCTS].activeCards,refreshAction:o.refreshActiveCards}),{state:s,appState:h,productsState:d,productsService:e,...t}=eo(u,x,C),S=Object.values(pr).map(H=>({value:H,description:hr[H]})),{purchaseId:L}=lr();X.useEffect(()=>{t.getPurchaseProductsPageDataHandler(L),t.getPurchasesProductsGridDataHandler(L)},[L]),X.useEffect(()=>{t.getGridFiltersDataHandler()},[]);async function m(H,l){switch(H){case"addProductToPurchase":t.addProductToPurchaseHandler(l,L);break;case"updatePurchaseProduct":t.updatePurchaseProductHandler(l,L);break;case"openCreateProductCard":t.openCreateProductCardHandler();break;case"submitProductData":t.submitProductDataHandler(l);break;case"openCreateProductCategoryCard":t.openCreateProductCategoryCardHandler();break;case"checkCategoryName":t.checkCategoryNameHandler(l);break;case"createProductCategory":t.createProductCategoryHandler(l);break;case"openCreateProductBrandCard":t.openCreateProductBrandCardHandler();break;case"checkBrandName":t.checkBrandNameHandler(l);break;case"createProductBrand":t.createProductBrandHandler(l);break;case"uploadCategoryOrBrandPhoto":t.uploadCategoryOrBrandPhotoHandler(l);break;case"closeProductConfigurationCard":t.closeProductConfigurationCardHandler();break;case"generateProductCode":t.generateProductCodeHandler();break;case"checkProductCode":t.checkProductCodeHandler(l);break;case"openPurchaseProductsCard":t.openPurchaseProductsCardHandler(L);break;case"openManageProductCard":t.openManageProductCardHandler();break;case"manageProductData":t.manageProductDataHandler();break;case"manageProductPhotos":t.manageProductPhotosHandler();break;case"changePhotoPosition":t.changePhotoPositionHandler(l);break;case"deletePhoto":t.deletePhotoHandler(l);break;case"activatePhoto":t.setPhotoActivationStateHandler(l);break;case"openConnectImageCard":t.openConnectImageCardHandler(l);break;case"imageActions":t.imageActionsHandler(l);break;case"closeProductPhotsCard":t.closeProductPhotosCardHandler();break;case"closeConnectImageCard":t.closeConnectImageCardHandler();break;case"manageProductTraits":t.manageProductTraitsHandler();break;case"addTrait":t.addTraitHandler();break;case"manageTrait":t.manageTraitHandler(l);break;case"setProductTraits":t.setProductTraitsHandler(l);break;case"deleteTrait":t.deleteTraitHandler(l);break;case"createTrait":t.createTraitHandler(l);break;case"updateTrait":t.updateTraitHandler(l);break;case"updateOption":t.updateOptionHandler(l);break;case"addOption":t.addOptionHandler();break;case"deleteOption":t.deleteOptionHandler(l);break;case"dndTraitOption":t.dndTraitOptionHandler(l);break;case"closeProductTraitConfigurationCard":t.closeProductTraitConfigurationCardHandler();break;case"openAddVariantCard":t.openAddVariantCardHandler(l);break;case"addVariantGridAction":t.addVariantGridActionHandler(l);break;case"addVariant":t.addVariantHandler(l,L);break;case"addDuplicatedVariant":t.addDuplicatedVariantHandler(l,L);break;case"closeAddVariantCard":t.closeAddVariantCardHandler();break;case"addStockAction":t.addStockActionHandler(l);break;case"updateStockAction":t.updateStockActionHandler(l);break;case"deleteStockAction":t.deleteStockActionHandler(l,L);break;case"deleteStockActionInGrid":t.deleteStockActionInGridHandler(l);break;case"manageVariant":t.manageVariantHandler(l);break;case"updateVariantDetails":t.updateVariantDetailsHandler(l);break;case"updateVariantTraitOptions":t.updateVariantTraitOptionsHandler(l);break;case"selectPurchase":t.selectPurchaseHandler(l);break;case"searchSupplier":t.searchSupplierHandler(l);break;case"filterSuppliersByDate":t.filterSuppliersByDateHandle(l);break;case"openSupplierCard":t.openSupplierCardHandler();break;case"openSelectPurchaseCard":t.openSelectPurchaseCardHandler(s.purchaseGridRequestModel);break;case"openSelectEntityCard":t.openSelectEntityCardHandler();break;case"searchEntity":t.searchEntityHandle(l);break;case"selectCompany":t.selectCompanyHandle(l);break;case"detachSupplier":t.detachSupplierHandler();break;case"createPurchase":t.createPurchaseForSupplierHandler(l);break;case"increaseStockAmount":t.increaseStockAmountHandler(l);break;case"closeAddStockCard":t.closeAddStockCardHandler();break;case"closeSelectPurchaseCard":t.closeSelectPurchaseCardHandler();break;case"closeSupplierCard":t.closeSupplierCardHandler();break;case"closeSelectEntityCard":t.closeSelectEntityCardHandler();break;case"closeSupplierConfigurationCard":t.closeSupplierConfigurationCardHandler();break;case"disposeFromStock":t.disposeFromStockHandler(l);break;case"uploadPhotoToVariant":t.uploadPhotoToVariantHandler(l);break;case"addPhotoToVariant":t.addPhotoToVariantHandler(l);break;case"detachPhotoFromVariant":t.detachPhotoFromVariantHandler(l);break;case"dndVariantPhoto":t.dndVariantPhotoHandler(l);break;case"openAddStockCard":t.openAddStockCardHandler();break;case"openCreateEntityCard":t.openCreateEntityCardHandler();break;case"createCompany":t.createCompanyHandler(l);break;case"closeCreateCompanyCard":t.closeCreateCompanyCardHandler();break;case"manageCompany":t.manageCompanyHandler(l);break;case"updateCompany":t.updateCompanyHandler(l);break;case"deleteCompany":t.deleteCompanyHandler(l);break;case"closeCompanyConfigurationCard":t.closeCompanyConfigurationCardHandler();break;case"manageCompanyPhotos":t.manageCompanyPhotosHandler();break;case"uploadPhoto":t.uploadPhotoHandler(l);break;case"deleteCompanyPhoto":t.deleteCompanyPhotoHandler(l);break;case"closePhotosCard":t.closePhotosCardHandler(l);break;case"openLocationConfigurationCard":t.openLocationConfigurationCardHandler(l);break;case"createLocation":t.createLocationHandler(l);break;case"updateLocation":t.updateLocationHandler(l);break;case"deleteLocation":t.deleteLocationHandler(l);break;case"manageLocationPhotos":t.manageLocationPhotosHandler();break;case"deleteLocationPhoto":t.deleteLocationPhotoHandler(l);break;case"closeLocationConfigurationCard":t.closeLocationConfigurationCardHandler();break;case"openDisposeStockCard":t.openDisposeStockCardHandler();break;case"openVariantHistoryCard":t.openVariantHistoryCardHandler(l);break;case"openManageTraitsCard":t.openManageTraitsCardHandler();break;case"closeCreateProductCategoryCard":t.closeCreateProductCategoryCardHandler();break;case"closeCreateProductBrandCard":t.closeCreateProductBrandCardHandler();break;case"openVariantPhotosCard":t.openVariantPhotosCardHandler();break;case"closeVariantPhotosCard":t.closeVariantPhotosCardHandler();break;case"closeVariantConfigurationCard":t.closeVariantConfigurationCardHandler();break;case"closeVariantHistoryCard":t.closeVariantHistoryCardHandler();break;case"navigateToManageVariant":t.navigateToManageVariantHandler(l);break;case"refreshPurchaseProductsTab":t.refreshPurchaseProductsTabHandler(l);break;case"gridRequestChange":t.gridRequestChangeHandler(L,l);break;case"refreshConnectProductsTab":t.getVariantsForPurchaseGridDataHandler();break}}return r.jsxs(kr,{className:_e.purchaseProductsPage,menuCollectionType:"purchases",menuTitle:"Report Purchase",itemId:Number(L),counter:d.purchaseCounters,activeCards:s.activeCards,children:[((j=s.activeCards)==null?void 0:j.includes("purchaseProductsCard"))&&r.jsx("div",{className:_e.purchaseProductsCard,ref:i("purchaseProductsCard"),children:r.jsx(Do,{isLoading:s.isPurchaseProductsCardLoading,isPurchaseProductsGridLoading:s.isPurchasesProductsGridLoading,isProductsGridLoading:s.isVariantsForPurchaseGridLoading,variantsGridRequestModel:s.variantsForPurchaseGridRequestModel,purchaseProductsGridRequestModel:s.purchasesProductsGridRequestModel,sortingOptions:S,preferences:h.preferences,brands:d.brands,categories:d.categories,colorsForFilter:d.colorsForFilter,sizesForFilter:d.sizesForFilter,variantsSkeletonQuantity:s.variantsForPurchaseGridRequestModel.pageSize,currencies:d.currenciesList,taxes:d.taxesList,purchaseSummary:s.purchaseSummary,purchaseId:L,onAction:m})}),((z=s.activeCards)==null?void 0:z.includes("manageProductCard"))&&r.jsx("div",{ref:i("manageProductCard"),children:r.jsx(Ko,{isLoading:s.isManageProductCardLoading,purchase:d.selectedPurchase,product:s.selectedProduct,variants:s.purchaseProductVariants,currencies:d.currenciesList,taxes:d.taxesList,isVariantGridLoading:s.isVariantGridLoading,productTraits:d.listOfTraitsWithOptionsForProduct,onAction:m})}),((P=s.activeCards)==null?void 0:P.includes("productConfigurationCard"))&&r.jsx("div",{ref:i("productConfigurationCard"),children:r.jsx(gr,{isLoading:s.isProductConfigurationCardLoading,product:s.selectedProduct,brandsList:d.brands,categoriesList:d.categories,countryCodesList:s.countryCodes,productCode:d.productCode,productId:(B=s.selectedProduct)==null?void 0:B.productId,showSecondaryButton:!0,onSecondaryButtonClick:()=>m("closeProductConfigurationCard"),onAction:m})}),s.activeCards.includes("createCategoryCard")&&r.jsx("div",{ref:i("createCategoryCard"),children:r.jsx(Pr,{isLoading:s.isCreateCategoryCardLoading,isPhotoUploaderLoading:d.isPhotoUploaderLoading,category:d.category,onAction:m})}),s.activeCards.includes("createBrandCard")&&r.jsx("div",{ref:i("createBrandCard"),children:r.jsx(fr,{isLoading:s.isCreateBrandCardLoading,isPhotoUploaderLoading:d.isPhotoUploaderLoading,brand:d.brand,onAction:m})}),s.activeCards.includes("productPhotosCard")&&r.jsx("div",{ref:i("productPhotosCard"),children:r.jsx(Nr,{isLoading:s.isProductPhotosCardLoading,isImageUploaderLoading:s.isImageUploaderLoading,isGridLoading:d.isProductPhotosLoading,data:d.productPhotos,productCounter:null,contextId:s.selectedProduct.productId,showCloseButton:!0,onAction:m})}),s.activeCards.includes("connectImageCard")&&r.jsx("div",{ref:i("connectImageCard"),children:r.jsx(Gr,{isLoading:s.isConnectImageCardLoading,isGridLoading:s.isVariantsGridLoading,variants:d.productVariants,selectedPhoto:s.selectedPhoto,onAction:m,onSecondaryButtonClick:()=>u("connectImageCard")})}),s.activeCards.includes("chooseVariantTraitsCard")&&r.jsx("div",{ref:i("chooseVariantTraitsCard"),children:r.jsx(Dr,{isLoading:s.isChooseVariantTraitsCardLoading,items:d.traits,selectedItems:d.listOfTraitsWithOptionsForProduct,onAction:m,onSecondaryButtonClick:()=>u("chooseVariantTraitsCard")})}),s.activeCards.includes("productTraitConfigurationCard")&&r.jsx("div",{ref:i("productTraitConfigurationCard"),children:r.jsx(Fr,{isLoading:s.isProductTraitConfigurationCardLoading,isGridLoading:s.isTraitOptionsGridLoading,data:s.colorOptionsGridRequestModel,selectedTrait:s.selectedTrait,typesOfTraits:d.typesOfTraits,onSecondaryButtonClick:()=>u("productTraitConfigurationCard"),onAction:m})}),s.activeCards.includes("addVariantCard")&&r.jsx("div",{ref:i("addVariantCard"),children:r.jsx(Mr,{isLoading:s.isAddVariantCardLoading,traits:d.listOfTraitsWithOptionsForProduct,isDuplicateVariant:s.isDuplicateVariant,onAction:m})}),s.activeCards.includes("variantConfigurationCard")&&r.jsx("div",{ref:i("variantConfigurationCard"),children:r.jsx(Or,{isLoading:s.isVariantConfigurationCardLoading,isVariantOptionsGridLoading:s.isVariantOptionsGridLoading,isVariantPhotoGridLoading:s.isVariantPhotoGridLoading,variant:d.selectedVariant,variantPhotos:s.variantPhotos,data:s.variantTraitsGridRequestModel,taxesList:d.taxesList,productCounter:d.productCounter,onAction:m,onGenerateProductCode:e.generateProductCodeHandler,onSecondaryButtonClick:()=>m("closeVariantConfigurationCard")})}),s.activeCards.includes("addStockCard")&&r.jsx("div",{ref:i("addStockCard"),children:r.jsx(_r,{isLoading:s.isAddStockCardLoading,taxTypes:d.taxesList,currencyTypes:d.currenciesList,variant:d.selectedVariant,purchase:s.selectedPurchase,onAction:m})}),s.activeCards.includes("selectPurchaseCard")&&r.jsx("div",{ref:i("selectPurchaseCard"),children:r.jsx(Br,{isLoading:s.setIsSelectPurchaseCardLoading,isGridLoading:s.setIsPurchaseGridLoading,purchases:s.purchaseGridRequestModel.items,onAction:m})}),s.activeCards.includes("supplierCard")&&r.jsx("div",{ref:i("supplierCard"),children:r.jsx(Wr,{isLoading:s.isSupplierCardLoading,selectedPurchase:d.selectedPurchase,selectedSupplier:s.selectedCompany,onAction:m})}),((v=s.activeCards)==null?void 0:v.includes("selectEntityCard"))&&r.jsx("div",{ref:i("selectEntityCard"),children:r.jsx(Er,{isLoading:s.isSelectEntityCardLoading,isGridLoading:s.isSuppliersGridLoading,entityName:"Company",entityCollection:(G=s.companiesGridRequestModel)==null?void 0:G.items,columns:$r({onAction:m}),onAction:m})}),s.activeCards.includes("createCompanyCard")&&r.jsx("div",{ref:i("createCompanyCard"),children:r.jsx(Ur,{isLoading:s.isCreateCompanyCardLoading,isPhotoUploaderLoading:s.isPhotoUploaderLoading,countryCodes:s.countryCodes,onAction:m})}),s.activeCards.includes("companyConfigurationCard")&&r.jsx("div",{ref:i("companyConfigurationCard"),children:r.jsx(Kr,{isLoading:s.isCompanyConfigurationCardLoading,isGridLoading:s.isLocationsGridLoading,company:s.managedCompany,countryCodes:s.countryCodes,onAction:m})}),s.activeCards.includes("companyPhotosCard")&&r.jsx("div",{ref:i("companyPhotosCard"),children:r.jsx(Oe,{isImageUploaderLoading:s.isPhotoUploaderLoading,data:(M=s.managedCompany)==null?void 0:M.photos,contextName:"Company",contextId:(k=s.managedCompany)==null?void 0:k.companyId,noDataText:"COMPANY HAS NO PHOTOS",showCloseButton:!0,columns:Qr({onAction:m}),onAction:m})}),s.activeCards.includes("locationConfigurationCard")&&r.jsx("div",{ref:i("locationConfigurationCard"),children:r.jsx(Yr,{isLoading:s.isCustomerAddressDetailsLoading,location:s.managedLocation,countryCodes:s.countryCodes,onAction:m})}),s.activeCards.includes("locationPhotosCard")&&r.jsx("div",{ref:i("locationPhotosCard"),children:r.jsx(Oe,{isImageUploaderLoading:s.isPhotoUploaderLoading,data:(A=s.managedLocation)==null?void 0:A.photos,contextName:"Location",contextId:(R=s.managedLocation)==null?void 0:R.locationId,noDataText:"LOCATION HAS NO PHOTOS",showCloseButton:!0,columns:Xr({onAction:m}),onAction:m})}),s.activeCards.includes("disposeStockCard")&&r.jsx("div",{ref:i("disposeStockCard"),children:r.jsx(Ar,{isLoading:s.isDisposeStockCardLoading,variant:d.selectedVariant,onAction:m,onSecondaryButtonClick:()=>u("disposeStockCard")})}),s.activeCards.includes("variantHistoryCard")&&r.jsx("div",{ref:i("variantHistoryCard"),children:r.jsx(Rr,{isLoading:s.isVariantHistoryCardLoading,isGridLoading:s.isVariantHistoryGridLoading,variant:d.selectedVariant,data:s.variantHistory,onAction:m})}),s.activeCards.includes("variantPhotosCard")&&r.jsx("div",{ref:i("variantPhotosCard"),children:r.jsx(wr,{isLoading:s.isVariantPhotosCardLoading,isVariantPhotoGridLoading:s.isVariantPhotoGridLoading,isProductPhotoGridLoading:s.isProductPhotoGridLoading,variantPhotos:s.variantPhotos,productPhotos:s.productPhotosForVariant,contextId:(O=d.selectedVariant)==null?void 0:O.variantId,onAction:m})}),s.activeCards.includes("manageTraitsCard")&&r.jsx("div",{ref:i("manageTraitsCard"),children:r.jsx(zr,{isLoading:s.isManageTraitsCardLoading,traits:d.listOfTraitsWithOptionsForProduct,variant:d.selectedVariant,onAction:m,onSecondaryButtonClick:()=>u("manageTraitsCard")})})]})}export{Os as PurchaseProductsPage};
