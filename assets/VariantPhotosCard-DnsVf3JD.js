import{j as e,K as Ve,L as De,e as k,Q as He,V as ne,r as _,o as A,f as Y,s as ue,I as Me,J as Ke,w as re,_ as Ge,D as Ae,aa as $e}from"./index-BgOJB3Ra.js";import{i as me,e as he,F as pe,a as xe,b as Ce,u as ze}from"./form-GLT8k_Jx.js";import{a as ge,b as je,c as Pe,d as fe,S as Se}from"./select-COj3wnSU.js";import{S as I,R as ke}from"./SheInput-D1_7mt6S.js";import{S as H}from"./SheGrid-hOUOr1Dk.js";import{S as R,a as Le}from"./SheForm-CScXrnf-.js";import{S as v}from"./SheCard-CCn2EH8C.js";import{u as $,I as ye}from"./useAppTranslation-CT98VBjh.js";import{E as Ue,W as We,M as Oe,l as Ee,B as qe,I as Qe,R as Je,L as Ye}from"./SheContextSidebar-DxIT1Qz7.js";import{P as V}from"./plus-CyuclygH.js";import{o as Q,n as B,u as _e,S as be,a as D}from"./types-mU7vaT1q.js";import{S as J}from"./SheSelect-Cn4D1Pp5.js";import{c as ce}from"./she-select-convertors-CdG-Ygpu.js";import{S as Xe,C as Ze}from"./SheDatePicker-Cnw2Ng_w.js";import{C as es}from"./trash-C8ichjcO.js";import{u as ss}from"./chevron-up-uQrm97uW.js";import{S as ts}from"./SheFileUploader-DQkikgYM.js";import{p as Ne}from"./placeholder-image-BgG3Yd5d.js";const as="_variantConfigurationCard_p7gad_1",os="_variantConfigurationCardContent_p7gad_1",ns="_variantConfigurationForm_p7gad_12",rs="_variantCodeFormRow_p7gad_17",cs="_priceFormRow_p7gad_27",is="_priceFormRowItem_p7gad_31",ls="_stockDetailsBlock_p7gad_48",ds="_buttonBlock_p7gad_53",us="_stockDetailsTitle_p7gad_61",ms="_stockBlock_p7gad_64",hs="_stockBlockRow_p7gad_68",ps="_stockBlockRowNumber_p7gad_76",xs="_variantGridBlock_p7gad_79",Cs="_variantGridBlockHeader_p7gad_84",gs="_expandableRow_p7gad_90",js="_expandableRowIcon_p7gad_96",Ps="_expandableRowText_p7gad_99",p={variantConfigurationCard:as,variantConfigurationCardContent:os,variantConfigurationForm:ns,variantCodeFormRow:rs,priceFormRow:cs,priceFormRowItem:is,stockDetailsBlock:ls,buttonBlock:ds,stockDetailsTitle:us,stockBlock:ms,stockBlockRow:hs,stockBlockRowNumber:ps,variantGridBlock:xs,variantGridBlockHeader:Cs,expandableRow:gs,expandableRowIcon:js,expandableRowText:Ps},fs=[{accessorKey:"optionColor",header:"Type",maxSize:100,minSize:100,cell:({row:o})=>e.jsx("span",{className:"she-text",children:o.original.optionColor===null?"Size":"Color"})},{accessorKey:"optionName",header:"Value",maxSize:150,minSize:150,cell:({row:o})=>e.jsx("div",{className:o.original.optionColor===null?"she-text":"",style:o.original.optionColor?{background:o.original.optionColor,width:"20px",height:"20px",borderRadius:"50%",alignSelf:"center"}:{alignSelf:"center"},children:o.original.optionColor===null?o.original.optionName:""})},{id:"traitName",header:"Name",minSize:100,cell:({row:o})=>e.jsx("div",{className:"she-text",children:o.original.traitName})}];function Ss({row:o,table:t,style:n,onAction:s}){const a=t.options.meta;return e.jsx("div",{style:n,children:e.jsxs(Ve,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(k,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(Ue,{}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(He,{align:"start",className:"w-[160px]",children:[e.jsx(ne,{onClick:()=>{queueMicrotask(()=>{s("detachFromVariant",o.id,a==null?void 0:a.setLoadingRow,o)})},children:"Detach photo"}),e.jsx(ne,{onClick:()=>{queueMicrotask(()=>{s("deletePhoto",o.id,a==null?void 0:a.setLoadingRow,o)})},children:"Delete photo"})]})]})})}const Te=o=>[{accessorKey:"thumbnailUrl",header:"Preview",minSize:80,maxSize:80,cell:({row:t,table:n})=>{const s=t.getValue("thumbnailUrl"),a=n.options.meta;return e.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>o("image",t.id,a==null?void 0:a.setLoadingRow),children:e.jsx("img",{src:s,alt:"photo",className:"object-cover rounded-md w-full h-full",onError:r=>{r.currentTarget.src=Ne}})})}},{accessorKey:"format",header:"Format",minSize:190,cell:({row:t})=>e.jsx("span",{className:"she-subtext",children:`${t.original.height}px x ${t.original.width}px`})},{id:"rowActions",header:"Actions",minSize:80,maxSize:80,cell:({row:t,table:n})=>e.jsx(Ss,{style:{paddingLeft:"30px"},row:t,onAction:o,table:n})}],ie=(o,t)=>{let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>o(...s),t)}};function Vt({isLoading:o,isVariantOptionsGridLoading:t,isVariantPhotoGridLoading:n,variant:s,variantPhotos:a,data:r,onAction:c,taxesList:u,productCounter:P,onGenerateProductCode:C,...f}){var Z,ee,se,te,ae;const[j,d]=_.useState({variantName:(s==null?void 0:s.variantName)||"",variantCode:(s==null?void 0:s.variantCode)||"",salePrice:{brutto:(Z=s==null?void 0:s.salePrice)==null?void 0:Z.brutto,netto:(ee=s==null?void 0:s.salePrice)==null?void 0:ee.netto,taxTypeId:((se=s==null?void 0:s.salePrice)==null?void 0:se.taxTypeId)||((te=u==null?void 0:u[0])==null?void 0:te.id)}}),{translate:m}=$(),h=fs,S=Te(Fe),g=me({defaultValues:j}),{setValue:N,register:F,getValues:W}=g,z=we(s==null?void 0:s.traitOptions),X=_.useRef((s==null?void 0:s.variantId)||null),w=_.useRef(!1),M=_.useRef(null),O=_.useRef(ie(()=>{w.current&&g.handleSubmit(L)()},1500));_.useEffect(()=>{O.current&&(O.current=ie(()=>{w.current&&g.handleSubmit(L)()},1500))},[s==null?void 0:s.variantId]),_.useEffect(()=>{var i,l,y,b;if(X.current!==(s==null?void 0:s.variantId)){X.current=(s==null?void 0:s.variantId)||null;const G={variantName:(s==null?void 0:s.variantName)||"",variantCode:(s==null?void 0:s.variantCode)||"",salePrice:{brutto:(i=s==null?void 0:s.salePrice)==null?void 0:i.brutto,netto:(l=s==null?void 0:s.salePrice)==null?void 0:l.netto,taxTypeId:((y=s==null?void 0:s.salePrice)==null?void 0:y.taxTypeId)||((b=u==null?void 0:u[0])==null?void 0:b.id)}};d(G),g.reset(G),w.current=!1}},[s==null?void 0:s.variantId,s,u,g]);function Ie(){C().then(i=>{g.setValue("variantCode",i.code,{shouldDirty:!0}),w.current=!0,g.handleSubmit(L)()})}function K(){const i=W(),l=j;(i.variantName!==l.variantName||i.variantCode!==l.variantCode||i.salePrice.netto!==l.salePrice.netto||i.salePrice.brutto!==l.salePrice.brutto||i.salePrice.taxTypeId!==l.salePrice.taxTypeId)&&(w.current=!0,O.current())}function L(i){var oe;if(!w.current)return;let l=typeof i.salePrice.netto=="string"?Number(i.salePrice.netto):i.salePrice.netto||0,y=typeof i.salePrice.brutto=="string"?Number(i.salePrice.brutto):i.salePrice.brutto||0;const b=i.salePrice.taxTypeId,G=((oe=u.find(Re=>Re.id===b))==null?void 0:oe.value)??0;M.current==="netto"?y=+(l*(1+G)).toFixed(2):M.current==="brutto"&&(l=+(y/(1+G)).toFixed(2)),N("salePrice.netto",l,{shouldDirty:!1}),N("salePrice.brutto",y,{shouldDirty:!1});const ve={...i,salePrice:{netto:l,brutto:y,taxTypeId:b}};s&&c("updateVariantDetails",{formattedData:ve,variant:s}),d({variantName:i.variantName||"",variantCode:i.variantCode||"",salePrice:{netto:l,brutto:y,taxTypeId:b}}),w.current=!1}function Fe(i,l,y,b){c("detachPhotoFromVariant",b.original),c("deletePhoto",b.original)}function we(i){return(i==null?void 0:i.map(l=>{const y=[];return l.isRemoved&&y.push({id:`${l.id}-removed`,type:"removed",message:m("ValidationMessages.TraitOptionRemoved")}),l.isMissing&&y.push({id:`${l.id}-missing`,type:"missing",message:m("ValidationMessages.TraitOptionMissingConfiguration")}),{...l,expandableRows:y}}))||[]}function Be(i){return e.jsx("div",{children:i.original.expandableRows.map(l=>e.jsxs("div",{className:p.expandableRow,children:[e.jsx(Y,{maxWidth:"20px",minWidth:"20px",className:p.expandableRowIcon,icon:Le}),e.jsx("span",{className:p.expandableRowText,children:l.message})]},l.id))})}return e.jsx(v,{className:p.variantConfigurationCard,title:"Manage Variant",titleTransKey:"CardTitles.ManageVariant",showCloseButton:!0,isLoading:o,showNotificationCard:!0,notificationCardProps:{title:"Delete Variant",titleTransKey:"CardTitles.DeleteVariant",text:"This variant will be deleted, it will no longer be available for sale but you will still see it in the orders where it sold",textTransKey:"ConfirmationMessages.DeleteVariant",onClick:()=>c("deleteVariant",s)},onSecondaryButtonClick:()=>c("closeVariantConfigurationCard"),...f,children:e.jsxs("div",{className:p.variantConfigurationCardContent,children:[e.jsx("div",{className:p.variantConfigurationForm,children:e.jsxs(R,{form:g,onSubmit:L,children:[e.jsx(R.Field,{name:"variantName",children:e.jsx(I,{label:"Optional Variant Name",labelTransKey:"ProductForm.Labels.OptionalVariantName",fullWidth:!0,onDelay:K})}),e.jsxs("div",{className:p.variantCodeFormRow,children:[e.jsx(R.Field,{name:"variantCode",label:m("ProductForm.Labels.VariantCode"),children:e.jsx("div",{children:e.jsx(I,{value:s==null?void 0:s.variantCode,...F("variantCode",{}),onDelay:K})})}),e.jsx(k,{icon:We,type:"button",variant:"outline",onClick:Ie})]}),e.jsxs("div",{className:p.priceFormRow,children:[e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(R.Field,{label:m("ProductForm.Labels.SalePriceNetto"),name:"salePrice.netto",children:e.jsx(I,{type:"number",step:"any",...F("salePrice.netto",{onChange:()=>{M.current="netto",K()}})})})}),e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(he,{control:g.control,name:"salePrice.taxTypeId",render:({field:i})=>e.jsxs(pe,{children:[e.jsx(xe,{children:m("ProductForm.Labels.VAT")}),e.jsxs(ge,{onValueChange:l=>{i.onChange(Number(l)),M.current="netto",K()},value:i.value?i.value.toString():"",children:[e.jsx(Ce,{children:e.jsx(je,{children:e.jsx(Pe,{placeholder:m("SelectOptions.SelectVAT")})})}),e.jsx(fe,{children:u==null?void 0:u.map(l=>e.jsx(Se,{value:l.id.toString(),children:e.jsx("div",{children:l.name})},l.id))})]})]})})}),e.jsx("div",{className:p.priceFormRowItem,children:e.jsx(R.Field,{label:m("ProductForm.Labels.SalePriceBrutto"),name:"salePrice.brutto",children:e.jsx(I,{type:"number",step:"any",...F("salePrice.brutto",{onChange:()=>{M.current="brutto",K()}})})})})]})]})}),e.jsx(A,{}),e.jsxs("div",{className:p.stockDetailsBlock,children:[e.jsxs("div",{className:p.buttonBlock,children:[e.jsx("span",{className:`${p.stockDetailsTitle} she-title`,children:m("SectionTitles.StockDetails")}),e.jsx(k,{value:"Add",valueTransKey:"CommonButtons.Add",icon:V,variant:"secondary",onClick:()=>c("openAddStockCard")}),e.jsx(k,{value:"Dispose",valueTransKey:"StockActions.Dispose",icon:Oe,variant:"secondary",maxWidth:"100px",minWidth:"100px",onClick:()=>c("openDisposeStockCard")}),e.jsx(k,{value:"History",valueTransKey:"CommonButtons.History",icon:Ee,variant:"secondary",maxWidth:"100px",minWidth:"100px",onClick:()=>c("openVariantHistoryCard",s.variantId)})]}),e.jsxs("div",{className:p.stockBlock,children:[e.jsxs("div",{className:p.stockBlockRow,children:[e.jsx("span",{className:"she-text",children:m("StockForm.Labels.CurrentlyInStock",{stockAmount:""})}),e.jsx("span",{className:p.stockBlockRowNumber,children:s==null?void 0:s.stockAmount})]}),e.jsxs("div",{className:p.stockBlockRow,children:[e.jsx("span",{className:"she-text",children:m("ProductForm.Labels.UnitsSold")}),e.jsx("span",{className:p.stockBlockRowNumber,children:s==null?void 0:s.soldUnits})]})]})]}),e.jsxs("div",{className:p.variantGridBlock,children:[e.jsxs("div",{className:p.variantGridBlockHeader,children:[e.jsx("span",{className:"she-title",children:m("ProductForm.Labels.VariantTraits")}),e.jsx(k,{value:"Manage",valueTransKey:"CommonButtons.Manage",icon:qe,variant:"secondary",onClick:()=>c("openManageTraitsCard")})]}),e.jsx("div",{children:e.jsx(H,{isLoading:t,showHeader:!1,columns:h,data:z,gridRequestModel:r,enableExpansion:!0,renderExpandedContent:Be})})]}),e.jsxs("div",{className:p.variantGridBlock,children:[e.jsxs("div",{className:p.variantGridBlockHeader,children:[e.jsx("span",{className:"she-title",children:m("ProductForm.Labels.VariantPhotos")}),e.jsx(k,{value:"Manage",valueTransKey:"CommonButtons.Manage",icon:Qe,variant:"secondary",onClick:()=>c("openVariantPhotosCard",s.variantId)})]}),((ae=s==null?void 0:s.photos)==null?void 0:ae.length)>0&&e.jsx("div",{children:e.jsx(H,{isLoading:n,enableDnd:!0,showHeader:!1,columns:S,data:a,gridRequestModel:r,skeletonQuantity:P==null?void 0:P.gallery,onNewItemPosition:(i,l)=>c("dndVariantPhoto",{newIndex:i,activeItem:l})})})]})]})})}const ks="_addStockCard_1db5a_1",ys="_addStockCardContent_1db5a_5",_s="_connectedPurchase_1db5a_27",bs="_connectedPurchaseInfo_1db5a_32",Ns="_connectedPurchaseHeader_1db5a_37",Ts="_connectedPurchaseHeaderTitle_1db5a_43",Is="_connectedPurchaseSupplier_1db5a_48",Fs="_supplierInfo_1db5a_54",ws="_supplierInfoImageWrapper_1db5a_59",Bs="_supplierInfoImage_1db5a_59",vs="_supplierInfoIcon_1db5a_70",Rs="_supplierInfoDetails_1db5a_77",Vs="_supplierInfoDetailsName_1db5a_81",Ds="_connectedPurchaseProductsSummary_1db5a_84",Hs="_connectedPurchaseProductsSummaryTitle_1db5a_91",Ms="_connectedPurchaseProductsSummaryHeaders_1db5a_95",Ks="_connectedPurchaseProductsSummaryInfo_1db5a_100",Gs="_unitsColumn_1db5a_105",As="_expenseColumn_1db5a_109",$s="_valueColumn_1db5a_112",zs="_purchaseDetails_1db5a_115",Ls="_purchaseDetailsButtonBlock_1db5a_120",Us="_cardButtonBlock_1db5a_129",x={addStockCard:ks,addStockCardContent:ys,connectedPurchase:_s,connectedPurchaseInfo:bs,connectedPurchaseHeader:Ns,connectedPurchaseHeaderTitle:Ts,connectedPurchaseSupplier:Is,supplierInfo:Fs,supplierInfoImageWrapper:ws,supplierInfoImage:Bs,supplierInfoIcon:vs,supplierInfoDetails:Rs,supplierInfoDetailsName:Vs,connectedPurchaseProductsSummary:Ds,connectedPurchaseProductsSummaryTitle:Hs,connectedPurchaseProductsSummaryHeaders:Ms,connectedPurchaseProductsSummaryInfo:Ks,unitsColumn:Gs,expenseColumn:As,valueColumn:$s,purchaseDetails:zs,purchaseDetailsButtonBlock:Ls,cardButtonBlock:Us},Ws="_addStockForm_15e7x_1",Os="_addStockFormRow_15e7x_7",le={addStockForm:Ws,addStockFormRow:Os},Es=Q({unitAmount:B().min(0,"Min value length 0"),priceModel:Q({price:B(),taxTypeId:B(),priceType:B().optional(),currencyId:B()})}),qs={unitAmount:void 0,priceModel:{price:void 0,taxTypeId:void 0,priceType:void 0,currencyId:void 0},purchaseId:void 0};function Qs({taxTypes:o,currencyTypes:t,onChange:n}){const{form:s}=_e({defaultValues:qs,scheme:Es,mode:ke.CHANGE});function a(r,c){setTimeout(()=>{n==null||n({unitsAmount:r.unitAmount,nettoPrice:r.priceModel.price,taxTypeId:r.priceModel.taxTypeId,currencyId:r.priceModel.currencyId},c)})}return e.jsxs(be,{form:s,className:le.addStockForm,hideFooter:!0,onChange:a,children:[e.jsxs("div",{className:le.addStockFormRow,children:[e.jsx(D,{name:"priceModel.price",render:({field:r})=>e.jsx(I,{value:r.value,label:"Purchase Price",labelTransKey:"PurchaseForm.Labels.PurchasePrice",placeholder:"enter price netto...",type:"number",minWidth:"150px"})}),e.jsx(D,{name:"priceModel.currencyId",render:({field:r})=>e.jsx(J,{items:t,selected:r.value,label:"Currency",placeholder:" ",hideFirstOption:!0,minWidth:"140px"})}),e.jsx(D,{name:"priceModel.taxTypeId",render:({field:r})=>e.jsx(J,{items:o,selected:r.value,label:"VAT",placeholder:" ",hideFirstOption:!0,minWidth:"40px"})})]}),e.jsx(D,{name:"unitAmount",render:({field:r})=>e.jsx(I,{value:r.value,label:"Units",type:"number",placeholder:"enter unit amount...",fullWidth:!0})})]})}function Dt({isLoading:o,variant:t,onAction:n,taxTypes:s,purchase:a,currencyTypes:r,...c}){var h,S,g,N;const[u,P]=_.useState(null),[C,f]=_.useState(void 0),{translate:j}=$();function d(F,W){var z;P((z=W.formState)==null?void 0:z.isValid),f(F)}function m(){const F={priceModel:{variantId:t.variantId,unitsAmount:C.unitsAmount,nettoPrice:C.nettoPrice,taxTypeId:C.taxTypeId,currencyId:C.currencyId},purchaseId:Number(a.purchaseId)};n("increaseStockAmount",F)}return e.jsx(v,{className:x.addStockCard,title:"Add product to stock",titleTransKey:"StockActions.AddProductToStock",description:`${j("SectionTitles.Product")}: "${t==null?void 0:t.variantName}"`,isLoading:o,showCloseButton:!0,showFooter:!1,onSecondaryButtonClick:()=>n("closeAddStockCard"),...c,children:e.jsxs("div",{className:x.addStockCardContent,children:[e.jsx(Qs,{currencyTypes:ce(r,{text:"name",value:"id"}),taxTypes:ce(s,{text:"name",value:"id"}),onChange:d}),e.jsx(A,{}),a?e.jsxs("div",{className:x.connectedPurchase,children:[e.jsxs("div",{className:x.connectedPurchaseInfo,children:[e.jsxs("div",{className:x.connectedPurchaseHeader,children:[e.jsxs("div",{className:x.connectedPurchaseHeaderTitle,children:[e.jsx("span",{className:"she-title",children:"Connected Purchase"}),e.jsxs("span",{className:"she-subtext",children:["If this is not the right purchase :"," "]})]}),e.jsx(k,{icon:Je,variant:"secondary",value:"Replace Purchase",onClick:()=>n("openSelectPurchaseCard")})]}),e.jsxs("div",{className:x.connectedPurchaseSupplier,children:[e.jsxs("div",{className:x.supplierInfo,children:[(h=a.supplier)!=null&&h.thumbnailUrl?e.jsx("div",{className:x.supplierInfoImageWrapper,children:e.jsx("img",{src:(S=a.supplier)==null?void 0:S.thumbnailUrl,alt:((g=a.supplier)==null?void 0:g.supplierName)||"Supplier",className:x.supplierInfoImage})}):e.jsx("div",{className:x.supplierInfoIcon,children:e.jsx(Y,{icon:ye,maxWidth:"30px"})}),e.jsxs("div",{className:x.supplierInfoDetails,children:[e.jsx("span",{className:x.supplierInfoDetailsName,children:(N=a.supplier)==null?void 0:N.supplierName}),e.jsx("span",{className:"she-text",children:ue(a.date,"date")})]})]}),e.jsx(k,{icon:Ye,variant:"ghost",value:"Purchase Details",txtColor:"#007AFF"})]})]}),e.jsxs("div",{className:x.connectedPurchaseProductsSummary,children:[e.jsx("span",{className:x.connectedPurchaseProductsSummaryTitle,children:"Products in purchase summary"}),e.jsx(A,{}),e.jsxs("div",{className:x.connectedPurchaseProductsSummaryHeaders,children:[e.jsx("span",{children:"Units"}),e.jsx("span",{children:"Expense"}),e.jsx("span",{children:"Projected value"})]}),e.jsx(A,{}),e.jsxs("div",{className:x.connectedPurchaseProductsSummaryInfo,children:[e.jsx("div",{className:x.unitsColumn,children:e.jsx("span",{children:a.unitsAmount})}),e.jsx("div",{className:x.expenseColumn,children:e.jsx("span",{children:`${a.expense} ${a.currencyBrief}`})}),e.jsx("div",{className:x.valueColumn,children:e.jsx("span",{children:`${a.orderValueAmount} ${a.currencyBrief}`})})]})]})]}):e.jsxs("div",{className:x.purchaseDetails,children:[e.jsx("span",{className:"she-title",children:"Purchase Details"}),e.jsx("span",{className:"she-text",children:"If you want to be able to track this stock change in the purchase section, please select the purchase this change is connected to."}),e.jsxs("div",{className:x.purchaseDetailsButtonBlock,children:[e.jsx(k,{icon:V,variant:"secondary",value:"Select Purchase",onClick:()=>n("openSelectPurchaseCard")}),e.jsx("span",{className:"she-text",children:"or"}),e.jsx(k,{icon:V,variant:"secondary",value:"Report Purchase",onClick:()=>n("openSupplierCard")})]})]}),e.jsx(A,{}),e.jsxs("div",{className:x.cardButtonBlock,children:[e.jsx(k,{icon:V,variant:"secondary",value:"Cancel",onClick:()=>n("closeAddStockCard")}),e.jsx(k,{icon:V,variant:"info",value:"Add to Stock",disabled:!a||!u,onClick:m})]})]})})}const Js="_selectPurchaseCardContent_32tmq_1",Ys={selectPurchaseCardContent:Js},Xs="_iconCheck_1wa1s_1",Zs={iconCheck:Xs};function et({onAction:o}){return[{id:"select",header:"Select",minSize:60,maxSize:60,cell:({row:t,table:n})=>{const s=n.options.meta;return e.jsx("div",{onClick:a=>a.stopPropagation(),children:e.jsx(k,{className:t.original.isSelected===!0?Zs.iconCheck:"",icon:t.original.isSelected===!0?Me:Ke,variant:"ghost",onClick:()=>o("selectPurchase",t.original),disabled:s==null?void 0:s.isRowLoading(t.id)})})}},{id:"Purchase",header:"Purchase",minSize:200,cell:({row:t})=>{var c,u,P;const n=(c=t.original.supplier)==null?void 0:c.thumbnailUrl,s=(u=t.original.supplier)==null?void 0:u.supplierName,a=(P=t.original.location)==null?void 0:P.address,r=t.original.date;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px",marginLeft:"-8px"},children:[e.jsx("div",{children:n?e.jsx("img",{src:n,alt:s||"Supplier",className:"object-cover rounded-md w-full h-full",style:{minWidth:"48px",height:"48px"}}):e.jsx("div",{style:{width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Y,{icon:ye,maxWidth:"30px"})})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsx(re,{delayDuration:200,text:s,className:"max-w-[calc(240px)] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-text",children:s})}),a&&e.jsx(re,{delayDuration:200,text:a,className:"max-w-[calc(240px)] overflow-hidden text-ellipsis whitespace-nowrap",children:e.jsx("span",{className:"she-subtext",children:a})}),r&&e.jsx("span",{className:"she-text",children:ue(r,"date")})]})]})}}]}function Ht({isLoading:o,isGridLoading:t,purchases:n,onAction:s}){return e.jsx(v,{title:"Select Purchase",showCloseButton:!0,isLoading:o,onSecondaryButtonClick:()=>s("closeSelectPurchaseCard"),children:e.jsxs("div",{className:Ys.selectPurchaseCardContent,children:[e.jsx(I,{isSearch:!0,fullWidth:!0,showClearBtn:!0,placeholder:"Search supplier...",onDelay:a=>s("searchSupplier",a),onClear:()=>s("searchSupplier",null)}),e.jsx(Xe,{mode:Ze.RANGE,icon:es,fullWidth:!0,showClearBtn:!0,placeholder:"Pick purchase date range",onSelectDate:a=>{s("filterSuppliersByDate",a?{dateFrom:a.from,dateTo:a.to}:{})},onClear:()=>{s("filterSuppliersByDate",null)}}),e.jsx(H,{isLoading:t,showHeader:!1,columns:et({onAction:s}),data:n,skeletonQuantity:10})]})})}const st={},de="field is required",tt=Q({unitAmount:B({required_error:de}).min(0,"min value length 0"),reason:B({required_error:de})}),E=[{value:1,text:"Damaged",textTransKey:"StockForm.Labels.Damaged"},{value:2,text:"Lost",textTransKey:"StockForm.Labels.Lost"},{value:3,text:"Broken",textTransKey:"StockForm.Labels.Broken"}];function Mt({isLoading:o,variant:t,onAction:n,onSecondaryButtonClick:s,...a}){const{translate:r}=$(),c={reason:E[0].value,unitAmount:0},{form:u}=_e({defaultValues:c,scheme:tt,mode:ke.CHANGE}),P=ze({control:u.control,name:"unitAmount"});function C(f){const j={...f,unitAmount:Number(f.unitAmount)};n==null||n("disposeFromStock",{variant:t,formattedData:j})}return e.jsx(v,{className:st.disposeStockCard,title:`${r("StockActions.Dispose")} ${t==null?void 0:t.variantName} ${r("SectionTitles.Product")}`,isLoading:o,showCloseButton:!0,showFooter:!0,primaryButtonTitle:"Dispose",primaryButtonTitleTransKey:"StockActions.Dispose",primaryButtonDisabled:!u.formState.isValid||Ge.isEqual(c,u.getValues())||Number(P)>Number(t==null?void 0:t.stockAmount),onPrimaryButtonClick:u.handleSubmit(C),onSecondaryButtonClick:s,...a,children:e.jsxs(be,{form:u,text:r("StockForm.Labels.CurrentlyInStock",{stockAmount:(t==null?void 0:t.stockAmount)||0},"Currently in stock"),headerPosition:Ae.LEFT,hideFooter:!0,children:[e.jsx(D,{name:"unitAmount",render:({field:f})=>e.jsx(I,{value:f.value,label:"Units",labelTransKey:"PurchaseForm.Labels.Units",placeholder:"enter amount of units...",placeholderTransKey:"PurchaseForm.Placeholders.Units",min:0,errorMessage:P>(t==null?void 0:t.stockAmount)&&"You try to dispose more units the you have in stock",type:"number",fullWidth:!0})}),e.jsx(D,{name:"reason",render:({field:f})=>e.jsx(J,{items:E,selected:f.value||E[0].value,label:"Reason",labelTransKey:"StockForm.Labels.Reason",fullWidth:!0,hideFirstOption:!0})})]})})}const at="_stockHistoryCard_10pfr_1",ot="_stockHistoryCardContent_10pfr_1",nt="_stockHistoryGrid_10pfr_1",q={stockHistoryCard:at,stockHistoryCardContent:ot,stockHistoryGrid:nt},rt=[{accessorKey:"amountUnit",header:"Units",minSize:60,maxSize:60,cell:({row:o})=>e.jsx("span",{className:"she-text",children:o.original.amountUnit})},{accessorKey:"actionType",header:"Action",minSize:100,maxSize:100,cell:({row:o})=>e.jsx("span",{className:"she-text",children:o.original.actionType})},{id:"createdDate",header:"Date",minSize:100,maxSize:100,cell:({row:o})=>e.jsx("span",{className:"she-text",children:o.original.createdDate})},{id:"status",header:"Status",minSize:100,cell:({row:o})=>e.jsx("span",{className:"she-text",children:e.jsx("span",{className:"she-text",children:`${o.original.stockDocument.DocumentType} ${o.original.stockDocument.DocumentId}`})})}];function Kt({isLoading:o,isGridLoading:t,variant:n,data:s,onAction:a,...r}){const{translate:c}=$();return e.jsx(v,{className:q.stockHistoryCard,title:c("CardTitles.StockHistory",{variantName:n==null?void 0:n.variantName}),showCloseButton:!0,showFooter:!0,isLoading:o,onSecondaryButtonClick:()=>a("closeVariantHistoryCard"),...r,children:e.jsx("div",{className:q.stockHistoryCardContent,children:e.jsx("div",{className:q.stockHistoryGrid,children:e.jsx(H,{isLoading:t,showHeader:!1,columns:rt,data:s})})})})}const ct="_manageTraitsCard_1tjgt_1",it="_manageTraitsCardContent_1tjgt_1",lt="_manageTraitsCardForm_1tjgt_1",U={manageTraitsCard:ct,manageTraitsCardContent:it,manageTraitsCardForm:lt};function Gt({isLoading:o,traits:t,variant:n,onAction:s,onSecondaryButtonClick:a,...r}){const{t:c}=ss(),u=(n==null?void 0:n.traitOptions)||[],P=t.reduce((d,m)=>{var S;const h=u.find(g=>g.traitName===m.traitName&&g.optionId!==null);return{...d,[m.traitId]:((S=h==null?void 0:h.optionId)==null?void 0:S.toString())||""}},{}),C=me({defaultValues:P}),f=Object.values(C.watch()).some(d=>!d);_.useEffect(()=>{if(n!=null&&n.traitOptions){const d=t.reduce((m,h)=>{var g;const S=u.find(N=>N.traitName===h.traitName&&N.optionId!==null);return{...m,[h.traitId]:((g=S==null?void 0:S.optionId)==null?void 0:g.toString())||""}},{});Object.entries(d).forEach(([m,h])=>{C.setValue(m,h)})}},[n,t,u]);function j(d){const h={options:Object.values(d).filter(S=>S!=="").map(S=>Number(S))};s("updateVariantTraitOptions",{variant:n,submissionData:h})}return e.jsx(v,{className:U.manageTraitsCard,title:"Manage Traits",titleTransKey:"CardTitles.ManageTraits",showCloseButton:!0,isLoading:o,showFooter:!0,primaryButtonProps:{value:"Save Changes",valueTransKey:"CommonButtons.SaveChanges",variant:"info",icon:$e,disabled:f},secondaryButtonTitle:"Cancel",secondaryButtonTitleTransKey:"CommonButtons.Cancel",onPrimaryButtonClick:C.handleSubmit(j),onSecondaryButtonClick:a,...r,children:e.jsxs("div",{className:U.manageTraitsCardContent,children:[e.jsx("div",{className:U.manageTraitsCardTextBlock,children:e.jsx("span",{className:"she-text",children:c("ProductForm.Labels.SelectTraitOptionsForVariant")})}),e.jsx("div",{children:e.jsx(R,{form:C,onSubmit:j,children:e.jsx("div",{className:U.manageTraitsCardForm,children:t.map(d=>e.jsx(he,{control:C.control,name:d.traitId.toString(),render:({field:m})=>e.jsxs(pe,{children:[e.jsx(xe,{children:d.traitName}),e.jsxs(ge,{onValueChange:m.onChange,value:m.value||"",children:[e.jsx(Ce,{children:e.jsx(je,{children:e.jsx(Pe,{placeholder:c("ProductForm.Placeholders.SelectTraitType",{traitType:d.traitTypeName.toLowerCase()})})})}),e.jsx(fe,{children:d.traitOptions.map(h=>e.jsx(Se,{value:h.optionId.toString(),children:d.traitTypeId===2?e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{style:{width:"20px",height:"20px",background:(h==null?void 0:h.optionColor)||"#ccc",marginRight:"8px",borderRadius:"2px"}}),h.optionName]}):h.optionName},h.optionId))})]})]})},d.traitId))})})})]})})}const dt="_variantPhotosCard_35wfr_1",ut="_variantPhotosCardContent_35wfr_1",mt="_managePhotos_35wfr_9",ht="_managePhotosTitle_35wfr_14",pt="_managePhotosGrid_35wfr_17",T={variantPhotosCard:dt,variantPhotosCardContent:ut,managePhotos:mt,managePhotosTitle:ht,managePhotosGrid:pt},xt=o=>[{accessorKey:"thumbnailUrl",header:"Preview",minSize:80,maxSize:80,cell:({row:t,table:n})=>{const s=t.getValue("thumbnailUrl"),a=n.options.meta;return e.jsx("div",{className:"relative w-12 h-12 cursor-pointer",onClick:()=>o("image",t.id,a==null?void 0:a.setLoadingRow),children:e.jsx("img",{src:s,alt:"photo",className:"object-cover rounded-md w-full h-full",onError:r=>{r.currentTarget.src=Ne}})})}},{accessorKey:"format",header:"Format",minSize:235,cell:({row:t})=>e.jsx("span",{className:"she-subtext",children:`${t.original.height}px x ${t.original.width}px`})},{id:"rowActions",header:"",minSize:55,maxSize:55,cell:({row:t})=>e.jsx(k,{icon:V,variant:"secondary",onClick:()=>o("addToVariant",t.id,void 0,t)})}];function At({isLoading:o,isVariantPhotoGridLoading:t,isProductPhotoGridLoading:n,variantPhotos:s,productPhotos:a,contextId:r,onAction:c,...u}){const{translate:P}=$();function C(j,d){switch(j){case"image":c("image",d);break;case"upload":c("uploadPhotoToVariant",d);break;case"delete":c("delete",d);break;case"detachFromVariant":c("detachPhotoFromVariant",d);break;case"addToVariant":c("addPhotoToVariant",d);break;case"dnd":const{newIndex:m,activeItem:h}=d;c("dndVariantPhoto",{newIndex:m,activeItem:h});break}}function f(j,d,m,h){switch(j){case"detachFromVariant":C("detachFromVariant",h.original);break;case"addToVariant":C("addToVariant",h.original);break}}return e.jsx(v,{className:T.variantPhotosCard,title:"Manage Photos",titleTransKey:"CardTitles.ManagePhotos",isLoading:o,showCloseButton:!0,showFooter:!1,onSecondaryButtonClick:()=>c("closeVariantPhotosCard"),...u,children:e.jsxs("div",{className:T.variantPhotosCardContent,children:[e.jsx(ts,{contextName:"variant",contextId:r,onUpload:j=>C("upload",j)}),e.jsxs("div",{className:T.managePhotos,children:[e.jsx("div",{className:`${T.managePhotosTitle} she-title`,children:e.jsx("span",{className:"she-title",children:P("ProductForm.Labels.VariantPhotos")})}),e.jsx("div",{className:T.managePhotosGrid,children:e.jsx(H,{isLoading:t,enableDnd:!0,showHeader:!1,columns:Te(f),data:s,gridRequestModel:s,customMessage:"VARIANT HAS NO PHOTO",customMessageTransKey:"ProductMessages.NoVariantPhotos",onNewItemPosition:(j,d)=>C("dnd",{newIndex:j,activeItem:d})})})]}),e.jsxs("div",{className:T.managePhotos,children:[e.jsx("div",{className:`${T.managePhotosTitle} she-title`,children:e.jsx("span",{className:"she-title",children:P("ProductForm.Labels.OtherProductPhotos")})}),e.jsx("div",{className:T.managePhotosGrid,children:e.jsx(H,{isLoading:n,enableDnd:!1,showHeader:!1,showColumnsHeader:!1,columns:xt(f),data:a,customMessage:!s&&!a?"PRODUCT HAS NO PHOTO":"All product photos are already attached to the variant.",customMessageTransKey:!s&&!a?"ProductMessages.NoPhotos":"ProductMessages.AllPhotosAttachedToVariant",gridRequestModel:a})})]})]})})}export{Dt as A,Mt as D,Gt as M,Ht as S,Vt as V,Kt as a,At as b};
